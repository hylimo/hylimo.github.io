import{N as mr,a8 as S0,h as Gi,x as _i,c as iv,z as Qs,p as ll,a0 as fl,o as hl,r as w0,O as E0,k as Gc,a2 as P0,b as M0,Y as ro,K as R0,ak as A0,R as $u,d as O0,ad as Cf,az as I0,ae as C0,B as Ga,u as T0,J as Yu,w as ku,j as Uu,n as D0,_ as x0}from"./framework.CDajJPzx.js";import{c as tu,g as rv,a as ov}from"./commonjsHelpers.DsqdWQfm.js";import{I as j0,T as Zi,N as sv,R as Nd,a as Fd,U as av,b as cv,S as bi,E as pl,c as uv,C as L0,L as Gu,g as N0,l as Xa,e as ms,d as F0,f as B0,h as V0,i as z0,j as q0,k as Tf,P as H0,D as K0,m as Df}from"./lspPlugin.Dc7u3h4q.js";import{r as dv,a as Le,b as lv,s as Su,c as Xi,t as Ji,C as $0,i as gl,L as jt,M as fn,d as kr,e as ts,B as hn,f as ml,g as fv,h as hv,j as pv,P as ei,k as gv,l as wa,D as Be,E as Wi,m as mv,n as Bd,o as Y0,p as k0,q as U0,u as Wa,R as yv,v as G0,w as X0,x as vv,y as W0,z as Z0,A as J0,F as Q0,G as eS,H as tS,T as nS,I as iS,J as rS,K as oS}from"./umlDiagramModule.CypNzXTp.js";import{M as xf}from"./index.D79tZ9oS.js";import{u as jf,o as sS,l as aS,a as cS,d as uS}from"./theme.gF1Kghr5.js";var Lf={};/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Nf;function yl(){if(Nf)return Lf;Nf=1;var n;return(function(e){(function(t){var i=typeof globalThis=="object"?globalThis:typeof tu=="object"?tu:typeof self=="object"?self:typeof this=="object"?this:u(),o=r(e);typeof i.Reflect<"u"&&(o=r(i.Reflect,o)),t(o,i),typeof i.Reflect>"u"&&(i.Reflect=e);function r(f,d){return function(c,l){Object.defineProperty(f,c,{configurable:!0,writable:!0,value:l}),d&&d(c,l)}}function s(){try{return Function("return this;")()}catch{}}function a(){try{return(0,eval)("(function() { return this; })()")}catch{}}function u(){return s()||a()}})(function(t,i){var o=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",s=r&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=r&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",u=typeof Object.create=="function",f={__proto__:[]}instanceof Array,d=!u&&!f,c={create:u?function(){return qn(Object.create(null))}:f?function(){return qn({__proto__:null})}:function(){return qn({})},has:d?function($,te){return o.call($,te)}:function($,te){return te in $},get:d?function($,te){return o.call($,te)?$[te]:void 0}:function($,te){return $[te]}},l=Object.getPrototypeOf(Function),p=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ii(),h=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pi(),g=typeof WeakMap=="function"?WeakMap:Io(),m=r?Symbol.for("@reflect-metadata:registry"):void 0,y=mn(),b=Lt(y);function v($,te,oe,ue){if(q(oe)){if(!ne($))throw new TypeError;if(!Z(te))throw new TypeError;return C($,te)}else{if(!ne($))throw new TypeError;if(!ve(te))throw new TypeError;if(!ve(ue)&&!q(ue)&&!ae(ue))throw new TypeError;return ae(ue)&&(ue=void 0),oe=X(oe),z($,te,oe,ue)}}t("decorate",v);function _($,te){function oe(ue,Me){if(!ve(ue))throw new TypeError;if(!q(Me)&&!ie(Me))throw new TypeError;J($,te,ue,Me)}return oe}t("metadata",_);function S($,te,oe,ue){if(!ve(oe))throw new TypeError;return q(ue)||(ue=X(ue)),J($,te,oe,ue)}t("defineMetadata",S);function E($,te,oe){if(!ve(te))throw new TypeError;return q(oe)||(oe=X(oe)),G($,te,oe)}t("hasMetadata",E);function O($,te,oe){if(!ve(te))throw new TypeError;return q(oe)||(oe=X(oe)),N($,te,oe)}t("hasOwnMetadata",O);function R($,te,oe){if(!ve(te))throw new TypeError;return q(oe)||(oe=X(oe)),U($,te,oe)}t("getMetadata",R);function w($,te,oe){if(!ve(te))throw new TypeError;return q(oe)||(oe=X(oe)),Q($,te,oe)}t("getOwnMetadata",w);function M($,te){if(!ve($))throw new TypeError;return q(te)||(te=X(te)),ce($,te)}t("getMetadataKeys",M);function I($,te){if(!ve($))throw new TypeError;return q(te)||(te=X(te)),we($,te)}t("getOwnMetadataKeys",I);function D($,te,oe){if(!ve(te))throw new TypeError;if(q(oe)||(oe=X(oe)),!ve(te))throw new TypeError;q(oe)||(oe=X(oe));var ue=ut(te,oe,!1);return q(ue)?!1:ue.OrdinaryDeleteMetadata($,te,oe)}t("deleteMetadata",D);function C($,te){for(var oe=$.length-1;oe>=0;--oe){var ue=$[oe],Me=ue(te);if(!q(Me)&&!ae(Me)){if(!Z(Me))throw new TypeError;te=Me}}return te}function z($,te,oe,ue){for(var Me=$.length-1;Me>=0;--Me){var ze=$[Me],Te=ze(te,oe,ue);if(!q(Te)&&!ae(Te)){if(!ve(Te))throw new TypeError;ue=Te}}return ue}function G($,te,oe){var ue=N($,te,oe);if(ue)return!0;var Me=pe(te);return ae(Me)?!1:G($,Me,oe)}function N($,te,oe){var ue=ut(te,oe,!1);return q(ue)?!1:V(ue.OrdinaryHasOwnMetadata($,te,oe))}function U($,te,oe){var ue=N($,te,oe);if(ue)return Q($,te,oe);var Me=pe(te);if(!ae(Me))return U($,Me,oe)}function Q($,te,oe){var ue=ut(te,oe,!1);if(!q(ue))return ue.OrdinaryGetOwnMetadata($,te,oe)}function J($,te,oe,ue){var Me=ut(oe,ue,!0);Me.OrdinaryDefineOwnMetadata($,te,oe,ue)}function ce($,te){var oe=we($,te),ue=pe($);if(ue===null)return oe;var Me=ce(ue,te);if(Me.length<=0)return oe;if(oe.length<=0)return Me;for(var ze=new h,Te=[],T=0,B=oe;T<B.length;T++){var H=B[T],P=ze.has(H);P||(ze.add(H),Te.push(H))}for(var A=0,x=Me;A<x.length;A++){var H=x[A],P=ze.has(H);P||(ze.add(H),Te.push(H))}return Te}function we($,te){var oe=ut($,te,!1);return oe?oe.OrdinaryOwnMetadataKeys($,te):[]}function K($){if($===null)return 1;switch(typeof $){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return $===null?1:6;default:return 6}}function q($){return $===void 0}function ae($){return $===null}function me($){return typeof $=="symbol"}function ve($){return typeof $=="object"?$!==null:typeof $=="function"}function L($,te){switch(K($)){case 0:return $;case 1:return $;case 2:return $;case 3:return $;case 4:return $;case 5:return $}var oe="string",ue=Ae($,s);if(ue!==void 0){var Me=ue.call($,oe);if(ve(Me))throw new TypeError;return Me}return j($)}function j($,te){var oe,ue,Me;{var ze=$.toString;if(re(ze)){var ue=ze.call($);if(!ve(ue))return ue}var oe=$.valueOf;if(re(oe)){var ue=oe.call($);if(!ve(ue))return ue}}throw new TypeError}function V($){return!!$}function F($){return""+$}function X($){var te=L($);return me(te)?te:F(te)}function ne($){return Array.isArray?Array.isArray($):$ instanceof Object?$ instanceof Array:Object.prototype.toString.call($)==="[object Array]"}function re($){return typeof $=="function"}function Z($){return typeof $=="function"}function ie($){switch(K($)){case 3:return!0;case 4:return!0;default:return!1}}function he($,te){return $===te||$!==$&&te!==te}function Ae($,te){var oe=$[te];if(oe!=null){if(!re(oe))throw new TypeError;return oe}}function Oe($){var te=Ae($,a);if(!re(te))throw new TypeError;var oe=te.call($);if(!ve(oe))throw new TypeError;return oe}function ye($){return $.value}function Se($){var te=$.next();return te.done?!1:te}function Ie($){var te=$.return;te&&te.call($)}function pe($){var te=Object.getPrototypeOf($);if(typeof $!="function"||$===l||te!==l)return te;var oe=$.prototype,ue=oe&&Object.getPrototypeOf(oe);if(ue==null||ue===Object.prototype)return te;var Me=ue.constructor;return typeof Me!="function"||Me===$?te:Me}function Xe(){var $;!q(m)&&typeof i.Reflect<"u"&&!(m in i.Reflect)&&typeof i.Reflect.defineMetadata=="function"&&($=mt(i.Reflect));var te,oe,ue,Me=new g,ze={registerProvider:Te,getProvider:B,setProvider:P};return ze;function Te(A){if(!Object.isExtensible(ze))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case $===A:break;case q(te):te=A;break;case te===A:break;case q(oe):oe=A;break;case oe===A:break;default:ue===void 0&&(ue=new h),ue.add(A);break}}function T(A,x){if(!q(te)){if(te.isProviderFor(A,x))return te;if(!q(oe)){if(oe.isProviderFor(A,x))return te;if(!q(ue))for(var k=Oe(ue);;){var Y=Se(k);if(!Y)return;var ee=ye(Y);if(ee.isProviderFor(A,x))return Ie(k),ee}}}if(!q($)&&$.isProviderFor(A,x))return $}function B(A,x){var k=Me.get(A),Y;return q(k)||(Y=k.get(x)),q(Y)&&(Y=T(A,x),q(Y)||(q(k)&&(k=new p,Me.set(A,k)),k.set(x,Y))),Y}function H(A){if(q(A))throw new TypeError;return te===A||oe===A||!q(ue)&&ue.has(A)}function P(A,x,k){if(!H(k))throw new Error("Metadata provider not registered.");var Y=B(A,x);if(Y!==k){if(!q(Y))return!1;var ee=Me.get(A);q(ee)&&(ee=new p,Me.set(A,ee)),ee.set(x,k)}return!0}}function mn(){var $;return!q(m)&&ve(i.Reflect)&&Object.isExtensible(i.Reflect)&&($=i.Reflect[m]),q($)&&($=Xe()),!q(m)&&ve(i.Reflect)&&Object.isExtensible(i.Reflect)&&Object.defineProperty(i.Reflect,m,{enumerable:!1,configurable:!1,writable:!1,value:$}),$}function Lt($){var te=new g,oe={isProviderFor:function(H,P){var A=te.get(H);return q(A)?!1:A.has(P)},OrdinaryDefineOwnMetadata:Te,OrdinaryHasOwnMetadata:Me,OrdinaryGetOwnMetadata:ze,OrdinaryOwnMetadataKeys:T,OrdinaryDeleteMetadata:B};return y.registerProvider(oe),oe;function ue(H,P,A){var x=te.get(H),k=!1;if(q(x)){if(!A)return;x=new p,te.set(H,x),k=!0}var Y=x.get(P);if(q(Y)){if(!A)return;if(Y=new p,x.set(P,Y),!$.setProvider(H,P,oe))throw x.delete(P),k&&te.delete(H),new Error("Wrong provider for target.")}return Y}function Me(H,P,A){var x=ue(P,A,!1);return q(x)?!1:V(x.has(H))}function ze(H,P,A){var x=ue(P,A,!1);if(!q(x))return x.get(H)}function Te(H,P,A,x){var k=ue(A,x,!0);k.set(H,P)}function T(H,P){var A=[],x=ue(H,P,!1);if(q(x))return A;for(var k=x.keys(),Y=Oe(k),ee=0;;){var de=Se(Y);if(!de)return A.length=ee,A;var _e=ye(de);try{A[ee]=_e}catch(Pe){try{Ie(Y)}finally{throw Pe}}ee++}}function B(H,P,A){var x=ue(P,A,!1);if(q(x)||!x.delete(H))return!1;if(x.size===0){var k=te.get(P);q(k)||(k.delete(A),k.size===0&&te.delete(k))}return!0}}function mt($){var te=$.defineMetadata,oe=$.hasOwnMetadata,ue=$.getOwnMetadata,Me=$.getOwnMetadataKeys,ze=$.deleteMetadata,Te=new g,T={isProviderFor:function(B,H){var P=Te.get(B);return!q(P)&&P.has(H)?!0:Me(B,H).length?(q(P)&&(P=new h,Te.set(B,P)),P.add(H),!0):!1},OrdinaryDefineOwnMetadata:te,OrdinaryHasOwnMetadata:oe,OrdinaryGetOwnMetadata:ue,OrdinaryOwnMetadataKeys:Me,OrdinaryDeleteMetadata:ze};return T}function ut($,te,oe){var ue=y.getProvider($,te);if(!q(ue))return ue;if(oe){if(y.setProvider($,te,b))return b;throw new Error("Illegal state.")}}function ii(){var $={},te=[],oe=(function(){function T(B,H,P){this._index=0,this._keys=B,this._values=H,this._selector=P}return T.prototype["@@iterator"]=function(){return this},T.prototype[a]=function(){return this},T.prototype.next=function(){var B=this._index;if(B>=0&&B<this._keys.length){var H=this._selector(this._keys[B],this._values[B]);return B+1>=this._keys.length?(this._index=-1,this._keys=te,this._values=te):this._index++,{value:H,done:!1}}return{value:void 0,done:!0}},T.prototype.throw=function(B){throw this._index>=0&&(this._index=-1,this._keys=te,this._values=te),B},T.prototype.return=function(B){return this._index>=0&&(this._index=-1,this._keys=te,this._values=te),{value:B,done:!0}},T})(),ue=(function(){function T(){this._keys=[],this._values=[],this._cacheKey=$,this._cacheIndex=-2}return Object.defineProperty(T.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),T.prototype.has=function(B){return this._find(B,!1)>=0},T.prototype.get=function(B){var H=this._find(B,!1);return H>=0?this._values[H]:void 0},T.prototype.set=function(B,H){var P=this._find(B,!0);return this._values[P]=H,this},T.prototype.delete=function(B){var H=this._find(B,!1);if(H>=0){for(var P=this._keys.length,A=H+1;A<P;A++)this._keys[A-1]=this._keys[A],this._values[A-1]=this._values[A];return this._keys.length--,this._values.length--,he(B,this._cacheKey)&&(this._cacheKey=$,this._cacheIndex=-2),!0}return!1},T.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=$,this._cacheIndex=-2},T.prototype.keys=function(){return new oe(this._keys,this._values,Me)},T.prototype.values=function(){return new oe(this._keys,this._values,ze)},T.prototype.entries=function(){return new oe(this._keys,this._values,Te)},T.prototype["@@iterator"]=function(){return this.entries()},T.prototype[a]=function(){return this.entries()},T.prototype._find=function(B,H){if(!he(this._cacheKey,B)){this._cacheIndex=-1;for(var P=0;P<this._keys.length;P++)if(he(this._keys[P],B)){this._cacheIndex=P;break}}return this._cacheIndex<0&&H&&(this._cacheIndex=this._keys.length,this._keys.push(B),this._values.push(void 0)),this._cacheIndex},T})();return ue;function Me(T,B){return T}function ze(T,B){return B}function Te(T,B){return[T,B]}}function Pi(){var $=(function(){function te(){this._map=new p}return Object.defineProperty(te.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),te.prototype.has=function(oe){return this._map.has(oe)},te.prototype.add=function(oe){return this._map.set(oe,oe),this},te.prototype.delete=function(oe){return this._map.delete(oe)},te.prototype.clear=function(){this._map.clear()},te.prototype.keys=function(){return this._map.keys()},te.prototype.values=function(){return this._map.keys()},te.prototype.entries=function(){return this._map.entries()},te.prototype["@@iterator"]=function(){return this.keys()},te.prototype[a]=function(){return this.keys()},te})();return $}function Io(){var $=16,te=c.create(),oe=ue();return(function(){function B(){this._key=ue()}return B.prototype.has=function(H){var P=Me(H,!1);return P!==void 0?c.has(P,this._key):!1},B.prototype.get=function(H){var P=Me(H,!1);return P!==void 0?c.get(P,this._key):void 0},B.prototype.set=function(H,P){var A=Me(H,!0);return A[this._key]=P,this},B.prototype.delete=function(H){var P=Me(H,!1);return P!==void 0?delete P[this._key]:!1},B.prototype.clear=function(){this._key=ue()},B})();function ue(){var B;do B="@@WeakMap@@"+T();while(c.has(te,B));return te[B]=!0,B}function Me(B,H){if(!o.call(B,oe)){if(!H)return;Object.defineProperty(B,oe,{value:c.create()})}return B[oe]}function ze(B,H){for(var P=0;P<H;++P)B[P]=Math.random()*255|0;return B}function Te(B){if(typeof Uint8Array=="function"){var H=new Uint8Array(B);return typeof crypto<"u"?crypto.getRandomValues(H):typeof msCrypto<"u"?msCrypto.getRandomValues(H):ze(H,B),H}return ze(new Array(B),B)}function T(){var B=Te($);B[6]=B[6]&79|64,B[8]=B[8]&191|128;for(var H="",P=0;P<$;++P){var A=B[P];(P===4||P===6||P===8)&&(H+="-"),A<16&&(H+="0"),H+=A.toString(16).toLowerCase()}return H}}function qn($){return $.__=void 0,delete $.__,$}})})(n||(n={})),Lf}yl();const dS={__name:"splitpanes",props:{horizontal:{type:Boolean,default:!1},pushOtherPanes:{type:Boolean,default:!0},maximizePanes:{type:Boolean,default:!0},rtl:{type:Boolean,default:!1},firstSplitter:{type:Boolean,default:!1}},emits:["ready","resize","resized","pane-click","pane-maximize","pane-add","pane-remove","splitter-click","splitter-dblclick"],setup(n,{emit:e}){const t=e,i=n,o=P0(),r=_i([]),s=Gi(()=>r.value.reduce((L,j)=>(L[~~j.id]=j)&&L,{})),a=Gi(()=>r.value.length),u=_i(null),f=_i(!1),d=_i({mouseDown:!1,dragging:!1,activeSplitter:null,cursorOffset:0}),c=_i({splitter:null,timeoutId:null}),l=Gi(()=>({[`splitpanes splitpanes--${i.horizontal?"horizontal":"vertical"}`]:!0,"splitpanes--dragging":d.value.dragging})),p=()=>{document.addEventListener("mousemove",m,{passive:!1}),document.addEventListener("mouseup",y),"ontouchstart"in window&&(document.addEventListener("touchmove",m,{passive:!1}),document.addEventListener("touchend",y))},h=()=>{document.removeEventListener("mousemove",m,{passive:!1}),document.removeEventListener("mouseup",y),"ontouchstart"in window&&(document.removeEventListener("touchmove",m,{passive:!1}),document.removeEventListener("touchend",y))},g=(L,j)=>{const V=L.target.closest(".splitpanes__splitter");if(V){const{left:F,top:X}=V.getBoundingClientRect(),{clientX:ne,clientY:re}="ontouchstart"in window&&L.touches?L.touches[0]:L;d.value.cursorOffset=i.horizontal?re-X:ne-F}p(),d.value.mouseDown=!0,d.value.activeSplitter=j},m=L=>{d.value.mouseDown&&(L.preventDefault(),d.value.dragging=!0,requestAnimationFrame(()=>{O(S(L)),me("resize",{event:L},!0)}))},y=L=>{d.value.dragging&&(window.getSelection().removeAllRanges(),me("resized",{event:L},!0)),d.value.mouseDown=!1,d.value.activeSplitter=null,setTimeout(()=>{d.value.dragging=!1,h()},100)},b=(L,j)=>{"ontouchstart"in window&&(L.preventDefault(),c.value.splitter===j?(clearTimeout(c.value.timeoutId),c.value.timeoutId=null,v(L,j),c.value.splitter=null):(c.value.splitter=j,c.value.timeoutId=setTimeout(()=>c.value.splitter=null,500))),d.value.dragging||me("splitter-click",{event:L,index:j},!0)},v=(L,j)=>{if(me("splitter-dblclick",{event:L,index:j},!0),i.maximizePanes){let V=0;r.value=r.value.map((F,X)=>(F.size=X===j?F.max:F.min,X!==j&&(V+=F.min),F)),r.value[j].size-=V,me("pane-maximize",{event:L,index:j,pane:r.value[j]}),me("resized",{event:L,index:j},!0)}},_=(L,j)=>{me("pane-click",{event:L,index:s.value[j].index,pane:s.value[j]})},S=L=>{const j=u.value.getBoundingClientRect(),{clientX:V,clientY:F}="ontouchstart"in window&&L.touches?L.touches[0]:L;return{x:V-(i.horizontal?0:d.value.cursorOffset)-j.left,y:F-(i.horizontal?d.value.cursorOffset:0)-j.top}},E=L=>{L=L[i.horizontal?"y":"x"];const j=u.value[i.horizontal?"clientHeight":"clientWidth"];return i.rtl&&!i.horizontal&&(L=j-L),L*100/j},O=L=>{const j=d.value.activeSplitter;let V={prevPanesSize:w(j),nextPanesSize:M(j),prevReachedMinPanes:0,nextReachedMinPanes:0};const F=0+(i.pushOtherPanes?0:V.prevPanesSize),X=100-(i.pushOtherPanes?0:V.nextPanesSize),ne=Math.max(Math.min(E(L),X),F);let re=[j,j+1],Z=r.value[re[0]]||null,ie=r.value[re[1]]||null;const he=Z.max<100&&ne>=Z.max+V.prevPanesSize,Ae=ie.max<100&&ne<=100-(ie.max+M(j+1));if(he||Ae){he?(Z.size=Z.max,ie.size=Math.max(100-Z.max-V.prevPanesSize-V.nextPanesSize,0)):(Z.size=Math.max(100-ie.max-V.prevPanesSize-M(j+1),0),ie.size=ie.max);return}if(i.pushOtherPanes){const Oe=R(V,ne);if(!Oe)return;({sums:V,panesToResize:re}=Oe),Z=r.value[re[0]]||null,ie=r.value[re[1]]||null}Z!==null&&(Z.size=Math.min(Math.max(ne-V.prevPanesSize-V.prevReachedMinPanes,Z.min),Z.max)),ie!==null&&(ie.size=Math.min(Math.max(100-ne-V.nextPanesSize-V.nextReachedMinPanes,ie.min),ie.max))},R=(L,j)=>{const V=d.value.activeSplitter,F=[V,V+1];return j<L.prevPanesSize+r.value[F[0]].min&&(F[0]=I(V).index,L.prevReachedMinPanes=0,F[0]<V&&r.value.forEach((X,ne)=>{ne>F[0]&&ne<=V&&(X.size=X.min,L.prevReachedMinPanes+=X.min)}),L.prevPanesSize=w(F[0]),F[0]===void 0)?(L.prevReachedMinPanes=0,r.value[0].size=r.value[0].min,r.value.forEach((X,ne)=>{ne>0&&ne<=V&&(X.size=X.min,L.prevReachedMinPanes+=X.min)}),r.value[F[1]].size=100-L.prevReachedMinPanes-r.value[0].min-L.prevPanesSize-L.nextPanesSize,null):j>100-L.nextPanesSize-r.value[F[1]].min&&(F[1]=D(V).index,L.nextReachedMinPanes=0,F[1]>V+1&&r.value.forEach((X,ne)=>{ne>V&&ne<F[1]&&(X.size=X.min,L.nextReachedMinPanes+=X.min)}),L.nextPanesSize=M(F[1]-1),F[1]===void 0)?(L.nextReachedMinPanes=0,r.value.forEach((X,ne)=>{ne<a.value-1&&ne>=V+1&&(X.size=X.min,L.nextReachedMinPanes+=X.min)}),r.value[F[0]].size=100-L.prevPanesSize-M(F[0]-1),null):{sums:L,panesToResize:F}},w=L=>r.value.reduce((j,V,F)=>j+(F<L?V.size:0),0),M=L=>r.value.reduce((j,V,F)=>j+(F>L+1?V.size:0),0),I=L=>[...r.value].reverse().find(j=>j.index<L&&j.size>j.min)||{},D=L=>r.value.find(j=>j.index>L+1&&j.size>j.min)||{},C=()=>{var L;const j=Array.from(((L=u.value)==null?void 0:L.children)||[]);for(const V of j){const F=V.classList.contains("splitpanes__pane"),X=V.classList.contains("splitpanes__splitter");!F&&!X&&(V.remove(),console.warn("Splitpanes: Only <pane> elements are allowed at the root of <splitpanes>. One of your DOM nodes was removed."))}},z=(L,j,V=!1)=>{const F=L-1,X=document.createElement("div");X.classList.add("splitpanes__splitter"),V||(X.onmousedown=ne=>g(ne,F),typeof window<"u"&&"ontouchstart"in window&&(X.ontouchstart=ne=>g(ne,F)),X.onclick=ne=>b(ne,F+1)),X.ondblclick=ne=>v(ne,F+1),j.parentNode.insertBefore(X,j)},G=L=>{L.onmousedown=void 0,L.onclick=void 0,L.ondblclick=void 0,L.remove()},N=()=>{var L;const j=Array.from(((L=u.value)==null?void 0:L.children)||[]);for(const F of j)F.className.includes("splitpanes__splitter")&&G(F);let V=0;for(const F of j)F.className.includes("splitpanes__pane")&&(!V&&i.firstSplitter?z(V,F,!0):V&&z(V,F),V++)},U=({uid:L,...j})=>{const V=s.value[L];for(const[F,X]of Object.entries(j))V[F]=X},Q=L=>{var j;let V=-1;Array.from(((j=u.value)==null?void 0:j.children)||[]).some(F=>(F.className.includes("splitpanes__pane")&&V++,F.isSameNode(L.el))),r.value.splice(V,0,{...L,index:V}),r.value.forEach((F,X)=>F.index=X),f.value&&$u(()=>{N(),ce({addedPane:r.value[V]}),me("pane-add",{pane:r.value[V]})})},J=L=>{const j=r.value.findIndex(F=>F.id===L);r.value[j].el=null;const V=r.value.splice(j,1)[0];r.value.forEach((F,X)=>F.index=X),$u(()=>{N(),me("pane-remove",{pane:V}),ce({removedPane:{...V}})})},ce=(L={})=>{!L.addedPane&&!L.removedPane?K():r.value.some(j=>j.givenSize!==null||j.min||j.max<100)?q(L):we(),f.value&&me("resized")},we=()=>{const L=100/a.value;let j=0;const V=[],F=[];for(const X of r.value)X.size=Math.max(Math.min(L,X.max),X.min),j-=X.size,X.size>=X.max&&V.push(X.id),X.size<=X.min&&F.push(X.id);j>.1&&ae(j,V,F)},K=()=>{let L=100;const j=[],V=[];let F=0;for(const ne of r.value)L-=ne.size,ne.givenSize!==null&&F++,ne.size>=ne.max&&j.push(ne.id),ne.size<=ne.min&&V.push(ne.id);let X=100;if(L>.1){for(const ne of r.value)ne.givenSize===null&&(ne.size=Math.max(Math.min(L/(a.value-F),ne.max),ne.min)),X-=ne.size;X>.1&&ae(X,j,V)}},q=({addedPane:L,removedPane:j}={})=>{let V=100/a.value,F=0;const X=[],ne=[];(L?.givenSize??null)!==null&&(V=(100-L.givenSize)/(a.value-1));for(const re of r.value)F-=re.size,re.size>=re.max&&X.push(re.id),re.size<=re.min&&ne.push(re.id);if(!(Math.abs(F)<.1)){for(const re of r.value)L?.givenSize!==null&&L?.id===re.id||(re.size=Math.max(Math.min(V,re.max),re.min)),F-=re.size,re.size>=re.max&&X.push(re.id),re.size<=re.min&&ne.push(re.id);F>.1&&ae(F,X,ne)}},ae=(L,j,V)=>{let F;L>0?F=L/(a.value-j.length):F=L/(a.value-V.length),r.value.forEach((X,ne)=>{if(L>0&&!j.includes(X.id)){const re=Math.max(Math.min(X.size+F,X.max),X.min),Z=re-X.size;L-=Z,X.size=re}else if(!V.includes(X.id)){const re=Math.max(Math.min(X.size+F,X.max),X.min),Z=re-X.size;L-=Z,X.size=re}}),Math.abs(L)>.1&&$u(()=>{f.value&&console.warn("Splitpanes: Could not resize panes correctly due to their constraints.")})},me=(L,j=void 0,V=!1)=>{const F=j?.index??d.value.activeSplitter??null;t(L,{...j,...F!==null&&{index:F},...V&&F!==null&&{prevPane:r.value[F-(i.firstSplitter?1:0)],nextPane:r.value[F+(i.firstSplitter?0:1)]},panes:r.value.map(X=>({min:X.min,max:X.max,size:X.size}))})};Qs(()=>i.firstSplitter,()=>N()),ll(()=>{C(),N(),ce(),me("ready"),f.value=!0}),fl(()=>f.value=!1);const ve=()=>{var L;return A0("div",{ref:u,class:l.value},(L=o.default)==null?void 0:L.call(o))};return ro("panes",r),ro("indexedPanes",s),ro("horizontal",Gi(()=>i.horizontal)),ro("requestUpdate",U),ro("onPaneAdd",Q),ro("onPaneRemove",J),ro("onPaneClick",_),(L,j)=>(hl(),M0(R0(ve)))}},Ff={__name:"pane",props:{size:{type:[Number,String]},minSize:{type:[Number,String],default:0},maxSize:{type:[Number,String],default:100}},setup(n){var e;const t=n,i=mr("requestUpdate"),o=mr("onPaneAdd"),r=mr("horizontal"),s=mr("onPaneRemove"),a=mr("onPaneClick"),u=(e=S0())==null?void 0:e.uid,f=mr("indexedPanes"),d=Gi(()=>f.value[u]),c=_i(null),l=Gi(()=>{const m=isNaN(t.size)||t.size===void 0?0:parseFloat(t.size);return Math.max(Math.min(m,h.value),p.value)}),p=Gi(()=>{const m=parseFloat(t.minSize);return isNaN(m)?0:m}),h=Gi(()=>{const m=parseFloat(t.maxSize);return isNaN(m)?100:m}),g=Gi(()=>{var m;return`${r.value?"height":"width"}: ${(m=d.value)==null?void 0:m.size}%`});return Qs(()=>l.value,m=>i({uid:u,size:m})),Qs(()=>p.value,m=>i({uid:u,min:m})),Qs(()=>h.value,m=>i({uid:u,max:m})),ll(()=>{o({id:u,el:c.value,min:p.value,max:h.value,givenSize:t.size===void 0?null:l.value,size:l.value})}),fl(()=>s(u)),(m,y)=>(hl(),iv("div",{ref_key:"paneEl",ref:c,class:"splitpanes__pane",onClick:y[0]||(y[0]=b=>Gc(a)(b,m._.uid)),style:E0(g.value)},[w0(m.$slots,"default")],4))}};var oo={},ys={},Bf;function lS(){if(Bf)return ys;Bf=1,Object.defineProperty(ys,"__esModule",{value:!0}),ys.ServerActionHandlerRegistry=void 0;class n{constructor(){this.handlers=new Map}getHandler(t){return this.handlers.get(t)}onAction(t,i){this.handlers.has(t)?this.handlers.get(t).push(i):this.handlers.set(t,[i])}removeActionHandler(t,i){const o=this.handlers.get(t);if(o){const r=o.indexOf(i);r>=0&&o.splice(r,1)}}}return ys.ServerActionHandlerRegistry=n,ys}var fe={},rr={},Vf;function Wr(){if(Vf)return rr;Vf=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.safeAssign=rr.hasOwnProperty=rr.isObject=void 0;function n(i){return typeof i=="object"&&i!==null}rr.isObject=n;function e(i,o,r){if(!n(i))return!1;if(Array.isArray(o))for(const s of o){if(!Object.prototype.hasOwnProperty.call(i,s)||typeof r=="string"&&typeof i[s]!==r)return!1;if(typeof r=="function"&&!r(i[s]))return!1}else{if(!Object.prototype.hasOwnProperty.call(i,o))return!1;if(typeof r=="string")return typeof i[o]===r;if(typeof r=="function")return r(i[o])}return!0}rr.hasOwnProperty=e;function t(i,o){return Object.assign(i,o)}return rr.safeAssign=t,rr}var zf;function qe(){if(zf)return fe;zf=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.ReconnectAction=fe.ApplyLabelEditAction=fe.DeleteElementAction=fe.CreateElementAction=fe.ExportSvgAction=fe.RequestExportSvgAction=fe.HoverFeedbackAction=fe.MoveAction=fe.RedoAction=fe.UndoAction=fe.BringToFrontAction=fe.ViewportResult=fe.GetViewportAction=fe.SetViewportAction=fe.FitToScreenAction=fe.CenterAction=fe.LayoutAction=fe.OpenAction=fe.CollapseExpandAllAction=fe.CollapseExpandAction=fe.SelectionResult=fe.GetSelectionAction=fe.SelectAllAction=fe.SelectAction=fe.LoggingAction=fe.ComputedBoundsAction=fe.RequestBoundsAction=fe.SetBoundsAction=fe.SetPopupModelAction=fe.RequestPopupModelAction=fe.UpdateModelAction=fe.SetModelAction=fe.RequestModelAction=fe.RejectAction=fe.isResponseAction=fe.setRequestContext=fe.generateRequestId=fe.isRequestAction=fe.isAction=fe.isActionMessage=void 0;const n=Wr();function e(L){return(0,n.hasOwnProperty)(L,"action")}fe.isActionMessage=e;function t(L){return(0,n.hasOwnProperty)(L,"kind","string")}fe.isAction=t;function i(L){return(0,n.hasOwnProperty)(L,"requestId","string")}fe.isRequestAction=i;let o="",r=1;function s(){return`${o}_${r++}`}fe.generateRequestId=s;function a(L){o=L}fe.setRequestContext=a;function u(L){return(0,n.hasOwnProperty)(L,"responseId","string")&&L.responseId!==""}fe.isResponseAction=u;var f;(function(L){L.KIND="rejectRequest";function j(V){return{kind:L.KIND,message:V.message,detail:V.detail,responseId:V.requestId}}L.create=j})(f||(fe.RejectAction=f={}));var d;(function(L){L.KIND="requestModel";function j(V){return{kind:L.KIND,options:V,requestId:s()}}L.create=j})(d||(fe.RequestModelAction=d={}));var c;(function(L){L.KIND="setModel";function j(V,F=""){return{kind:L.KIND,newRoot:V,responseId:F}}L.create=j})(c||(fe.SetModelAction=c={}));var l;(function(L){L.KIND="updateModel";function j(V,F={}){return Array.isArray(V)?{kind:L.KIND,matches:V,animate:F.animate,cause:F.cause}:{kind:L.KIND,newRoot:V,animate:F.animate,cause:F.cause}}L.create=j})(l||(fe.UpdateModelAction=l={}));var p;(function(L){L.KIND="requestPopupModel";function j(V){return{kind:L.KIND,elementId:V.elementId,bounds:V.bounds,requestId:s()}}L.create=j})(p||(fe.RequestPopupModelAction=p={}));var h;(function(L){L.KIND="setPopupModel";function j(V,F=""){return{kind:L.KIND,newRoot:V,responseId:F}}L.create=j})(h||(fe.SetPopupModelAction=h={}));var g;(function(L){L.KIND="setBounds";function j(V){return{kind:L.KIND,bounds:V}}L.create=j})(g||(fe.SetBoundsAction=g={}));var m;(function(L){L.KIND="requestBounds";function j(V){return{kind:L.KIND,newRoot:V,requestId:s()}}L.create=j})(m||(fe.RequestBoundsAction=m={}));var y;(function(L){L.KIND="computedBounds";function j(V,F={}){var X;return{kind:L.KIND,bounds:V,revision:F.revision,alignments:F.alignments,responseId:(X=F.requestId)!==null&&X!==void 0?X:""}}L.create=j})(y||(fe.ComputedBoundsAction=y={}));var b;(function(L){L.KIND="logging";function j(V){return Object.assign({kind:L.KIND},V)}L.create=j})(b||(fe.LoggingAction=b={}));var v;(function(L){L.KIND="elementSelected";function j(V){var F,X;return{kind:L.KIND,selectedElementsIDs:(F=V.selectedElementsIDs)!==null&&F!==void 0?F:[],deselectedElementsIDs:(X=V.deselectedElementsIDs)!==null&&X!==void 0?X:[]}}L.create=j})(v||(fe.SelectAction=v={}));var _;(function(L){L.KIND="allSelected";function j(V={}){var F;return{kind:L.KIND,select:(F=V.select)!==null&&F!==void 0?F:!0}}L.create=j})(_||(fe.SelectAllAction=_={}));var S;(function(L){L.KIND="getSelection";function j(){return{kind:L.KIND,requestId:s()}}L.create=j})(S||(fe.GetSelectionAction=S={}));var E;(function(L){L.KIND="selectionResult";function j(V,F){return{kind:L.KIND,selectedElementsIDs:V,responseId:F}}L.create=j})(E||(fe.SelectionResult=E={}));var O;(function(L){L.KIND="collapseExpand";function j(V){var F,X;return{kind:L.KIND,expandIds:(F=V.expandIds)!==null&&F!==void 0?F:[],collapseIds:(X=V.collapseIds)!==null&&X!==void 0?X:[]}}L.create=j})(O||(fe.CollapseExpandAction=O={}));var R;(function(L){L.KIND="collapseExpandAll";function j(V={}){var F;return{kind:L.KIND,expand:(F=V.expand)!==null&&F!==void 0?F:!0}}L.create=j})(R||(fe.CollapseExpandAllAction=R={}));var w;(function(L){L.KIND="open";function j(V){return{kind:L.KIND,elementId:V}}L.create=j})(w||(fe.OpenAction=w={}));var M;(function(L){L.KIND="layout";function j(V={}){return{kind:L.KIND,layoutType:V.layoutType,elementIds:V.elementIds}}L.create=j})(M||(fe.LayoutAction=M={}));var I;(function(L){L.KIND="center";function j(V,F={}){var X,ne;return{kind:L.KIND,elementIds:V,animate:(X=F.animate)!==null&&X!==void 0?X:!0,retainZoom:(ne=F.retainZoom)!==null&&ne!==void 0?ne:!1,zoomScale:F.zoomScale}}L.create=j})(I||(fe.CenterAction=I={}));var D;(function(L){L.KIND="fit";function j(V,F={}){var X;return{kind:L.KIND,elementIds:V,padding:F.padding,maxZoom:F.maxZoom,animate:(X=F.animate)!==null&&X!==void 0?X:!0}}L.create=j})(D||(fe.FitToScreenAction=D={}));var C;(function(L){L.KIND="viewport";function j(V,F,X={}){var ne;return{kind:L.KIND,elementId:V,newViewport:F,animate:(ne=X.animate)!==null&&ne!==void 0?ne:!0}}L.create=j})(C||(fe.SetViewportAction=C={}));var z;(function(L){L.KIND="getViewport";function j(){return{kind:L.KIND,requestId:s()}}L.create=j})(z||(fe.GetViewportAction=z={}));var G;(function(L){L.KIND="viewportResult";function j(V,F,X){return{kind:L.KIND,viewport:V,canvasBounds:F,responseId:X}}L.create=j})(G||(fe.ViewportResult=G={}));var N;(function(L){L.KIND="bringToFront";function j(V){return{kind:L.KIND,elementIDs:V}}L.create=j})(N||(fe.BringToFrontAction=N={}));var U;(function(L){L.KIND="undo";function j(){return{kind:L.KIND}}L.create=j})(U||(fe.UndoAction=U={}));var Q;(function(L){L.KIND="redo";function j(){return{kind:L.KIND}}L.create=j})(Q||(fe.RedoAction=Q={}));var J;(function(L){L.KIND="move";function j(V,F={}){var X,ne,re;return{kind:L.KIND,moves:V,animate:(X=F.animate)!==null&&X!==void 0?X:!0,finished:(ne=F.finished)!==null&&ne!==void 0?ne:!1,stoppable:(re=F.stoppable)!==null&&re!==void 0?re:!1}}L.create=j})(J||(fe.MoveAction=J={}));var ce;(function(L){L.KIND="hoverFeedback";function j(V){return{kind:L.KIND,mouseoverElement:V.mouseoverElement,mouseIsOver:V.mouseIsOver}}L.create=j})(ce||(fe.HoverFeedbackAction=ce={}));var we;(function(L){L.KIND="requestExportSvg";function j(V){return{kind:L.KIND,requestId:s(),options:V}}L.create=j})(we||(fe.RequestExportSvgAction=we={}));var K;(function(L){L.KIND="exportSvg";function j(V,F,X){return{kind:L.KIND,svg:V,responseId:F,options:X}}L.create=j})(K||(fe.ExportSvgAction=K={}));var q;(function(L){L.KIND="createElement";function j(V,F){return{kind:L.KIND,elementSchema:V,containerId:F.containerId}}L.create=j})(q||(fe.CreateElementAction=q={}));var ae;(function(L){L.KIND="delete";function j(V){return{kind:L.KIND,elementIds:V}}L.create=j})(ae||(fe.DeleteElementAction=ae={}));var me;(function(L){L.KIND="applyLabelEdit";function j(V,F){return{kind:L.KIND,labelId:V,text:F}}L.create=j})(me||(fe.ApplyLabelEditAction=me={}));var ve;return(function(L){L.KIND="reconnect";function j(V){return{kind:L.KIND,routableId:V.routableId,newSourceId:V.newSourceId,newTargetId:V.newTargetId}}L.create=j})(ve||(fe.ReconnectAction=ve={})),fe}var vs={},_s={},qf;function vl(){if(qf)return _s;qf=1,Object.defineProperty(_s,"__esModule",{value:!0}),_s.Deferred=void 0;class n{constructor(){this._state="unresolved",this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i}),this.promise.then(t=>this._state="resolved",t=>this._state="rejected")}set state(t){this._state==="unresolved"&&(this._state=t)}get state(){return this._state}}return _s.Deferred=n,_s}var nn={},Hf;function ns(){if(Hf)return nn;Hf=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.SModelIndex=nn.findElement=nn.getSubType=nn.getBasicType=nn.applyBounds=nn.cloneModel=void 0;function n(s){return JSON.parse(JSON.stringify(s))}nn.cloneModel=n;function e(s,a){const u=new r;u.add(s);for(const f of a.bounds){const d=u.getById(f.elementId);if(d){const c=d;f.newPosition&&(c.position={x:f.newPosition.x,y:f.newPosition.y}),f.newSize&&(c.size={width:f.newSize.width,height:f.newSize.height})}}if(a.alignments)for(const f of a.alignments){const d=u.getById(f.elementId);if(d){const c=d;c.alignment={x:f.newAlignment.x,y:f.newAlignment.y}}}}nn.applyBounds=e;function t(s){if(!s.type)return"";const a=s.type.indexOf(":");return a>=0?s.type.substring(0,a):s.type}nn.getBasicType=t;function i(s){if(!s.type)return"";const a=s.type.indexOf(":");return a>=0?s.type.substring(a+1):s.type}nn.getSubType=i;function o(s,a){if(s.id===a)return s;if(s.children)for(const u of s.children){const f=o(u,a);if(f!==void 0)return f}}nn.findElement=o;class r{constructor(){this.id2element=new Map,this.id2parent=new Map}add(a){if(a.id){if(this.contains(a))throw new Error("Duplicate ID in model: "+a.id)}else throw new Error("Model element has no ID.");if(this.id2element.set(a.id,a),Array.isArray(a.children))for(const u of a.children)this.add(u),this.id2parent.set(u.id,a);return this}remove(a){if(this.id2element.delete(a.id),Array.isArray(a.children))for(const u of a.children)this.id2parent.delete(u.id),this.remove(u);return this}contains(a){return this.id2element.has(a.id)}getById(a){return this.id2element.get(a)}getParent(a){return this.id2parent.get(a)}getRoot(a){let u=a;for(;u;){const f=this.id2parent.get(u.id);if(f===void 0)return u;u=f}throw new Error("Element has no root")}}return nn.SModelIndex=r,nn}var Kf;function fS(){if(Kf)return vs;Kf=1,Object.defineProperty(vs,"__esModule",{value:!0}),vs.DiagramServer=void 0;const n=qe(),e=vl(),t=ns();class i{constructor(r,s){this.state={currentRoot:{type:"NONE",id:"ROOT"},revision:0},this.requests=new Map,this.dispatch=r,this.diagramGenerator=s.DiagramGenerator,this.layoutEngine=s.ModelLayoutEngine,this.actionHandlerRegistry=s.ServerActionHandlerRegistry}setModel(r){return r.revision=++this.state.revision,this.state.currentRoot=r,this.submitModel(r,!1)}updateModel(r){return r.revision=++this.state.revision,this.state.currentRoot=r,this.submitModel(r,!0)}get needsClientLayout(){return this.state.options&&this.state.options.needsClientLayout!==void 0?!!this.state.options.needsClientLayout:!0}get needsServerLayout(){return this.state.options&&this.state.options.needsServerLayout!==void 0?!!this.state.options.needsServerLayout:!1}accept(r){if((0,n.isResponseAction)(r)){const s=r.responseId,a=this.requests.get(s);if(a){if(this.requests.delete(s),r.kind===n.RejectAction.KIND){const u=r;a.reject(new Error(u.message)),console.warn(`Request with id ${r.responseId} failed: ${u.message}`,u.detail)}else a.resolve(r);return Promise.resolve()}console.info("No matching request for response:",r)}return this.handleAction(r)}request(r){r.requestId||(r.requestId="server_"+(0,n.generateRequestId)());const s=new e.Deferred;return this.requests.set(r.requestId,s),this.dispatch(r).catch(a=>{this.requests.delete(r.requestId),s.reject(a)}),s.promise}rejectRemoteRequest(r,s){r&&(0,n.isRequestAction)(r)&&this.dispatch({kind:n.RejectAction.KIND,responseId:r.requestId,message:s.message,detail:s.stack})}handleAction(r){var s,a;const u=(s=this.actionHandlerRegistry)===null||s===void 0?void 0:s.getHandler(r.kind);if(u&&u.length===1)return(a=u[0](r,this.state,this))!==null&&a!==void 0?a:Promise.resolve();if(u&&u.length>1)return Promise.all(u.map(f=>{var d;return(d=f(r,this.state,this))!==null&&d!==void 0?d:Promise.resolve()}));switch(r.kind){case n.RequestModelAction.KIND:return this.handleRequestModel(r);case n.ComputedBoundsAction.KIND:return this.handleComputedBounds(r);case n.LayoutAction.KIND:return this.handleLayout(r)}return console.warn(`Unhandled action from client: ${r.kind}`),Promise.resolve()}async handleRequestModel(r){var s;this.state.options=r.options;try{const a=await this.diagramGenerator.generate({options:(s=this.state.options)!==null&&s!==void 0?s:{},state:this.state});a.revision=++this.state.revision,this.state.currentRoot=a,await this.submitModel(this.state.currentRoot,!1,r)}catch(a){this.rejectRemoteRequest(r,a),console.error("Failed to generate diagram:",a)}}async submitModel(r,s,a){if(this.needsClientLayout)if(!this.needsServerLayout)this.dispatch({kind:n.RequestBoundsAction.KIND,newRoot:r});else{const u=n.RequestBoundsAction.create(r),f=await this.request(u),d=this.state.currentRoot;f.revision===d.revision?((0,t.applyBounds)(d,f),await this.doSubmitModel(d,s,a)):this.rejectRemoteRequest(a,new Error(`Model revision does not match: ${f.revision}`))}else await this.doSubmitModel(r,s,a)}async doSubmitModel(r,s,a){if(r.revision!==this.state.revision)return;this.needsServerLayout&&this.layoutEngine&&(r=await this.layoutEngine.layout(r));const u=r.type;if(a&&a.kind===n.RequestModelAction.KIND){const f=a.requestId,d=n.SetModelAction.create(r,f);await this.dispatch(d)}else s&&u===this.state.lastSubmittedModelType?await this.dispatch({kind:n.UpdateModelAction.KIND,newRoot:r,cause:a}):await this.dispatch({kind:n.SetModelAction.KIND,newRoot:r});this.state.lastSubmittedModelType=u}handleComputedBounds(r){return r.revision!==this.state.currentRoot.revision?Promise.reject():((0,t.applyBounds)(this.state.currentRoot,r),Promise.resolve())}async handleLayout(r){if(this.layoutEngine){if(!this.needsServerLayout){let s=(0,t.cloneModel)(this.state.currentRoot);s=await this.layoutEngine.layout(s),s.revision=++this.state.revision,this.state.currentRoot=s}await this.doSubmitModel(this.state.currentRoot,!0,r)}}}return vs.DiagramServer=i,vs}var Xu={},$f;function hS(){return $f||($f=1,Object.defineProperty(Xu,"__esModule",{value:!0})),Xu}var so={},Yf;function pS(){if(Yf)return so;Yf=1,Object.defineProperty(so,"__esModule",{value:!0}),so.isZoomable=so.isScrollable=void 0;const n=Wr();function e(i){return(0,n.hasOwnProperty)(i,"scroll")}so.isScrollable=e;function t(i){return(0,n.hasOwnProperty)(i,"zoom")}return so.isZoomable=t,so}var st={},kf;function He(){if(kf)return st;kf=1,Object.defineProperty(st,"__esModule",{value:!0}),st.almostEquals=st.toRadians=st.toDegrees=st.Bounds=st.isBounds=st.Dimension=st.centerOfLine=st.angleBetweenPoints=st.angleOfPoint=st.Point=void 0;const n=Wr();var e;(function(c){c.ORIGIN=Object.freeze({x:0,y:0});function l(O,R){return{x:O.x+R.x,y:O.y+R.y}}c.add=l;function p(O,R){return{x:O.x-R.x,y:O.y-R.y}}c.subtract=p;function h(O,R){return O.x===R.x&&O.y===R.y}c.equals=h;function g(O,R,w){const M=p(R,O),I=m(M),D={x:I.x*w,y:I.y*w};return l(O,D)}c.shiftTowards=g;function m(O){const R=y(O);return R===0||R===1?c.ORIGIN:{x:O.x/R,y:O.y/R}}c.normalize=m;function y(O){return Math.sqrt(Math.pow(O.x,2)+Math.pow(O.y,2))}c.magnitude=y;function b(O,R,w){return{x:(1-w)*O.x+w*R.x,y:(1-w)*O.y+w*R.y}}c.linear=b;function v(O,R){const w=R.x-O.x,M=R.y-O.y;return Math.sqrt(w*w+M*M)}c.euclideanDistance=v;function _(O,R){return Math.abs(R.x-O.x)+Math.abs(R.y-O.y)}c.manhattanDistance=_;function S(O,R){return Math.max(Math.abs(R.x-O.x),Math.abs(R.y-O.y))}c.maxDistance=S;function E(O,R){return O.x*R.x+O.y*R.y}c.dotProduct=E})(e||(st.Point=e={}));function t(c){return Math.atan2(c.y,c.x)}st.angleOfPoint=t;function i(c,l){const p=Math.sqrt((c.x*c.x+c.y*c.y)*(l.x*l.x+l.y*l.y));if(isNaN(p)||p===0)return NaN;const h=c.x*l.x+c.y*l.y;return Math.acos(h/p)}st.angleBetweenPoints=i;function o(c,l){const p={x:c.x>l.x?l.x:c.x,y:c.y>l.y?l.y:c.y,width:Math.abs(l.x-c.x),height:Math.abs(l.y-c.y)};return a.center(p)}st.centerOfLine=o;var r;(function(c){c.EMPTY=Object.freeze({width:-1,height:-1});function l(p){return p.width>=0&&p.height>=0}c.isValid=l})(r||(st.Dimension=r={}));function s(c){return(0,n.hasOwnProperty)(c,["x","y","width","height"])}st.isBounds=s;var a;(function(c){c.EMPTY=Object.freeze({x:0,y:0,width:-1,height:-1});function l(m,y){if(!r.isValid(m))return r.isValid(y)?y:c.EMPTY;if(!r.isValid(y))return m;const b=Math.min(m.x,y.x),v=Math.min(m.y,y.y),_=Math.max(m.x+(m.width>=0?m.width:0),y.x+(y.width>=0?y.width:0)),S=Math.max(m.y+(m.height>=0?m.height:0),y.y+(y.height>=0?y.height:0));return{x:b,y:v,width:_-b,height:S-v}}c.combine=l;function p(m,y){return{x:m.x+y.x,y:m.y+y.y,width:m.width,height:m.height}}c.translate=p;function h(m){return{x:m.x+(m.width>=0?.5*m.width:0),y:m.y+(m.height>=0?.5*m.height:0)}}c.center=h;function g(m,y){return y.x>=m.x&&y.x<=m.x+m.width&&y.y>=m.y&&y.y<=m.y+m.height}c.includes=g})(a||(st.Bounds=a={}));function u(c){return c*180/Math.PI}st.toDegrees=u;function f(c){return c*Math.PI/180}st.toRadians=f;function d(c,l){return Math.abs(c-l)<.001}return st.almostEquals=d,st}var Wu={},Uf;function gS(){return Uf||(Uf=1,Object.defineProperty(Wu,"__esModule",{value:!0})),Wu}var Gf;function ti(){return Gf||(Gf=1,(function(n){var e=oo&&oo.__createBinding||(Object.create?(function(i,o,r,s){s===void 0&&(s=r);var a=Object.getOwnPropertyDescriptor(o,r);(!a||("get"in a?!o.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return o[r]}}),Object.defineProperty(i,s,a)}):(function(i,o,r,s){s===void 0&&(s=r),i[s]=o[r]})),t=oo&&oo.__exportStar||function(i,o){for(var r in i)r!=="default"&&!Object.prototype.hasOwnProperty.call(o,r)&&e(o,i,r)};Object.defineProperty(n,"__esModule",{value:!0}),t(lS(),n),t(qe(),n),t(fS(),n),t(hS(),n),t(pS(),n),t(vl(),n),t(He(),n),t(gS(),n),t(ns(),n),t(Wr(),n)})(oo)),oo}var ft=ti();const Zu=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");let mS=class{[Zu];#e;constructor(e){this.#e=e,this[Zu]=!0}static is(e){return typeof e=="object"&&e!==null&&e[Zu]===!0}unwrap(){return this.#e()}};function br(n,e){return Reflect.getMetadata(e,n)}function Xf(n,e,t,i){const o=i(br(n,e)??t);Reflect.defineMetadata(e,o,n)}const wu="named",_l="name",bl="unmanaged",Sl="optional",wl="inject",El="multi_inject",_v="post_construct",bv="pre_destroy",yS=[wl,El,_l,bl,wu,Sl],Ju=Symbol.for("@inversifyjs/core/InversifyCoreError");let _o=class Sv extends Error{[Ju];kind;constructor(e,t,i){super(t,i),this[Ju]=!0,this.kind=e}static is(e){return typeof e=="object"&&e!==null&&e[Ju]===!0}static isErrorOfKind(e,t){return Sv.is(e)&&e.kind===t}};var Sr,Cn;function wv(n,e){const t=[];for(let i=0;i<e.length;++i)e[i]===void 0&&t.push(i);if(t.length>0)throw new _o(Sr.missingInjectionDecorator,`Found unexpected missing metadata on type "${n.name}" at constructor indexes "${t.join('", "')}".

Are you using @inject, @multiInject or @unmanaged decorators at those indexes?

If you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}function Ev(n){return{kind:Cn.singleInjection,name:void 0,optional:!1,tags:new Map,targetName:void 0,value:n}}function Eu(n){const e=n.find((s=>s.key===wl)),t=n.find((s=>s.key===El));if(n.find((s=>s.key===bl))!==void 0)return(function(s,a){if(a!==void 0||s!==void 0)throw new _o(Sr.missingInjectionDecorator,"Expected a single @inject, @multiInject or @unmanaged metadata");return{kind:Cn.unmanaged}})(e,t);if(t===void 0&&e===void 0)throw new _o(Sr.missingInjectionDecorator,"Expected @inject, @multiInject or @unmanaged metadata");const i=n.find((s=>s.key===wu)),o=n.find((s=>s.key===Sl)),r=n.find((s=>s.key===_l));return{kind:e===void 0?Cn.multipleInjection:Cn.singleInjection,name:i?.value,optional:o!==void 0,tags:new Map(n.filter((s=>yS.every((a=>s.key!==a)))).map((s=>[s.key,s.value]))),targetName:r?.value,value:e===void 0?t?.value:e.value}}function Pv(n,e,t){try{return Eu(t)}catch(i){throw _o.isErrorOfKind(i,Sr.missingInjectionDecorator)?new _o(Sr.missingInjectionDecorator,`Expected a single @inject, @multiInject or @unmanaged decorator at type "${n.name}" at constructor arguments at index "${e.toString()}"`,{cause:i}):i}}function vS(n){const e=br(n,"design:paramtypes"),t=br(n,"inversify:tagged"),i=[];if(t!==void 0)for(const[o,r]of Object.entries(t)){const s=parseInt(o);i[s]=Pv(n,s,r)}if(e!==void 0){for(let o=0;o<e.length;++o)if(i[o]===void 0){const r=e[o];i[o]=Ev(r)}}return wv(n,i),i}function Mv(n,e,t){try{return Eu(t)}catch(i){throw _o.isErrorOfKind(i,Sr.missingInjectionDecorator)?new _o(Sr.missingInjectionDecorator,`Expected a single @inject, @multiInject or @unmanaged decorator at type "${n.name}" at property "${e.toString()}"`,{cause:i}):i}}function Rv(n){const e=br(n,"inversify:tagged_props"),t=new Map;if(e!==void 0)for(const i of Reflect.ownKeys(e)){const o=e[i];t.set(i,Mv(n,i,o))}return t}function _S(n){const e=br(n,_v),t=br(n,bv);return{constructorArguments:vS(n),lifecycle:{postConstructMethodName:e?.value,preDestroyMethodName:t?.value},properties:Rv(n)}}function bS(n,e){const t=e.getConstructorMetadata(n),i=[];for(const[o,r]of Object.entries(t.userGeneratedMetadata)){const s=parseInt(o);i[s]=Pv(n,s,r)}if(t.compilerGeneratedMetadata!==void 0){for(let o=0;o<t.compilerGeneratedMetadata.length;++o)if(i[o]===void 0){const r=t.compilerGeneratedMetadata[o];i[o]=Ev(r)}}return wv(n,i),i}function Av(n,e){const t=e.getPropertiesMetadata(n),i=new Map;for(const o of Reflect.ownKeys(t)){const r=t[o];i.set(o,Mv(n,o,r))}return i}function SS(n,e){const t=br(n,_v),i=br(n,bv);return{constructorArguments:bS(n,e),lifecycle:{postConstructMethodName:t?.value,preDestroyMethodName:i?.value},properties:Av(n,e)}}function Wf(n){return Object.getPrototypeOf(n.prototype)?.constructor}function wS(n){return n.kind===Cn.unmanaged?[{key:bl,value:!0}]:(function(e){const t=[ES(e)];e.name!==void 0&&t.push({key:wu,value:e.name}),e.optional&&t.push({key:Sl,value:!0});for(const[i,o]of e.tags)t.push({key:i,value:o});return e.targetName!==void 0&&t.push({key:_l,value:e.targetName}),t})(n)}function ES(n){let e;switch(n.kind){case Cn.multipleInjection:e={key:El,value:n.value};break;case Cn.singleInjection:e={key:wl,value:n.value}}return e}(function(n){n[n.injectionDecoratorConflict=0]="injectionDecoratorConflict",n[n.missingInjectionDecorator=1]="missingInjectionDecorator",n[n.planning=2]="planning",n[n.unknown=3]="unknown"})(Sr||(Sr={})),(function(n){n[n.multipleInjection=0]="multipleInjection",n[n.singleInjection=1]="singleInjection",n[n.unmanaged=2]="unmanaged"})(Cn||(Cn={}));let PS=class{#e;constructor(e){this.#e=e}startsWith(e){return this.#e.startsWith(e)}endsWith(e){return this.#e.endsWith(e)}contains(e){return this.#e.includes(e)}equals(e){return this.#e===e}value(){return this.#e}};const Qu="@inversifyjs/core/targetId";let nu=class{#e;#n;#i;#t;#r;#o;constructor(e,t,i){this.#n=(function(){const o=br(Object,Qu)??0;return o===Number.MAX_SAFE_INTEGER?Xf(Object,Qu,o,(()=>Number.MIN_SAFE_INTEGER)):Xf(Object,Qu,o,(r=>r+1)),o})(),this.#i=e,this.#t=void 0,this.#e=t,this.#r=new PS(typeof e=="string"?e:e.toString().slice(7,-1)),this.#o=i}get id(){return this.#n}get identifier(){return this.#i}get metadata(){return this.#t===void 0&&(this.#t=wS(this.#e)),this.#t}get name(){return this.#r}get type(){return this.#o}get serviceIdentifier(){return mS.is(this.#e.value)?this.#e.value.unwrap():this.#e.value}getCustomTags(){return[...this.#e.tags.entries()].map((([e,t])=>({key:e,value:t})))}getNamedTag(){return this.#e.name===void 0?null:{key:wu,value:this.#e.name}}hasTag(e){return this.metadata.some((t=>t.key===e))}isArray(){return this.#e.kind===Cn.multipleInjection}isNamed(){return this.#e.name!==void 0}isOptional(){return this.#e.optional}isTagged(){return this.#e.tags.size>0}matchesArray(e){return this.isArray()&&this.#e.value===e}matchesNamedTag(e){return this.#e.name===e}matchesTag(e){return t=>this.metadata.some((i=>i.key===e&&i.value===t))}};const Ov=n=>(function(e,t){return function(i){const o=e(i);let r=Wf(i);for(;r!==void 0&&r!==Object;){const a=t(r);for(const[u,f]of a)o.properties.has(u)||o.properties.set(u,f);r=Wf(r)}const s=[];for(const a of o.constructorArguments)if(a.kind!==Cn.unmanaged){const u=a.targetName??"";s.push(new nu(u,a,"ConstructorArgument"))}for(const[a,u]of o.properties)if(u.kind!==Cn.unmanaged){const f=u.targetName??a;s.push(new nu(f,u,"ClassProperty"))}return s}})(n===void 0?_S:e=>SS(e,n),n===void 0?Rv:e=>Av(e,n)),vi="named",MS="unmanaged",Iv="optional",Cv="inject",Tv="multi_inject",Dv="inversify:tagged",xv="inversify:tagged_props",Zf="inversify:paramtypes",jv="design:paramtypes",Jf="post_construct",Vd="pre_destroy",St={Request:"Request",Singleton:"Singleton",Transient:"Transient"},Qe={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},Lv={ConstructorArgument:"ConstructorArgument",Variable:"Variable"};let RS=0;function Ea(){return RS++}class Pl{id;moduleId;activated;serviceIdentifier;implementationType;cache;dynamicValue;scope;type;factory;provider;constraint;onActivation;onDeactivation;constructor(e,t){this.id=Ea(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=Qe.Invalid,this.constraint=i=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}clone(){const e=new Pl(this.serviceIdentifier,this.scope);return e.activated=e.scope===St.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e}}const Nv="Metadata key was used more than once in a parameter:",Qf="NULL argument",eh="Key Not Found",AS="Ambiguous match found for serviceIdentifier:",OS="No matching bindings found for serviceIdentifier:",Fv="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",zd=(n,e)=>`onDeactivation() error in class ${n}: ${e}`;class IS{getConstructorMetadata(e){return{compilerGeneratedMetadata:Reflect.getMetadata(jv,e)??[],userGeneratedMetadata:Reflect.getMetadata(Dv,e)??{}}}getPropertiesMetadata(e){return Reflect.getMetadata(xv,e)??{}}}var xo;function Bv(n){return n instanceof RangeError||n.message==="Maximum call stack size exceeded"}(function(n){n[n.MultipleBindingsAvailable=2]="MultipleBindingsAvailable",n[n.NoBindingsAvailable=0]="NoBindingsAvailable",n[n.OnlyOneBindingAvailable=1]="OnlyOneBindingAvailable"})(xo||(xo={}));function Yr(n){return typeof n=="function"?n.name:typeof n=="symbol"?n.toString():n}function th(n,e,t){let i="";const o=t(n,e);return o.length!==0&&(i=`
Registered bindings:`,o.forEach((r=>{let s="Object";r.implementationType!==null&&(s=qv(r.implementationType)),i=`${i}
 ${s}`,r.constraint.metaData&&(i=`${i} - ${r.constraint.metaData}`)}))),i}function Vv(n,e){return n.parentRequest!==null&&(n.parentRequest.serviceIdentifier===e||Vv(n.parentRequest,e))}function zv(n){n.childRequests.forEach((e=>{if(Vv(n,e.serviceIdentifier)){const t=(function(i){return(function r(s,a=[]){const u=Yr(s.serviceIdentifier);return a.push(u),s.parentRequest!==null?r(s.parentRequest,a):a})(i).reverse().join(" --> ")})(e);throw new Error(`Circular dependency found: ${t}`)}zv(e)}))}function qv(n){if(n.name!=null&&n.name!=="")return n.name;{const e=n.toString(),t=e.match(/^function\s*([^\s(]+)/);return t===null?`Anonymous function: ${e}`:t[1]}}function nh(n){return`{"key":"${n.key.toString()}","value":"${n.value.toString()}"}`}class Hv{id;container;plan;currentRequest;constructor(e){this.id=Ea(),this.container=e}addPlan(e){this.plan=e}setCurrentRequest(e){this.currentRequest=e}}class Lo{key;value;constructor(e,t){this.key=e,this.value=t}toString(){return this.key===vi?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}class CS{parentContext;rootRequest;constructor(e,t){this.parentContext=e,this.rootRequest=t}}function Kv(n,e){const t=(function(a){return Object.getPrototypeOf(a.prototype)?.constructor})(e);if(t===void 0||t===Object)return 0;const i=Ov(n)(t),o=i.map((a=>a.metadata.filter((u=>u.key===MS)))),r=[].concat.apply([],o).length,s=i.length-r;return s>0?s:Kv(n,t)}class Pa{id;serviceIdentifier;parentContext;parentRequest;bindings;childRequests;target;requestScope;constructor(e,t,i,o,r){this.id=Ea(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=i,this.target=r,this.childRequests=[],this.bindings=Array.isArray(o)?o:[o],this.requestScope=i===null?new Map:null}addChildRequest(e,t,i){const o=new Pa(e,this.parentContext,this,t,i);return this.childRequests.push(o),o}}function iu(n){return n._bindingDictionary}function ih(n,e,t,i,o){let r=Ws(t.container,o.serviceIdentifier),s=[];return r.length===xo.NoBindingsAvailable&&t.container.options.autoBindInjectable===!0&&typeof o.serviceIdentifier=="function"&&n.getConstructorMetadata(o.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(o.serviceIdentifier).toSelf(),r=Ws(t.container,o.serviceIdentifier)),s=e?r:r.filter((a=>{const u=new Pa(a.serviceIdentifier,t,i,a,o);return a.constraint(u)})),(function(a,u,f,d,c){switch(u.length){case xo.NoBindingsAvailable:if(d.isOptional())return u;{const l=Yr(a);let p=OS;throw p+=(function(h,g){if(g.isTagged()||g.isNamed()){let m="";const y=g.getNamedTag(),b=g.getCustomTags();return y!==null&&(m+=nh(y)+`
`),b!==null&&b.forEach((v=>{m+=nh(v)+`
`})),` ${h}
 ${h} - ${m}`}return` ${h}`})(l,d),p+=th(c,l,Ws),f!==null&&(p+=`
Trying to resolve bindings for "${Yr(f.serviceIdentifier)}"`),new Error(p)}case xo.OnlyOneBindingAvailable:return u;case xo.MultipleBindingsAvailable:default:if(d.isArray())return u;{const l=Yr(a);let p=`${AS} ${l}`;throw p+=th(c,l,Ws),new Error(p)}}})(o.serviceIdentifier,s,i,o,t.container),s}function $v(n,e){const t=e.isMultiInject?Tv:Cv,i=[new Lo(t,n)];return e.customTag!==void 0&&i.push(new Lo(e.customTag.key,e.customTag.value)),e.isOptional===!0&&i.push(new Lo(Iv,!0)),i}function Yv(n,e,t,i,o,r){let s,a;if(o===null){s=ih(n,e,i,null,r),a=new Pa(t,i,null,s,r);const u=new CS(i,a);i.addPlan(u)}else s=ih(n,e,i,o,r),a=o.addChildRequest(r.serviceIdentifier,s,r);s.forEach((u=>{let f=null;if(r.isArray())f=a.addChildRequest(u.serviceIdentifier,u,r);else{if(u.cache!==null)return;f=a}if(u.type===Qe.Instance&&u.implementationType!==null){const d=(function(c,l){return Ov(c)(l)})(n,u.implementationType);if(i.container.options.skipBaseClassChecks!==!0){const c=Kv(n,u.implementationType);if(d.length<c){const l=`The number of constructor arguments in the derived class ${qv(u.implementationType)} must be >= than the number of constructor arguments of its base class.`;throw new Error(l)}}d.forEach((c=>{Yv(n,!1,c.serviceIdentifier,i,f,c)}))}}))}function Ws(n,e){let t=[];const i=iu(n);return i.hasKey(e)?t=i.get(e):n.parent!==null&&(t=Ws(n.parent,e)),t}function TS(n,e,t,i,o,r=!1){const s=new Hv(e),a=(function(u,f,d){const c=$v(f,d),l=Eu(c);if(l.kind===Cn.unmanaged)throw new Error("Unexpected metadata when creating target");return new nu("",l,u)})(t,i,o);try{return Yv(n,r,i,s,null,a),s}catch(u){throw Bv(u)&&zv(s.plan.rootRequest),u}}function In(n){return(typeof n=="object"&&n!==null||typeof n=="function")&&typeof n.then=="function"}function kv(n){return!!In(n)||Array.isArray(n)&&n.some(In)}const DS=(n,e,t)=>{n.has(e.id)||n.set(e.id,t)},xS=(n,e)=>{n.cache=e,n.activated=!0,In(e)&&jS(n,e)},jS=async(n,e)=>{try{const t=await e;n.cache=t}catch(t){throw n.cache=null,n.activated=!1,t}};var ea;(function(n){n.DynamicValue="toDynamicValue",n.Factory="toFactory",n.Provider="toProvider"})(ea||(ea={}));function LS(n,e,t){let i;if(e.length>0){const o=(function(s,a){return s.reduce(((u,f)=>{const d=a(f);return f.target.type===Lv.ConstructorArgument?u.constructorInjections.push(d):(u.propertyRequests.push(f),u.propertyInjections.push(d)),u.isAsync||(u.isAsync=kv(d)),u}),{constructorInjections:[],isAsync:!1,propertyInjections:[],propertyRequests:[]})})(e,t),r={...o,constr:n};i=o.isAsync?(async function(s){const a=await oh(s.constructorInjections),u=await oh(s.propertyInjections);return rh({...s,constructorInjections:a,propertyInjections:u})})(r):rh(r)}else i=new n;return i}function rh(n){const e=new n.constr(...n.constructorInjections);return n.propertyRequests.forEach(((t,i)=>{const o=t.target.identifier,r=n.propertyInjections[i];t.target.isOptional()&&r===void 0||(e[o]=r)})),e}async function oh(n){const e=[];for(const t of n)Array.isArray(t)?e.push(Promise.all(t)):e.push(t);return Promise.all(e)}function sh(n,e){const t=(function(i,o){if(Reflect.hasMetadata(Jf,i)){const a=Reflect.getMetadata(Jf,i);try{return o[a.value]?.()}catch(u){if(u instanceof Error)throw new Error((r=i.name,s=u.message,`@postConstruct error in class ${r}: ${s}`))}}var r,s})(n,e);return In(t)?t.then((()=>e)):e}function NS(n,e){n.scope!==St.Singleton&&(function(t,i){const o=`Class cannot be instantiated in ${t.scope===St.Request?"request":"transient"} scope.`;if(typeof t.onDeactivation=="function")throw new Error(zd(i.name,o));if(Reflect.hasMetadata(Vd,i))throw new Error(`@preDestroy error in class ${i.name}: ${o}`)})(n,e)}const Ml=n=>e=>{e.parentContext.setCurrentRequest(e);const t=e.bindings,i=e.childRequests,o=e.target&&e.target.isArray(),r=!(e.parentRequest&&e.parentRequest.target&&e.target&&e.parentRequest.target.matchesArray(e.target.serviceIdentifier));if(o&&r)return i.map((s=>Ml(n)(s)));{if(e.target.isOptional()&&t.length===0)return;const s=t[0];return zS(n,e,s)}},FS=(n,e)=>{const t=(i=>{switch(i.type){case Qe.Factory:return{factory:i.factory,factoryType:ea.Factory};case Qe.Provider:return{factory:i.provider,factoryType:ea.Provider};case Qe.DynamicValue:return{factory:i.dynamicValue,factoryType:ea.DynamicValue};default:throw new Error(`Unexpected factory type ${i.type}`)}})(n);return((i,o)=>{try{return i()}catch(r){throw Bv(r)?o():r}})((()=>t.factory.bind(n)(e)),(()=>{return new Error((i=t.factoryType,o=e.currentRequest.serviceIdentifier.toString(),`It looks like there is a circular dependency in one of the '${i}' bindings. Please investigate bindings with service identifier '${o}'.`));var i,o}))},BS=(n,e,t)=>{let i;const o=e.childRequests;switch((r=>{let s=null;switch(r.type){case Qe.ConstantValue:case Qe.Function:s=r.cache;break;case Qe.Constructor:case Qe.Instance:s=r.implementationType;break;case Qe.DynamicValue:s=r.dynamicValue;break;case Qe.Provider:s=r.provider;break;case Qe.Factory:s=r.factory}if(s===null){const a=Yr(r.serviceIdentifier);throw new Error(`Invalid binding type: ${a}`)}})(t),t.type){case Qe.ConstantValue:case Qe.Function:i=t.cache;break;case Qe.Constructor:i=t.implementationType;break;case Qe.Instance:i=(function(r,s,a,u){NS(r,s);const f=LS(s,a,u);return In(f)?f.then((d=>sh(s,d))):sh(s,f)})(t,t.implementationType,o,Ml(n));break;default:i=FS(t,e.parentContext)}return i},VS=(n,e,t)=>{let i=((o,r)=>r.scope===St.Singleton&&r.activated?r.cache:r.scope===St.Request&&o.has(r.id)?o.get(r.id):null)(n,e);return i!==null||(i=t(),((o,r,s)=>{r.scope===St.Singleton&&xS(r,s),r.scope===St.Request&&DS(o,r,s)})(n,e,i)),i},zS=(n,e,t)=>VS(n,t,(()=>{let i=BS(n,e,t);return i=In(i)?i.then((o=>ah(e,t,o))):ah(e,t,i),i}));function ah(n,e,t){let i=qS(n.parentContext,e,t);const o=$S(n.parentContext.container);let r,s=o.next();do{r=s.value;const a=n.parentContext,u=n.serviceIdentifier,f=KS(r,u);i=In(i)?Uv(f,a,i):HS(f,a,i),s=o.next()}while(s.done!==!0&&!iu(r).hasKey(n.serviceIdentifier));return i}const qS=(n,e,t)=>{let i;return i=typeof e.onActivation=="function"?e.onActivation(n,t):t,i},HS=(n,e,t)=>{let i=n.next();for(;i.done!==!0;){if(In(t=i.value(e,t)))return Uv(n,e,t);i=n.next()}return t},Uv=async(n,e,t)=>{let i=await t,o=n.next();for(;o.done!==!0;)i=await o.value(e,i),o=n.next();return i},KS=(n,e)=>{const t=n._activations;return t.hasKey(e)?t.get(e).values():[].values()},$S=n=>{const e=[n];let t=n.parent;for(;t!==null;)e.push(t),t=t.parent;return{next:()=>{const i=e.pop();return i!==void 0?{done:!1,value:i}:{done:!0,value:void 0}}}},gr=(n,e)=>{const t=n.parentRequest;return t!==null&&(!!e(t)||gr(t,e))},Zs=n=>e=>{const t=i=>i!==null&&i.target!==null&&i.target.matchesTag(n)(e);return t.metaData=new Lo(n,e),t},Za=Zs(vi),ed=n=>e=>{let t=null;if(e!==null){if(t=e.bindings[0],typeof n=="string")return t.serviceIdentifier===n;{const i=e.bindings[0].implementationType;return n===i}}return!1};class ru{_binding;constructor(e){this._binding=e}when(e){return this._binding.constraint=e,new Xt(this._binding)}whenTargetNamed(e){return this._binding.constraint=Za(e),new Xt(this._binding)}whenTargetIsDefault(){return this._binding.constraint=e=>e===null?!1:e.target!==null&&!e.target.isNamed()&&!e.target.isTagged(),new Xt(this._binding)}whenTargetTagged(e,t){return this._binding.constraint=Zs(e)(t),new Xt(this._binding)}whenInjectedInto(e){return this._binding.constraint=t=>t!==null&&ed(e)(t.parentRequest),new Xt(this._binding)}whenParentNamed(e){return this._binding.constraint=t=>t!==null&&Za(e)(t.parentRequest),new Xt(this._binding)}whenParentTagged(e,t){return this._binding.constraint=i=>i!==null&&Zs(e)(t)(i.parentRequest),new Xt(this._binding)}whenAnyAncestorIs(e){return this._binding.constraint=t=>t!==null&&gr(t,ed(e)),new Xt(this._binding)}whenNoAncestorIs(e){return this._binding.constraint=t=>t!==null&&!gr(t,ed(e)),new Xt(this._binding)}whenAnyAncestorNamed(e){return this._binding.constraint=t=>t!==null&&gr(t,Za(e)),new Xt(this._binding)}whenNoAncestorNamed(e){return this._binding.constraint=t=>t!==null&&!gr(t,Za(e)),new Xt(this._binding)}whenAnyAncestorTagged(e,t){return this._binding.constraint=i=>i!==null&&gr(i,Zs(e)(t)),new Xt(this._binding)}whenNoAncestorTagged(e,t){return this._binding.constraint=i=>i!==null&&!gr(i,Zs(e)(t)),new Xt(this._binding)}whenAnyAncestorMatches(e){return this._binding.constraint=t=>t!==null&&gr(t,e),new Xt(this._binding)}whenNoAncestorMatches(e){return this._binding.constraint=t=>t!==null&&!gr(t,e),new Xt(this._binding)}}class Xt{_binding;constructor(e){this._binding=e}onActivation(e){return this._binding.onActivation=e,new ru(this._binding)}onDeactivation(e){return this._binding.onDeactivation=e,new ru(this._binding)}}class yr{_bindingWhenSyntax;_bindingOnSyntax;_binding;constructor(e){this._binding=e,this._bindingWhenSyntax=new ru(this._binding),this._bindingOnSyntax=new Xt(this._binding)}when(e){return this._bindingWhenSyntax.when(e)}whenTargetNamed(e){return this._bindingWhenSyntax.whenTargetNamed(e)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)}whenInjectedInto(e){return this._bindingWhenSyntax.whenInjectedInto(e)}whenParentNamed(e){return this._bindingWhenSyntax.whenParentNamed(e)}whenParentTagged(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)}whenAnyAncestorIs(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)}whenNoAncestorIs(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)}whenAnyAncestorNamed(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)}whenAnyAncestorTagged(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)}whenNoAncestorNamed(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)}whenNoAncestorTagged(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)}whenAnyAncestorMatches(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)}whenNoAncestorMatches(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)}onActivation(e){return this._bindingOnSyntax.onActivation(e)}onDeactivation(e){return this._bindingOnSyntax.onDeactivation(e)}}class YS{_binding;constructor(e){this._binding=e}inRequestScope(){return this._binding.scope=St.Request,new yr(this._binding)}inSingletonScope(){return this._binding.scope=St.Singleton,new yr(this._binding)}inTransientScope(){return this._binding.scope=St.Transient,new yr(this._binding)}}class ch{_bindingInSyntax;_bindingWhenSyntax;_bindingOnSyntax;_binding;constructor(e){this._binding=e,this._bindingWhenSyntax=new ru(this._binding),this._bindingOnSyntax=new Xt(this._binding),this._bindingInSyntax=new YS(e)}inRequestScope(){return this._bindingInSyntax.inRequestScope()}inSingletonScope(){return this._bindingInSyntax.inSingletonScope()}inTransientScope(){return this._bindingInSyntax.inTransientScope()}when(e){return this._bindingWhenSyntax.when(e)}whenTargetNamed(e){return this._bindingWhenSyntax.whenTargetNamed(e)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)}whenInjectedInto(e){return this._bindingWhenSyntax.whenInjectedInto(e)}whenParentNamed(e){return this._bindingWhenSyntax.whenParentNamed(e)}whenParentTagged(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)}whenAnyAncestorIs(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)}whenNoAncestorIs(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)}whenAnyAncestorNamed(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)}whenAnyAncestorTagged(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)}whenNoAncestorNamed(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)}whenNoAncestorTagged(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)}whenAnyAncestorMatches(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)}whenNoAncestorMatches(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)}onActivation(e){return this._bindingOnSyntax.onActivation(e)}onDeactivation(e){return this._bindingOnSyntax.onDeactivation(e)}}class kS{_binding;constructor(e){this._binding=e}to(e){return this._binding.type=Qe.Instance,this._binding.implementationType=e,new ch(this._binding)}toSelf(){if(typeof this._binding.serviceIdentifier!="function")throw new Error("The toSelf function can only be applied when a constructor is used as service identifier");const e=this._binding.serviceIdentifier;return this.to(e)}toConstantValue(e){return this._binding.type=Qe.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=St.Singleton,new yr(this._binding)}toDynamicValue(e){return this._binding.type=Qe.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new ch(this._binding)}toConstructor(e){return this._binding.type=Qe.Constructor,this._binding.implementationType=e,this._binding.scope=St.Singleton,new yr(this._binding)}toFactory(e){return this._binding.type=Qe.Factory,this._binding.factory=e,this._binding.scope=St.Singleton,new yr(this._binding)}toFunction(e){if(typeof e!="function")throw new Error("Value provided to function binding must be a function!");const t=this.toConstantValue(e);return this._binding.type=Qe.Function,this._binding.scope=St.Singleton,t}toAutoFactory(e){return this._binding.type=Qe.Factory,this._binding.factory=t=>()=>t.container.get(e),this._binding.scope=St.Singleton,new yr(this._binding)}toAutoNamedFactory(e){return this._binding.type=Qe.Factory,this._binding.factory=t=>i=>t.container.getNamed(e,i),new yr(this._binding)}toProvider(e){return this._binding.type=Qe.Provider,this._binding.provider=e,this._binding.scope=St.Singleton,new yr(this._binding)}toService(e){this._binding.type=Qe.DynamicValue,Object.defineProperty(this._binding,"cache",{configurable:!0,enumerable:!0,get:()=>null,set(t){}}),this._binding.dynamicValue=t=>{try{return t.container.get(e)}catch{return t.container.getAsync(e)}},this._binding.implementationType=null}}class Rl{bindings;activations;deactivations;middleware;moduleActivationStore;static of(e,t,i,o,r){const s=new Rl;return s.bindings=e,s.middleware=t,s.deactivations=o,s.activations=i,s.moduleActivationStore=r,s}}class vr{_map;constructor(){this._map=new Map}getMap(){return this._map}add(e,t){if(this._checkNonNulish(e),t==null)throw new Error(Qf);const i=this._map.get(e);i!==void 0?i.push(t):this._map.set(e,[t])}get(e){this._checkNonNulish(e);const t=this._map.get(e);if(t!==void 0)return t;throw new Error(eh)}remove(e){if(this._checkNonNulish(e),!this._map.delete(e))throw new Error(eh)}removeIntersection(e){this.traverse(((t,i)=>{const o=e.hasKey(t)?e.get(t):void 0;if(o!==void 0){const r=i.filter((s=>!o.some((a=>s===a))));this._setValue(t,r)}}))}removeByCondition(e){const t=[];return this._map.forEach(((i,o)=>{const r=[];for(const s of i)e(s)?t.push(s):r.push(s);this._setValue(o,r)})),t}hasKey(e){return this._checkNonNulish(e),this._map.has(e)}clone(){const e=new vr;return this._map.forEach(((t,i)=>{t.forEach((o=>{var r;e.add(i,typeof(r=o)=="object"&&r!==null&&"clone"in r&&typeof r.clone=="function"?o.clone():o)}))})),e}traverse(e){this._map.forEach(((t,i)=>{e(i,t)}))}_checkNonNulish(e){if(e==null)throw new Error(Qf)}_setValue(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)}}class Al{_map=new Map;remove(e){const t=this._map.get(e);return t===void 0?this._getEmptyHandlersStore():(this._map.delete(e),t)}addDeactivation(e,t,i){this._getModuleActivationHandlers(e).onDeactivations.add(t,i)}addActivation(e,t,i){this._getModuleActivationHandlers(e).onActivations.add(t,i)}clone(){const e=new Al;return this._map.forEach(((t,i)=>{e._map.set(i,{onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})})),e}_getModuleActivationHandlers(e){let t=this._map.get(e);return t===void 0&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t}_getEmptyHandlersStore(){return{onActivations:new vr,onDeactivations:new vr}}}class ou{id;parent;options;_middleware;_bindingDictionary;_activations;_deactivations;_snapshots;_metadataReader;_moduleActivationStore;constructor(e){const t=e||{};if(typeof t!="object")throw new Error("Invalid Container constructor argument. Container options must be an object.");if(t.defaultScope===void 0)t.defaultScope=St.Transient;else if(t.defaultScope!==St.Singleton&&t.defaultScope!==St.Transient&&t.defaultScope!==St.Request)throw new Error('Invalid Container option. Default scope must be a string ("singleton" or "transient").');if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error("Invalid Container option. Auto bind injectable must be a boolean");if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error("Invalid Container option. Skip base check must be a boolean");this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=Ea(),this._bindingDictionary=new vr,this._snapshots=[],this._middleware=null,this._activations=new vr,this._deactivations=new vr,this.parent=null,this._metadataReader=new IS,this._moduleActivationStore=new Al}static merge(e,t,...i){const o=new ou,r=[e,t,...i].map((a=>iu(a))),s=iu(o);return r.forEach((a=>{var u;u=s,a.traverse(((f,d)=>{d.forEach((c=>{u.add(c.serviceIdentifier,c.clone())}))}))})),o}load(...e){const t=this._getContainerModuleHelpersFactory();for(const i of e){const o=t(i.id);i.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction,o.unbindAsyncFunction,o.onActivationFunction,o.onDeactivationFunction)}}async loadAsync(...e){const t=this._getContainerModuleHelpersFactory();for(const i of e){const o=t(i.id);await i.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction,o.unbindAsyncFunction,o.onActivationFunction,o.onDeactivationFunction)}}unload(...e){e.forEach((t=>{const i=this._removeModuleBindings(t.id);this._deactivateSingletons(i),this._removeModuleHandlers(t.id)}))}async unloadAsync(...e){for(const t of e){const i=this._removeModuleBindings(t.id);await this._deactivateSingletonsAsync(i),this._removeModuleHandlers(t.id)}}bind(e){return this._bind(this._buildBinding(e))}rebind(e){return this.unbind(e),this.bind(e)}async rebindAsync(e){return await this.unbindAsync(e),this.bind(e)}unbind(e){if(this._bindingDictionary.hasKey(e)){const t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)}async unbindAsync(e){if(this._bindingDictionary.hasKey(e)){const t=this._bindingDictionary.get(e);await this._deactivateSingletonsAsync(t)}this._removeServiceFromDictionary(e)}unbindAll(){this._bindingDictionary.traverse(((e,t)=>{this._deactivateSingletons(t)})),this._bindingDictionary=new vr}async unbindAllAsync(){const e=[];this._bindingDictionary.traverse(((t,i)=>{e.push(this._deactivateSingletonsAsync(i))})),await Promise.all(e),this._bindingDictionary=new vr}onActivation(e,t){this._activations.add(e,t)}onDeactivation(e,t){this._deactivations.add(e,t)}isBound(e){let t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t}isCurrentBound(e){return this._bindingDictionary.hasKey(e)}isBoundNamed(e,t){return this.isBoundTagged(e,vi,t)}isBoundTagged(e,t,i){let o=!1;if(this._bindingDictionary.hasKey(e)){const r=this._bindingDictionary.get(e),s=(function(a,u,f){const d=$v(u,f),c=Eu(d);if(c.kind===Cn.unmanaged)throw new Error("Unexpected metadata when creating target");const l=new nu("",c,"Variable"),p=new Hv(a);return new Pa(u,p,null,[],l)})(this,e,{customTag:{key:t,value:i},isMultiInject:!1});o=r.some((a=>a.constraint(s)))}return!o&&this.parent&&(o=this.parent.isBoundTagged(e,t,i)),o}snapshot(){this._snapshots.push(Rl.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))}restore(){const e=this._snapshots.pop();if(e===void 0)throw new Error("No snapshot available to restore.");this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore}createChild(e){const t=new ou(e||this.options);return t.parent=this,t}applyMiddleware(...e){const t=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(((i,o)=>o(i)),t)}applyCustomMetadataReader(e){this._metadataReader=e}get(e){const t=this._getNotAllArgs(e,!1,!1);return this._getButThrowIfAsync(t)}async getAsync(e){const t=this._getNotAllArgs(e,!1,!1);return this._get(t)}getTagged(e,t,i){const o=this._getNotAllArgs(e,!1,!1,t,i);return this._getButThrowIfAsync(o)}async getTaggedAsync(e,t,i){const o=this._getNotAllArgs(e,!1,!1,t,i);return this._get(o)}getNamed(e,t){return this.getTagged(e,vi,t)}async getNamedAsync(e,t){return this.getTaggedAsync(e,vi,t)}getAll(e,t){const i=this._getAllArgs(e,t,!1);return this._getButThrowIfAsync(i)}async getAllAsync(e,t){const i=this._getAllArgs(e,t,!1);return this._getAll(i)}getAllTagged(e,t,i){const o=this._getNotAllArgs(e,!0,!1,t,i);return this._getButThrowIfAsync(o)}async getAllTaggedAsync(e,t,i){const o=this._getNotAllArgs(e,!0,!1,t,i);return this._getAll(o)}getAllNamed(e,t){return this.getAllTagged(e,vi,t)}async getAllNamedAsync(e,t){return this.getAllTaggedAsync(e,vi,t)}resolve(e){const t=this.isBound(e);t||this.bind(e).toSelf();const i=this.get(e);return t||this.unbind(e),i}tryGet(e){const t=this._getNotAllArgs(e,!1,!0);return this._getButThrowIfAsync(t)}async tryGetAsync(e){const t=this._getNotAllArgs(e,!1,!0);return this._get(t)}tryGetTagged(e,t,i){const o=this._getNotAllArgs(e,!1,!0,t,i);return this._getButThrowIfAsync(o)}async tryGetTaggedAsync(e,t,i){const o=this._getNotAllArgs(e,!1,!0,t,i);return this._get(o)}tryGetNamed(e,t){return this.tryGetTagged(e,vi,t)}async tryGetNamedAsync(e,t){return this.tryGetTaggedAsync(e,vi,t)}tryGetAll(e,t){const i=this._getAllArgs(e,t,!0);return this._getButThrowIfAsync(i)}async tryGetAllAsync(e,t){const i=this._getAllArgs(e,t,!0);return this._getAll(i)}tryGetAllTagged(e,t,i){const o=this._getNotAllArgs(e,!0,!0,t,i);return this._getButThrowIfAsync(o)}async tryGetAllTaggedAsync(e,t,i){const o=this._getNotAllArgs(e,!0,!0,t,i);return this._getAll(o)}tryGetAllNamed(e,t){return this.tryGetAllTagged(e,vi,t)}async tryGetAllNamedAsync(e,t){return this.tryGetAllTaggedAsync(e,vi,t)}_preDestroy(e,t){if(e!==void 0&&Reflect.hasMetadata(Vd,e)){const i=Reflect.getMetadata(Vd,e);return t[i.value]?.()}}_removeModuleHandlers(e){const t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)}_removeModuleBindings(e){return this._bindingDictionary.removeByCondition((t=>t.moduleId===e))}_deactivate(e,t){const i=t==null?void 0:Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){const r=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if(In(r))return this._handleDeactivationError(r.then((async()=>this._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,i))),e.serviceIdentifier)}const o=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,i);if(In(o))return this._handleDeactivationError(o,e.serviceIdentifier)}catch(o){if(o instanceof Error)throw new Error(zd(Yr(e.serviceIdentifier),o.message))}}async _handleDeactivationError(e,t){try{await e}catch(i){if(i instanceof Error)throw new Error(zd(Yr(t),i.message))}}_deactivateContainer(e,t){let i=t.next();for(;typeof i.value=="function";){const o=i.value(e);if(In(o))return o.then((async()=>this._deactivateContainerAsync(e,t)));i=t.next()}}async _deactivateContainerAsync(e,t){let i=t.next();for(;typeof i.value=="function";)await i.value(e),i=t.next()}_getContainerModuleHelpersFactory(){const e=u=>f=>{const d=this._buildBinding(f);return d.moduleId=u,this._bind(d)},t=()=>u=>{this.unbind(u)},i=()=>async u=>this.unbindAsync(u),o=()=>u=>this.isBound(u),r=u=>{const f=e(u);return d=>(this.unbind(d),f(d))},s=u=>(f,d)=>{this._moduleActivationStore.addActivation(u,f,d),this.onActivation(f,d)},a=u=>(f,d)=>{this._moduleActivationStore.addDeactivation(u,f,d),this.onDeactivation(f,d)};return u=>({bindFunction:e(u),isboundFunction:o(),onActivationFunction:s(u),onDeactivationFunction:a(u),rebindFunction:r(u),unbindAsyncFunction:i(),unbindFunction:t()})}_bind(e){return this._bindingDictionary.add(e.serviceIdentifier,e),new kS(e)}_buildBinding(e){const t=this.options.defaultScope||St.Transient;return new Pl(e,t)}async _getAll(e){return Promise.all(this._get(e))}_get(e){const t={...e,contextInterceptor:i=>i,targetType:Lv.Variable};if(this._middleware){const i=this._middleware(t);if(i==null)throw new Error("Invalid return type in middleware. Middleware must return!");return i}return this._planAndResolve()(t)}_getButThrowIfAsync(e){const t=this._get(e);if(kv(t))throw new Error(`You are attempting to construct ${(function(i){return typeof i=="function"?`[function/class ${i.name||"<anonymous>"}]`:typeof i=="symbol"?i.toString():`'${i}'`})(e.serviceIdentifier)} in a synchronous way but it has asynchronous dependencies.`);return t}_getAllArgs(e,t,i){return{avoidConstraints:!t?.enforceBindingConstraints,isMultiInject:!0,isOptional:i,serviceIdentifier:e}}_getNotAllArgs(e,t,i,o,r){return{avoidConstraints:!1,isMultiInject:t,isOptional:i,key:o,serviceIdentifier:e,value:r}}_getPlanMetadataFromNextArgs(e){const t={isMultiInject:e.isMultiInject};return e.key!==void 0&&(t.customTag={key:e.key,value:e.value}),e.isOptional===!0&&(t.isOptional=!0),t}_planAndResolve(){return e=>{let t=TS(this._metadataReader,this,e.targetType,e.serviceIdentifier,this._getPlanMetadataFromNextArgs(e),e.avoidConstraints);return t=e.contextInterceptor(t),(function(o){return Ml(o.plan.rootRequest.requestScope)(o.plan.rootRequest)})(t)}}_deactivateIfSingleton(e){if(e.activated)return In(e.cache)?e.cache.then((t=>this._deactivate(e,t))):this._deactivate(e,e.cache)}_deactivateSingletons(e){for(const t of e)if(In(this._deactivateIfSingleton(t)))throw new Error("Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)")}async _deactivateSingletonsAsync(e){await Promise.all(e.map((async t=>this._deactivateIfSingleton(t))))}_propagateContainerDeactivationThenBindingAndPreDestroy(e,t,i){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,i)}async _propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,i){this.parent?await this._deactivate.bind(this.parent)(e,t):await this._bindingDeactivationAndPreDestroyAsync(e,t,i)}_removeServiceFromDictionary(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(`Could not unbind serviceIdentifier: ${Yr(e)}`)}}_bindingDeactivationAndPreDestroy(e,t,i){if(typeof e.onDeactivation=="function"){const o=e.onDeactivation(t);if(In(o))return o.then((()=>this._preDestroy(i,t)))}return this._preDestroy(i,t)}async _bindingDeactivationAndPreDestroyAsync(e,t,i){typeof e.onDeactivation=="function"&&await e.onDeactivation(t),await this._preDestroy(i,t)}}class At{id;registry;constructor(e){this.id=Ea(),this.registry=e}}function US(n,e,t,i){(function(o){if(o!==void 0)throw new Error(Fv)})(e),Gv(Dv,n,t.toString(),i)}function GS(n){let e=[];if(Array.isArray(n)){e=n;const t=(function(i){const o=new Set;for(const r of i){if(o.has(r))return r;o.add(r)}})(e.map((i=>i.key)));if(t!==void 0)throw new Error(`${Nv} ${t.toString()}`)}else e=[n];return e}function Gv(n,e,t,i){const o=GS(i);let r={};Reflect.hasOwnMetadata(n,e)&&(r=Reflect.getMetadata(n,e));let s=r[t];if(s===void 0)s=[];else for(const a of s)if(o.some((u=>u.key===a.key)))throw new Error(`${Nv} ${a.key.toString()}`);s.push(...o),r[t]=s,Reflect.defineMetadata(n,r,e)}function Xv(n){return(e,t,i)=>{typeof i=="number"?US(e,t,i,n):(function(o,r,s){if(o.prototype!==void 0)throw new Error(Fv);Gv(xv,o.constructor,r,s)})(e,t,n)}}function Re(){return function(n){if(Reflect.hasOwnMetadata(Zf,n))throw new Error("Cannot apply @injectable decorator multiple times.");const e=Reflect.getMetadata(jv,n)||[];return Reflect.defineMetadata(Zf,e,n),n}}function Wv(n){return e=>(t,i,o)=>{if(e===void 0){const r=typeof t=="function"?t.name:t.constructor.name;throw new Error(`@inject called with undefined this could mean that the class ${r} has a circular dependency problem. You can use a LazyServiceIdentifer to overcome this limitation.`)}Xv(new Lo(n,e))(t,i,o)}}const Ee=Wv(Cv);function Zv(){return Xv(new Lo(Iv,!0))}const Jv=Wv(Tv);var or={},ao={},uh;function Ol(){if(uh)return ao;uh=1,Object.defineProperty(ao,"__esModule",{value:!0}),ao.isLabeledAction=ao.LabeledAction=void 0;class n{constructor(i,o,r){this.label=i,this.actions=o,this.icon=r}}ao.LabeledAction=n;function e(t){return t!==void 0&&t.label!==void 0&&t.actions!==void 0}return ao.isLabeledAction=e,ao}var Mi={},sr={},td={},Ja={},dh;function XS(){if(dh)return Ja;dh=1,Object.defineProperty(Ja,"__esModule",{value:!0}),Ja.stringifyServiceIdentifier=n;function n(e){switch(typeof e){case"string":case"symbol":return e.toString();case"function":return e.name;default:throw new Error(`Unexpected ${typeof e} service id type`)}}return Ja}var nd={},lh;function WS(){return lh||(lh=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.LazyServiceIdentifier=n.islazyServiceIdentifierSymbol=void 0,n.islazyServiceIdentifierSymbol=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");class e{[n.islazyServiceIdentifierSymbol];#e;constructor(i){this.#e=i,this[n.islazyServiceIdentifierSymbol]=!0}static is(i){return typeof i=="object"&&i!==null&&i[n.islazyServiceIdentifierSymbol]===!0}unwrap(){return this.#e()}}n.LazyServiceIdentifier=e})(nd)),nd}var fh;function qd(){return fh||(fh=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.stringifyServiceIdentifier=n.LazyServiceIdentifier=void 0;const e=XS();Object.defineProperty(n,"stringifyServiceIdentifier",{enumerable:!0,get:function(){return e.stringifyServiceIdentifier}});const t=WS();Object.defineProperty(n,"LazyServiceIdentifier",{enumerable:!0,get:function(){return t.LazyServiceIdentifier}})})(td)),td}var id={},hh;function Bt(){return hh||(hh=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.NON_CUSTOM_TAG_KEYS=n.PRE_DESTROY=n.POST_CONSTRUCT=n.DESIGN_PARAM_TYPES=n.PARAM_TYPES=n.TAGGED_PROP=n.TAGGED=n.MULTI_INJECT_TAG=n.INJECT_TAG=n.OPTIONAL_TAG=n.UNMANAGED_TAG=n.NAME_TAG=n.NAMED_TAG=void 0,n.NAMED_TAG="named",n.NAME_TAG="name",n.UNMANAGED_TAG="unmanaged",n.OPTIONAL_TAG="optional",n.INJECT_TAG="inject",n.MULTI_INJECT_TAG="multi_inject",n.TAGGED="inversify:tagged",n.TAGGED_PROP="inversify:tagged_props",n.PARAM_TYPES="inversify:paramtypes",n.DESIGN_PARAM_TYPES="design:paramtypes",n.POST_CONSTRUCT="post_construct",n.PRE_DESTROY="pre_destroy";function e(){return[n.INJECT_TAG,n.MULTI_INJECT_TAG,n.NAME_TAG,n.UNMANAGED_TAG,n.NAMED_TAG,n.OPTIONAL_TAG]}n.NON_CUSTOM_TAG_KEYS=e()})(id)),id}var oi={},bs={},ar={},ph;function Qi(){if(ph)return ar;ph=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.TargetTypeEnum=ar.BindingTypeEnum=ar.BindingScopeEnum=void 0;const n={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ar.BindingScopeEnum=n;const e={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ar.BindingTypeEnum=e;const t={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};return ar.TargetTypeEnum=t,ar}var Qa={},gh;function is(){if(gh)return Qa;gh=1,Object.defineProperty(Qa,"__esModule",{value:!0}),Qa.id=e;let n=0;function e(){return n++}return Qa}var mh;function ZS(){if(mh)return bs;mh=1,Object.defineProperty(bs,"__esModule",{value:!0}),bs.Binding=void 0;const n=Qi(),e=is();class t{id;moduleId;activated;serviceIdentifier;implementationType;cache;dynamicValue;scope;type;factory;provider;constraint;onActivation;onDeactivation;constructor(o,r){this.id=(0,e.id)(),this.activated=!1,this.serviceIdentifier=o,this.scope=r,this.type=n.BindingTypeEnum.Invalid,this.constraint=s=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}clone(){const o=new t(this.serviceIdentifier,this.scope);return o.activated=o.scope===n.BindingScopeEnum.Singleton?this.activated:!1,o.implementationType=this.implementationType,o.dynamicValue=this.dynamicValue,o.scope=this.scope,o.type=this.type,o.factory=this.factory,o.provider=this.provider,o.constraint=this.constraint,o.onActivation=this.onActivation,o.onDeactivation=this.onDeactivation,o.cache=this.cache,o}}return bs.Binding=t,bs}var be={},yh;function Tn(){if(yh)return be;yh=1,Object.defineProperty(be,"__esModule",{value:!0}),be.STACK_OVERFLOW=be.CIRCULAR_DEPENDENCY_IN_FACTORY=be.ON_DEACTIVATION_ERROR=be.PRE_DESTROY_ERROR=be.POST_CONSTRUCT_ERROR=be.ASYNC_UNBIND_REQUIRED=be.MULTIPLE_POST_CONSTRUCT_METHODS=be.MULTIPLE_PRE_DESTROY_METHODS=be.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=be.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=be.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=be.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=be.ARGUMENTS_LENGTH_MISMATCH=be.INVALID_DECORATOR_OPERATION=be.INVALID_TO_SELF_VALUE=be.LAZY_IN_SYNC=be.INVALID_FUNCTION_BINDING=be.INVALID_MIDDLEWARE_RETURN=be.NO_MORE_SNAPSHOTS_AVAILABLE=be.INVALID_BINDING_TYPE=be.CIRCULAR_DEPENDENCY=be.UNDEFINED_INJECT_ANNOTATION=be.TRYING_TO_RESOLVE_BINDINGS=be.NOT_REGISTERED=be.CANNOT_UNBIND=be.AMBIGUOUS_MATCH=be.KEY_NOT_FOUND=be.NULL_ARGUMENT=be.DUPLICATED_METADATA=be.DUPLICATED_INJECTABLE_DECORATOR=void 0,be.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",be.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",be.NULL_ARGUMENT="NULL argument",be.KEY_NOT_FOUND="Key Not Found",be.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",be.CANNOT_UNBIND="Could not unbind serviceIdentifier:",be.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";const n=f=>`Trying to resolve bindings for "${f}"`;be.TRYING_TO_RESOLVE_BINDINGS=n;const e=f=>`@inject called with undefined this could mean that the class ${f} has a circular dependency problem. You can use a LazyServiceIdentifer to overcome this limitation.`;be.UNDEFINED_INJECT_ANNOTATION=e,be.CIRCULAR_DEPENDENCY="Circular dependency found:",be.INVALID_BINDING_TYPE="Invalid binding type:",be.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",be.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",be.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";const t=f=>`You are attempting to construct ${u(f)} in a synchronous way but it has asynchronous dependencies.`;be.LAZY_IN_SYNC=t,be.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",be.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";const i=f=>`The number of constructor arguments in the derived class ${f} must be >= than the number of constructor arguments of its base class.`;be.ARGUMENTS_LENGTH_MISMATCH=i,be.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",be.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE='Invalid Container option. Default scope must be a string ("singleton" or "transient").',be.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",be.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",be.MULTIPLE_PRE_DESTROY_METHODS="Cannot apply @preDestroy decorator multiple times in the same class",be.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",be.ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)";const o=(f,d)=>`@postConstruct error in class ${f}: ${d}`;be.POST_CONSTRUCT_ERROR=o;const r=(f,d)=>`@preDestroy error in class ${f}: ${d}`;be.PRE_DESTROY_ERROR=r;const s=(f,d)=>`onDeactivation() error in class ${f}: ${d}`;be.ON_DEACTIVATION_ERROR=s;const a=(f,d)=>`It looks like there is a circular dependency in one of the '${f}' bindings. Please investigate bindings with service identifier '${d}'.`;be.CIRCULAR_DEPENDENCY_IN_FACTORY=a,be.STACK_OVERFLOW="Maximum call stack size exceeded";function u(f){return typeof f=="function"?`[function/class ${f.name||"<anonymous>"}]`:typeof f=="symbol"?f.toString():`'${f}'`}return be}var si={},vh;function Qv(){if(vh)return si;vh=1;var n=si&&si.__createBinding||(Object.create?(function(r,s,a,u){u===void 0&&(u=a);var f=Object.getOwnPropertyDescriptor(s,a);(!f||("get"in f?!s.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return s[a]}}),Object.defineProperty(r,u,f)}):(function(r,s,a,u){u===void 0&&(u=a),r[u]=s[a]})),e=si&&si.__setModuleDefault||(Object.create?(function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}):function(r,s){r.default=s}),t=si&&si.__importStar||(function(){var r=function(s){return r=Object.getOwnPropertyNames||function(a){var u=[];for(var f in a)Object.prototype.hasOwnProperty.call(a,f)&&(u[u.length]=f);return u},r(s)};return function(s){if(s&&s.__esModule)return s;var a={};if(s!=null)for(var u=r(s),f=0;f<u.length;f++)u[f]!=="default"&&n(a,s,u[f]);return e(a,s),a}})();Object.defineProperty(si,"__esModule",{value:!0}),si.MetadataReader=void 0;const i=t(Bt());class o{getConstructorMetadata(s){const a=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,s)??[],u=Reflect.getMetadata(i.TAGGED,s);return{compilerGeneratedMetadata:a,userGeneratedMetadata:u??{}}}getPropertiesMetadata(s){return Reflect.getMetadata(i.TAGGED_PROP,s)??{}}}return si.MetadataReader=o,si}var Kn={},rd={},Ss={},ec={},od={},tc={},_h;function e_(){if(_h)return tc;_h=1,Object.defineProperty(tc,"__esModule",{value:!0}),tc.getReflectMetadata=n;function n(e,t){return Reflect.getMetadata(t,e)}return tc}var nc={},bh;function JS(){if(bh)return nc;bh=1,Object.defineProperty(nc,"__esModule",{value:!0}),nc.updateReflectMetadata=e;const n=e_();function e(t,i,o,r){const s=(0,n.getReflectMetadata)(t,i)??o,a=r(s);Reflect.defineMetadata(i,a,t)}return nc}var Sh;function Ma(){return Sh||(Sh=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateReflectMetadata=n.getReflectMetadata=void 0;const e=e_();Object.defineProperty(n,"getReflectMetadata",{enumerable:!0,get:function(){return e.getReflectMetadata}});const t=JS();Object.defineProperty(n,"updateReflectMetadata",{enumerable:!0,get:function(){return t.updateReflectMetadata}})})(od)),od}var sd={},wh;function Ro(){return wh||(wh=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.NON_CUSTOM_TAG_KEYS=n.PRE_DESTROY=n.POST_CONSTRUCT=n.DESIGN_PARAM_TYPES=n.PARAM_TYPES=n.TAGGED_PROP=n.TAGGED=n.MULTI_INJECT_TAG=n.INJECT_TAG=n.OPTIONAL_TAG=n.UNMANAGED_TAG=n.NAME_TAG=n.NAMED_TAG=void 0,n.NAMED_TAG="named",n.NAME_TAG="name",n.UNMANAGED_TAG="unmanaged",n.OPTIONAL_TAG="optional",n.INJECT_TAG="inject",n.MULTI_INJECT_TAG="multi_inject",n.TAGGED="inversify:tagged",n.TAGGED_PROP="inversify:tagged_props",n.PARAM_TYPES="inversify:paramtypes",n.DESIGN_PARAM_TYPES="design:paramtypes",n.POST_CONSTRUCT="post_construct",n.PRE_DESTROY="pre_destroy";function e(){return[n.INJECT_TAG,n.MULTI_INJECT_TAG,n.NAME_TAG,n.UNMANAGED_TAG,n.NAMED_TAG,n.OPTIONAL_TAG]}n.NON_CUSTOM_TAG_KEYS=e()})(sd)),sd}var ic={},rc={},ad={},Eh;function Pu(){return Eh||(Eh=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.InversifyCoreError=n.isAppErrorSymbol=void 0,n.isAppErrorSymbol=Symbol.for("@inversifyjs/core/InversifyCoreError");class e extends Error{[n.isAppErrorSymbol];kind;constructor(i,o,r){super(o,r),this[n.isAppErrorSymbol]=!0,this.kind=i}static is(i){return typeof i=="object"&&i!==null&&i[n.isAppErrorSymbol]===!0}static isErrorOfKind(i,o){return e.is(i)&&i.kind===o}}n.InversifyCoreError=e})(ad)),ad}var ws={},Ph;function Mu(){if(Ph)return ws;Ph=1,Object.defineProperty(ws,"__esModule",{value:!0}),ws.InversifyCoreErrorKind=void 0;var n;return(function(e){e[e.injectionDecoratorConflict=0]="injectionDecoratorConflict",e[e.missingInjectionDecorator=1]="missingInjectionDecorator",e[e.planning=2]="planning",e[e.unknown=3]="unknown"})(n||(ws.InversifyCoreErrorKind=n={})),ws}var Mh;function t_(){if(Mh)return rc;Mh=1,Object.defineProperty(rc,"__esModule",{value:!0}),rc.assertConstructorMetadataArrayFilled=t;const n=Pu(),e=Mu();function t(i,o){const r=[];for(let s=0;s<o.length;++s)o[s]===void 0&&r.push(s);if(r.length>0)throw new n.InversifyCoreError(e.InversifyCoreErrorKind.missingInjectionDecorator,`Found unexpected missing metadata on type "${i.name}" at constructor indexes "${r.join('", "')}".

Are you using @inject, @multiInject or @unmanaged decorators at those indexes?

If you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}return rc}var oc={},Es={},Rh;function rs(){if(Rh)return Es;Rh=1,Object.defineProperty(Es,"__esModule",{value:!0}),Es.ClassElementMetadataKind=void 0;var n;return(function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection",e[e.unmanaged=2]="unmanaged"})(n||(Es.ClassElementMetadataKind=n={})),Es}var Ah;function n_(){if(Ah)return oc;Ah=1,Object.defineProperty(oc,"__esModule",{value:!0}),oc.getClassElementMetadataFromNewable=e;const n=rs();function e(t){return{kind:n.ClassElementMetadataKind.singleInjection,name:void 0,optional:!1,tags:new Map,targetName:void 0,value:t}}return oc}var sc={},ac={},Oh;function Il(){if(Oh)return ac;Oh=1,Object.defineProperty(ac,"__esModule",{value:!0}),ac.getClassElementMetadataFromLegacyMetadata=o;const n=Pu(),e=Mu(),t=Ro(),i=rs();function o(s){const a=s.find(h=>h.key===t.INJECT_TAG),u=s.find(h=>h.key===t.MULTI_INJECT_TAG);if(s.find(h=>h.key===t.UNMANAGED_TAG)!==void 0)return r(a,u);if(u===void 0&&a===void 0)throw new n.InversifyCoreError(e.InversifyCoreErrorKind.missingInjectionDecorator,"Expected @inject, @multiInject or @unmanaged metadata");const d=s.find(h=>h.key===t.NAMED_TAG),c=s.find(h=>h.key===t.OPTIONAL_TAG),l=s.find(h=>h.key===t.NAME_TAG);return{kind:a===void 0?i.ClassElementMetadataKind.multipleInjection:i.ClassElementMetadataKind.singleInjection,name:d?.value,optional:c!==void 0,tags:new Map(s.filter(h=>t.NON_CUSTOM_TAG_KEYS.every(g=>h.key!==g)).map(h=>[h.key,h.value])),targetName:l?.value,value:a===void 0?u?.value:a.value}}function r(s,a){if(a!==void 0||s!==void 0)throw new n.InversifyCoreError(e.InversifyCoreErrorKind.missingInjectionDecorator,"Expected a single @inject, @multiInject or @unmanaged metadata");return{kind:i.ClassElementMetadataKind.unmanaged}}return ac}var Ih;function i_(){if(Ih)return sc;Ih=1,Object.defineProperty(sc,"__esModule",{value:!0}),sc.getConstructorArgumentMetadataFromLegacyMetadata=i;const n=Pu(),e=Mu(),t=Il();function i(o,r,s){try{return(0,t.getClassElementMetadataFromLegacyMetadata)(s)}catch(a){throw n.InversifyCoreError.isErrorOfKind(a,e.InversifyCoreErrorKind.missingInjectionDecorator)?new n.InversifyCoreError(e.InversifyCoreErrorKind.missingInjectionDecorator,`Expected a single @inject, @multiInject or @unmanaged decorator at type "${o.name}" at constructor arguments at index "${r.toString()}"`,{cause:a}):a}}return sc}var Ch;function QS(){if(Ch)return ic;Ch=1,Object.defineProperty(ic,"__esModule",{value:!0}),ic.getClassMetadataConstructorArguments=r;const n=Ma(),e=Ro(),t=t_(),i=n_(),o=i_();function r(s){const a=(0,n.getReflectMetadata)(s,e.DESIGN_PARAM_TYPES),u=(0,n.getReflectMetadata)(s,e.TAGGED),f=[];if(u!==void 0)for(const[d,c]of Object.entries(u)){const l=parseInt(d);f[l]=(0,o.getConstructorArgumentMetadataFromLegacyMetadata)(s,l,c)}if(a!==void 0){for(let d=0;d<a.length;++d)if(f[d]===void 0){const c=a[d];f[d]=(0,i.getClassElementMetadataFromNewable)(c)}}return(0,t.assertConstructorMetadataArrayFilled)(s,f),f}return ic}var cc={},uc={},Th;function r_(){if(Th)return uc;Th=1,Object.defineProperty(uc,"__esModule",{value:!0}),uc.getPropertyMetadataFromLegacyMetadata=i;const n=Pu(),e=Mu(),t=Il();function i(o,r,s){try{return(0,t.getClassElementMetadataFromLegacyMetadata)(s)}catch(a){throw n.InversifyCoreError.isErrorOfKind(a,e.InversifyCoreErrorKind.missingInjectionDecorator)?new n.InversifyCoreError(e.InversifyCoreErrorKind.missingInjectionDecorator,`Expected a single @inject, @multiInject or @unmanaged decorator at type "${o.name}" at property "${r.toString()}"`,{cause:a}):a}}return uc}var Dh;function o_(){if(Dh)return cc;Dh=1,Object.defineProperty(cc,"__esModule",{value:!0}),cc.getClassMetadataProperties=i;const n=Ma(),e=Ro(),t=r_();function i(o){const r=(0,n.getReflectMetadata)(o,e.TAGGED_PROP),s=new Map;if(r!==void 0)for(const a of Reflect.ownKeys(r)){const u=r[a];s.set(a,(0,t.getPropertyMetadataFromLegacyMetadata)(o,a,u))}return s}return cc}var xh;function s_(){if(xh)return ec;xh=1,Object.defineProperty(ec,"__esModule",{value:!0}),ec.getClassMetadata=o;const n=Ma(),e=Ro(),t=QS(),i=o_();function o(r){const s=(0,n.getReflectMetadata)(r,e.POST_CONSTRUCT),a=(0,n.getReflectMetadata)(r,e.PRE_DESTROY);return{constructorArguments:(0,t.getClassMetadataConstructorArguments)(r),lifecycle:{postConstructMethodName:s?.value,preDestroyMethodName:a?.value},properties:(0,i.getClassMetadataProperties)(r)}}return ec}var dc={},lc={},jh;function ew(){if(jh)return lc;jh=1,Object.defineProperty(lc,"__esModule",{value:!0}),lc.getClassMetadataConstructorArgumentsFromMetadataReader=i;const n=t_(),e=n_(),t=i_();function i(o,r){const s=r.getConstructorMetadata(o),a=[];for(const[u,f]of Object.entries(s.userGeneratedMetadata)){const d=parseInt(u);a[d]=(0,t.getConstructorArgumentMetadataFromLegacyMetadata)(o,d,f)}if(s.compilerGeneratedMetadata!==void 0){for(let u=0;u<s.compilerGeneratedMetadata.length;++u)if(a[u]===void 0){const f=s.compilerGeneratedMetadata[u];a[u]=(0,e.getClassElementMetadataFromNewable)(f)}}return(0,n.assertConstructorMetadataArrayFilled)(o,a),a}return lc}var fc={},Lh;function a_(){if(Lh)return fc;Lh=1,Object.defineProperty(fc,"__esModule",{value:!0}),fc.getClassMetadataPropertiesFromMetadataReader=e;const n=r_();function e(t,i){const o=i.getPropertiesMetadata(t),r=new Map;for(const s of Reflect.ownKeys(o)){const a=o[s];r.set(s,(0,n.getPropertyMetadataFromLegacyMetadata)(t,s,a))}return r}return fc}var Nh;function c_(){if(Nh)return dc;Nh=1,Object.defineProperty(dc,"__esModule",{value:!0}),dc.getClassMetadataFromMetadataReader=o;const n=Ma(),e=Ro(),t=ew(),i=a_();function o(r,s){const a=(0,n.getReflectMetadata)(r,e.POST_CONSTRUCT),u=(0,n.getReflectMetadata)(r,e.PRE_DESTROY);return{constructorArguments:(0,t.getClassMetadataConstructorArgumentsFromMetadataReader)(r,s),lifecycle:{postConstructMethodName:a?.value,preDestroyMethodName:u?.value},properties:(0,i.getClassMetadataPropertiesFromMetadataReader)(r,s)}}return dc}var hc={},pc={},Fh;function tw(){if(Fh)return pc;Fh=1,Object.defineProperty(pc,"__esModule",{value:!0}),pc.getBaseType=n;function n(e){return Object.getPrototypeOf(e.prototype)?.constructor}return pc}var Ps={},gc={},Bh;function nw(){if(Bh)return gc;Bh=1,Object.defineProperty(gc,"__esModule",{value:!0}),gc.getLegacyMetadata=t;const n=Ro(),e=rs();function t(s){switch(s.kind){case e.ClassElementMetadataKind.unmanaged:return r();default:return i(s)}}function i(s){const a=[o(s)];s.name!==void 0&&a.push({key:n.NAMED_TAG,value:s.name}),s.optional&&a.push({key:n.OPTIONAL_TAG,value:!0});for(const[u,f]of s.tags)a.push({key:u,value:f});return s.targetName!==void 0&&a.push({key:n.NAME_TAG,value:s.targetName}),a}function o(s){let a;switch(s.kind){case e.ClassElementMetadataKind.multipleInjection:a={key:n.MULTI_INJECT_TAG,value:s.value};break;case e.ClassElementMetadataKind.singleInjection:a={key:n.INJECT_TAG,value:s.value};break}return a}function r(){return[{key:n.UNMANAGED_TAG,value:!0}]}return gc}var Ms={},Vh;function iw(){if(Vh)return Ms;Vh=1,Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.LegacyQueryableStringImpl=void 0;let n=class{#e;constructor(t){this.#e=t}startsWith(t){return this.#e.startsWith(t)}endsWith(t){return this.#e.endsWith(t)}contains(t){return this.#e.includes(t)}equals(t){return this.#e===t}value(){return this.#e}};return Ms.LegacyQueryableStringImpl=n,Ms}var mc={},zh;function rw(){if(zh)return mc;zh=1,Object.defineProperty(mc,"__esModule",{value:!0}),mc.getDescription=t;const n=7,e=-1;function t(i){return i.toString().slice(n,e)}return mc}var yc={},qh;function ow(){if(qh)return yc;qh=1,Object.defineProperty(yc,"__esModule",{value:!0}),yc.getTargetId=t;const n=Ma(),e="@inversifyjs/core/targetId";function t(){const i=(0,n.getReflectMetadata)(Object,e)??0;return i===Number.MAX_SAFE_INTEGER?(0,n.updateReflectMetadata)(Object,e,i,()=>Number.MIN_SAFE_INTEGER):(0,n.updateReflectMetadata)(Object,e,i,o=>o+1),i}return yc}var Hh;function u_(){if(Hh)return Ps;Hh=1,Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.LegacyTargetImpl=void 0;const n=qd(),e=nw(),t=rs(),i=Ro(),o=iw(),r=rw(),s=ow();let a=class{#e;#n;#i;#t;#r;#o;constructor(f,d,c){this.#n=(0,s.getTargetId)(),this.#i=f,this.#t=void 0,this.#e=d,this.#r=new o.LegacyQueryableStringImpl(typeof f=="string"?f:(0,r.getDescription)(f)),this.#o=c}get id(){return this.#n}get identifier(){return this.#i}get metadata(){return this.#t===void 0&&(this.#t=(0,e.getLegacyMetadata)(this.#e)),this.#t}get name(){return this.#r}get type(){return this.#o}get serviceIdentifier(){return n.LazyServiceIdentifier.is(this.#e.value)?this.#e.value.unwrap():this.#e.value}getCustomTags(){return[...this.#e.tags.entries()].map(([f,d])=>({key:f,value:d}))}getNamedTag(){return this.#e.name===void 0?null:{key:i.NAMED_TAG,value:this.#e.name}}hasTag(f){return this.metadata.some(d=>d.key===f)}isArray(){return this.#e.kind===t.ClassElementMetadataKind.multipleInjection}isNamed(){return this.#e.name!==void 0}isOptional(){return this.#e.optional}isTagged(){return this.#e.tags.size>0}matchesArray(f){return this.isArray()&&this.#e.value===f}matchesNamedTag(f){return this.#e.name===f}matchesTag(f){return d=>this.metadata.some(c=>c.key===f&&c.value===d)}};return Ps.LegacyTargetImpl=a,Ps}var Kh;function sw(){if(Kh)return hc;Kh=1,Object.defineProperty(hc,"__esModule",{value:!0}),hc.getTargetsFromMetadataProviders=i;const n=rs(),e=tw(),t=u_();function i(o,r){return function(a){const u=o(a);let f=(0,e.getBaseType)(a);for(;f!==void 0&&f!==Object;){const c=r(f);for(const[l,p]of c)u.properties.has(l)||u.properties.set(l,p);f=(0,e.getBaseType)(f)}const d=[];for(const c of u.constructorArguments)if(c.kind!==n.ClassElementMetadataKind.unmanaged){const l=c.targetName??"";d.push(new t.LegacyTargetImpl(l,c,"ConstructorArgument"))}for(const[c,l]of u.properties)if(l.kind!==n.ClassElementMetadataKind.unmanaged){const p=l.targetName??c;d.push(new t.LegacyTargetImpl(p,l,"ClassProperty"))}return d}}return hc}var $h;function aw(){if($h)return Ss;$h=1,Object.defineProperty(Ss,"__esModule",{value:!0}),Ss.getTargets=void 0;const n=s_(),e=c_(),t=o_(),i=a_(),o=sw(),r=s=>{const a=s===void 0?n.getClassMetadata:f=>(0,e.getClassMetadataFromMetadataReader)(f,s),u=s===void 0?t.getClassMetadataProperties:f=>(0,i.getClassMetadataPropertiesFromMetadataReader)(f,s);return(0,o.getTargetsFromMetadataProviders)(a,u)};return Ss.getTargets=r,Ss}var Yh;function d_(){return Yh||(Yh=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.LegacyTargetImpl=n.getTargets=n.getClassMetadataFromMetadataReader=n.getClassMetadata=n.getClassElementMetadataFromLegacyMetadata=n.ClassElementMetadataKind=void 0;const e=aw();Object.defineProperty(n,"getTargets",{enumerable:!0,get:function(){return e.getTargets}});const t=u_();Object.defineProperty(n,"LegacyTargetImpl",{enumerable:!0,get:function(){return t.LegacyTargetImpl}});const i=Il();Object.defineProperty(n,"getClassElementMetadataFromLegacyMetadata",{enumerable:!0,get:function(){return i.getClassElementMetadataFromLegacyMetadata}});const o=s_();Object.defineProperty(n,"getClassMetadata",{enumerable:!0,get:function(){return o.getClassMetadata}});const r=c_();Object.defineProperty(n,"getClassMetadataFromMetadataReader",{enumerable:!0,get:function(){return r.getClassMetadataFromMetadataReader}});const s=rs();Object.defineProperty(n,"ClassElementMetadataKind",{enumerable:!0,get:function(){return s.ClassElementMetadataKind}})})(rd)),rd}var Rs={},kh;function cw(){if(kh)return Rs;kh=1,Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.BindingCount=void 0;var n;return(function(e){e[e.MultipleBindingsAvailable=2]="MultipleBindingsAvailable",e[e.NoBindingsAvailable=0]="NoBindingsAvailable",e[e.OnlyOneBindingAvailable=1]="OnlyOneBindingAvailable"})(n||(Rs.BindingCount=n={})),Rs}var $n={},Uh;function l_(){if(Uh)return $n;Uh=1;var n=$n&&$n.__createBinding||(Object.create?(function(s,a,u,f){f===void 0&&(f=u);var d=Object.getOwnPropertyDescriptor(a,u);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[u]}}),Object.defineProperty(s,f,d)}):(function(s,a,u,f){f===void 0&&(f=u),s[f]=a[u]})),e=$n&&$n.__setModuleDefault||(Object.create?(function(s,a){Object.defineProperty(s,"default",{enumerable:!0,value:a})}):function(s,a){s.default=a}),t=$n&&$n.__importStar||(function(){var s=function(a){return s=Object.getOwnPropertyNames||function(u){var f=[];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[f.length]=d);return f},s(a)};return function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f=s(a),d=0;d<f.length;d++)f[d]!=="default"&&n(u,a,f[d]);return e(u,a),u}})();Object.defineProperty($n,"__esModule",{value:!0}),$n.tryAndThrowErrorIfStackOverflow=void 0,$n.isStackOverflowException=o;const i=t(Tn());function o(s){return s instanceof RangeError||s.message===i.STACK_OVERFLOW}const r=(s,a)=>{try{return s()}catch(u){throw o(u)?a():u}};return $n.tryAndThrowErrorIfStackOverflow=r,$n}var rn={},Gh;function Ra(){if(Gh)return rn;Gh=1;var n=rn&&rn.__createBinding||(Object.create?(function(p,h,g,m){m===void 0&&(m=g);var y=Object.getOwnPropertyDescriptor(h,g);(!y||("get"in y?!h.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return h[g]}}),Object.defineProperty(p,m,y)}):(function(p,h,g,m){m===void 0&&(m=g),p[m]=h[g]})),e=rn&&rn.__setModuleDefault||(Object.create?(function(p,h){Object.defineProperty(p,"default",{enumerable:!0,value:h})}):function(p,h){p.default=h}),t=rn&&rn.__importStar||(function(){var p=function(h){return p=Object.getOwnPropertyNames||function(g){var m=[];for(var y in g)Object.prototype.hasOwnProperty.call(g,y)&&(m[m.length]=y);return m},p(h)};return function(h){if(h&&h.__esModule)return h;var g={};if(h!=null)for(var m=p(h),y=0;y<m.length;y++)m[y]!=="default"&&n(g,h,m[y]);return e(g,h),g}})();Object.defineProperty(rn,"__esModule",{value:!0}),rn.getFunctionName=d,rn.getServiceIdentifierAsString=o,rn.listRegisteredBindingsForServiceIdentifier=r,rn.listMetadataForTarget=f,rn.circularDependencyToException=u,rn.getSymbolDescription=c;const i=t(Tn());function o(p){return typeof p=="function"?p.name:typeof p=="symbol"?p.toString():p}function r(p,h,g){let m="";const y=g(p,h);return y.length!==0&&(m=`
Registered bindings:`,y.forEach(b=>{let v="Object";b.implementationType!==null&&(v=d(b.implementationType)),m=`${m}
 ${v}`,b.constraint.metaData&&(m=`${m} - ${b.constraint.metaData}`)})),m}function s(p,h){return p.parentRequest===null?!1:p.parentRequest.serviceIdentifier===h?!0:s(p.parentRequest,h)}function a(p){function h(m,y=[]){const b=o(m.serviceIdentifier);return y.push(b),m.parentRequest!==null?h(m.parentRequest,y):y}return h(p).reverse().join(" --> ")}function u(p){p.childRequests.forEach(h=>{if(s(p,h.serviceIdentifier)){const g=a(h);throw new Error(`${i.CIRCULAR_DEPENDENCY} ${g}`)}else u(h)})}function f(p,h){if(h.isTagged()||h.isNamed()){let g="";const m=h.getNamedTag(),y=h.getCustomTags();return m!==null&&(g+=l(m)+`
`),y!==null&&y.forEach(b=>{g+=l(b)+`
`}),` ${p}
 ${p} - ${g}`}else return` ${p}`}function d(p){if(p.name!=null&&p.name!=="")return p.name;{const h=p.toString(),g=h.match(/^function\s*([^\s(]+)/);return g===null?`Anonymous function: ${h}`:g[1]}}function c(p){return p.toString().slice(7,-1)}function l(p){return`{"key":"${p.key.toString()}","value":"${p.value.toString()}"}`}return rn}var As={},Xh;function uw(){if(Xh)return As;Xh=1,Object.defineProperty(As,"__esModule",{value:!0}),As.Context=void 0;const n=is();class e{id;container;plan;currentRequest;constructor(i){this.id=(0,n.id)(),this.container=i}addPlan(i){this.plan=i}setCurrentRequest(i){this.currentRequest=i}}return As.Context=e,As}var ai={},Wh;function wr(){if(Wh)return ai;Wh=1;var n=ai&&ai.__createBinding||(Object.create?(function(r,s,a,u){u===void 0&&(u=a);var f=Object.getOwnPropertyDescriptor(s,a);(!f||("get"in f?!s.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return s[a]}}),Object.defineProperty(r,u,f)}):(function(r,s,a,u){u===void 0&&(u=a),r[u]=s[a]})),e=ai&&ai.__setModuleDefault||(Object.create?(function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}):function(r,s){r.default=s}),t=ai&&ai.__importStar||(function(){var r=function(s){return r=Object.getOwnPropertyNames||function(a){var u=[];for(var f in a)Object.prototype.hasOwnProperty.call(a,f)&&(u[u.length]=f);return u},r(s)};return function(s){if(s&&s.__esModule)return s;var a={};if(s!=null)for(var u=r(s),f=0;f<u.length;f++)u[f]!=="default"&&n(a,s,u[f]);return e(a,s),a}})();Object.defineProperty(ai,"__esModule",{value:!0}),ai.Metadata=void 0;const i=t(Bt());class o{key;value;constructor(s,a){this.key=s,this.value=a}toString(){return this.key===i.NAMED_TAG?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}return ai.Metadata=o,ai}var Os={},Zh;function dw(){if(Zh)return Os;Zh=1,Object.defineProperty(Os,"__esModule",{value:!0}),Os.Plan=void 0;class n{parentContext;rootRequest;constructor(t,i){this.parentContext=t,this.rootRequest=i}}return Os.Plan=n,Os}var cr={},vc={},Jh;function lw(){if(Jh)return vc;Jh=1,Object.defineProperty(vc,"__esModule",{value:!0}),vc.getBaseType=n;function n(e){return Object.getPrototypeOf(e.prototype)?.constructor}return vc}var Qh;function fw(){return Qh||(Qh=1,(function(n){var e=cr&&cr.__createBinding||(Object.create?(function(d,c,l,p){p===void 0&&(p=l);var h=Object.getOwnPropertyDescriptor(c,l);(!h||("get"in h?!c.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return c[l]}}),Object.defineProperty(d,p,h)}):(function(d,c,l,p){p===void 0&&(p=l),d[p]=c[l]})),t=cr&&cr.__setModuleDefault||(Object.create?(function(d,c){Object.defineProperty(d,"default",{enumerable:!0,value:c})}):function(d,c){d.default=c}),i=cr&&cr.__importStar||(function(){var d=function(c){return d=Object.getOwnPropertyNames||function(l){var p=[];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(p[p.length]=h);return p},d(c)};return function(c){if(c&&c.__esModule)return c;var l={};if(c!=null)for(var p=d(c),h=0;h<p.length;h++)p[h]!=="default"&&e(l,c,p[h]);return t(l,c),l}})();Object.defineProperty(n,"__esModule",{value:!0}),n.getFunctionName=void 0,n.getDependencies=u,n.getBaseClassDependencyCount=f;const o=d_(),r=i(Bt()),s=lw(),a=Ra();Object.defineProperty(n,"getFunctionName",{enumerable:!0,get:function(){return a.getFunctionName}});function u(d,c){return(0,o.getTargets)(d)(c)}function f(d,c){const l=(0,s.getBaseType)(c);if(l===void 0||l===Object)return 0;const p=(0,o.getTargets)(d)(l),h=p.map(y=>y.metadata.filter(b=>b.key===r.UNMANAGED_TAG)),g=[].concat.apply([],h).length,m=p.length-g;return m>0?m:f(d,l)}})(cr)),cr}var Is={},ep;function hw(){if(ep)return Is;ep=1,Object.defineProperty(Is,"__esModule",{value:!0}),Is.Request=void 0;const n=is();class e{id;serviceIdentifier;parentContext;parentRequest;bindings;childRequests;target;requestScope;constructor(i,o,r,s,a){this.id=(0,n.id)(),this.serviceIdentifier=i,this.parentContext=o,this.parentRequest=r,this.target=a,this.childRequests=[],this.bindings=Array.isArray(s)?s:[s],this.requestScope=r===null?new Map:null}addChildRequest(i,o,r){const s=new e(i,this.parentContext,this,o,r);return this.childRequests.push(s),s}}return Is.Request=e,Is}var tp;function f_(){if(tp)return Kn;tp=1;var n=Kn&&Kn.__createBinding||(Object.create?(function(R,w,M,I){I===void 0&&(I=M);var D=Object.getOwnPropertyDescriptor(w,M);(!D||("get"in D?!w.__esModule:D.writable||D.configurable))&&(D={enumerable:!0,get:function(){return w[M]}}),Object.defineProperty(R,I,D)}):(function(R,w,M,I){I===void 0&&(I=M),R[I]=w[M]})),e=Kn&&Kn.__setModuleDefault||(Object.create?(function(R,w){Object.defineProperty(R,"default",{enumerable:!0,value:w})}):function(R,w){R.default=w}),t=Kn&&Kn.__importStar||(function(){var R=function(w){return R=Object.getOwnPropertyNames||function(M){var I=[];for(var D in M)Object.prototype.hasOwnProperty.call(M,D)&&(I[I.length]=D);return I},R(w)};return function(w){if(w&&w.__esModule)return w;var M={};if(w!=null)for(var I=R(w),D=0;D<I.length;D++)I[D]!=="default"&&n(M,w,I[D]);return e(M,w),M}})();Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.getBindingDictionary=g,Kn.plan=E,Kn.createMockRequest=O;const i=d_(),o=cw(),r=t(Tn()),s=Qi(),a=t(Bt()),u=l_(),f=Ra(),d=uw(),c=wr(),l=dw(),p=fw(),h=hw();function g(R){return R._bindingDictionary}function m(R,w,M){const I=b(w,M),D=(0,i.getClassElementMetadataFromLegacyMetadata)(I);if(D.kind===i.ClassElementMetadataKind.unmanaged)throw new Error("Unexpected metadata when creating target");return new i.LegacyTargetImpl("",D,R)}function y(R,w,M,I,D){let C=S(M.container,D.serviceIdentifier),z=[];return C.length===o.BindingCount.NoBindingsAvailable&&M.container.options.autoBindInjectable===!0&&typeof D.serviceIdentifier=="function"&&R.getConstructorMetadata(D.serviceIdentifier).compilerGeneratedMetadata&&(M.container.bind(D.serviceIdentifier).toSelf(),C=S(M.container,D.serviceIdentifier)),w?z=C:z=C.filter(G=>{const N=new h.Request(G.serviceIdentifier,M,I,G,D);return G.constraint(N)}),v(D.serviceIdentifier,z,I,D,M.container),z}function b(R,w){const M=w.isMultiInject?a.MULTI_INJECT_TAG:a.INJECT_TAG,I=[new c.Metadata(M,R)];return w.customTag!==void 0&&I.push(new c.Metadata(w.customTag.key,w.customTag.value)),w.isOptional===!0&&I.push(new c.Metadata(a.OPTIONAL_TAG,!0)),I}function v(R,w,M,I,D){switch(w.length){case o.BindingCount.NoBindingsAvailable:if(I.isOptional())return w;{const C=(0,f.getServiceIdentifierAsString)(R);let z=r.NOT_REGISTERED;throw z+=(0,f.listMetadataForTarget)(C,I),z+=(0,f.listRegisteredBindingsForServiceIdentifier)(D,C,S),M!==null&&(z+=`
${r.TRYING_TO_RESOLVE_BINDINGS((0,f.getServiceIdentifierAsString)(M.serviceIdentifier))}`),new Error(z)}case o.BindingCount.OnlyOneBindingAvailable:return w;case o.BindingCount.MultipleBindingsAvailable:default:if(I.isArray())return w;{const C=(0,f.getServiceIdentifierAsString)(R);let z=`${r.AMBIGUOUS_MATCH} ${C}`;throw z+=(0,f.listRegisteredBindingsForServiceIdentifier)(D,C,S),new Error(z)}}}function _(R,w,M,I,D,C){let z,G;if(D===null){z=y(R,w,I,null,C),G=new h.Request(M,I,null,z,C);const N=new l.Plan(I,G);I.addPlan(N)}else z=y(R,w,I,D,C),G=D.addChildRequest(C.serviceIdentifier,z,C);z.forEach(N=>{let U=null;if(C.isArray())U=G.addChildRequest(N.serviceIdentifier,N,C);else{if(N.cache!==null)return;U=G}if(N.type===s.BindingTypeEnum.Instance&&N.implementationType!==null){const Q=(0,p.getDependencies)(R,N.implementationType);if(I.container.options.skipBaseClassChecks!==!0){const J=(0,p.getBaseClassDependencyCount)(R,N.implementationType);if(Q.length<J){const ce=r.ARGUMENTS_LENGTH_MISMATCH((0,p.getFunctionName)(N.implementationType));throw new Error(ce)}}Q.forEach(J=>{_(R,!1,J.serviceIdentifier,I,U,J)})}})}function S(R,w){let M=[];const I=g(R);return I.hasKey(w)?M=I.get(w):R.parent!==null&&(M=S(R.parent,w)),M}function E(R,w,M,I,D,C=!1){const z=new d.Context(w),G=m(M,I,D);try{return _(R,C,I,z,null,G),z}catch(N){throw(0,u.isStackOverflowException)(N)&&(0,f.circularDependencyToException)(z.plan.rootRequest),N}}function O(R,w,M){const I=b(w,M),D=(0,i.getClassElementMetadataFromLegacyMetadata)(I);if(D.kind===i.ClassElementMetadataKind.unmanaged)throw new Error("Unexpected metadata when creating target");const C=new i.LegacyTargetImpl("",D,"Variable"),z=new d.Context(R);return new h.Request(w,z,null,[],C)}return Kn}var Ri={},co={},Cs={},np;function Ru(){if(np)return Cs;np=1,Object.defineProperty(Cs,"__esModule",{value:!0}),Cs.isPromise=n,Cs.isPromiseOrContainsPromise=e;function n(t){return(typeof t=="object"&&t!==null||typeof t=="function")&&typeof t.then=="function"}function e(t){return n(t)?!0:Array.isArray(t)&&t.some(n)}return Cs}var ip;function pw(){if(ip)return co;ip=1,Object.defineProperty(co,"__esModule",{value:!0}),co.saveToScope=co.tryGetFromScope=void 0;const n=Qi(),e=Ru(),t=(a,u)=>u.scope===n.BindingScopeEnum.Singleton&&u.activated?u.cache:u.scope===n.BindingScopeEnum.Request&&a.has(u.id)?a.get(u.id):null;co.tryGetFromScope=t;const i=(a,u,f)=>{u.scope===n.BindingScopeEnum.Singleton&&r(u,f),u.scope===n.BindingScopeEnum.Request&&o(a,u,f)};co.saveToScope=i;const o=(a,u,f)=>{a.has(u.id)||a.set(u.id,f)},r=(a,u)=>{a.cache=u,a.activated=!0,(0,e.isPromise)(u)&&s(a,u)},s=async(a,u)=>{try{const f=await u;a.cache=f}catch(f){throw a.cache=null,a.activated=!1,f}};return co}var on={},Ts={},rp;function gw(){if(rp)return Ts;rp=1,Object.defineProperty(Ts,"__esModule",{value:!0}),Ts.FactoryType=void 0;var n;return(function(e){e.DynamicValue="toDynamicValue",e.Factory="toFactory",e.Provider="toProvider"})(n||(Ts.FactoryType=n={})),Ts}var op;function h_(){if(op)return on;op=1;var n=on&&on.__createBinding||(Object.create?(function(d,c,l,p){p===void 0&&(p=l);var h=Object.getOwnPropertyDescriptor(c,l);(!h||("get"in h?!c.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return c[l]}}),Object.defineProperty(d,p,h)}):(function(d,c,l,p){p===void 0&&(p=l),d[p]=c[l]})),e=on&&on.__setModuleDefault||(Object.create?(function(d,c){Object.defineProperty(d,"default",{enumerable:!0,value:c})}):function(d,c){d.default=c}),t=on&&on.__importStar||(function(){var d=function(c){return d=Object.getOwnPropertyNames||function(l){var p=[];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(p[p.length]=h);return p},d(c)};return function(c){if(c&&c.__esModule)return c;var l={};if(c!=null)for(var p=d(c),h=0;h<p.length;h++)p[h]!=="default"&&n(l,c,p[h]);return e(l,c),l}})();Object.defineProperty(on,"__esModule",{value:!0}),on.getFactoryDetails=on.ensureFullyBound=on.multiBindToService=void 0;const i=t(Tn()),o=Qi(),r=Ra(),s=gw(),a=d=>c=>(...l)=>{l.forEach(p=>{d.bind(p).toService(c)})};on.multiBindToService=a;const u=d=>{let c=null;switch(d.type){case o.BindingTypeEnum.ConstantValue:case o.BindingTypeEnum.Function:c=d.cache;break;case o.BindingTypeEnum.Constructor:case o.BindingTypeEnum.Instance:c=d.implementationType;break;case o.BindingTypeEnum.DynamicValue:c=d.dynamicValue;break;case o.BindingTypeEnum.Provider:c=d.provider;break;case o.BindingTypeEnum.Factory:c=d.factory;break}if(c===null){const l=(0,r.getServiceIdentifierAsString)(d.serviceIdentifier);throw new Error(`${i.INVALID_BINDING_TYPE} ${l}`)}};on.ensureFullyBound=u;const f=d=>{switch(d.type){case o.BindingTypeEnum.Factory:return{factory:d.factory,factoryType:s.FactoryType.Factory};case o.BindingTypeEnum.Provider:return{factory:d.provider,factoryType:s.FactoryType.Provider};case o.BindingTypeEnum.DynamicValue:return{factory:d.dynamicValue,factoryType:s.FactoryType.DynamicValue};default:throw new Error(`Unexpected factory type ${d.type}`)}};return on.getFactoryDetails=f,on}var Ai={},sp;function mw(){if(sp)return Ai;sp=1;var n=Ai&&Ai.__createBinding||(Object.create?(function(y,b,v,_){_===void 0&&(_=v);var S=Object.getOwnPropertyDescriptor(b,v);(!S||("get"in S?!b.__esModule:S.writable||S.configurable))&&(S={enumerable:!0,get:function(){return b[v]}}),Object.defineProperty(y,_,S)}):(function(y,b,v,_){_===void 0&&(_=v),y[_]=b[v]})),e=Ai&&Ai.__setModuleDefault||(Object.create?(function(y,b){Object.defineProperty(y,"default",{enumerable:!0,value:b})}):function(y,b){y.default=b}),t=Ai&&Ai.__importStar||(function(){var y=function(b){return y=Object.getOwnPropertyNames||function(v){var _=[];for(var S in v)Object.prototype.hasOwnProperty.call(v,S)&&(_[_.length]=S);return _},y(b)};return function(b){if(b&&b.__esModule)return b;var v={};if(b!=null)for(var _=y(b),S=0;S<_.length;S++)_[S]!=="default"&&n(v,b,_[S]);return e(v,b),v}})();Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.resolveInstance=m;const i=Tn(),o=Qi(),r=t(Bt()),s=Ru();function a(y,b){return y.reduce((v,_)=>{const S=b(_);return _.target.type===o.TargetTypeEnum.ConstructorArgument?v.constructorInjections.push(S):(v.propertyRequests.push(_),v.propertyInjections.push(S)),v.isAsync||(v.isAsync=(0,s.isPromiseOrContainsPromise)(S)),v},{constructorInjections:[],isAsync:!1,propertyInjections:[],propertyRequests:[]})}function u(y,b,v){let _;if(b.length>0){const S=a(b,v),E={...S,constr:y};S.isAsync?_=d(E):_=f(E)}else _=new y;return _}function f(y){const b=new y.constr(...y.constructorInjections);return y.propertyRequests.forEach((v,_)=>{const S=v.target.identifier,E=y.propertyInjections[_];(!v.target.isOptional()||E!==void 0)&&(b[S]=E)}),b}async function d(y){const b=await c(y.constructorInjections),v=await c(y.propertyInjections);return f({...y,constructorInjections:b,propertyInjections:v})}async function c(y){const b=[];for(const v of y)Array.isArray(v)?b.push(Promise.all(v)):b.push(v);return Promise.all(b)}function l(y,b){const v=p(y,b);return(0,s.isPromise)(v)?v.then(()=>b):b}function p(y,b){if(Reflect.hasMetadata(r.POST_CONSTRUCT,y)){const v=Reflect.getMetadata(r.POST_CONSTRUCT,y);try{return b[v.value]?.()}catch(_){if(_ instanceof Error)throw new Error((0,i.POST_CONSTRUCT_ERROR)(y.name,_.message))}}}function h(y,b){y.scope!==o.BindingScopeEnum.Singleton&&g(y,b)}function g(y,b){const v=`Class cannot be instantiated in ${y.scope===o.BindingScopeEnum.Request?"request":"transient"} scope.`;if(typeof y.onDeactivation=="function")throw new Error((0,i.ON_DEACTIVATION_ERROR)(b.name,v));if(Reflect.hasMetadata(r.PRE_DESTROY,b))throw new Error((0,i.PRE_DESTROY_ERROR)(b.name,v))}function m(y,b,v,_){h(y,b);const S=u(b,v,_);return(0,s.isPromise)(S)?S.then(E=>l(b,E)):l(b,S)}return Ai}var ap;function yw(){if(ap)return Ri;ap=1;var n=Ri&&Ri.__createBinding||(Object.create?(function(O,R,w,M){M===void 0&&(M=w);var I=Object.getOwnPropertyDescriptor(R,w);(!I||("get"in I?!R.__esModule:I.writable||I.configurable))&&(I={enumerable:!0,get:function(){return R[w]}}),Object.defineProperty(O,M,I)}):(function(O,R,w,M){M===void 0&&(M=w),O[M]=R[w]})),e=Ri&&Ri.__setModuleDefault||(Object.create?(function(O,R){Object.defineProperty(O,"default",{enumerable:!0,value:R})}):function(O,R){O.default=R}),t=Ri&&Ri.__importStar||(function(){var O=function(R){return O=Object.getOwnPropertyNames||function(w){var M=[];for(var I in w)Object.prototype.hasOwnProperty.call(w,I)&&(M[M.length]=I);return M},O(R)};return function(R){if(R&&R.__esModule)return R;var w={};if(R!=null)for(var M=O(R),I=0;I<M.length;I++)M[I]!=="default"&&n(w,R,M[I]);return e(w,R),w}})();Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.resolve=E;const i=t(Tn()),o=Qi(),r=f_(),s=pw(),a=Ru(),u=h_(),f=l_(),d=mw(),c=O=>R=>{R.parentContext.setCurrentRequest(R);const w=R.bindings,M=R.childRequests,I=R.target&&R.target.isArray(),D=!R.parentRequest||!R.parentRequest.target||!R.target||!R.parentRequest.target.matchesArray(R.target.serviceIdentifier);if(I&&D)return M.map(C=>c(O)(C));{if(R.target.isOptional()&&w.length===0)return;const C=w[0];return g(O,R,C)}},l=(O,R)=>{const w=(0,u.getFactoryDetails)(O);return(0,f.tryAndThrowErrorIfStackOverflow)(()=>w.factory.bind(O)(R),()=>new Error(i.CIRCULAR_DEPENDENCY_IN_FACTORY(w.factoryType,R.currentRequest.serviceIdentifier.toString())))},p=(O,R,w)=>{let M;const I=R.childRequests;switch((0,u.ensureFullyBound)(w),w.type){case o.BindingTypeEnum.ConstantValue:case o.BindingTypeEnum.Function:M=w.cache;break;case o.BindingTypeEnum.Constructor:M=w.implementationType;break;case o.BindingTypeEnum.Instance:M=(0,d.resolveInstance)(w,w.implementationType,I,c(O));break;default:M=l(w,R.parentContext)}return M},h=(O,R,w)=>{let M=(0,s.tryGetFromScope)(O,R);return M!==null||(M=w(),(0,s.saveToScope)(O,R,M)),M},g=(O,R,w)=>h(O,w,()=>{let M=p(O,R,w);return(0,a.isPromise)(M)?M=M.then(I=>m(R,w,I)):M=m(R,w,M),M});function m(O,R,w){let M=y(O.parentContext,R,w);const I=S(O.parentContext.container);let D,C=I.next();do{D=C.value;const z=O.parentContext,G=O.serviceIdentifier,N=_(D,G);(0,a.isPromise)(M)?M=v(N,z,M):M=b(N,z,M),C=I.next()}while(C.done!==!0&&!(0,r.getBindingDictionary)(D).hasKey(O.serviceIdentifier));return M}const y=(O,R,w)=>{let M;return typeof R.onActivation=="function"?M=R.onActivation(O,w):M=w,M},b=(O,R,w)=>{let M=O.next();for(;M.done!==!0;){if(w=M.value(R,w),(0,a.isPromise)(w))return v(O,R,w);M=O.next()}return w},v=async(O,R,w)=>{let M=await w,I=O.next();for(;I.done!==!0;)M=await I.value(R,M),I=O.next();return M},_=(O,R)=>{const w=O._activations;return w.hasKey(R)?w.get(R).values():[].values()},S=O=>{const R=[O];let w=O.parent;for(;w!==null;)R.push(w),w=w.parent;return{next:()=>{const D=R.pop();return D!==void 0?{done:!1,value:D}:{done:!0,value:void 0}}}};function E(O){return c(O.plan.rootRequest.requestScope)(O.plan.rootRequest)}return Ri}var ci={},Ds={},xs={},js={},Ls={},Ns={},qt={},cp;function p_(){if(cp)return qt;cp=1;var n=qt&&qt.__createBinding||(Object.create?(function(f,d,c,l){l===void 0&&(l=c);var p=Object.getOwnPropertyDescriptor(d,c);(!p||("get"in p?!d.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return d[c]}}),Object.defineProperty(f,l,p)}):(function(f,d,c,l){l===void 0&&(l=c),f[l]=d[c]})),e=qt&&qt.__setModuleDefault||(Object.create?(function(f,d){Object.defineProperty(f,"default",{enumerable:!0,value:d})}):function(f,d){f.default=d}),t=qt&&qt.__importStar||(function(){var f=function(d){return f=Object.getOwnPropertyNames||function(c){var l=[];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(l[l.length]=p);return l},f(d)};return function(d){if(d&&d.__esModule)return d;var c={};if(d!=null)for(var l=f(d),p=0;p<l.length;p++)l[p]!=="default"&&n(c,d,l[p]);return e(c,d),c}})();Object.defineProperty(qt,"__esModule",{value:!0}),qt.typeConstraint=qt.namedConstraint=qt.taggedConstraint=qt.traverseAncerstors=void 0;const i=t(Bt()),o=wr(),r=(f,d)=>{const c=f.parentRequest;return c!==null?d(c)?!0:r(c,d):!1};qt.traverseAncerstors=r;const s=f=>d=>{const c=l=>l!==null&&l.target!==null&&l.target.matchesTag(f)(d);return c.metaData=new o.Metadata(f,d),c};qt.taggedConstraint=s;const a=s(i.NAMED_TAG);qt.namedConstraint=a;const u=f=>d=>{let c=null;if(d!==null){if(c=d.bindings[0],typeof f=="string")return c.serviceIdentifier===f;{const l=d.bindings[0].implementationType;return f===l}}return!1};return qt.typeConstraint=u,qt}var up;function Cl(){if(up)return Ns;up=1,Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.BindingWhenSyntax=void 0;const n=Tl(),e=p_();class t{_binding;constructor(o){this._binding=o}when(o){return this._binding.constraint=o,new n.BindingOnSyntax(this._binding)}whenTargetNamed(o){return this._binding.constraint=(0,e.namedConstraint)(o),new n.BindingOnSyntax(this._binding)}whenTargetIsDefault(){return this._binding.constraint=o=>o===null?!1:o.target!==null&&!o.target.isNamed()&&!o.target.isTagged(),new n.BindingOnSyntax(this._binding)}whenTargetTagged(o,r){return this._binding.constraint=(0,e.taggedConstraint)(o)(r),new n.BindingOnSyntax(this._binding)}whenInjectedInto(o){return this._binding.constraint=r=>r!==null&&(0,e.typeConstraint)(o)(r.parentRequest),new n.BindingOnSyntax(this._binding)}whenParentNamed(o){return this._binding.constraint=r=>r!==null&&(0,e.namedConstraint)(o)(r.parentRequest),new n.BindingOnSyntax(this._binding)}whenParentTagged(o,r){return this._binding.constraint=s=>s!==null&&(0,e.taggedConstraint)(o)(r)(s.parentRequest),new n.BindingOnSyntax(this._binding)}whenAnyAncestorIs(o){return this._binding.constraint=r=>r!==null&&(0,e.traverseAncerstors)(r,(0,e.typeConstraint)(o)),new n.BindingOnSyntax(this._binding)}whenNoAncestorIs(o){return this._binding.constraint=r=>r!==null&&!(0,e.traverseAncerstors)(r,(0,e.typeConstraint)(o)),new n.BindingOnSyntax(this._binding)}whenAnyAncestorNamed(o){return this._binding.constraint=r=>r!==null&&(0,e.traverseAncerstors)(r,(0,e.namedConstraint)(o)),new n.BindingOnSyntax(this._binding)}whenNoAncestorNamed(o){return this._binding.constraint=r=>r!==null&&!(0,e.traverseAncerstors)(r,(0,e.namedConstraint)(o)),new n.BindingOnSyntax(this._binding)}whenAnyAncestorTagged(o,r){return this._binding.constraint=s=>s!==null&&(0,e.traverseAncerstors)(s,(0,e.taggedConstraint)(o)(r)),new n.BindingOnSyntax(this._binding)}whenNoAncestorTagged(o,r){return this._binding.constraint=s=>s!==null&&!(0,e.traverseAncerstors)(s,(0,e.taggedConstraint)(o)(r)),new n.BindingOnSyntax(this._binding)}whenAnyAncestorMatches(o){return this._binding.constraint=r=>r!==null&&(0,e.traverseAncerstors)(r,o),new n.BindingOnSyntax(this._binding)}whenNoAncestorMatches(o){return this._binding.constraint=r=>r!==null&&!(0,e.traverseAncerstors)(r,o),new n.BindingOnSyntax(this._binding)}}return Ns.BindingWhenSyntax=t,Ns}var dp;function Tl(){if(dp)return Ls;dp=1,Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.BindingOnSyntax=void 0;const n=Cl();class e{_binding;constructor(i){this._binding=i}onActivation(i){return this._binding.onActivation=i,new n.BindingWhenSyntax(this._binding)}onDeactivation(i){return this._binding.onDeactivation=i,new n.BindingWhenSyntax(this._binding)}}return Ls.BindingOnSyntax=e,Ls}var lp;function g_(){if(lp)return js;lp=1,Object.defineProperty(js,"__esModule",{value:!0}),js.BindingWhenOnSyntax=void 0;const n=Tl(),e=Cl();class t{_bindingWhenSyntax;_bindingOnSyntax;_binding;constructor(o){this._binding=o,this._bindingWhenSyntax=new e.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new n.BindingOnSyntax(this._binding)}when(o){return this._bindingWhenSyntax.when(o)}whenTargetNamed(o){return this._bindingWhenSyntax.whenTargetNamed(o)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(o,r){return this._bindingWhenSyntax.whenTargetTagged(o,r)}whenInjectedInto(o){return this._bindingWhenSyntax.whenInjectedInto(o)}whenParentNamed(o){return this._bindingWhenSyntax.whenParentNamed(o)}whenParentTagged(o,r){return this._bindingWhenSyntax.whenParentTagged(o,r)}whenAnyAncestorIs(o){return this._bindingWhenSyntax.whenAnyAncestorIs(o)}whenNoAncestorIs(o){return this._bindingWhenSyntax.whenNoAncestorIs(o)}whenAnyAncestorNamed(o){return this._bindingWhenSyntax.whenAnyAncestorNamed(o)}whenAnyAncestorTagged(o,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(o,r)}whenNoAncestorNamed(o){return this._bindingWhenSyntax.whenNoAncestorNamed(o)}whenNoAncestorTagged(o,r){return this._bindingWhenSyntax.whenNoAncestorTagged(o,r)}whenAnyAncestorMatches(o){return this._bindingWhenSyntax.whenAnyAncestorMatches(o)}whenNoAncestorMatches(o){return this._bindingWhenSyntax.whenNoAncestorMatches(o)}onActivation(o){return this._bindingOnSyntax.onActivation(o)}onDeactivation(o){return this._bindingOnSyntax.onDeactivation(o)}}return js.BindingWhenOnSyntax=t,js}var fp;function vw(){if(fp)return xs;fp=1,Object.defineProperty(xs,"__esModule",{value:!0}),xs.BindingInSyntax=void 0;const n=Qi(),e=g_();class t{_binding;constructor(o){this._binding=o}inRequestScope(){return this._binding.scope=n.BindingScopeEnum.Request,new e.BindingWhenOnSyntax(this._binding)}inSingletonScope(){return this._binding.scope=n.BindingScopeEnum.Singleton,new e.BindingWhenOnSyntax(this._binding)}inTransientScope(){return this._binding.scope=n.BindingScopeEnum.Transient,new e.BindingWhenOnSyntax(this._binding)}}return xs.BindingInSyntax=t,xs}var hp;function _w(){if(hp)return Ds;hp=1,Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.BindingInWhenOnSyntax=void 0;const n=vw(),e=Tl(),t=Cl();class i{_bindingInSyntax;_bindingWhenSyntax;_bindingOnSyntax;_binding;constructor(r){this._binding=r,this._bindingWhenSyntax=new t.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new e.BindingOnSyntax(this._binding),this._bindingInSyntax=new n.BindingInSyntax(r)}inRequestScope(){return this._bindingInSyntax.inRequestScope()}inSingletonScope(){return this._bindingInSyntax.inSingletonScope()}inTransientScope(){return this._bindingInSyntax.inTransientScope()}when(r){return this._bindingWhenSyntax.when(r)}whenTargetNamed(r){return this._bindingWhenSyntax.whenTargetNamed(r)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(r,s){return this._bindingWhenSyntax.whenTargetTagged(r,s)}whenInjectedInto(r){return this._bindingWhenSyntax.whenInjectedInto(r)}whenParentNamed(r){return this._bindingWhenSyntax.whenParentNamed(r)}whenParentTagged(r,s){return this._bindingWhenSyntax.whenParentTagged(r,s)}whenAnyAncestorIs(r){return this._bindingWhenSyntax.whenAnyAncestorIs(r)}whenNoAncestorIs(r){return this._bindingWhenSyntax.whenNoAncestorIs(r)}whenAnyAncestorNamed(r){return this._bindingWhenSyntax.whenAnyAncestorNamed(r)}whenAnyAncestorTagged(r,s){return this._bindingWhenSyntax.whenAnyAncestorTagged(r,s)}whenNoAncestorNamed(r){return this._bindingWhenSyntax.whenNoAncestorNamed(r)}whenNoAncestorTagged(r,s){return this._bindingWhenSyntax.whenNoAncestorTagged(r,s)}whenAnyAncestorMatches(r){return this._bindingWhenSyntax.whenAnyAncestorMatches(r)}whenNoAncestorMatches(r){return this._bindingWhenSyntax.whenNoAncestorMatches(r)}onActivation(r){return this._bindingOnSyntax.onActivation(r)}onDeactivation(r){return this._bindingOnSyntax.onDeactivation(r)}}return Ds.BindingInWhenOnSyntax=i,Ds}var pp;function bw(){if(pp)return ci;pp=1;var n=ci&&ci.__createBinding||(Object.create?(function(u,f,d,c){c===void 0&&(c=d);var l=Object.getOwnPropertyDescriptor(f,d);(!l||("get"in l?!f.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return f[d]}}),Object.defineProperty(u,c,l)}):(function(u,f,d,c){c===void 0&&(c=d),u[c]=f[d]})),e=ci&&ci.__setModuleDefault||(Object.create?(function(u,f){Object.defineProperty(u,"default",{enumerable:!0,value:f})}):function(u,f){u.default=f}),t=ci&&ci.__importStar||(function(){var u=function(f){return u=Object.getOwnPropertyNames||function(d){var c=[];for(var l in d)Object.prototype.hasOwnProperty.call(d,l)&&(c[c.length]=l);return c},u(f)};return function(f){if(f&&f.__esModule)return f;var d={};if(f!=null)for(var c=u(f),l=0;l<c.length;l++)c[l]!=="default"&&n(d,f,c[l]);return e(d,f),d}})();Object.defineProperty(ci,"__esModule",{value:!0}),ci.BindingToSyntax=void 0;const i=t(Tn()),o=Qi(),r=_w(),s=g_();class a{_binding;constructor(f){this._binding=f}to(f){return this._binding.type=o.BindingTypeEnum.Instance,this._binding.implementationType=f,new r.BindingInWhenOnSyntax(this._binding)}toSelf(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(i.INVALID_TO_SELF_VALUE);const f=this._binding.serviceIdentifier;return this.to(f)}toConstantValue(f){return this._binding.type=o.BindingTypeEnum.ConstantValue,this._binding.cache=f,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=o.BindingScopeEnum.Singleton,new s.BindingWhenOnSyntax(this._binding)}toDynamicValue(f){return this._binding.type=o.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=f,this._binding.implementationType=null,new r.BindingInWhenOnSyntax(this._binding)}toConstructor(f){return this._binding.type=o.BindingTypeEnum.Constructor,this._binding.implementationType=f,this._binding.scope=o.BindingScopeEnum.Singleton,new s.BindingWhenOnSyntax(this._binding)}toFactory(f){return this._binding.type=o.BindingTypeEnum.Factory,this._binding.factory=f,this._binding.scope=o.BindingScopeEnum.Singleton,new s.BindingWhenOnSyntax(this._binding)}toFunction(f){if(typeof f!="function")throw new Error(i.INVALID_FUNCTION_BINDING);const d=this.toConstantValue(f);return this._binding.type=o.BindingTypeEnum.Function,this._binding.scope=o.BindingScopeEnum.Singleton,d}toAutoFactory(f){return this._binding.type=o.BindingTypeEnum.Factory,this._binding.factory=d=>()=>d.container.get(f),this._binding.scope=o.BindingScopeEnum.Singleton,new s.BindingWhenOnSyntax(this._binding)}toAutoNamedFactory(f){return this._binding.type=o.BindingTypeEnum.Factory,this._binding.factory=d=>c=>d.container.getNamed(f,c),new s.BindingWhenOnSyntax(this._binding)}toProvider(f){return this._binding.type=o.BindingTypeEnum.Provider,this._binding.provider=f,this._binding.scope=o.BindingScopeEnum.Singleton,new s.BindingWhenOnSyntax(this._binding)}toService(f){this._binding.type=o.BindingTypeEnum.DynamicValue,Object.defineProperty(this._binding,"cache",{configurable:!0,enumerable:!0,get(){return null},set(d){}}),this._binding.dynamicValue=d=>{try{return d.container.get(f)}catch{return d.container.getAsync(f)}},this._binding.implementationType=null}}return ci.BindingToSyntax=a,ci}var Fs={},gp;function Sw(){if(gp)return Fs;gp=1,Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.ContainerSnapshot=void 0;class n{bindings;activations;deactivations;middleware;moduleActivationStore;static of(t,i,o,r,s){const a=new n;return a.bindings=t,a.middleware=i,a.deactivations=r,a.activations=o,a.moduleActivationStore=s,a}}return Fs.ContainerSnapshot=n,Fs}var ui={},_c={},mp;function ww(){if(mp)return _c;mp=1,Object.defineProperty(_c,"__esModule",{value:!0}),_c.isClonable=n;function n(e){return typeof e=="object"&&e!==null&&"clone"in e&&typeof e.clone=="function"}return _c}var yp;function m_(){if(yp)return ui;yp=1;var n=ui&&ui.__createBinding||(Object.create?(function(s,a,u,f){f===void 0&&(f=u);var d=Object.getOwnPropertyDescriptor(a,u);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[u]}}),Object.defineProperty(s,f,d)}):(function(s,a,u,f){f===void 0&&(f=u),s[f]=a[u]})),e=ui&&ui.__setModuleDefault||(Object.create?(function(s,a){Object.defineProperty(s,"default",{enumerable:!0,value:a})}):function(s,a){s.default=a}),t=ui&&ui.__importStar||(function(){var s=function(a){return s=Object.getOwnPropertyNames||function(u){var f=[];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[f.length]=d);return f},s(a)};return function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f=s(a),d=0;d<f.length;d++)f[d]!=="default"&&n(u,a,f[d]);return e(u,a),u}})();Object.defineProperty(ui,"__esModule",{value:!0}),ui.Lookup=void 0;const i=t(Tn()),o=ww();class r{_map;constructor(){this._map=new Map}getMap(){return this._map}add(a,u){if(this._checkNonNulish(a),u==null)throw new Error(i.NULL_ARGUMENT);const f=this._map.get(a);f!==void 0?f.push(u):this._map.set(a,[u])}get(a){this._checkNonNulish(a);const u=this._map.get(a);if(u!==void 0)return u;throw new Error(i.KEY_NOT_FOUND)}remove(a){if(this._checkNonNulish(a),!this._map.delete(a))throw new Error(i.KEY_NOT_FOUND)}removeIntersection(a){this.traverse((u,f)=>{const d=a.hasKey(u)?a.get(u):void 0;if(d!==void 0){const c=f.filter(l=>!d.some(p=>l===p));this._setValue(u,c)}})}removeByCondition(a){const u=[];return this._map.forEach((f,d)=>{const c=[];for(const l of f)a(l)?u.push(l):c.push(l);this._setValue(d,c)}),u}hasKey(a){return this._checkNonNulish(a),this._map.has(a)}clone(){const a=new r;return this._map.forEach((u,f)=>{u.forEach(d=>{a.add(f,(0,o.isClonable)(d)?d.clone():d)})}),a}traverse(a){this._map.forEach((u,f)=>{a(f,u)})}_checkNonNulish(a){if(a==null)throw new Error(i.NULL_ARGUMENT)}_setValue(a,u){u.length>0?this._map.set(a,u):this._map.delete(a)}}return ui.Lookup=r,ui}var Bs={},vp;function Ew(){if(vp)return Bs;vp=1,Object.defineProperty(Bs,"__esModule",{value:!0}),Bs.ModuleActivationStore=void 0;const n=m_();class e{_map=new Map;remove(i){const o=this._map.get(i);return o===void 0?this._getEmptyHandlersStore():(this._map.delete(i),o)}addDeactivation(i,o,r){this._getModuleActivationHandlers(i).onDeactivations.add(o,r)}addActivation(i,o,r){this._getModuleActivationHandlers(i).onActivations.add(o,r)}clone(){const i=new e;return this._map.forEach((o,r)=>{i._map.set(r,{onActivations:o.onActivations.clone(),onDeactivations:o.onDeactivations.clone()})}),i}_getModuleActivationHandlers(i){let o=this._map.get(i);return o===void 0&&(o=this._getEmptyHandlersStore(),this._map.set(i,o)),o}_getEmptyHandlersStore(){return{onActivations:new n.Lookup,onDeactivations:new n.Lookup}}}return Bs.ModuleActivationStore=e,Bs}var _p;function Pw(){if(_p)return oi;_p=1;var n=oi&&oi.__createBinding||(Object.create?(function(b,v,_,S){S===void 0&&(S=_);var E=Object.getOwnPropertyDescriptor(v,_);(!E||("get"in E?!v.__esModule:E.writable||E.configurable))&&(E={enumerable:!0,get:function(){return v[_]}}),Object.defineProperty(b,S,E)}):(function(b,v,_,S){S===void 0&&(S=_),b[S]=v[_]})),e=oi&&oi.__setModuleDefault||(Object.create?(function(b,v){Object.defineProperty(b,"default",{enumerable:!0,value:v})}):function(b,v){b.default=v}),t=oi&&oi.__importStar||(function(){var b=function(v){return b=Object.getOwnPropertyNames||function(_){var S=[];for(var E in _)Object.prototype.hasOwnProperty.call(_,E)&&(S[S.length]=E);return S},b(v)};return function(v){if(v&&v.__esModule)return v;var _={};if(v!=null)for(var S=b(v),E=0;E<S.length;E++)S[E]!=="default"&&n(_,v,S[E]);return e(_,v),_}})();Object.defineProperty(oi,"__esModule",{value:!0}),oi.Container=void 0;const i=ZS(),o=t(Tn()),r=Qi(),s=t(Bt()),a=Qv(),u=f_(),f=yw(),d=bw(),c=Ru(),l=is(),p=Ra(),h=Sw(),g=m_(),m=Ew();class y{id;parent;options;_middleware;_bindingDictionary;_activations;_deactivations;_snapshots;_metadataReader;_moduleActivationStore;constructor(v){const _=v||{};if(typeof _!="object")throw new Error(o.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(_.defaultScope===void 0)_.defaultScope=r.BindingScopeEnum.Transient;else if(_.defaultScope!==r.BindingScopeEnum.Singleton&&_.defaultScope!==r.BindingScopeEnum.Transient&&_.defaultScope!==r.BindingScopeEnum.Request)throw new Error(o.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(_.autoBindInjectable===void 0)_.autoBindInjectable=!1;else if(typeof _.autoBindInjectable!="boolean")throw new Error(o.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(_.skipBaseClassChecks===void 0)_.skipBaseClassChecks=!1;else if(typeof _.skipBaseClassChecks!="boolean")throw new Error(o.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:_.autoBindInjectable,defaultScope:_.defaultScope,skipBaseClassChecks:_.skipBaseClassChecks},this.id=(0,l.id)(),this._bindingDictionary=new g.Lookup,this._snapshots=[],this._middleware=null,this._activations=new g.Lookup,this._deactivations=new g.Lookup,this.parent=null,this._metadataReader=new a.MetadataReader,this._moduleActivationStore=new m.ModuleActivationStore}static merge(v,_,...S){const E=new y,O=[v,_,...S].map(M=>(0,u.getBindingDictionary)(M)),R=(0,u.getBindingDictionary)(E);function w(M,I){M.traverse((D,C)=>{C.forEach(z=>{I.add(z.serviceIdentifier,z.clone())})})}return O.forEach(M=>{w(M,R)}),E}load(...v){const _=this._getContainerModuleHelpersFactory();for(const S of v){const E=_(S.id);S.registry(E.bindFunction,E.unbindFunction,E.isboundFunction,E.rebindFunction,E.unbindAsyncFunction,E.onActivationFunction,E.onDeactivationFunction)}}async loadAsync(...v){const _=this._getContainerModuleHelpersFactory();for(const S of v){const E=_(S.id);await S.registry(E.bindFunction,E.unbindFunction,E.isboundFunction,E.rebindFunction,E.unbindAsyncFunction,E.onActivationFunction,E.onDeactivationFunction)}}unload(...v){v.forEach(_=>{const S=this._removeModuleBindings(_.id);this._deactivateSingletons(S),this._removeModuleHandlers(_.id)})}async unloadAsync(...v){for(const _ of v){const S=this._removeModuleBindings(_.id);await this._deactivateSingletonsAsync(S),this._removeModuleHandlers(_.id)}}bind(v){return this._bind(this._buildBinding(v))}rebind(v){return this.unbind(v),this.bind(v)}async rebindAsync(v){return await this.unbindAsync(v),this.bind(v)}unbind(v){if(this._bindingDictionary.hasKey(v)){const _=this._bindingDictionary.get(v);this._deactivateSingletons(_)}this._removeServiceFromDictionary(v)}async unbindAsync(v){if(this._bindingDictionary.hasKey(v)){const _=this._bindingDictionary.get(v);await this._deactivateSingletonsAsync(_)}this._removeServiceFromDictionary(v)}unbindAll(){this._bindingDictionary.traverse((v,_)=>{this._deactivateSingletons(_)}),this._bindingDictionary=new g.Lookup}async unbindAllAsync(){const v=[];this._bindingDictionary.traverse((_,S)=>{v.push(this._deactivateSingletonsAsync(S))}),await Promise.all(v),this._bindingDictionary=new g.Lookup}onActivation(v,_){this._activations.add(v,_)}onDeactivation(v,_){this._deactivations.add(v,_)}isBound(v){let _=this._bindingDictionary.hasKey(v);return!_&&this.parent&&(_=this.parent.isBound(v)),_}isCurrentBound(v){return this._bindingDictionary.hasKey(v)}isBoundNamed(v,_){return this.isBoundTagged(v,s.NAMED_TAG,_)}isBoundTagged(v,_,S){let E=!1;if(this._bindingDictionary.hasKey(v)){const O=this._bindingDictionary.get(v),R=(0,u.createMockRequest)(this,v,{customTag:{key:_,value:S},isMultiInject:!1});E=O.some(w=>w.constraint(R))}return!E&&this.parent&&(E=this.parent.isBoundTagged(v,_,S)),E}snapshot(){this._snapshots.push(h.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))}restore(){const v=this._snapshots.pop();if(v===void 0)throw new Error(o.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=v.bindings,this._activations=v.activations,this._deactivations=v.deactivations,this._middleware=v.middleware,this._moduleActivationStore=v.moduleActivationStore}createChild(v){const _=new y(v||this.options);return _.parent=this,_}applyMiddleware(...v){const _=this._middleware?this._middleware:this._planAndResolve();this._middleware=v.reduce((S,E)=>E(S),_)}applyCustomMetadataReader(v){this._metadataReader=v}get(v){const _=this._getNotAllArgs(v,!1,!1);return this._getButThrowIfAsync(_)}async getAsync(v){const _=this._getNotAllArgs(v,!1,!1);return this._get(_)}getTagged(v,_,S){const E=this._getNotAllArgs(v,!1,!1,_,S);return this._getButThrowIfAsync(E)}async getTaggedAsync(v,_,S){const E=this._getNotAllArgs(v,!1,!1,_,S);return this._get(E)}getNamed(v,_){return this.getTagged(v,s.NAMED_TAG,_)}async getNamedAsync(v,_){return this.getTaggedAsync(v,s.NAMED_TAG,_)}getAll(v,_){const S=this._getAllArgs(v,_,!1);return this._getButThrowIfAsync(S)}async getAllAsync(v,_){const S=this._getAllArgs(v,_,!1);return this._getAll(S)}getAllTagged(v,_,S){const E=this._getNotAllArgs(v,!0,!1,_,S);return this._getButThrowIfAsync(E)}async getAllTaggedAsync(v,_,S){const E=this._getNotAllArgs(v,!0,!1,_,S);return this._getAll(E)}getAllNamed(v,_){return this.getAllTagged(v,s.NAMED_TAG,_)}async getAllNamedAsync(v,_){return this.getAllTaggedAsync(v,s.NAMED_TAG,_)}resolve(v){const _=this.isBound(v);_||this.bind(v).toSelf();const S=this.get(v);return _||this.unbind(v),S}tryGet(v){const _=this._getNotAllArgs(v,!1,!0);return this._getButThrowIfAsync(_)}async tryGetAsync(v){const _=this._getNotAllArgs(v,!1,!0);return this._get(_)}tryGetTagged(v,_,S){const E=this._getNotAllArgs(v,!1,!0,_,S);return this._getButThrowIfAsync(E)}async tryGetTaggedAsync(v,_,S){const E=this._getNotAllArgs(v,!1,!0,_,S);return this._get(E)}tryGetNamed(v,_){return this.tryGetTagged(v,s.NAMED_TAG,_)}async tryGetNamedAsync(v,_){return this.tryGetTaggedAsync(v,s.NAMED_TAG,_)}tryGetAll(v,_){const S=this._getAllArgs(v,_,!0);return this._getButThrowIfAsync(S)}async tryGetAllAsync(v,_){const S=this._getAllArgs(v,_,!0);return this._getAll(S)}tryGetAllTagged(v,_,S){const E=this._getNotAllArgs(v,!0,!0,_,S);return this._getButThrowIfAsync(E)}async tryGetAllTaggedAsync(v,_,S){const E=this._getNotAllArgs(v,!0,!0,_,S);return this._getAll(E)}tryGetAllNamed(v,_){return this.tryGetAllTagged(v,s.NAMED_TAG,_)}async tryGetAllNamedAsync(v,_){return this.tryGetAllTaggedAsync(v,s.NAMED_TAG,_)}_preDestroy(v,_){if(v!==void 0&&Reflect.hasMetadata(s.PRE_DESTROY,v)){const S=Reflect.getMetadata(s.PRE_DESTROY,v);return _[S.value]?.()}}_removeModuleHandlers(v){const _=this._moduleActivationStore.remove(v);this._activations.removeIntersection(_.onActivations),this._deactivations.removeIntersection(_.onDeactivations)}_removeModuleBindings(v){return this._bindingDictionary.removeByCondition(_=>_.moduleId===v)}_deactivate(v,_){const S=_==null?void 0:Object.getPrototypeOf(_).constructor;try{if(this._deactivations.hasKey(v.serviceIdentifier)){const O=this._deactivateContainer(_,this._deactivations.get(v.serviceIdentifier).values());if((0,c.isPromise)(O))return this._handleDeactivationError(O.then(async()=>this._propagateContainerDeactivationThenBindingAndPreDestroyAsync(v,_,S)),v.serviceIdentifier)}const E=this._propagateContainerDeactivationThenBindingAndPreDestroy(v,_,S);if((0,c.isPromise)(E))return this._handleDeactivationError(E,v.serviceIdentifier)}catch(E){if(E instanceof Error)throw new Error(o.ON_DEACTIVATION_ERROR((0,p.getServiceIdentifierAsString)(v.serviceIdentifier),E.message))}}async _handleDeactivationError(v,_){try{await v}catch(S){if(S instanceof Error)throw new Error(o.ON_DEACTIVATION_ERROR((0,p.getServiceIdentifierAsString)(_),S.message))}}_deactivateContainer(v,_){let S=_.next();for(;typeof S.value=="function";){const E=S.value(v);if((0,c.isPromise)(E))return E.then(async()=>this._deactivateContainerAsync(v,_));S=_.next()}}async _deactivateContainerAsync(v,_){let S=_.next();for(;typeof S.value=="function";)await S.value(v),S=_.next()}_getContainerModuleHelpersFactory(){const v=M=>I=>{const D=this._buildBinding(I);return D.moduleId=M,this._bind(D)},_=()=>M=>{this.unbind(M)},S=()=>async M=>this.unbindAsync(M),E=()=>M=>this.isBound(M),O=M=>{const I=v(M);return D=>(this.unbind(D),I(D))},R=M=>(I,D)=>{this._moduleActivationStore.addActivation(M,I,D),this.onActivation(I,D)},w=M=>(I,D)=>{this._moduleActivationStore.addDeactivation(M,I,D),this.onDeactivation(I,D)};return M=>({bindFunction:v(M),isboundFunction:E(),onActivationFunction:R(M),onDeactivationFunction:w(M),rebindFunction:O(M),unbindAsyncFunction:S(),unbindFunction:_()})}_bind(v){return this._bindingDictionary.add(v.serviceIdentifier,v),new d.BindingToSyntax(v)}_buildBinding(v){const _=this.options.defaultScope||r.BindingScopeEnum.Transient;return new i.Binding(v,_)}async _getAll(v){return Promise.all(this._get(v))}_get(v){const _={...v,contextInterceptor:S=>S,targetType:r.TargetTypeEnum.Variable};if(this._middleware){const S=this._middleware(_);if(S==null)throw new Error(o.INVALID_MIDDLEWARE_RETURN);return S}return this._planAndResolve()(_)}_getButThrowIfAsync(v){const _=this._get(v);if((0,c.isPromiseOrContainsPromise)(_))throw new Error(o.LAZY_IN_SYNC(v.serviceIdentifier));return _}_getAllArgs(v,_,S){return{avoidConstraints:!(_?.enforceBindingConstraints??!1),isMultiInject:!0,isOptional:S,serviceIdentifier:v}}_getNotAllArgs(v,_,S,E,O){return{avoidConstraints:!1,isMultiInject:_,isOptional:S,key:E,serviceIdentifier:v,value:O}}_getPlanMetadataFromNextArgs(v){const _={isMultiInject:v.isMultiInject};return v.key!==void 0&&(_.customTag={key:v.key,value:v.value}),v.isOptional===!0&&(_.isOptional=!0),_}_planAndResolve(){return v=>{let _=(0,u.plan)(this._metadataReader,this,v.targetType,v.serviceIdentifier,this._getPlanMetadataFromNextArgs(v),v.avoidConstraints);return _=v.contextInterceptor(_),(0,f.resolve)(_)}}_deactivateIfSingleton(v){if(v.activated)return(0,c.isPromise)(v.cache)?v.cache.then(_=>this._deactivate(v,_)):this._deactivate(v,v.cache)}_deactivateSingletons(v){for(const _ of v){const S=this._deactivateIfSingleton(_);if((0,c.isPromise)(S))throw new Error(o.ASYNC_UNBIND_REQUIRED)}}async _deactivateSingletonsAsync(v){await Promise.all(v.map(async _=>this._deactivateIfSingleton(_)))}_propagateContainerDeactivationThenBindingAndPreDestroy(v,_,S){return this.parent?this._deactivate.bind(this.parent)(v,_):this._bindingDeactivationAndPreDestroy(v,_,S)}async _propagateContainerDeactivationThenBindingAndPreDestroyAsync(v,_,S){this.parent?await this._deactivate.bind(this.parent)(v,_):await this._bindingDeactivationAndPreDestroyAsync(v,_,S)}_removeServiceFromDictionary(v){try{this._bindingDictionary.remove(v)}catch{throw new Error(`${o.CANNOT_UNBIND} ${(0,p.getServiceIdentifierAsString)(v)}`)}}_bindingDeactivationAndPreDestroy(v,_,S){if(typeof v.onDeactivation=="function"){const E=v.onDeactivation(_);if((0,c.isPromise)(E))return E.then(()=>this._preDestroy(S,_))}return this._preDestroy(S,_)}async _bindingDeactivationAndPreDestroyAsync(v,_,S){typeof v.onDeactivation=="function"&&await v.onDeactivation(_),await this._preDestroy(S,_)}}return oi.Container=y,oi}var uo={},bp;function Mw(){if(bp)return uo;bp=1,Object.defineProperty(uo,"__esModule",{value:!0}),uo.AsyncContainerModule=uo.ContainerModule=void 0;const n=is();class e{id;registry;constructor(o){this.id=(0,n.id)(),this.registry=o}}uo.ContainerModule=e;class t{id;registry;constructor(o){this.id=(0,n.id)(),this.registry=o}}return uo.AsyncContainerModule=t,uo}var jn={},bc={},Sp;function Rw(){if(Sp)return bc;Sp=1,Object.defineProperty(bc,"__esModule",{value:!0}),bc.getFirstArrayDuplicate=n;function n(e){const t=new Set;for(const i of e){if(t.has(i))return i;t.add(i)}}return bc}var wp;function Ur(){if(wp)return jn;wp=1;var n=jn&&jn.__createBinding||(Object.create?(function(m,y,b,v){v===void 0&&(v=b);var _=Object.getOwnPropertyDescriptor(y,b);(!_||("get"in _?!y.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return y[b]}}),Object.defineProperty(m,v,_)}):(function(m,y,b,v){v===void 0&&(v=b),m[v]=y[b]})),e=jn&&jn.__setModuleDefault||(Object.create?(function(m,y){Object.defineProperty(m,"default",{enumerable:!0,value:y})}):function(m,y){m.default=y}),t=jn&&jn.__importStar||(function(){var m=function(y){return m=Object.getOwnPropertyNames||function(b){var v=[];for(var _ in b)Object.prototype.hasOwnProperty.call(b,_)&&(v[v.length]=_);return v},m(y)};return function(y){if(y&&y.__esModule)return y;var b={};if(y!=null)for(var v=m(y),_=0;_<v.length;_++)v[_]!=="default"&&n(b,y,v[_]);return e(b,y),b}})();Object.defineProperty(jn,"__esModule",{value:!0}),jn.decorate=g,jn.tagParameter=u,jn.tagProperty=f,jn.createTaggedDecorator=l;const i=t(Tn()),o=t(Bt()),r=Rw();function s(m){return m.prototype!==void 0}function a(m){if(m!==void 0)throw new Error(i.INVALID_DECORATOR_OPERATION)}function u(m,y,b,v){a(y),c(o.TAGGED,m,b.toString(),v)}function f(m,y,b){if(s(m))throw new Error(i.INVALID_DECORATOR_OPERATION);c(o.TAGGED_PROP,m.constructor,y,b)}function d(m){let y=[];if(Array.isArray(m)){y=m;const b=(0,r.getFirstArrayDuplicate)(y.map(v=>v.key));if(b!==void 0)throw new Error(`${i.DUPLICATED_METADATA} ${b.toString()}`)}else y=[m];return y}function c(m,y,b,v){const _=d(v);let S={};Reflect.hasOwnMetadata(m,y)&&(S=Reflect.getMetadata(m,y));let E=S[b];if(E===void 0)E=[];else for(const O of E)if(_.some(R=>R.key===O.key))throw new Error(`${i.DUPLICATED_METADATA} ${O.key.toString()}`);E.push(..._),S[b]=E,Reflect.defineMetadata(m,S,y)}function l(m){return(y,b,v)=>{typeof v=="number"?u(y,b,v,m):f(y,b,m)}}function p(m,y){Reflect.decorate(m,y)}function h(m,y){return function(b,v){y(b,v,m)}}function g(m,y,b){typeof b=="number"?p([h(b,m)],y):typeof b=="string"?Reflect.decorate([m],y,b):p([m],y)}return jn}var Oi={},Ep;function Aw(){if(Ep)return Oi;Ep=1;var n=Oi&&Oi.__createBinding||(Object.create?(function(s,a,u,f){f===void 0&&(f=u);var d=Object.getOwnPropertyDescriptor(a,u);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[u]}}),Object.defineProperty(s,f,d)}):(function(s,a,u,f){f===void 0&&(f=u),s[f]=a[u]})),e=Oi&&Oi.__setModuleDefault||(Object.create?(function(s,a){Object.defineProperty(s,"default",{enumerable:!0,value:a})}):function(s,a){s.default=a}),t=Oi&&Oi.__importStar||(function(){var s=function(a){return s=Object.getOwnPropertyNames||function(u){var f=[];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[f.length]=d);return f},s(a)};return function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f=s(a),d=0;d<f.length;d++)f[d]!=="default"&&n(u,a,f[d]);return e(u,a),u}})();Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.injectable=r;const i=t(Tn()),o=t(Bt());function r(){return function(s){if(Reflect.hasOwnMetadata(o.PARAM_TYPES,s))throw new Error(i.DUPLICATED_INJECTABLE_DECORATOR);const a=Reflect.getMetadata(o.DESIGN_PARAM_TYPES,s)||[];return Reflect.defineMetadata(o.PARAM_TYPES,a,s),s}}return Oi}var Sc={},Pp;function Ow(){if(Pp)return Sc;Pp=1,Object.defineProperty(Sc,"__esModule",{value:!0}),Sc.tagged=t;const n=wr(),e=Ur();function t(i,o){return(0,e.createTaggedDecorator)(new n.Metadata(i,o))}return Sc}var Ii={},Mp;function Iw(){if(Mp)return Ii;Mp=1;var n=Ii&&Ii.__createBinding||(Object.create?(function(a,u,f,d){d===void 0&&(d=f);var c=Object.getOwnPropertyDescriptor(u,f);(!c||("get"in c?!u.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(a,d,c)}):(function(a,u,f,d){d===void 0&&(d=f),a[d]=u[f]})),e=Ii&&Ii.__setModuleDefault||(Object.create?(function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}):function(a,u){a.default=u}),t=Ii&&Ii.__importStar||(function(){var a=function(u){return a=Object.getOwnPropertyNames||function(f){var d=[];for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(d[d.length]=c);return d},a(u)};return function(u){if(u&&u.__esModule)return u;var f={};if(u!=null)for(var d=a(u),c=0;c<d.length;c++)d[c]!=="default"&&n(f,u,d[c]);return e(f,u),f}})();Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.named=s;const i=t(Bt()),o=wr(),r=Ur();function s(a){return(0,r.createTaggedDecorator)(new o.Metadata(i.NAMED_TAG,a))}return Ii}var di={},wc={},Rp;function y_(){if(Rp)return wc;Rp=1,Object.defineProperty(wc,"__esModule",{value:!0}),wc.injectBase=i;const n=Tn(),e=wr(),t=Ur();function i(o){return r=>(s,a,u)=>{if(r===void 0){const f=typeof s=="function"?s.name:s.constructor.name;throw new Error((0,n.UNDEFINED_INJECT_ANNOTATION)(f))}(0,t.createTaggedDecorator)(new e.Metadata(o,r))(s,a,u)}}return wc}var Ap;function Cw(){if(Ap)return di;Ap=1;var n=di&&di.__createBinding||(Object.create?(function(s,a,u,f){f===void 0&&(f=u);var d=Object.getOwnPropertyDescriptor(a,u);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[u]}}),Object.defineProperty(s,f,d)}):(function(s,a,u,f){f===void 0&&(f=u),s[f]=a[u]})),e=di&&di.__setModuleDefault||(Object.create?(function(s,a){Object.defineProperty(s,"default",{enumerable:!0,value:a})}):function(s,a){s.default=a}),t=di&&di.__importStar||(function(){var s=function(a){return s=Object.getOwnPropertyNames||function(u){var f=[];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[f.length]=d);return f},s(a)};return function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f=s(a),d=0;d<f.length;d++)f[d]!=="default"&&n(u,a,f[d]);return e(u,a),u}})();Object.defineProperty(di,"__esModule",{value:!0}),di.inject=void 0;const i=t(Bt()),r=(0,y_().injectBase)(i.INJECT_TAG);return di.inject=r,di}var Ci={},Op;function Tw(){if(Op)return Ci;Op=1;var n=Ci&&Ci.__createBinding||(Object.create?(function(a,u,f,d){d===void 0&&(d=f);var c=Object.getOwnPropertyDescriptor(u,f);(!c||("get"in c?!u.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(a,d,c)}):(function(a,u,f,d){d===void 0&&(d=f),a[d]=u[f]})),e=Ci&&Ci.__setModuleDefault||(Object.create?(function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}):function(a,u){a.default=u}),t=Ci&&Ci.__importStar||(function(){var a=function(u){return a=Object.getOwnPropertyNames||function(f){var d=[];for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(d[d.length]=c);return d},a(u)};return function(u){if(u&&u.__esModule)return u;var f={};if(u!=null)for(var d=a(u),c=0;c<d.length;c++)d[c]!=="default"&&n(f,u,d[c]);return e(f,u),f}})();Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.optional=s;const i=t(Bt()),o=wr(),r=Ur();function s(){return(0,r.createTaggedDecorator)(new o.Metadata(i.OPTIONAL_TAG,!0))}return Ci}var Ti={},Ip;function Dw(){if(Ip)return Ti;Ip=1;var n=Ti&&Ti.__createBinding||(Object.create?(function(a,u,f,d){d===void 0&&(d=f);var c=Object.getOwnPropertyDescriptor(u,f);(!c||("get"in c?!u.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(a,d,c)}):(function(a,u,f,d){d===void 0&&(d=f),a[d]=u[f]})),e=Ti&&Ti.__setModuleDefault||(Object.create?(function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}):function(a,u){a.default=u}),t=Ti&&Ti.__importStar||(function(){var a=function(u){return a=Object.getOwnPropertyNames||function(f){var d=[];for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(d[d.length]=c);return d},a(u)};return function(u){if(u&&u.__esModule)return u;var f={};if(u!=null)for(var d=a(u),c=0;c<d.length;c++)d[c]!=="default"&&n(f,u,d[c]);return e(f,u),f}})();Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.unmanaged=s;const i=t(Bt()),o=wr(),r=Ur();function s(){return function(a,u,f){const d=new o.Metadata(i.UNMANAGED_TAG,!0);(0,r.tagParameter)(a,u,f,d)}}return Ti}var li={},Cp;function xw(){if(Cp)return li;Cp=1;var n=li&&li.__createBinding||(Object.create?(function(s,a,u,f){f===void 0&&(f=u);var d=Object.getOwnPropertyDescriptor(a,u);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[u]}}),Object.defineProperty(s,f,d)}):(function(s,a,u,f){f===void 0&&(f=u),s[f]=a[u]})),e=li&&li.__setModuleDefault||(Object.create?(function(s,a){Object.defineProperty(s,"default",{enumerable:!0,value:a})}):function(s,a){s.default=a}),t=li&&li.__importStar||(function(){var s=function(a){return s=Object.getOwnPropertyNames||function(u){var f=[];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[f.length]=d);return f},s(a)};return function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f=s(a),d=0;d<f.length;d++)f[d]!=="default"&&n(u,a,f[d]);return e(u,a),u}})();Object.defineProperty(li,"__esModule",{value:!0}),li.multiInject=void 0;const i=t(Bt()),r=(0,y_().injectBase)(i.MULTI_INJECT_TAG);return li.multiInject=r,li}var Di={},Tp;function jw(){if(Tp)return Di;Tp=1;var n=Di&&Di.__createBinding||(Object.create?(function(a,u,f,d){d===void 0&&(d=f);var c=Object.getOwnPropertyDescriptor(u,f);(!c||("get"in c?!u.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(a,d,c)}):(function(a,u,f,d){d===void 0&&(d=f),a[d]=u[f]})),e=Di&&Di.__setModuleDefault||(Object.create?(function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}):function(a,u){a.default=u}),t=Di&&Di.__importStar||(function(){var a=function(u){return a=Object.getOwnPropertyNames||function(f){var d=[];for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(d[d.length]=c);return d},a(u)};return function(u){if(u&&u.__esModule)return u;var f={};if(u!=null)for(var d=a(u),c=0;c<d.length;c++)d[c]!=="default"&&n(f,u,d[c]);return e(f,u),f}})();Object.defineProperty(Di,"__esModule",{value:!0}),Di.targetName=s;const i=t(Bt()),o=wr(),r=Ur();function s(a){return function(u,f,d){const c=new o.Metadata(i.NAME_TAG,a);(0,r.tagParameter)(u,f,d,c)}}return Di}var fi={},Ec={},Dp;function v_(){if(Dp)return Ec;Dp=1,Object.defineProperty(Ec,"__esModule",{value:!0}),Ec.propertyEventDecorator=e;const n=wr();function e(t,i){return()=>(o,r)=>{const s=new n.Metadata(t,r);if(Reflect.hasOwnMetadata(t,o.constructor))throw new Error(i);Reflect.defineMetadata(t,s,o.constructor)}}return Ec}var xp;function Lw(){if(xp)return fi;xp=1;var n=fi&&fi.__createBinding||(Object.create?(function(a,u,f,d){d===void 0&&(d=f);var c=Object.getOwnPropertyDescriptor(u,f);(!c||("get"in c?!u.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(a,d,c)}):(function(a,u,f,d){d===void 0&&(d=f),a[d]=u[f]})),e=fi&&fi.__setModuleDefault||(Object.create?(function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}):function(a,u){a.default=u}),t=fi&&fi.__importStar||(function(){var a=function(u){return a=Object.getOwnPropertyNames||function(f){var d=[];for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(d[d.length]=c);return d},a(u)};return function(u){if(u&&u.__esModule)return u;var f={};if(u!=null)for(var d=a(u),c=0;c<d.length;c++)d[c]!=="default"&&n(f,u,d[c]);return e(f,u),f}})();Object.defineProperty(fi,"__esModule",{value:!0}),fi.postConstruct=void 0;const i=t(Tn()),o=t(Bt()),s=(0,v_().propertyEventDecorator)(o.POST_CONSTRUCT,i.MULTIPLE_POST_CONSTRUCT_METHODS);return fi.postConstruct=s,fi}var hi={},jp;function Nw(){if(jp)return hi;jp=1;var n=hi&&hi.__createBinding||(Object.create?(function(a,u,f,d){d===void 0&&(d=f);var c=Object.getOwnPropertyDescriptor(u,f);(!c||("get"in c?!u.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(a,d,c)}):(function(a,u,f,d){d===void 0&&(d=f),a[d]=u[f]})),e=hi&&hi.__setModuleDefault||(Object.create?(function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}):function(a,u){a.default=u}),t=hi&&hi.__importStar||(function(){var a=function(u){return a=Object.getOwnPropertyNames||function(f){var d=[];for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(d[d.length]=c);return d},a(u)};return function(u){if(u&&u.__esModule)return u;var f={};if(u!=null)for(var d=a(u),c=0;c<d.length;c++)d[c]!=="default"&&n(f,u,d[c]);return e(f,u),f}})();Object.defineProperty(hi,"__esModule",{value:!0}),hi.preDestroy=void 0;const i=t(Tn()),o=t(Bt()),s=(0,v_().propertyEventDecorator)(o.PRE_DESTROY,i.MULTIPLE_PRE_DESTROY_METHODS);return hi.preDestroy=s,hi}var Lp;function se(){return Lp||(Lp=1,(function(n){var e=sr&&sr.__createBinding||(Object.create?(function(I,D,C,z){z===void 0&&(z=C);var G=Object.getOwnPropertyDescriptor(D,C);(!G||("get"in G?!D.__esModule:G.writable||G.configurable))&&(G={enumerable:!0,get:function(){return D[C]}}),Object.defineProperty(I,z,G)}):(function(I,D,C,z){z===void 0&&(z=C),I[z]=D[C]})),t=sr&&sr.__setModuleDefault||(Object.create?(function(I,D){Object.defineProperty(I,"default",{enumerable:!0,value:D})}):function(I,D){I.default=D}),i=sr&&sr.__importStar||(function(){var I=function(D){return I=Object.getOwnPropertyNames||function(C){var z=[];for(var G in C)Object.prototype.hasOwnProperty.call(C,G)&&(z[z.length]=G);return z},I(D)};return function(D){if(D&&D.__esModule)return D;var C={};if(D!=null)for(var z=I(D),G=0;G<z.length;G++)z[G]!=="default"&&e(C,D,z[G]);return t(C,D),C}})();Object.defineProperty(n,"__esModule",{value:!0}),n.multiBindToService=n.getServiceIdentifierAsString=n.typeConstraint=n.namedConstraint=n.taggedConstraint=n.traverseAncerstors=n.decorate=n.id=n.MetadataReader=n.preDestroy=n.postConstruct=n.targetName=n.multiInject=n.unmanaged=n.optional=n.inject=n.named=n.tagged=n.injectable=n.createTaggedDecorator=n.ContainerModule=n.AsyncContainerModule=n.TargetTypeEnum=n.BindingTypeEnum=n.BindingScopeEnum=n.Container=n.METADATA_KEY=n.LazyServiceIdentifer=n.LazyServiceIdentifier=void 0,yl();const o=qd(),r=i(Bt());var s=qd();Object.defineProperty(n,"LazyServiceIdentifier",{enumerable:!0,get:function(){return s.LazyServiceIdentifier}}),n.LazyServiceIdentifer=o.LazyServiceIdentifier,n.METADATA_KEY=r;var a=Pw();Object.defineProperty(n,"Container",{enumerable:!0,get:function(){return a.Container}});var u=Qi();Object.defineProperty(n,"BindingScopeEnum",{enumerable:!0,get:function(){return u.BindingScopeEnum}}),Object.defineProperty(n,"BindingTypeEnum",{enumerable:!0,get:function(){return u.BindingTypeEnum}}),Object.defineProperty(n,"TargetTypeEnum",{enumerable:!0,get:function(){return u.TargetTypeEnum}});var f=Mw();Object.defineProperty(n,"AsyncContainerModule",{enumerable:!0,get:function(){return f.AsyncContainerModule}}),Object.defineProperty(n,"ContainerModule",{enumerable:!0,get:function(){return f.ContainerModule}});var d=Ur();Object.defineProperty(n,"createTaggedDecorator",{enumerable:!0,get:function(){return d.createTaggedDecorator}});var c=Aw();Object.defineProperty(n,"injectable",{enumerable:!0,get:function(){return c.injectable}});var l=Ow();Object.defineProperty(n,"tagged",{enumerable:!0,get:function(){return l.tagged}});var p=Iw();Object.defineProperty(n,"named",{enumerable:!0,get:function(){return p.named}});var h=Cw();Object.defineProperty(n,"inject",{enumerable:!0,get:function(){return h.inject}});var g=Tw();Object.defineProperty(n,"optional",{enumerable:!0,get:function(){return g.optional}});var m=Dw();Object.defineProperty(n,"unmanaged",{enumerable:!0,get:function(){return m.unmanaged}});var y=xw();Object.defineProperty(n,"multiInject",{enumerable:!0,get:function(){return y.multiInject}});var b=jw();Object.defineProperty(n,"targetName",{enumerable:!0,get:function(){return b.targetName}});var v=Lw();Object.defineProperty(n,"postConstruct",{enumerable:!0,get:function(){return v.postConstruct}});var _=Nw();Object.defineProperty(n,"preDestroy",{enumerable:!0,get:function(){return _.preDestroy}});var S=Qv();Object.defineProperty(n,"MetadataReader",{enumerable:!0,get:function(){return S.MetadataReader}});var E=is();Object.defineProperty(n,"id",{enumerable:!0,get:function(){return E.id}});var O=Ur();Object.defineProperty(n,"decorate",{enumerable:!0,get:function(){return O.decorate}});var R=p_();Object.defineProperty(n,"traverseAncerstors",{enumerable:!0,get:function(){return R.traverseAncerstors}}),Object.defineProperty(n,"taggedConstraint",{enumerable:!0,get:function(){return R.taggedConstraint}}),Object.defineProperty(n,"namedConstraint",{enumerable:!0,get:function(){return R.namedConstraint}}),Object.defineProperty(n,"typeConstraint",{enumerable:!0,get:function(){return R.typeConstraint}});var w=Ra();Object.defineProperty(n,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return w.getServiceIdentifierAsString}});var M=h_();Object.defineProperty(n,"multiBindToService",{enumerable:!0,get:function(){return M.multiBindToService}})})(sr)),sr}var Vs={},Np;function ge(){return Np||(Np=1,Object.defineProperty(Vs,"__esModule",{value:!0}),Vs.TYPES=void 0,Vs.TYPES={Action:Symbol("Action"),IActionDispatcher:Symbol("IActionDispatcher"),IActionDispatcherProvider:Symbol("IActionDispatcherProvider"),IActionHandlerInitializer:Symbol("IActionHandlerInitializer"),ActionHandlerRegistration:Symbol("ActionHandlerRegistration"),ActionHandlerRegistryProvider:Symbol("ActionHandlerRegistryProvider"),IAnchorComputer:Symbol("IAnchor"),AnimationFrameSyncer:Symbol("AnimationFrameSyncer"),IButtonHandlerRegistration:Symbol("IButtonHandlerRegistration"),ICommandPaletteActionProvider:Symbol("ICommandPaletteActionProvider"),ICommandPaletteActionProviderRegistry:Symbol("ICommandPaletteActionProviderRegistry"),CommandRegistration:Symbol("CommandRegistration"),ICommandStack:Symbol("ICommandStack"),CommandStackOptions:Symbol("CommandStackOptions"),ICommandStackProvider:Symbol("ICommandStackProvider"),IContextMenuItemProvider:Symbol.for("IContextMenuProvider"),IContextMenuProviderRegistry:Symbol.for("IContextMenuProviderRegistry"),IContextMenuService:Symbol.for("IContextMenuService"),IContextMenuServiceProvider:Symbol.for("IContextMenuServiceProvider"),DOMHelper:Symbol("DOMHelper"),IDiagramLocker:Symbol("IDiagramLocker"),IEdgeRouter:Symbol("IEdgeRouter"),IEdgeRoutePostprocessor:Symbol("IEdgeRoutePostprocessor"),IEditLabelValidationDecorator:Symbol("IEditLabelValidationDecorator"),IEditLabelValidator:Symbol("IEditLabelValidator"),HiddenModelViewer:Symbol("HiddenModelViewer"),HiddenVNodePostprocessor:Symbol("HiddenVNodeDecorator"),HoverState:Symbol("HoverState"),KeyListener:Symbol("KeyListener"),LayoutRegistration:Symbol("LayoutRegistration"),LayoutRegistry:Symbol("LayoutRegistry"),Layouter:Symbol("Layouter"),LogLevel:Symbol("LogLevel"),ILogger:Symbol("ILogger"),IModelFactory:Symbol("IModelFactory"),IModelLayoutEngine:Symbol("IModelLayoutEngine"),ModelRendererFactory:Symbol("ModelRendererFactory"),ModelSource:Symbol("ModelSource"),ModelSourceProvider:Symbol("ModelSourceProvider"),ModelViewer:Symbol("ModelViewer"),MouseListener:Symbol("MouseListener"),PatcherProvider:Symbol("PatcherProvider"),IPopupModelProvider:Symbol("IPopupModelProvider"),PopupModelViewer:Symbol("PopupModelViewer"),PopupMouseListener:Symbol("PopupMouseListener"),PopupVNodePostprocessor:Symbol("PopupVNodeDecorator"),SModelElementRegistration:Symbol("SModelElementRegistration"),SModelRegistry:Symbol("SModelRegistry"),ISnapper:Symbol("ISnapper"),SvgExporter:Symbol("SvgExporter"),ISvgExportPostprocessor:Symbol("ISvgExportPostprocessor"),IUIExtension:Symbol("IUIExtension"),UIExtensionRegistry:Symbol("UIExtensionRegistry"),IVNodePostprocessor:Symbol("IVNodePostprocessor"),ViewRegistration:Symbol("ViewRegistration"),ViewRegistry:Symbol("ViewRegistry"),IViewer:Symbol("IViewer"),ViewerOptions:Symbol("ViewerOptions"),IViewerProvider:Symbol("IViewerProvider")}),Vs}var It={},Ht={},Fp;function Er(){if(Fp)return Ht;Fp=1;var n=Ht&&Ht.__decorate||function(s,a,u,f){var d=arguments.length,c=d<3?a:f===null?f=Object.getOwnPropertyDescriptor(a,u):f,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,a,u,f);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(c=(d<3?l(c):d>3?l(a,u,c):l(a,u))||c);return d>3&&c&&Object.defineProperty(a,u,c),c};Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.MultiInstanceRegistry=Ht.InstanceRegistry=Ht.FactoryRegistry=Ht.ProviderRegistry=void 0;const e=se();let t=class{constructor(){this.elements=new Map}register(a,u){if(a===void 0)throw new Error("Key is undefined");if(this.hasKey(a))throw new Error("Key is already registered: "+a);this.elements.set(a,u)}deregister(a){if(a===void 0)throw new Error("Key is undefined");this.elements.delete(a)}hasKey(a){return this.elements.has(a)}get(a,u){const f=this.elements.get(a);return f?new f(u):this.missing(a,u)}missing(a,u){throw new Error("Unknown registry key: "+a)}};Ht.ProviderRegistry=t,Ht.ProviderRegistry=t=n([(0,e.injectable)()],t);let i=class{constructor(){this.elements=new Map}register(a,u){if(a===void 0)throw new Error("Key is undefined");if(this.hasKey(a))throw new Error(`Key is already registered: ${a}. Use \`overrideModelElement\` instead.`);this.elements.set(a,u)}override(a,u){if(a===void 0)throw new Error("Key is undefined");if(!this.hasKey(a))throw new Error(`Key is not registered: ${a}. Use \`configureModelElement\` instead.`);this.elements.set(a,u)}deregister(a){if(a===void 0)throw new Error("Key is undefined");this.elements.delete(a)}hasKey(a){return this.elements.has(a)}get(a,u){const f=this.elements.get(a);return f?f(u):this.missing(a,u)}missing(a,u){throw new Error("Unknown registry key: "+a)}};Ht.FactoryRegistry=i,Ht.FactoryRegistry=i=n([(0,e.injectable)()],i);let o=class{constructor(){this.elements=new Map}register(a,u){if(a===void 0)throw new Error("Key is undefined");if(this.hasKey(a))throw new Error(`Key is already registered: ${a}. Use \`overrideModelElement\` instead.`);this.elements.set(a,u)}override(a,u){if(a===void 0)throw new Error("Key is undefined");if(!this.hasKey(a))throw new Error(`Key is not registered: ${a}. Use \`configureModelElement\` instead.`);this.elements.set(a,u)}deregister(a){if(a===void 0)throw new Error("Key is undefined");this.elements.delete(a)}hasKey(a){return this.elements.has(a)}get(a){const u=this.elements.get(a);return u||this.missing(a)}missing(a){throw new Error("Unknown registry key: "+a)}};Ht.InstanceRegistry=o,Ht.InstanceRegistry=o=n([(0,e.injectable)()],o);let r=class{constructor(){this.elements=new Map}register(a,u){if(a===void 0)throw new Error("Key is undefined");const f=this.elements.get(a);f!==void 0?f.push(u):this.elements.set(a,[u])}deregisterAll(a){if(a===void 0)throw new Error("Key is undefined");this.elements.delete(a)}get(a){const u=this.elements.get(a);return u!==void 0?u:[]}};return Ht.MultiInstanceRegistry=r,Ht.MultiInstanceRegistry=r=n([(0,e.injectable)()],r),Ht}var Kt={},cd={},Bp;function os(){return Bp||(Bp=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.mapIterable=n.filterIterable=n.DONE_RESULT=n.toArray=n.FluentIterableImpl=void 0;class e{constructor(u,f){this.startFn=u,this.nextFn=f}[Symbol.iterator](){const u={state:this.startFn(),next:()=>this.nextFn(u.state),[Symbol.iterator]:()=>u};return u}filter(u){return i(this,u)}map(u){return o(this,u)}forEach(u){const f=this[Symbol.iterator]();let d=0,c;do c=f.next(),c.value!==void 0&&u(c.value,d),d++;while(!c.done)}indexOf(u){const f=this[Symbol.iterator]();let d=0,c;do{if(c=f.next(),c.value===u)return d;d++}while(!c.done);return-1}}n.FluentIterableImpl=e;function t(a){if(a.constructor===Array)return a;const u=[];return a.forEach(f=>u.push(f)),u}n.toArray=t,n.DONE_RESULT=Object.freeze({done:!0,value:void 0});function i(a,u){return new e(()=>r(a),f=>{let d;do d=f.next();while(!d.done&&!u(d.value));return d})}n.filterIterable=i;function o(a,u){return new e(()=>r(a),f=>{const{done:d,value:c}=f.next();return d?n.DONE_RESULT:{done:!1,value:u(c)}})}n.mapIterable=o;function r(a){const u=a[Symbol.iterator];if(typeof u=="function")return u.call(a);const f=a.length;return typeof f=="number"&&f>=0?new s(a):{next:()=>n.DONE_RESULT}}class s{constructor(u){this.array=u,this.index=0}next(){return this.index<this.array.length?{done:!1,value:this.array[this.index++]}:n.DONE_RESULT}[Symbol.iterator](){return this}}})(cd)),cd}var Vp;function Ke(){if(Vp)return Kt;Vp=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.ModelIndexImpl=Kt.createRandomId=Kt.SModelRootImpl=Kt.SChildElementImpl=Kt.SParentElementImpl=Kt.isParent=Kt.SModelElementImpl=void 0;const n=He(),e=os();class t{get root(){let c=this;for(;c;){if(c instanceof s)return c;c instanceof r?c=c.parent:c=void 0}throw new Error("Element has no root")}get index(){return this.root.index}hasFeature(c){return this.features!==void 0&&this.features.has(c)}}Kt.SModelElementImpl=t;function i(d){const c=d.children;return c!==void 0&&c.constructor===Array}Kt.isParent=i;class o extends t{constructor(){super(...arguments),this.children=[]}add(c,l){const p=this.children;if(l===void 0)p.push(c);else{if(l<0||l>this.children.length)throw new Error(`Child index ${l} out of bounds (0..${p.length})`);p.splice(l,0,c)}c.parent=this,this.index.add(c)}remove(c){const l=this.children,p=l.indexOf(c);if(p<0)throw new Error(`No such child ${c.id}`);l.splice(p,1),this.index.remove(c)}removeAll(c){const l=this.children;if(c!==void 0){for(let p=l.length-1;p>=0;p--)if(c(l[p])){const h=l.splice(p,1)[0];this.index.remove(h)}}else l.forEach(p=>{this.index.remove(p)}),l.splice(0,l.length)}move(c,l){const p=this.children,h=p.indexOf(c);if(h===-1)throw new Error(`No such child ${c.id}`);if(l<0||l>p.length-1)throw new Error(`Child index ${l} out of bounds (0..${p.length})`);p.splice(h,1),p.splice(l,0,c)}localToParent(c){return(0,n.isBounds)(c)?c:{x:c.x,y:c.y,width:-1,height:-1}}parentToLocal(c){return(0,n.isBounds)(c)?c:{x:c.x,y:c.y,width:-1,height:-1}}}Kt.SParentElementImpl=o;class r extends o{}Kt.SChildElementImpl=r;class s extends o{constructor(c=new f){super(),this.canvasBounds=n.Bounds.EMPTY,Object.defineProperty(this,"index",{value:c,writable:!1})}}Kt.SModelRootImpl=s;const a="0123456789abcdefghijklmnopqrstuvwxyz";function u(d=8){let c="";for(let l=0;l<d;l++)c+=a.charAt(Math.floor(Math.random()*a.length));return c}Kt.createRandomId=u;class f{constructor(){this.id2element=new Map}add(c){if(c.id){if(this.contains(c))throw new Error("Duplicate ID in model: "+c.id)}else do c.id=u();while(this.contains(c));if(this.id2element.set(c.id,c),c instanceof o)for(const l of c.children)this.add(l)}remove(c){if(this.id2element.delete(c.id),c instanceof o)for(const l of c.children)this.remove(l)}contains(c){return this.id2element.has(c.id)}getById(c){return this.id2element.get(c)}getAttachedElements(c){return[]}all(){return(0,e.mapIterable)(this.id2element,([c,l])=>l)}}return Kt.ModelIndexImpl=f,Kt}var zp;function Zr(){if(zp)return It;zp=1;var n=It&&It.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g},e=It&&It.__metadata||function(d,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(d,c)},t=It&&It.__param||function(d,c){return function(l,p){c(l,p,d)}};Object.defineProperty(It,"__esModule",{value:!0}),It.createFeatureSet=It.EMPTY_ROOT=It.SModelFactory=It.SModelRegistry=void 0;const i=se(),o=ge(),r=Er(),s=Ke();let a=class extends r.FactoryRegistry{constructor(c){super(),c.forEach(l=>{let p=this.getDefaultFeatures(l.constr);if(!p&&l.features&&l.features.enable&&(p=[]),p){const h=f(p,l.features);l.isOverride?this.override(l.type,()=>{const g=new l.constr;return g.features=h,g}):this.register(l.type,()=>{const g=new l.constr;return g.features=h,g})}else l.isOverride?this.override(l.type,()=>new l.constr):this.register(l.type,()=>new l.constr)})}getDefaultFeatures(c){let l=c;do{const p=l.DEFAULT_FEATURES;if(p)return p;l=Object.getPrototypeOf(l)}while(l)}};It.SModelRegistry=a,It.SModelRegistry=a=n([(0,i.injectable)(),t(0,(0,i.multiInject)(o.TYPES.SModelElementRegistration)),t(0,(0,i.optional)()),e("design:paramtypes",[Array])],a);let u=class{createElement(c,l){let p;if(this.registry.hasKey(c.type)){const h=this.registry.get(c.type,void 0);if(!(h instanceof s.SChildElementImpl))throw new Error(`Element with type ${c.type} was expected to be an SChildElement.`);p=h}else p=new s.SChildElementImpl;return this.initializeChild(p,c,l)}createRoot(c){let l;if(this.registry.hasKey(c.type)){const p=this.registry.get(c.type,void 0);if(!(p instanceof s.SModelRootImpl))throw new Error(`Element with type ${c.type} was expected to be an SModelRoot.`);l=p}else l=new s.SModelRootImpl;return this.initializeRoot(l,c)}createSchema(c){const l={};for(const p in c)if(!this.isReserved(c,p)){const h=c[p];typeof h!="function"&&(l[p]=h)}return c instanceof s.SParentElementImpl&&(l.children=c.children.map(p=>this.createSchema(p))),l}initializeElement(c,l){for(const p in l)if(!this.isReserved(c,p)){const h=l[p];typeof h!="function"&&(c[p]=h)}return c}isReserved(c,l){if(["children","parent","index"].indexOf(l)>=0)return!0;let p=c;do{const h=Object.getOwnPropertyDescriptor(p,l);if(h!==void 0)return h.get!==void 0;p=Object.getPrototypeOf(p)}while(p);return!1}initializeParent(c,l){return this.initializeElement(c,l),(0,s.isParent)(l)&&(c.children=l.children.map(p=>this.createElement(p,c))),c}initializeChild(c,l,p){return this.initializeParent(c,l),p!==void 0&&(c.parent=p),c}initializeRoot(c,l){return this.initializeParent(c,l),c.index.add(c),c}};It.SModelFactory=u,n([(0,i.inject)(o.TYPES.SModelRegistry),e("design:type",a)],u.prototype,"registry",void 0),It.SModelFactory=u=n([(0,i.injectable)()],u),It.EMPTY_ROOT=Object.freeze({type:"NONE",id:"EMPTY"});function f(d,c){const l=new Set(d);if(c&&c.enable)for(const p of c.enable)l.add(p);if(c&&c.disable)for(const p of c.disable)l.delete(p);return l}return It.createFeatureSet=f,It}var Ar={},qp;function Aa(){if(qp)return Ar;qp=1;var n=Ar&&Ar.__decorate||function(i,o,r,s){var a=arguments.length,u=a<3?o:s===null?s=Object.getOwnPropertyDescriptor(o,r):s,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(i,o,r,s);else for(var d=i.length-1;d>=0;d--)(f=i[d])&&(u=(a<3?f(u):a>3?f(o,r,u):f(o,r))||u);return a>3&&u&&Object.defineProperty(o,r,u),u};Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.AnimationFrameSyncer=void 0;const e=se();let t=class{constructor(){this.tasks=[],this.endTasks=[],this.triggered=!1}isAvailable(){return typeof requestAnimationFrame=="function"}onNextFrame(o){this.tasks.push(o),this.trigger()}onEndOfNextFrame(o){this.endTasks.push(o),this.trigger()}trigger(){this.triggered||(this.triggered=!0,this.isAvailable()?requestAnimationFrame(o=>this.run(o)):setTimeout(o=>this.run(o)))}run(o){const r=this.tasks,s=this.endTasks;this.triggered=!1,this.tasks=[],this.endTasks=[],r.forEach(a=>a.call(void 0,o)),s.forEach(a=>a.call(void 0,o))}};return Ar.AnimationFrameSyncer=t,Ar.AnimationFrameSyncer=t=n([(0,e.injectable)()],t),Ar}var Hp;function Dl(){if(Hp)return Mi;Hp=1;var n=Mi&&Mi.__decorate||function(f,d,c,l){var p=arguments.length,h=p<3?d:l===null?l=Object.getOwnPropertyDescriptor(d,c):l,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,d,c,l);else for(var m=f.length-1;m>=0;m--)(g=f[m])&&(h=(p<3?g(h):p>3?g(d,c,h):g(d,c))||h);return p>3&&h&&Object.defineProperty(d,c,h),h},e=Mi&&Mi.__metadata||function(f,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,d)};Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.ActionDispatcher=void 0;const t=se(),i=qe(),o=vl(),r=ge(),s=Zr(),a=Aa();(0,i.setRequestContext)("client");let u=class{constructor(){this.postponedActions=[],this.requests=new Map}initialize(){return this.initialized||(this.initialized=this.actionHandlerRegistryProvider().then(d=>{this.actionHandlerRegistry=d,this.handleAction(i.SetModelAction.create(s.EMPTY_ROOT)).catch(()=>{})})),this.initialized}dispatch(d){return this.initialize().then(()=>{if(this.blockUntil!==void 0)return this.handleBlocked(d,this.blockUntil);if(this.diagramLocker.isAllowed(d))return this.handleAction(d)})}dispatchAll(d){return Promise.all(d.map(c=>this.dispatch(c)))}request(d){if(!d.requestId)return Promise.reject(new Error("Request without requestId"));const c=new o.Deferred;return this.requests.set(d.requestId,c),this.dispatch(d).catch(()=>{}),c.promise}handleAction(d){if(d.kind===i.UndoAction.KIND)return this.commandStack.undo().then(()=>{});if(d.kind===i.RedoAction.KIND)return this.commandStack.redo().then(()=>{});if((0,i.isResponseAction)(d)){const p=this.requests.get(d.responseId);if(p!==void 0){if(this.requests.delete(d.responseId),d.kind===i.RejectAction.KIND){const h=d;p.reject(new Error(h.message)),this.logger.warn(this,`Request with id ${d.responseId} failed.`,h.message,h.detail)}else p.resolve(d);return Promise.resolve()}this.logger.log(this,"No matching request for response",d)}const c=this.actionHandlerRegistry.get(d.kind);if(c.length===0){this.logger.warn(this,"Missing handler for action",d);const p=new Error(`Missing handler for action '${d.kind}'`);if((0,i.isRequestAction)(d)){const h=this.requests.get(d.requestId);h!==void 0&&(this.requests.delete(d.requestId),h.reject(p))}return Promise.reject(p)}this.logger.log(this,"Handle",d);const l=[];for(const p of c){const h=p.handle(d);(0,i.isAction)(h)?l.push(this.dispatch(h)):h!==void 0&&(l.push(this.commandStack.execute(h)),this.blockUntil=h.blockUntil)}return Promise.all(l)}handleBlocked(d,c){if(c(d)){this.blockUntil=void 0;const l=this.handleAction(d),p=this.postponedActions;this.postponedActions=[];for(const h of p)this.dispatch(h.action).then(h.resolve,h.reject);return l}else return this.logger.log(this,"Action is postponed due to block condition",d),new Promise((l,p)=>{this.postponedActions.push({action:d,resolve:l,reject:p})})}};return Mi.ActionDispatcher=u,n([(0,t.inject)(r.TYPES.ActionHandlerRegistryProvider),e("design:type",Function)],u.prototype,"actionHandlerRegistryProvider",void 0),n([(0,t.inject)(r.TYPES.ICommandStack),e("design:type",Object)],u.prototype,"commandStack",void 0),n([(0,t.inject)(r.TYPES.ILogger),e("design:type",Object)],u.prototype,"logger",void 0),n([(0,t.inject)(r.TYPES.AnimationFrameSyncer),e("design:type",a.AnimationFrameSyncer)],u.prototype,"syncer",void 0),n([(0,t.inject)(r.TYPES.IDiagramLocker),e("design:type",Object)],u.prototype,"diagramLocker",void 0),Mi.ActionDispatcher=u=n([(0,t.injectable)()],u),Mi}var Qt={},zs={},Kp;function ss(){if(Kp)return zs;Kp=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.isInjectable=void 0;function n(e){return Reflect.getMetadata("inversify:paramtypes",e)!==void 0}return zs.isInjectable=n,zs}var $p;function Au(){if($p)return Qt;$p=1;var n=Qt&&Qt.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g},e=Qt&&Qt.__metadata||function(d,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(d,c)},t=Qt&&Qt.__param||function(d,c){return function(l,p){c(l,p,d)}};Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.onAction=Qt.configureActionHandler=Qt.ActionHandlerRegistry=void 0;const i=se(),o=ge(),r=Er(),s=ss();let a=class extends r.MultiInstanceRegistry{constructor(c,l){super(),c.forEach(p=>this.register(p.actionKind,p.factory())),l.forEach(p=>this.initializeActionHandler(p))}initializeActionHandler(c){c.initialize(this)}};Qt.ActionHandlerRegistry=a,Qt.ActionHandlerRegistry=a=n([(0,i.injectable)(),t(0,(0,i.multiInject)(o.TYPES.ActionHandlerRegistration)),t(0,(0,i.optional)()),t(1,(0,i.multiInject)(o.TYPES.IActionHandlerInitializer)),t(1,(0,i.optional)()),e("design:paramtypes",[Array,Array])],a);function u(d,c,l){if(typeof l=="function"){if(!(0,s.isInjectable)(l))throw new Error(`Action handlers should be @injectable: ${l.name}`);d.isBound(l)||d.bind(l).toSelf()}d.bind(o.TYPES.ActionHandlerRegistration).toDynamicValue(p=>({actionKind:c,factory:()=>p.container.get(l)}))}Qt.configureActionHandler=u;function f(d,c,l){d.bind(o.TYPES.ActionHandlerRegistration).toConstantValue({actionKind:c,factory:()=>({handle:l})})}return Qt.onAction=f,Qt}var Or={},Yp;function __(){if(Yp)return Or;Yp=1;var n=Or&&Or.__decorate||function(i,o,r,s){var a=arguments.length,u=a<3?o:s===null?s=Object.getOwnPropertyDescriptor(o,r):s,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(i,o,r,s);else for(var d=i.length-1;d>=0;d--)(f=i[d])&&(u=(a<3?f(u):a>3?f(o,r,u):f(o,r))||u);return a>3&&u&&Object.defineProperty(o,r,u),u};Object.defineProperty(Or,"__esModule",{value:!0}),Or.DefaultDiagramLocker=void 0;const e=se();let t=class{isAllowed(o){return!0}};return Or.DefaultDiagramLocker=t,Or.DefaultDiagramLocker=t=n([(0,e.injectable)()],t),Or}var lo={},qs={},kp;function b_(){if(kp)return qs;kp=1,Object.defineProperty(qs,"__esModule",{value:!0}),qs.easeInOut=void 0;function n(e){return e<.5?e*e*2:1-(1-e)*(1-e)*2}return qs.easeInOut=n,qs}var Up;function as(){if(Up)return lo;Up=1,Object.defineProperty(lo,"__esModule",{value:!0}),lo.CompoundAnimation=lo.Animation=void 0;const n=b_();class e{constructor(o,r=n.easeInOut){this.context=o,this.ease=r,this.stopped=!1}start(){return this.stopped=!1,new Promise((o,r)=>{let s,a=0;const u=f=>{a++;let d;s===void 0?(s=f,d=0):d=f-s;const c=Math.min(1,d/this.context.duration),l=this.tween(this.ease(c),this.context);this.context.modelChanged.update(l),c===1?(this.context.logger.log(this,a*1e3/this.context.duration+" fps"),o(l)):this.stopped?(this.context.logger.log(this,"Animation stopped at "+c*100+"%"),o(l)):this.context.syncer.onNextFrame(u)};if(this.context.syncer.isAvailable())this.context.syncer.onNextFrame(u);else{const f=this.tween(1,this.context);o(f)}})}stop(){this.stopped=!0}}lo.Animation=e;class t extends e{constructor(o,r,s=[],a=n.easeInOut){super(r,a),this.model=o,this.context=r,this.components=s,this.ease=a}include(o){return this.components.push(o),this}tween(o,r){for(const s of this.components)s.tween(o,r);return this.model}}return lo.CompoundAnimation=t,lo}var it={},Gp;function gt(){if(Gp)return it;Gp=1;var n=it&&it.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g};Object.defineProperty(it,"__esModule",{value:!0}),it.ResetCommand=it.SystemCommand=it.PopupCommand=it.HiddenCommand=it.MergeableCommand=it.Command=it.isStoppableCommand=void 0,yl();const e=se(),t=ti();function i(d){return d&&(0,t.hasOwnProperty)(d,"stoppableCommandKey")&&"stopExecution"in d&&typeof d.stopExecution=="function"}it.isStoppableCommand=i;let o=class{};it.Command=o,it.Command=o=n([(0,e.injectable)()],o);let r=class extends o{merge(c,l){return!1}};it.MergeableCommand=r,it.MergeableCommand=r=n([(0,e.injectable)()],r);let s=class extends o{undo(c){return c.logger.error(this,"Cannot undo a hidden command"),c.root}redo(c){return c.logger.error(this,"Cannot redo a hidden command"),c.root}};it.HiddenCommand=s,it.HiddenCommand=s=n([(0,e.injectable)()],s);let a=class extends o{};it.PopupCommand=a,it.PopupCommand=a=n([(0,e.injectable)()],a);let u=class extends o{};it.SystemCommand=u,it.SystemCommand=u=n([(0,e.injectable)()],u);let f=class extends o{};return it.ResetCommand=f,it.ResetCommand=f=n([(0,e.injectable)()],f),it}var en={},Xp;function Vn(){if(Xp)return en;Xp=1;var n=en&&en.__decorate||function(f,d,c,l){var p=arguments.length,h=p<3?d:l===null?l=Object.getOwnPropertyDescriptor(d,c):l,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,d,c,l);else for(var m=f.length-1;m>=0;m--)(g=f[m])&&(h=(p<3?g(h):p>3?g(d,c,h):g(d,c))||h);return p>3&&h&&Object.defineProperty(d,c,h),h},e=en&&en.__metadata||function(f,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,d)},t=en&&en.__param||function(f,d){return function(c,l){d(c,l,f)}};Object.defineProperty(en,"__esModule",{value:!0}),en.configureCommand=en.CommandActionHandlerInitializer=en.CommandActionHandler=void 0;const i=se(),o=ss(),r=ge();class s{constructor(d){this.commandRegistration=d}handle(d){return this.commandRegistration.factory(d)}}en.CommandActionHandler=s;let a=class{constructor(d){this.registrations=d}initialize(d){this.registrations.forEach(c=>d.register(c.kind,new s(c)))}};en.CommandActionHandlerInitializer=a,en.CommandActionHandlerInitializer=a=n([(0,i.injectable)(),t(0,(0,i.multiInject)(r.TYPES.CommandRegistration)),t(0,(0,i.optional)()),e("design:paramtypes",[Array])],a);function u(f,d){if(!(0,o.isInjectable)(d))throw new Error(`Commands should be @injectable: ${d.name}`);f.isBound(d)||f.bind(d).toSelf(),f.bind(r.TYPES.CommandRegistration).toDynamicValue(c=>({kind:d.KIND,factory:l=>{const p=new i.Container;return p.parent=c.container,p.bind(r.TYPES.Action).toConstantValue(l),p.get(d)}}))}return en.configureCommand=u,en}var ud={},Wp;function S_(){return Wp||(Wp=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.overrideCommandStackOptions=n.configureCommandStackOptions=n.defaultCommandStackOptions=void 0;const e=Wr(),t=ge(),i=()=>({defaultDuration:250,undoHistoryLimit:50});n.defaultCommandStackOptions=i;function o(s,a){const u=Object.assign(Object.assign({},(0,n.defaultCommandStackOptions)()),a);s.isBound(t.TYPES.CommandStackOptions)?s.rebind(t.TYPES.CommandStackOptions).toConstantValue(u):s.bind(t.TYPES.CommandStackOptions).toConstantValue(u)}n.configureCommandStackOptions=o;function r(s,a){const u=s.get(t.TYPES.CommandStackOptions);return(0,e.safeAssign)(u,a),u}n.overrideCommandStackOptions=r})(ud)),ud}var xi={},Zp;function w_(){if(Zp)return xi;Zp=1;var n=xi&&xi.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g},e=xi&&xi.__metadata||function(d,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(d,c)};Object.defineProperty(xi,"__esModule",{value:!0}),xi.CommandStack=void 0;const t=se(),i=ge(),o=Zr(),r=Ke(),s=Aa(),a=gt();let u=class{constructor(){this.undoStack=[],this.redoStack=[],this.stoppableCommands=new Map,this.offStack=[]}initialize(){this.currentPromise=Promise.resolve({main:{model:this.modelFactory.createRoot(o.EMPTY_ROOT),modelChanged:!1},hidden:{model:this.modelFactory.createRoot(o.EMPTY_ROOT),modelChanged:!1},popup:{model:this.modelFactory.createRoot(o.EMPTY_ROOT),modelChanged:!1}})}get currentModel(){return this.currentPromise.then(c=>c.main.model)}executeAll(c){return c.forEach(l=>{this.logger.log(this,"Executing",l),this.handleCommand(l,l.execute,this.mergeOrPush)}),this.thenUpdate()}execute(c){return this.logger.log(this,"Executing",c),this.handleCommand(c,c.execute,this.mergeOrPush),this.thenUpdate()}undo(){this.undoOffStackSystemCommands(),this.undoPreceedingSystemCommands();const c=this.undoStack[this.undoStack.length-1];return c!==void 0&&!this.isBlockUndo(c)&&(this.undoStack.pop(),this.logger.log(this,"Undoing",c),this.handleCommand(c,c.undo,(l,p)=>{this.redoStack.push(l)})),this.thenUpdate()}redo(){this.undoOffStackSystemCommands();const c=this.redoStack.pop();return c!==void 0&&(this.logger.log(this,"Redoing",c),this.handleCommand(c,c.redo,(l,p)=>{this.pushToUndoStack(l)})),this.redoFollowingSystemCommands(),this.thenUpdate()}handleCommand(c,l,p){if((0,a.isStoppableCommand)(c)){const h=this.stoppableCommands.get(c.stoppableCommandKey);h&&h.stopExecution(),this.stoppableCommands.set(c.stoppableCommandKey,c)}this.currentPromise=this.currentPromise.then(h=>new Promise(g=>{let m;c instanceof a.HiddenCommand?m="hidden":c instanceof a.PopupCommand?m="popup":m="main";const y=this.createContext(h.main.model);let b;try{b=l.call(c,y)}catch(_){this.logger.error(this,"Failed to execute command:",_),b=h[m].model}const v=f(h);b instanceof Promise?b.then(_=>{m==="main"&&p.call(this,c,y),v[m]={model:_,modelChanged:!0},g(v)}):b instanceof r.SModelRootImpl?(m==="main"&&p.call(this,c,y),v[m]={model:b,modelChanged:!0},g(v)):(m==="main"&&p.call(this,c,y),v[m]={model:b.model,modelChanged:h[m].modelChanged||b.modelChanged,cause:b.cause},g(v))}))}pushToUndoStack(c){this.undoStack.push(c),this.options.undoHistoryLimit>=0&&this.undoStack.length>this.options.undoHistoryLimit&&this.undoStack.splice(0,this.undoStack.length-this.options.undoHistoryLimit)}thenUpdate(){return this.currentPromise=this.currentPromise.then(c=>{const l=f(c);return c.hidden.modelChanged&&(this.updateHidden(c.hidden.model,c.hidden.cause),l.hidden.modelChanged=!1,l.hidden.cause=void 0),c.main.modelChanged&&(this.update(c.main.model,c.main.cause),l.main.modelChanged=!1,l.main.cause=void 0),c.popup.modelChanged&&(this.updatePopup(c.popup.model,c.popup.cause),l.popup.modelChanged=!1,l.popup.cause=void 0),l}),this.currentModel}update(c,l){this.modelViewer===void 0&&(this.modelViewer=this.viewerProvider.modelViewer),this.modelViewer.update(c,l)}updateHidden(c,l){this.hiddenModelViewer===void 0&&(this.hiddenModelViewer=this.viewerProvider.hiddenModelViewer),this.hiddenModelViewer.update(c,l)}updatePopup(c,l){this.popupModelViewer===void 0&&(this.popupModelViewer=this.viewerProvider.popupModelViewer),this.popupModelViewer.update(c,l)}mergeOrPush(c,l){if(this.isBlockUndo(c)){this.undoStack=[],this.redoStack=[],this.offStack=[],this.pushToUndoStack(c);return}if(this.isPushToOffStack(c)&&this.redoStack.length>0){if(this.offStack.length>0){const p=this.offStack[this.offStack.length-1];if(p instanceof a.MergeableCommand&&p.merge(c,l))return}this.offStack.push(c);return}if(this.isPushToUndoStack(c)){if(this.offStack.forEach(p=>this.undoStack.push(p)),this.offStack=[],this.redoStack=[],this.undoStack.length>0){const p=this.undoStack[this.undoStack.length-1];if(p instanceof a.MergeableCommand&&p.merge(c,l))return}this.pushToUndoStack(c)}}undoOffStackSystemCommands(){let c=this.offStack.pop();for(;c!==void 0;)this.logger.log(this,"Undoing off-stack",c),this.handleCommand(c,c.undo,()=>{}),c=this.offStack.pop()}undoPreceedingSystemCommands(){let c=this.undoStack[this.undoStack.length-1];for(;c!==void 0&&this.isPushToOffStack(c);)this.undoStack.pop(),this.logger.log(this,"Undoing",c),this.handleCommand(c,c.undo,(l,p)=>{this.redoStack.push(l)}),c=this.undoStack[this.undoStack.length-1]}redoFollowingSystemCommands(){let c=this.redoStack[this.redoStack.length-1];for(;c!==void 0&&this.isPushToOffStack(c);)this.redoStack.pop(),this.logger.log(this,"Redoing ",c),this.handleCommand(c,c.redo,(l,p)=>{this.pushToUndoStack(l)}),c=this.redoStack[this.redoStack.length-1]}createContext(c){return{root:c,modelChanged:this,modelFactory:this.modelFactory,duration:this.options.defaultDuration,logger:this.logger,syncer:this.syncer}}isPushToOffStack(c){return c instanceof a.SystemCommand}isPushToUndoStack(c){return!(c instanceof a.HiddenCommand)}isBlockUndo(c){return c instanceof a.ResetCommand}};xi.CommandStack=u,n([(0,t.inject)(i.TYPES.IModelFactory),e("design:type",Object)],u.prototype,"modelFactory",void 0),n([(0,t.inject)(i.TYPES.IViewerProvider),e("design:type",Object)],u.prototype,"viewerProvider",void 0),n([(0,t.inject)(i.TYPES.ILogger),e("design:type",Object)],u.prototype,"logger",void 0),n([(0,t.inject)(i.TYPES.AnimationFrameSyncer),e("design:type",s.AnimationFrameSyncer)],u.prototype,"syncer",void 0),n([(0,t.inject)(i.TYPES.CommandStackOptions),e("design:type",Object)],u.prototype,"options",void 0),n([(0,t.postConstruct)(),e("design:type",Function),e("design:paramtypes",[]),e("design:returntype",void 0)],u.prototype,"initialize",null),xi.CommandStack=u=n([(0,t.injectable)()],u);function f(d){return{main:Object.assign({},d.main),hidden:Object.assign({},d.hidden),popup:Object.assign({},d.popup)}}return xi}var $t={},sn={},Jp;function er(){if(Jp)return sn;Jp=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.isSVGGraphicsElement=sn.hitsMouseEvent=sn.getWindowScroll=sn.isCrossSite=sn.isMac=sn.isCtrlOrCmd=void 0;const n=ti();function e(a){return t()?a.metaKey:a.ctrlKey}sn.isCtrlOrCmd=e;function t(){return window.navigator.userAgent.indexOf("Mac")!==-1}sn.isMac=t;function i(a){if(a&&typeof window<"u"&&window.location){let u="";return window.location.protocol&&(u+=window.location.protocol+"//"),window.location.host&&(u+=window.location.host),u.length>0&&!a.startsWith(u)}return!1}sn.isCrossSite=i;function o(){return typeof window>"u"?n.Point.ORIGIN:{x:window.pageXOffset,y:window.pageYOffset}}sn.getWindowScroll=o;function r(a,u){const f=a.getBoundingClientRect();return u.clientX>=f.left&&u.clientX<=f.right&&u.clientY>=f.top&&u.clientY<=f.bottom}sn.hitsMouseEvent=r;function s(a){return typeof a.getBBox=="function"}return sn.isSVGGraphicsElement=s,sn}var Qp;function Ou(){if(Qp)return $t;Qp=1;var n=$t&&$t.__decorate||function(l,p,h,g){var m=arguments.length,y=m<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,h):g,b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(l,p,h,g);else for(var v=l.length-1;v>=0;v--)(b=l[v])&&(y=(m<3?b(y):m>3?b(p,h,y):b(p,h))||y);return m>3&&y&&Object.defineProperty(p,h,y),y},e=$t&&$t.__metadata||function(l,p){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(l,p)},t=$t&&$t.__param||function(l,p){return function(h,g){p(h,g,l)}};Object.defineProperty($t,"__esModule",{value:!0}),$t.InitializeCanvasBoundsCommand=$t.InitializeCanvasBoundsAction=$t.CanvasBoundsInitializer=void 0;const i=se(),o=He(),r=ge(),s=Ke(),a=gt(),u=er();let f=class{decorate(p,h){return h instanceof s.SModelRootImpl&&!o.Dimension.isValid(h.canvasBounds)&&(this.rootAndVnode=[h,p]),p}postUpdate(){if(this.rootAndVnode!==void 0){const p=this.rootAndVnode[1].elm,h=this.rootAndVnode[0].canvasBounds;if(p!==void 0){const g=this.getBoundsInPage(p);(0,o.almostEquals)(g.x,h.x)&&(0,o.almostEquals)(g.y,h.y)&&(0,o.almostEquals)(g.width,h.width)&&(0,o.almostEquals)(g.height,h.width)||this.actionDispatcher.dispatch(d.create(g))}this.rootAndVnode=void 0}}getBoundsInPage(p){const h=p.getBoundingClientRect(),g=(0,u.getWindowScroll)();return{x:h.left+g.x,y:h.top+g.y,width:h.width,height:h.height}}};$t.CanvasBoundsInitializer=f,n([(0,i.inject)(r.TYPES.IActionDispatcher),e("design:type",Object)],f.prototype,"actionDispatcher",void 0),$t.CanvasBoundsInitializer=f=n([(0,i.injectable)()],f);var d;(function(l){l.KIND="initializeCanvasBounds";function p(h){return{kind:l.KIND,newCanvasBounds:h}}l.create=p})(d||($t.InitializeCanvasBoundsAction=d={}));let c=class extends a.SystemCommand{constructor(p){super(),this.action=p}execute(p){return this.newCanvasBounds=this.action.newCanvasBounds,p.root.canvasBounds=this.newCanvasBounds,p.root}undo(p){return p.root}redo(p){return p.root}};return $t.InitializeCanvasBoundsCommand=c,c.KIND=d.KIND,$t.InitializeCanvasBoundsCommand=c=n([(0,i.injectable)(),t(0,(0,i.inject)(r.TYPES.Action)),e("design:paramtypes",[Object])],c),$t}var Yn={},eg;function xl(){if(eg)return Yn;eg=1;var n=Yn&&Yn.__decorate||function(f,d,c,l){var p=arguments.length,h=p<3?d:l===null?l=Object.getOwnPropertyDescriptor(d,c):l,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,d,c,l);else for(var m=f.length-1;m>=0;m--)(g=f[m])&&(h=(p<3?g(h):p>3?g(d,c,h):g(d,c))||h);return p>3&&h&&Object.defineProperty(d,c,h),h},e=Yn&&Yn.__metadata||function(f,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,d)},t=Yn&&Yn.__param||function(f,d){return function(c,l){d(c,l,f)}};Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.SetModelCommand=void 0;const i=se(),o=qe(),r=gt(),s=ge(),a=Ou();let u=class extends r.ResetCommand{constructor(d){super(),this.action=d}execute(d){return this.oldRoot=d.modelFactory.createRoot(d.root),this.newRoot=d.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(d){return this.oldRoot}redo(d){return this.newRoot}get blockUntil(){return d=>d.kind===a.InitializeCanvasBoundsCommand.KIND}};return Yn.SetModelCommand=u,u.KIND=o.SetModelAction.KIND,Yn.SetModelCommand=u=n([(0,i.injectable)(),t(0,(0,i.inject)(s.TYPES.Action)),e("design:paramtypes",[Object])],u),Yn}var Yt={},tg;function tn(){if(tg)return Yt;tg=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.transformToRootBounds=Yt.containsSome=Yt.translateBounds=Yt.translatePoint=Yt.findParentByFeature=Yt.findParent=Yt.registerModelElement=void 0;const n=ge(),e=Ke();function t(f,d,c,l,p){f.bind(n.TYPES.SModelElementRegistration).toConstantValue({type:d,constr:c,features:l,isOverride:p})}Yt.registerModelElement=t;function i(f,d){let c=f;for(;c!==void 0;){if(d(c))return c;c instanceof e.SChildElementImpl?c=c.parent:c=void 0}return c}Yt.findParent=i;function o(f,d){let c=f;for(;c!==void 0;){if(d(c))return c;c instanceof e.SChildElementImpl?c=c.parent:c=void 0}return c}Yt.findParentByFeature=o;function r(f,d,c){if(d!==c){for(;d instanceof e.SChildElementImpl;)if(f=d.localToParent(f),d=d.parent,d===c)return f;const l=[];for(;c instanceof e.SChildElementImpl;)l.push(c),c=c.parent;if(d!==c)throw new Error("Incompatible source and target: "+d.id+", "+c.id);for(let p=l.length-1;p>=0;p--)f=l[p].parentToLocal(f)}return f}Yt.translatePoint=r;function s(f,d,c){const l=r(f,d,c),p=r({x:f.x+f.width,y:f.y+f.height},d,c);return{x:l.x,y:l.y,width:p.x-l.x,height:p.y-l.y}}Yt.translateBounds=s;function a(f,d){const c=p=>f.index.getById(p.id)!==void 0,l=p=>p.some(h=>c(h)||l(h.children));return l([d])}Yt.containsSome=a;function u(f,d){for(;f instanceof e.SChildElementImpl;)d=f.localToParent(d),f=f.parent;return d}return Yt.transformToRootBounds=u,Yt}var kt={},ng;function Iu(){if(ng)return kt;ng=1;var n=kt&&kt.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g},e=kt&&kt.__metadata||function(d,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(d,c)},t=kt&&kt.__param||function(d,c){return function(l,p){c(l,p,d)}};Object.defineProperty(kt,"__esModule",{value:!0}),kt.SetUIExtensionVisibilityCommand=kt.SetUIExtensionVisibilityAction=kt.UIExtensionRegistry=void 0;const i=se(),o=Er(),r=gt(),s=ge();let a=class extends o.InstanceRegistry{constructor(c=[]){super(),c.forEach(l=>this.register(l.id(),l))}};kt.UIExtensionRegistry=a,kt.UIExtensionRegistry=a=n([(0,i.injectable)(),t(0,(0,i.multiInject)(s.TYPES.IUIExtension)),t(0,(0,i.optional)()),e("design:paramtypes",[Array])],a);var u;(function(d){d.KIND="setUIExtensionVisibility";function c(l){var p;return{kind:d.KIND,extensionId:l.extensionId,visible:l.visible,contextElementsId:(p=l.contextElementsId)!==null&&p!==void 0?p:[]}}d.create=c})(u||(kt.SetUIExtensionVisibilityAction=u={}));let f=class extends r.SystemCommand{constructor(c){super(),this.action=c}execute(c){const l=this.registry.get(this.action.extensionId);return l&&(this.action.visible?l.show(c.root,...this.action.contextElementsId):l.hide()),{model:c.root,modelChanged:!1}}undo(c){return{model:c.root,modelChanged:!1}}redo(c){return{model:c.root,modelChanged:!1}}};return kt.SetUIExtensionVisibilityCommand=f,f.KIND=u.KIND,n([(0,i.inject)(s.TYPES.UIExtensionRegistry),e("design:type",a)],f.prototype,"registry",void 0),kt.SetUIExtensionVisibilityCommand=f=n([(0,i.injectable)(),t(0,(0,i.inject)(s.TYPES.Action)),e("design:paramtypes",[Object])],f),kt}var kn={},ig;function jl(){if(ig)return kn;ig=1;var n=kn&&kn.__decorate||function(a,u,f,d){var c=arguments.length,l=c<3?u:d===null?d=Object.getOwnPropertyDescriptor(u,f):d,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(a,u,f,d);else for(var h=a.length-1;h>=0;h--)(p=a[h])&&(l=(c<3?p(l):c>3?p(u,f,l):p(u,f))||l);return c>3&&l&&Object.defineProperty(u,f,l),l},e=kn&&kn.__metadata||function(a,u){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,u)};Object.defineProperty(kn,"__esModule",{value:!0}),kn.AbstractUIExtension=kn.isUIExtension=void 0;const t=se(),i=ti(),o=ge();function r(a){return(0,i.hasOwnProperty)(a,"id","function")&&(0,i.hasOwnProperty)(a,"show","function")&&(0,i.hasOwnProperty)(a,"hide","function")}kn.isUIExtension=r;let s=class{show(u,...f){this.activeElement=document.activeElement,!(!this.containerElement&&!this.initialize())&&(this.onBeforeShow(this.containerElement,u,...f),this.setContainerVisible(!0))}hide(){this.setContainerVisible(!1),this.restoreFocus(),this.activeElement=null}restoreFocus(){const u=this.activeElement;u&&u.focus()}initialize(){const u=document.getElementById(this.options.baseDiv);return u?(this.containerElement=this.getOrCreateContainer(u.id),this.initializeContents(this.containerElement),u&&u.insertBefore(this.containerElement,u.firstChild),!0):(this.logger.warn(this,`Could not obtain sprotty base container for initializing UI extension ${this.id}`,this),!1)}getOrCreateContainer(u){let f=document.getElementById(this.id());return f===null&&(f=document.createElement("div"),f.id=u+"_"+this.id(),f.classList.add(this.containerClass())),f}setContainerVisible(u){this.containerElement&&(u?(this.containerElement.style.visibility="visible",this.containerElement.style.opacity="1"):(this.containerElement.style.visibility="hidden",this.containerElement.style.opacity="0"))}onBeforeShow(u,f,...d){}};return kn.AbstractUIExtension=s,n([(0,t.inject)(o.TYPES.ViewerOptions),e("design:type",Object)],s.prototype,"options",void 0),n([(0,t.inject)(o.TYPES.ILogger),e("design:type",Object)],s.prototype,"logger",void 0),kn.AbstractUIExtension=s=n([(0,t.injectable)()],s),kn}var an={},Ct={},rg;function Wt(){if(rg)return Ct;rg=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.getAttrs=Ct.on=Ct.mergeStyle=Ct.copyClassesFromElement=Ct.copyClassesFromVNode=Ct.setNamespace=Ct.setClass=Ct.setAttr=void 0;function n(c,l,p){a(c)[l]=p}Ct.setAttr=n;function e(c,l,p){f(c)[l]=p}Ct.setClass=e;function t(c,l){c.data===void 0&&(c.data={}),c.data.ns=l;const p=c.children;if(p!==void 0)for(let h=0;h<p.length;h++){const g=p[h];typeof g!="string"&&t(g,l)}}Ct.setNamespace=t;function i(c,l){const p=f(c);Object.keys(p).forEach(h=>e(l,h,!0))}Ct.copyClassesFromVNode=i;function o(c,l){const p=c.classList;for(let h=0;h<p.length;h++){const g=p.item(h);g&&e(l,g,!0)}}Ct.copyClassesFromElement=o;function r(c,l){u(c).style=Object.assign(Object.assign({},u(c).style||{}),l)}Ct.mergeStyle=r;function s(c,l,p){const h=d(c);if(h[l])throw new Error("EventListener for "+l+" already registered on VNode");h[l]=p}Ct.on=s;function a(c){const l=u(c);return l.attrs||(l.attrs={}),l.attrs}Ct.getAttrs=a;function u(c){return c.data||(c.data={}),c.data}function f(c){const l=u(c);return l.class||(l.class={}),l.class}function d(c){const l=u(c);return l.on||(l.on={}),l.on}return Ct}var og;function Pr(){if(og)return an;og=1;var n=an&&an.__decorate||function(f,d,c,l){var p=arguments.length,h=p<3?d:l===null?l=Object.getOwnPropertyDescriptor(d,c):l,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,d,c,l);else for(var m=f.length-1;m>=0;m--)(g=f[m])&&(h=(p<3?g(h):p>3?g(d,c,h):g(d,c))||h);return p>3&&h&&Object.defineProperty(d,c,h),h},e=an&&an.__metadata||function(f,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,d)},t=an&&an.__param||function(f,d){return function(c,l){d(c,l,f)}};Object.defineProperty(an,"__esModule",{value:!0}),an.KeyListener=an.KeyTool=void 0;const i=se(),o=ge(),r=Ke(),s=Wt();let a=class{constructor(d=[]){this.keyListeners=d}register(d){this.keyListeners.push(d)}deregister(d){const c=this.keyListeners.indexOf(d);c>=0&&this.keyListeners.splice(c,1)}handleEvent(d,c,l){const p=this.keyListeners.map(h=>h[d].apply(h,[c,l])).reduce((h,g)=>h.concat(g));p.length>0&&(l.preventDefault(),this.actionDispatcher.dispatchAll(p))}keyDown(d,c){this.handleEvent("keyDown",d,c)}keyUp(d,c){this.handleEvent("keyUp",d,c)}focus(){}decorate(d,c){return c instanceof r.SModelRootImpl&&((0,s.on)(d,"focus",this.focus.bind(this,c)),(0,s.on)(d,"keydown",this.keyDown.bind(this,c)),(0,s.on)(d,"keyup",this.keyUp.bind(this,c))),d}postUpdate(){}};an.KeyTool=a,n([(0,i.inject)(o.TYPES.IActionDispatcher),e("design:type",Object)],a.prototype,"actionDispatcher",void 0),an.KeyTool=a=n([(0,i.injectable)(),t(0,(0,i.multiInject)(o.TYPES.KeyListener)),t(0,(0,i.optional)()),e("design:paramtypes",[Array])],a);let u=class{keyDown(d,c){return[]}keyUp(d,c){return[]}};return an.KeyListener=u,an.KeyListener=u=n([(0,i.injectable)()],u),an}var vt={},ji={},sg;function Oa(){if(sg)return ji;sg=1;var n=ji&&ji.__decorate||function(r,s,a,u){var f=arguments.length,d=f<3?s:u===null?u=Object.getOwnPropertyDescriptor(s,a):u,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(r,s,a,u);else for(var l=r.length-1;l>=0;l--)(c=r[l])&&(d=(f<3?c(d):f>3?c(s,a,d):c(s,a))||d);return f>3&&d&&Object.defineProperty(s,a,d),d},e=ji&&ji.__metadata||function(r,s){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,s)};Object.defineProperty(ji,"__esModule",{value:!0}),ji.DOMHelper=void 0;const t=se(),i=ge();let o=class{getPrefix(){return this.viewerOptions!==void 0&&this.viewerOptions.baseDiv!==void 0?this.viewerOptions.baseDiv+"_":""}createUniqueDOMElementId(s){return this.getPrefix()+s.id}findSModelIdByDOMElement(s){return s.id.replace(this.getPrefix(),"")}};return ji.DOMHelper=o,n([(0,t.inject)(i.TYPES.ViewerOptions),e("design:type",Object)],o.prototype,"viewerOptions",void 0),ji.DOMHelper=o=n([(0,t.injectable)()],o),ji}var ag;function ni(){if(ag)return vt;ag=1;var n=vt&&vt.__decorate||function(p,h,g,m){var y=arguments.length,b=y<3?h:m===null?m=Object.getOwnPropertyDescriptor(h,g):m,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(p,h,g,m);else for(var _=p.length-1;_>=0;_--)(v=p[_])&&(b=(y<3?v(b):y>3?v(h,g,b):v(h,g))||b);return y>3&&b&&Object.defineProperty(h,g,b),b},e=vt&&vt.__metadata||function(p,h){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(p,h)},t=vt&&vt.__param||function(p,h){return function(g,m){h(g,m,p)}};Object.defineProperty(vt,"__esModule",{value:!0}),vt.MousePositionTracker=vt.MouseListener=vt.PopupMouseTool=vt.MouseTool=void 0;const i=se(),o=qe(),r=Ke(),s=ge(),a=Oa(),u=Wt();let f=class{constructor(h=[]){this.mouseListeners=h}register(h){this.mouseListeners.push(h)}deregister(h){const g=this.mouseListeners.indexOf(h);g>=0&&this.mouseListeners.splice(g,1)}getTargetElement(h,g){let m=g.target;const y=h.index;for(;m;){if(m.id){const b=y.getById(this.domHelper.findSModelIdByDOMElement(m));if(b!==void 0)return b}m=m.parentNode}}handleEvent(h,g,m){this.focusOnMouseEvent(h,g);const y=this.getTargetElement(g,m);if(!y)return;const b=this.mouseListeners.map(v=>v[h](y,m)).reduce((v,_)=>v.concat(_));if(b.length>0){m.preventDefault();for(const v of b)(0,o.isAction)(v)?this.actionDispatcher.dispatch(v):v.then(_=>{this.actionDispatcher.dispatch(_)})}}focusOnMouseEvent(h,g){if(document&&h==="mouseDown"){const m=document.getElementById(this.domHelper.createUniqueDOMElementId(g));m!==null&&typeof m.focus=="function"&&m.focus()}}mouseOver(h,g){this.handleEvent("mouseOver",h,g)}mouseOut(h,g){this.handleEvent("mouseOut",h,g)}mouseEnter(h,g){this.handleEvent("mouseEnter",h,g)}mouseLeave(h,g){this.handleEvent("mouseLeave",h,g)}mouseDown(h,g){this.handleEvent("mouseDown",h,g)}mouseMove(h,g){this.handleEvent("mouseMove",h,g)}mouseUp(h,g){this.handleEvent("mouseUp",h,g)}wheel(h,g){this.handleEvent("wheel",h,g)}contextMenu(h,g){g.preventDefault(),this.handleEvent("contextMenu",h,g)}doubleClick(h,g){this.handleEvent("doubleClick",h,g)}decorate(h,g){return g instanceof r.SModelRootImpl&&((0,u.on)(h,"mouseover",this.mouseOver.bind(this,g)),(0,u.on)(h,"mouseout",this.mouseOut.bind(this,g)),(0,u.on)(h,"mouseenter",this.mouseEnter.bind(this,g)),(0,u.on)(h,"mouseleave",this.mouseLeave.bind(this,g)),(0,u.on)(h,"mousedown",this.mouseDown.bind(this,g)),(0,u.on)(h,"mouseup",this.mouseUp.bind(this,g)),(0,u.on)(h,"mousemove",this.mouseMove.bind(this,g)),(0,u.on)(h,"wheel",this.wheel.bind(this,g)),(0,u.on)(h,"contextmenu",this.contextMenu.bind(this,g)),(0,u.on)(h,"dblclick",this.doubleClick.bind(this,g)),(0,u.on)(h,"dragover",m=>this.handleEvent("dragOver",g,m)),(0,u.on)(h,"drop",m=>this.handleEvent("drop",g,m))),h=this.mouseListeners.reduce((m,y)=>y.decorate(m,g),h),h}postUpdate(){}};vt.MouseTool=f,n([(0,i.inject)(s.TYPES.IActionDispatcher),e("design:type",Object)],f.prototype,"actionDispatcher",void 0),n([(0,i.inject)(s.TYPES.DOMHelper),e("design:type",a.DOMHelper)],f.prototype,"domHelper",void 0),vt.MouseTool=f=n([(0,i.injectable)(),t(0,(0,i.multiInject)(s.TYPES.MouseListener)),t(0,(0,i.optional)()),e("design:paramtypes",[Array])],f);let d=class extends f{constructor(h=[]){super(h),this.mouseListeners=h}};vt.PopupMouseTool=d,vt.PopupMouseTool=d=n([(0,i.injectable)(),t(0,(0,i.multiInject)(s.TYPES.PopupMouseListener)),t(0,(0,i.optional)()),e("design:paramtypes",[Array])],d);let c=class{mouseOver(h,g){return[]}mouseOut(h,g){return[]}mouseEnter(h,g){return[]}mouseLeave(h,g){return[]}mouseDown(h,g){return[]}mouseMove(h,g){return[]}mouseUp(h,g){return[]}wheel(h,g){return[]}doubleClick(h,g){return[]}contextMenu(h,g){return[]}dragOver(h,g){return[]}drop(h,g){return[]}decorate(h,g){return h}};vt.MouseListener=c,vt.MouseListener=c=n([(0,i.injectable)()],c);let l=class extends c{mouseMove(h,g){return this.lastPosition=h.root.parentToLocal({x:g.offsetX,y:g.offsetY}),[]}get lastPositionOnDiagram(){return this.lastPosition}};return vt.MousePositionTracker=l,vt.MousePositionTracker=l=n([(0,i.injectable)()],l),vt}var Li={};function Fw(n,e){return document.createElement(n,e)}function Bw(n,e,t){return document.createElementNS(n,e,t)}function Vw(){return go(document.createDocumentFragment())}function zw(n){return document.createTextNode(n)}function qw(n){return document.createComment(n)}function Hw(n,e,t){if(_r(n)){let i=n;for(;i&&_r(i);)i=go(i).parent;n=i??n}_r(e)&&(e=go(e,n)),t&&_r(t)&&(t=go(t).firstChildNode),n.insertBefore(e,t)}function Kw(n,e){n.removeChild(e)}function $w(n,e){_r(e)&&(e=go(e,n)),n.appendChild(e)}function E_(n){if(_r(n)){for(;n&&_r(n);)n=go(n).parent;return n??null}return n.parentNode}function Yw(n){var e;if(_r(n)){const t=go(n),i=E_(t);if(i&&t.lastChildNode){const o=Array.from(i.childNodes),r=o.indexOf(t.lastChildNode);return(e=o[r+1])!==null&&e!==void 0?e:null}return null}return n.nextSibling}function kw(n){return n.tagName}function Uw(n,e){n.textContent=e}function Gw(n){return n.textContent}function Xw(n){return n.nodeType===1}function Ww(n){return n.nodeType===3}function Zw(n){return n.nodeType===8}function _r(n){return n.nodeType===11}function go(n,e){var t,i,o;const r=n;return(t=r.parent)!==null&&t!==void 0||(r.parent=e??null),(i=r.firstChildNode)!==null&&i!==void 0||(r.firstChildNode=n.firstChild),(o=r.lastChildNode)!==null&&o!==void 0||(r.lastChildNode=n.lastChild),r}const Ll={createElement:Fw,createElementNS:Bw,createTextNode:zw,createDocumentFragment:Vw,createComment:qw,insertBefore:Hw,removeChild:Kw,appendChild:$w,parentNode:E_,nextSibling:Yw,tagName:kw,setTextContent:Uw,getTextContent:Gw,isElement:Xw,isText:Ww,isComment:Zw,isDocumentFragment:_r};function pn(n,e,t,i,o){const r=e===void 0?void 0:e.key;return{sel:n,data:e,children:t,text:i,elm:o,key:r}}const aa=Array.isArray;function mo(n){return typeof n=="string"||typeof n=="number"||n instanceof String||n instanceof Number}function dd(n){return n===void 0}function _n(n){return n!==void 0}const ld=pn("",{},[],void 0,void 0);function Hs(n,e){var t,i;const o=n.key===e.key,r=((t=n.data)===null||t===void 0?void 0:t.is)===((i=e.data)===null||i===void 0?void 0:i.is),s=n.sel===e.sel,a=!n.sel&&n.sel===e.sel?typeof n.text==typeof e.text:!0;return s&&o&&r&&a}function Jw(){throw new Error("The document fragment is not supported on this platform.")}function Qw(n,e){return n.isElement(e)}function eE(n,e){return n.isDocumentFragment(e)}function tE(n,e,t){var i;const o={};for(let r=e;r<=t;++r){const s=(i=n[r])===null||i===void 0?void 0:i.key;s!==void 0&&(o[s]=r)}return o}const nE=["create","update","remove","destroy","pre","post"];function iE(n,e,t){const i={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},o=e!==void 0?e:Ll;for(const h of nE)for(const g of n){const m=g[h];m!==void 0&&i[h].push(m)}function r(h){const g=h.id?"#"+h.id:"",m=h.getAttribute("class"),y=m?"."+m.split(" ").join("."):"";return pn(o.tagName(h).toLowerCase()+g+y,{},[],void 0,h)}function s(h){return pn(void 0,{},[],void 0,h)}function a(h,g){return function(){if(--g===0){const y=o.parentNode(h);o.removeChild(y,h)}}}function u(h,g){var m,y,b,v;let _,S=h.data;if(S!==void 0){const R=(m=S.hook)===null||m===void 0?void 0:m.init;_n(R)&&(R(h),S=h.data)}const E=h.children,O=h.sel;if(O==="!")dd(h.text)&&(h.text=""),h.elm=o.createComment(h.text);else if(O!==void 0){const R=O.indexOf("#"),w=O.indexOf(".",R),M=R>0?R:O.length,I=w>0?w:O.length,D=R!==-1||w!==-1?O.slice(0,Math.min(M,I)):O,C=h.elm=_n(S)&&_n(_=S.ns)?o.createElementNS(_,D,S):o.createElement(D,S);for(M<I&&C.setAttribute("id",O.slice(M+1,I)),w>0&&C.setAttribute("class",O.slice(I+1).replace(/\./g," ")),_=0;_<i.create.length;++_)i.create[_](ld,h);if(aa(E))for(_=0;_<E.length;++_){const G=E[_];G!=null&&o.appendChild(C,u(G,g))}else mo(h.text)&&o.appendChild(C,o.createTextNode(h.text));const z=h.data.hook;_n(z)&&((y=z.create)===null||y===void 0||y.call(z,ld,h),z.insert&&g.push(h))}else if(!((b=t?.experimental)===null||b===void 0)&&b.fragments&&h.children){for(h.elm=((v=o.createDocumentFragment)!==null&&v!==void 0?v:Jw)(),_=0;_<i.create.length;++_)i.create[_](ld,h);for(_=0;_<h.children.length;++_){const R=h.children[_];R!=null&&o.appendChild(h.elm,u(R,g))}}else h.elm=o.createTextNode(h.text);return h.elm}function f(h,g,m,y,b,v){for(;y<=b;++y){const _=m[y];_!=null&&o.insertBefore(h,u(_,v),g)}}function d(h){var g,m;const y=h.data;if(y!==void 0){(m=(g=y?.hook)===null||g===void 0?void 0:g.destroy)===null||m===void 0||m.call(g,h);for(let b=0;b<i.destroy.length;++b)i.destroy[b](h);if(h.children!==void 0)for(let b=0;b<h.children.length;++b){const v=h.children[b];v!=null&&typeof v!="string"&&d(v)}}}function c(h,g,m,y){for(var b,v;m<=y;++m){let _,S;const E=g[m];if(E!=null)if(_n(E.sel)){d(E),_=i.remove.length+1,S=a(E.elm,_);for(let R=0;R<i.remove.length;++R)i.remove[R](E,S);const O=(v=(b=E?.data)===null||b===void 0?void 0:b.hook)===null||v===void 0?void 0:v.remove;_n(O)?O(E,S):S()}else E.children?(d(E),c(h,E.children,0,E.children.length-1)):o.removeChild(h,E.elm)}}function l(h,g,m,y){let b=0,v=0,_=g.length-1,S=g[0],E=g[_],O=m.length-1,R=m[0],w=m[O],M,I,D,C;for(;b<=_&&v<=O;)S==null?S=g[++b]:E==null?E=g[--_]:R==null?R=m[++v]:w==null?w=m[--O]:Hs(S,R)?(p(S,R,y),S=g[++b],R=m[++v]):Hs(E,w)?(p(E,w,y),E=g[--_],w=m[--O]):Hs(S,w)?(p(S,w,y),o.insertBefore(h,S.elm,o.nextSibling(E.elm)),S=g[++b],w=m[--O]):Hs(E,R)?(p(E,R,y),o.insertBefore(h,E.elm,S.elm),E=g[--_],R=m[++v]):(M===void 0&&(M=tE(g,b,_)),I=M[R.key],dd(I)?o.insertBefore(h,u(R,y),S.elm):(D=g[I],D.sel!==R.sel?o.insertBefore(h,u(R,y),S.elm):(p(D,R,y),g[I]=void 0,o.insertBefore(h,D.elm,S.elm))),R=m[++v]);v<=O&&(C=m[O+1]==null?null:m[O+1].elm,f(h,C,m,v,O,y)),b<=_&&c(h,g,b,_)}function p(h,g,m){var y,b,v,_,S,E,O,R;const w=(y=g.data)===null||y===void 0?void 0:y.hook;(b=w?.prepatch)===null||b===void 0||b.call(w,h,g);const M=g.elm=h.elm;if(h===g)return;if(g.data!==void 0||_n(g.text)&&g.text!==h.text){(v=g.data)!==null&&v!==void 0||(g.data={}),(_=h.data)!==null&&_!==void 0||(h.data={});for(let C=0;C<i.update.length;++C)i.update[C](h,g);(O=(E=(S=g.data)===null||S===void 0?void 0:S.hook)===null||E===void 0?void 0:E.update)===null||O===void 0||O.call(E,h,g)}const I=h.children,D=g.children;dd(g.text)?_n(I)&&_n(D)?I!==D&&l(M,I,D,m):_n(D)?(_n(h.text)&&o.setTextContent(M,""),f(M,null,D,0,D.length-1,m)):_n(I)?c(M,I,0,I.length-1):_n(h.text)&&o.setTextContent(M,""):h.text!==g.text&&(_n(I)&&c(M,I,0,I.length-1),o.setTextContent(M,g.text)),(R=w?.postpatch)===null||R===void 0||R.call(w,h,g)}return function(g,m){let y,b,v;const _=[];for(y=0;y<i.pre.length;++y)i.pre[y]();for(Qw(o,g)?g=r(g):eE(o,g)&&(g=s(g)),Hs(g,m)?p(g,m,_):(b=g.elm,v=o.parentNode(b),u(m,_),v!==null&&(o.insertBefore(v,m.elm,o.nextSibling(b)),c(v,[g],0,0))),y=0;y<_.length;++y)_[y].data.hook.insert(_[y]);for(y=0;y<i.post.length;++y)i.post[y]();return m}}function Cu(n,e,t){if(n.ns="http://www.w3.org/2000/svg",t!=="foreignObject"&&e!==void 0)for(let i=0;i<e.length;++i){const o=e[i];if(typeof o=="string")continue;const r=o.data;r!==void 0&&Cu(r,o.children,o.sel)}}function su(n,e,t){let i={},o,r,s;if(t!==void 0?(e!==null&&(i=e),aa(t)?o=t:mo(t)?r=t.toString():t&&t.sel&&(o=[t])):e!=null&&(aa(e)?o=e:mo(e)?r=e.toString():e&&e.sel?o=[e]:i=e),o!==void 0)for(s=0;s<o.length;++s)mo(o[s])&&(o[s]=pn(void 0,void 0,void 0,o[s],void 0));return n[0]==="s"&&n[1]==="v"&&n[2]==="g"&&(n.length===3||n[3]==="."||n[3]==="#")&&Cu(i,o,n),pn(n,i,o,r,void 0)}function rE(n){let e,t;if(aa(n)?e=n:mo(e)?t=n:e&&e.sel&&(e=[n]),e!==void 0)for(let i=0;i<e.length;++i)mo(e[i])&&(e[i]=pn(void 0,void 0,void 0,e[i],void 0));return pn(void 0,{},e,t,void 0)}function Xc(n,e){var t;const i=(t=e.data)===null||t===void 0?void 0:t.ns;n.data.fn=e.data.fn,n.data.args=e.data.args,e.data=n.data,e.children=n.children,e.text=n.text,e.elm=n.elm,i&&Cu(e.data,e.children,e.sel)}function oE(n){const e=n.data,t=e.fn(...e.args);Xc(t,n)}function sE(n,e){let t;const i=n.data,o=e.data,r=i.args,s=o.args;if(i.fn!==o.fn||r.length!==s.length){Xc(o.fn(...s),e);return}for(t=0;t<s.length;++t)if(r[t]!==s[t]){Xc(o.fn(...s),e);return}Xc(n,e)}const aE=function(e,t,i,o){return o===void 0&&(o=i,i=t,t=void 0),su(e,{key:t,hook:{init:oE,prepatch:sE},fn:i,args:o})};function cE(n,e){const t=n.data.attachData;e.data.attachData.placeholder=t.placeholder,e.data.attachData.real=t.real,n.elm=n.data.attachData.real}function uE(n,e){e.elm=e.data.attachData.placeholder}function dE(n){n.elm!==void 0&&n.elm.parentNode.removeChild(n.elm),n.elm=n.data.attachData.real}function lE(n,e){const t=e.elm,i=e.data.attachData,o=document.createElement("span");e.elm=o,i.target.appendChild(t),i.real=t,i.placeholder=o}function fE(n,e){e.data===void 0&&(e.data={}),e.data.hook===void 0&&(e.data.hook={});const t=e.data,i=e.data.hook;return t.attachData={target:n,placeholder:void 0,real:void 0},i.create=lE,i.prepatch=cE,i.postpatch=uE,i.destroy=dE,e}function P_(n,e){const t=e!==void 0?e:Ll;let i;if(t.isElement(n)){const o=n.id?"#"+n.id:"",r=n.getAttribute("class"),s=r?"."+r.split(" ").join("."):"",a=t.tagName(n).toLowerCase()+o+s,u={},f={},d={},c=[];let l,p,h;const g=n.attributes,m=n.childNodes;for(p=0,h=g.length;p<h;p++)l=g[p].nodeName,l[0]==="d"&&l[1]==="a"&&l[2]==="t"&&l[3]==="a"&&l[4]==="-"?f[l.slice(5)]=g[p].nodeValue||"":l!=="id"&&l!=="class"&&(u[l]=g[p].nodeValue);for(p=0,h=m.length;p<h;p++)c.push(P_(m[p],e));return Object.keys(u).length>0&&(d.attrs=u),Object.keys(f).length>0&&(d.dataset=f),a[0]==="s"&&a[1]==="v"&&a[2]==="g"&&(a.length===3||a[3]==="."||a[3]==="#")&&Cu(d,c,a),pn(a,d,c,void 0,n)}else return t.isText(n)?(i=t.getTextContent(n),pn(void 0,void 0,void 0,i,n)):t.isComment(n)?(i=t.getTextContent(n),pn("!",{},[],i,n)):pn("",{},[],void 0,n)}const hE="http://www.w3.org/1999/xlink",pE="http://www.w3.org/XML/1998/namespace",cg=58,gE=120;function ug(n,e){let t;const i=e.elm;let o=n.data.attrs,r=e.data.attrs;if(!(!o&&!r)&&o!==r){o=o||{},r=r||{};for(t in r){const s=r[t];o[t]!==s&&(s===!0?i.setAttribute(t,""):s===!1?i.removeAttribute(t):t.charCodeAt(0)!==gE?i.setAttribute(t,s):t.charCodeAt(3)===cg?i.setAttributeNS(pE,t,s):t.charCodeAt(5)===cg?i.setAttributeNS(hE,t,s):i.setAttribute(t,s))}for(t in o)t in r||i.removeAttribute(t)}}const mE={create:ug,update:ug};function dg(n,e){let t,i;const o=e.elm;let r=n.data.class,s=e.data.class;if(!(!r&&!s)&&r!==s){r=r||{},s=s||{};for(i in r)r[i]&&!Object.prototype.hasOwnProperty.call(s,i)&&o.classList.remove(i);for(i in s)t=s[i],t!==r[i]&&o.classList[t?"add":"remove"](i)}}const yE={create:dg,update:dg},lg=/[A-Z]/g;function fg(n,e){const t=e.elm;let i=n.data.dataset,o=e.data.dataset,r;if(!i&&!o||i===o)return;i=i||{},o=o||{};const s=t.dataset;for(r in i)o[r]||(s?r in s&&delete s[r]:t.removeAttribute("data-"+r.replace(lg,"-$&").toLowerCase()));for(r in o)i[r]!==o[r]&&(s?s[r]=o[r]:t.setAttribute("data-"+r.replace(lg,"-$&").toLowerCase(),o[r]))}const vE={create:fg,update:fg};function M_(n,e,t){if(typeof n=="function")n.call(e,t,e);else if(typeof n=="object")for(let i=0;i<n.length;i++)M_(n[i],e,t)}function _E(n,e){const t=n.type,i=e.data.on;i&&i[t]&&M_(i[t],e,n)}function bE(){return function n(e){_E(e,n.vnode)}}function fd(n,e){const t=n.data.on,i=n.listener,o=n.elm,r=e&&e.data.on,s=e&&e.elm;let a;if(t!==r){if(t&&i)if(r)for(a in t)r[a]||o.removeEventListener(a,i,!1);else for(a in t)o.removeEventListener(a,i,!1);if(r){const u=e.listener=n.listener||bE();if(u.vnode=e,t)for(a in r)t[a]||s.addEventListener(a,u,!1);else for(a in r)s.addEventListener(a,u,!1)}}}const SE={create:fd,update:fd,destroy:fd};function hg(n,e){let t,i,o;const r=e.elm;let s=n.data.props,a=e.data.props;if(!(!s&&!a)&&s!==a){s=s||{},a=a||{};for(t in a)i=a[t],o=s[t],o!==i&&(t!=="value"||r[t]!==i)&&(r[t]=i)}}const wE={create:hg,update:hg},pg=typeof window<"u"&&window.requestAnimationFrame.bind(window)||setTimeout,EE=function(n){pg(function(){pg(n)})};let Hd=!1;function PE(n,e,t){EE(function(){n[e]=t})}function gg(n,e){let t,i;const o=e.elm;let r=n.data.style,s=e.data.style;if(!r&&!s||r===s)return;r=r||{},s=s||{};const a="delayed"in r;for(i in r)s[i]||(i[0]==="-"&&i[1]==="-"?o.style.removeProperty(i):o.style[i]="");for(i in s)if(t=s[i],i==="delayed"&&s.delayed)for(const u in s.delayed)t=s.delayed[u],(!a||t!==r.delayed[u])&&PE(o.style,u,t);else i!=="remove"&&t!==r[i]&&(i[0]==="-"&&i[1]==="-"?o.style.setProperty(i,t):o.style[i]=t)}function ME(n){let e,t;const i=n.elm,o=n.data.style;if(!(!o||!(e=o.destroy)))for(t in e)i.style[t]=e[t]}function RE(n,e){const t=n.data.style;if(!t||!t.remove){e();return}Hd||(n.elm.offsetLeft,Hd=!0);let i;const o=n.elm;let r=0;const s=t.remove;let a=0;const u=[];for(i in s)u.push(i),o.style[i]=s[i];const d=getComputedStyle(o)["transition-property"].split(", ");for(;r<d.length;++r)u.indexOf(d[r])!==-1&&a++;o.addEventListener("transitionend",function(c){c.target===o&&--a,a===0&&e()})}function AE(){Hd=!1}const OE={pre:AE,create:gg,update:gg,destroy:ME,remove:RE};function IE(n,...e){const t=Nl(e,[]);return t.length===1&&!t[0].sel&&t[0].text?pn(void 0,void 0,void 0,t[0].text,void 0):pn(void 0,n??{},t,void 0,void 0)}function Nl(n,e){for(const t of n)t!=null&&t!==!1&&t!==""&&(Array.isArray(t)?Nl(t,e):typeof t=="string"||typeof t=="number"||typeof t=="boolean"?e.push(pn(void 0,void 0,void 0,String(t),void 0)):e.push(t));return e}function Kd(n,e,...t){const i=Nl(t,[]);return typeof n=="function"?n(e,i):i.length===1&&!i[0].sel&&i[0].text?su(n,e,i[0].text):su(n,e,i)}Kd||(Kd={});const CE=Object.freeze(Object.defineProperty({__proto__:null,Fragment:IE,array:aa,attachTo:fE,attributesModule:mE,classModule:yE,datasetModule:vE,eventListenersModule:SE,fragment:rE,h:su,htmlDomApi:Ll,init:iE,get jsx(){return Kd},primitive:mo,propsModule:wE,styleModule:OE,thunk:aE,toVNode:P_,vnode:pn},Symbol.toStringTag,{value:"Module"})),Ia=rv(CE);var mg;function R_(){if(mg)return Li;mg=1;var n=Li&&Li.__decorate||function(r,s,a,u){var f=arguments.length,d=f<3?s:u===null?u=Object.getOwnPropertyDescriptor(s,a):u,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(r,s,a,u);else for(var l=r.length-1;l>=0;l--)(c=r[l])&&(d=(f<3?c(d):f>3?c(s,a,d):c(s,a))||d);return f>3&&d&&Object.defineProperty(s,a,d),d};Object.defineProperty(Li,"__esModule",{value:!0}),Li.isThunk=Li.ThunkView=void 0;const e=Ia,t=se();let i=class{render(s,a){return(0,e.h)(this.selector(s),{key:s.id,hook:{init:this.init.bind(this),prepatch:this.prepatch.bind(this)},fn:()=>this.renderAndDecorate(s,a),args:this.watchedArgs(s),thunk:!0})}renderAndDecorate(s,a){const u=this.doRender(s,a);return a.decorate(u,s),u}copyToThunk(s,a){a.elm=s.elm,s.data.fn=a.data.fn,s.data.args=a.data.args,a.data=s.data,a.children=s.children,a.text=s.text,a.elm=s.elm}init(s){const a=s.data,u=a.fn.apply(void 0,a.args);this.copyToThunk(u,s)}prepatch(s,a){const u=s.data,f=a.data;this.equals(u.args,f.args)?this.copyToThunk(s,a):this.copyToThunk(f.fn.apply(void 0,f.args),a)}equals(s,a){if(Array.isArray(s)&&Array.isArray(a)){if(s.length!==a.length)return!1;for(let u=0;u<a.length;++u)if(!this.equals(s[u],a[u]))return!1}else if(typeof s=="object"&&typeof a=="object"){if(Object.keys(s).length!==Object.keys(a).length)return!1;for(const u in s)if(u!=="parent"&&u!=="root"&&(!(u in a)||!this.equals(s[u],a[u])))return!1}else if(s!==a)return!1;return!0}};Li.ThunkView=i,Li.ThunkView=i=n([(0,t.injectable)()],i);function o(r){return"thunk"in r}return Li.isThunk=o,Li}var Ze={},ur={},yg;function tr(){if(yg)return ur;yg=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.JSX=ur.svg=ur.html=void 0;const n=Ia,e=["hook","on","style","class","props","attrs","dataset"],t="http://www.w3.org/2000/svg";function i(a,u,f){const d={};if(f&&(d.ns=f),a===null)return d;return e.forEach(l=>{a[l]&&(d[l]=a[l])}),Object.keys(a).forEach(l=>{if(l==="key"||l==="classNames"||l==="selector")return;const p=l.indexOf("-");if(p>0){const h=l.slice(0,p);e.includes(h)?c(h,l.slice(p+1),a[l]):c(u,l,a[l])}else d[l]||c(u,l,a[l])}),d;function c(l,p,h){const g=d[l]||(d[l]={});g[p]=h}}function o(a,u="props"){return(f,d,...c)=>{const l=typeof f=="function";return(0,n.jsx)(f,l?d:i(d,u,a),c)}}ur.JSX=o;const r=o();ur.html=r;const s=o(t,"attrs");return ur.svg=s,ur}var vg;function Ca(){if(vg)return Ze;vg=1;var n=Ze&&Ze.__decorate||function(v,_,S,E){var O=arguments.length,R=O<3?_:E===null?E=Object.getOwnPropertyDescriptor(_,S):E,w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(v,_,S,E);else for(var M=v.length-1;M>=0;M--)(w=v[M])&&(R=(O<3?w(R):O>3?w(_,S,R):w(_,S))||R);return O>3&&R&&Object.defineProperty(_,S,R),R},e=Ze&&Ze.__metadata||function(v,_){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(v,_)},t=Ze&&Ze.__param||function(v,_){return function(S,E){_(S,E,v)}},i;Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.MissingView=Ze.EmptyView=Ze.configureView=Ze.overrideModelElement=Ze.configureModelElement=Ze.ViewRegistry=Ze.findArgValue=void 0;const o=tr(),r=se(),s=ge(),a=Er(),u=ss(),f=Zr(),d=tn(),c=ti();function l(v,_){for(;v!==void 0&&!(_ in v)&&v.parentArgs;)v=v.parentArgs;return v?v[_]:void 0}Ze.findArgValue=l;let p=class extends a.InstanceRegistry{constructor(_){super(),this.registerDefaults(),_.forEach(S=>{S.isOverride?this.override(S.type,S.factory()):this.register(S.type,S.factory())})}registerDefaults(){this.register(f.EMPTY_ROOT.type,new y)}missing(_){return this.logger.warn(this,`no registered view for type '${_}', please configure a view in the ContainerModule`),new b}};Ze.ViewRegistry=p,n([(0,r.inject)(s.TYPES.ILogger),e("design:type",Object)],p.prototype,"logger",void 0),Ze.ViewRegistry=p=n([(0,r.injectable)(),t(0,(0,r.multiInject)(s.TYPES.ViewRegistration)),t(0,(0,r.optional)()),e("design:paramtypes",[Array])],p);function h(v,_,S,E,O){(0,d.registerModelElement)(v,_,S,O),m(v,_,E)}Ze.configureModelElement=h;function g(v,_,S,E,O){(0,d.registerModelElement)(v,_,S,O,!0),m(v,_,E,!0)}Ze.overrideModelElement=g;function m(v,_,S,E){if(typeof S=="function"){if(!(0,u.isInjectable)(S))throw new Error(`Views should be @injectable: ${S.name}`);v.isBound(S)||v.bind(S).toSelf()}v.bind(s.TYPES.ViewRegistration).toDynamicValue(O=>({type:_,factory:()=>O.container.get(S),isOverride:E}))}Ze.configureView=m;let y=class{render(_,S){return(0,o.svg)("svg",{"class-sprotty-empty":!0})}};Ze.EmptyView=y,Ze.EmptyView=y=n([(0,r.injectable)()],y);let b=i=class{render(_,S){const E=_.position||this.getPostion(_.type);return(0,o.svg)("text",{"class-sprotty-missing":!0,x:E.x,y:E.y},'missing "',_.type,'" view')}getPostion(_){let S=i.positionMap.get(_);return S||(S=c.Point.ORIGIN,i.positionMap.forEach(E=>S=E.y>=S.y?{x:0,y:E.y+20}:S),i.positionMap.set(_,S)),S}};return Ze.MissingView=b,b.positionMap=new Map,Ze.MissingView=b=i=n([(0,r.injectable)()],b),Ze}var Ni={},_g;function A_(){if(_g)return Ni;_g=1;var n=Ni&&Ni.__decorate||function(s,a,u,f){var d=arguments.length,c=d<3?a:f===null?f=Object.getOwnPropertyDescriptor(a,u):f,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,a,u,f);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(c=(d<3?l(c):d>3?l(a,u,c):l(a,u))||c);return d>3&&c&&Object.defineProperty(a,u,c),c},e=Ni&&Ni.__metadata||function(s,a){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,a)};Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.ViewerCache=void 0;const t=se(),i=ge(),o=Aa();let r=class{update(a,u){if(u!==void 0)this.delegate.update(a,u),this.cachedModel=void 0;else{const f=this.cachedModel===void 0;this.cachedModel=a,f&&this.scheduleUpdate()}}scheduleUpdate(){this.syncer.onEndOfNextFrame(()=>{this.cachedModel&&(this.delegate.update(this.cachedModel),this.cachedModel=void 0)})}};return Ni.ViewerCache=r,n([(0,t.inject)(i.TYPES.IViewer),e("design:type",Object)],r.prototype,"delegate",void 0),n([(0,t.inject)(i.TYPES.AnimationFrameSyncer),e("design:type",o.AnimationFrameSyncer)],r.prototype,"syncer",void 0),Ni.ViewerCache=r=n([(0,t.injectable)()],r),Ni}var hd={},bg;function O_(){return bg||(bg=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.overrideViewerOptions=n.configureViewerOptions=n.defaultViewerOptions=void 0;const e=Wr(),t=ge(),i=()=>({baseDiv:"sprotty",baseClass:"sprotty",hiddenDiv:"sprotty-hidden",hiddenClass:"sprotty-hidden",popupDiv:"sprotty-popup",popupClass:"sprotty-popup",popupClosedClass:"sprotty-popup-closed",needsClientLayout:!0,needsServerLayout:!1,popupOpenDelay:1e3,popupCloseDelay:300,zoomLimits:{min:.01,max:10},horizontalScrollLimits:{min:-1e5,max:1e5},verticalScrollLimits:{min:-1e5,max:1e5}});n.defaultViewerOptions=i;function o(s,a){const u=Object.assign(Object.assign({},(0,n.defaultViewerOptions)()),a);s.isBound(t.TYPES.ViewerOptions)?s.rebind(t.TYPES.ViewerOptions).toConstantValue(u):s.bind(t.TYPES.ViewerOptions).toConstantValue(u)}n.configureViewerOptions=o;function r(s,a){const u=s.get(t.TYPES.ViewerOptions);return(0,e.safeAssign)(u,a),u}n.overrideViewerOptions=r})(hd)),hd}var at={},Sg;function I_(){if(Sg)return at;Sg=1;var n=at&&at.__decorate||function(y,b,v,_){var S=arguments.length,E=S<3?b:_===null?_=Object.getOwnPropertyDescriptor(b,v):_,O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(y,b,v,_);else for(var R=y.length-1;R>=0;R--)(O=y[R])&&(E=(S<3?O(E):S>3?O(b,v,E):O(b,v))||E);return S>3&&E&&Object.defineProperty(b,v,E),E},e=at&&at.__metadata||function(y,b){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(y,b)},t=at&&at.__param||function(y,b){return function(v,_){b(v,_,y)}};Object.defineProperty(at,"__esModule",{value:!0}),at.PopupModelViewer=at.HiddenModelViewer=at.ModelViewer=at.PatcherProvider=at.ModelRenderer=void 0;const i=se(),o=Ia,r=tr(),s=er(),a=Ou(),u=Zr(),f=ge(),d=R_(),c=Wt();class l{constructor(b,v,_,S={}){this.viewRegistry=b,this.targetKind=v,this.postprocessors=_,this.args=S}decorate(b,v){return(0,d.isThunk)(b)?b:this.postprocessors.reduce((_,S)=>S.decorate(_,v),b)}renderElement(b){const _=this.viewRegistry.get(b.type).render(b,this,this.args);if(_)return this.decorate(_,b)}renderChildren(b,v){const _=v?new l(this.viewRegistry,this.targetKind,this.postprocessors,Object.assign(Object.assign({},v),{parentArgs:this.args})):this;return b.children.map(S=>_.renderElement(S)).filter(S=>S!==void 0)}postUpdate(b){this.postprocessors.forEach(v=>v.postUpdate(b))}}at.ModelRenderer=l;let p=class{constructor(){this.patcher=(0,o.init)(this.createModules())}createModules(){return[o.propsModule,o.attributesModule,o.classModule,o.styleModule,o.eventListenersModule]}};at.PatcherProvider=p,at.PatcherProvider=p=n([(0,i.injectable)(),e("design:paramtypes",[])],p);let h=class{constructor(b,v,_){this.renderer=b("main",_),this.patcher=v.patcher}update(b,v){var _;this.logger.log(this,"rendering",b);const S=(0,r.html)("div",{id:this.options.baseDiv},this.renderer.renderElement(b));if(this.lastVDOM!==void 0){const E=this.hasFocus();(0,c.copyClassesFromVNode)(this.lastVDOM,S),this.lastVDOM=this.patcher.call(this,this.lastVDOM,S),this.restoreFocus(E)}else if(typeof document<"u"){let E=null;if(this.options.shadowRoot){const O=(_=document.getElementById(this.options.shadowRoot))===null||_===void 0?void 0:_.shadowRoot;O&&(E=O.getElementById(this.options.baseDiv))}else E=document.getElementById(this.options.baseDiv);E!==null?(typeof window<"u"&&window.addEventListener("resize",()=>{this.onWindowResize(S)}),(0,c.copyClassesFromElement)(E,S),(0,c.setClass)(S,this.options.baseClass,!0),this.lastVDOM=this.patcher.call(this,E,S)):this.logger.error(this,"element not in DOM:",this.options.baseDiv)}this.renderer.postUpdate(v)}hasFocus(){if(typeof document<"u"&&document.activeElement&&this.lastVDOM.children&&this.lastVDOM.children.length>0){const b=this.lastVDOM.children[0];if(typeof b=="object"){const v=b.elm;return document.activeElement===v}}return!1}restoreFocus(b){if(b&&this.lastVDOM.children&&this.lastVDOM.children.length>0){const v=this.lastVDOM.children[0];if(typeof v=="object"){const _=v.elm;_&&typeof _.focus=="function"&&_.focus()}}}onWindowResize(b){const v=document.getElementById(this.options.baseDiv);if(v!==null){const _=this.getBoundsInPage(v);this.actiondispatcher.dispatch(a.InitializeCanvasBoundsAction.create(_))}}getBoundsInPage(b){const v=b.getBoundingClientRect(),_=(0,s.getWindowScroll)();return{x:v.left+_.x,y:v.top+_.y,width:v.width,height:v.height}}};at.ModelViewer=h,n([(0,i.inject)(f.TYPES.ViewerOptions),e("design:type",Object)],h.prototype,"options",void 0),n([(0,i.inject)(f.TYPES.ILogger),e("design:type",Object)],h.prototype,"logger",void 0),n([(0,i.inject)(f.TYPES.IActionDispatcher),e("design:type",Object)],h.prototype,"actiondispatcher",void 0),at.ModelViewer=h=n([(0,i.injectable)(),t(0,(0,i.inject)(f.TYPES.ModelRendererFactory)),t(1,(0,i.inject)(f.TYPES.PatcherProvider)),t(2,(0,i.multiInject)(f.TYPES.IVNodePostprocessor)),t(2,(0,i.optional)()),e("design:paramtypes",[Function,p,Array])],h);let g=class{constructor(b,v,_){this.hiddenRenderer=b("hidden",_),this.patcher=v.patcher}update(b,v){this.logger.log(this,"rendering hidden");let _;if(b.type===u.EMPTY_ROOT.type)_=(0,r.html)("div",{id:this.options.hiddenDiv});else{const S=this.hiddenRenderer.renderElement(b);S&&(0,c.setAttr)(S,"opacity",0),_=(0,r.html)("div",{id:this.options.hiddenDiv},S)}if(this.lastHiddenVDOM!==void 0)(0,c.copyClassesFromVNode)(this.lastHiddenVDOM,_),this.lastHiddenVDOM=this.patcher.call(this,this.lastHiddenVDOM,_);else{let S=document.getElementById(this.options.hiddenDiv);S===null?(S=document.createElement("div"),document.body.appendChild(S)):(0,c.copyClassesFromElement)(S,_),(0,c.setClass)(_,this.options.baseClass,!0),(0,c.setClass)(_,this.options.hiddenClass,!0),this.lastHiddenVDOM=this.patcher.call(this,S,_)}this.hiddenRenderer.postUpdate(v)}};at.HiddenModelViewer=g,n([(0,i.inject)(f.TYPES.ViewerOptions),e("design:type",Object)],g.prototype,"options",void 0),n([(0,i.inject)(f.TYPES.ILogger),e("design:type",Object)],g.prototype,"logger",void 0),at.HiddenModelViewer=g=n([(0,i.injectable)(),t(0,(0,i.inject)(f.TYPES.ModelRendererFactory)),t(1,(0,i.inject)(f.TYPES.PatcherProvider)),t(2,(0,i.multiInject)(f.TYPES.HiddenVNodePostprocessor)),t(2,(0,i.optional)()),e("design:paramtypes",[Function,p,Array])],g);let m=class{constructor(b,v,_){this.modelRendererFactory=b,this.popupRenderer=this.modelRendererFactory("popup",_),this.patcher=v.patcher}update(b,v){this.logger.log(this,"rendering popup",b);const _=b.type===u.EMPTY_ROOT.type;let S;if(_)S=(0,r.html)("div",{id:this.options.popupDiv});else{const E=b.canvasBounds,O={top:E.y+"px",left:E.x+"px"};S=(0,r.html)("div",{id:this.options.popupDiv,style:O},this.popupRenderer.renderElement(b))}if(this.lastPopupVDOM!==void 0)(0,c.copyClassesFromVNode)(this.lastPopupVDOM,S),(0,c.setClass)(S,this.options.popupClosedClass,_),this.lastPopupVDOM=this.patcher.call(this,this.lastPopupVDOM,S);else if(typeof document<"u"){let E=document.getElementById(this.options.popupDiv);E===null?(E=document.createElement("div"),document.body.appendChild(E)):(0,c.copyClassesFromElement)(E,S),(0,c.setClass)(S,this.options.popupClass,!0),(0,c.setClass)(S,this.options.popupClosedClass,_),this.lastPopupVDOM=this.patcher.call(this,E,S)}this.popupRenderer.postUpdate(v)}};return at.PopupModelViewer=m,n([(0,i.inject)(f.TYPES.ViewerOptions),e("design:type",Object)],m.prototype,"options",void 0),n([(0,i.inject)(f.TYPES.ILogger),e("design:type",Object)],m.prototype,"logger",void 0),at.PopupModelViewer=m=n([(0,i.injectable)(),t(0,(0,i.inject)(f.TYPES.ModelRendererFactory)),t(1,(0,i.inject)(f.TYPES.PatcherProvider)),t(2,(0,i.multiInject)(f.TYPES.PopupVNodePostprocessor)),t(2,(0,i.optional)()),e("design:paramtypes",[Function,p,Array])],m),at}var Ir={},wg;function C_(){if(wg)return Ir;wg=1;var n=Ir&&Ir.__decorate||function(o,r,s,a){var u=arguments.length,f=u<3?r:a===null?a=Object.getOwnPropertyDescriptor(r,s):a,d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,r,s,a);else for(var c=o.length-1;c>=0;c--)(d=o[c])&&(f=(u<3?d(f):u>3?d(r,s,f):d(r,s))||f);return u>3&&f&&Object.defineProperty(r,s,f),f};Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.FocusFixPostprocessor=void 0;const e=se(),t=Wt();let i=class{decorate(r,s){return r.sel&&r.sel.startsWith("svg")&&(0,t.setAttr)(r,"tabindex",0),r}postUpdate(){}};return Ir.FocusFixPostprocessor=i,Ir.FocusFixPostprocessor=i=n([(0,e.injectable)()],i),Ir}var Pc={},cn={},Eg;function Fl(){if(Eg)return cn;Eg=1;var n=cn&&cn.__decorate||function(a,u,f,d){var c=arguments.length,l=c<3?u:d===null?d=Object.getOwnPropertyDescriptor(u,f):d,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(a,u,f,d);else for(var h=a.length-1;h>=0;h--)(p=a[h])&&(l=(c<3?p(l):c>3?p(u,f,l):p(u,f))||l);return c>3&&l&&Object.defineProperty(u,f,l),l},e=cn&&cn.__metadata||function(a,u){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,u)};Object.defineProperty(cn,"__esModule",{value:!0}),cn.ConsoleLogger=cn.NullLogger=cn.LogLevel=void 0;const t=se(),i=ge();var o;(function(a){a[a.none=0]="none",a[a.error=1]="error",a[a.warn=2]="warn",a[a.info=3]="info",a[a.log=4]="log"})(o||(cn.LogLevel=o={}));let r=class{constructor(){this.logLevel=o.none}error(u,f,...d){}warn(u,f,...d){}info(u,f,...d){}log(u,f,...d){}};cn.NullLogger=r,cn.NullLogger=r=n([(0,t.injectable)()],r);let s=class{constructor(){this.logLevel=o.log,this.viewOptions={baseDiv:""}}error(u,f,...d){if(this.logLevel>=o.error)try{console.error.apply(u,this.consoleArguments(u,f,d))}catch{}}warn(u,f,...d){if(this.logLevel>=o.warn)try{console.warn.apply(u,this.consoleArguments(u,f,d))}catch{}}info(u,f,...d){if(this.logLevel>=o.info)try{console.info.apply(u,this.consoleArguments(u,f,d))}catch{}}log(u,f,...d){if(this.logLevel>=o.log)try{console.log.apply(u,this.consoleArguments(u,f,d))}catch{}}consoleArguments(u,f,d){let c;return typeof u=="object"?c=u.constructor.name:c=u,[new Date().toLocaleTimeString()+" "+this.viewOptions.baseDiv+" "+c+": "+f,...d]}};return cn.ConsoleLogger=s,n([(0,t.inject)(i.TYPES.LogLevel),e("design:type",Number)],s.prototype,"logLevel",void 0),n([(0,t.inject)(i.TYPES.ViewerOptions),e("design:type",Object)],s.prototype,"viewOptions",void 0),cn.ConsoleLogger=s=n([(0,t.injectable)()],s),cn}var Fi={},Pg;function TE(){if(Pg)return Fi;Pg=1;var n=Fi&&Fi.__decorate||function(a,u,f,d){var c=arguments.length,l=c<3?u:d===null?d=Object.getOwnPropertyDescriptor(u,f):d,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(a,u,f,d);else for(var h=a.length-1;h>=0;h--)(p=a[h])&&(l=(c<3?p(l):c>3?p(u,f,l):p(u,f))||l);return c>3&&l&&Object.defineProperty(u,f,l),l},e=Fi&&Fi.__metadata||function(a,u){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,u)};Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.IdPostprocessor=void 0;const t=se(),i=ge(),o=Oa(),r=Wt();let s=class{decorate(u,f){const d=(0,r.getAttrs)(u);return d.id!==void 0&&this.logger.warn(u,"Overriding id of vnode ("+d.id+"). Make sure not to set it manually in view."),d.id=this.domHelper.createUniqueDOMElementId(f),u.key||(u.key=f.id),u}postUpdate(){}};return Fi.IdPostprocessor=s,n([(0,t.inject)(i.TYPES.ILogger),e("design:type",Object)],s.prototype,"logger",void 0),n([(0,t.inject)(i.TYPES.DOMHelper),e("design:type",o.DOMHelper)],s.prototype,"domHelper",void 0),Fi.IdPostprocessor=s=n([(0,t.injectable)()],s),Fi}var Cr={},Mg;function DE(){if(Mg)return Cr;Mg=1;var n=Cr&&Cr.__decorate||function(r,s,a,u){var f=arguments.length,d=f<3?s:u===null?u=Object.getOwnPropertyDescriptor(s,a):u,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(r,s,a,u);else for(var l=r.length-1;l>=0;l--)(c=r[l])&&(d=(f<3?c(d):f>3?c(s,a,d):c(s,a))||d);return f>3&&d&&Object.defineProperty(s,a,d),d};Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.CssClassPostprocessor=void 0;const e=ns(),t=Wt(),i=se();let o=class{decorate(s,a){if(a.cssClasses)for(const f of a.cssClasses)(0,t.setClass)(s,f,!0);const u=(0,e.getSubType)(a);return u&&u!==a.type&&(0,t.setClass)(s,u,!0),s}postUpdate(){}};return Cr.CssClassPostprocessor=o,Cr.CssClassPostprocessor=o=n([(0,i.injectable)()],o),Cr}var Rg;function T_(){if(Rg)return Pc;Rg=1,Object.defineProperty(Pc,"__esModule",{value:!0});const n=se(),e=ge(),t=Ou(),i=Fl(),o=Dl(),r=Au(),s=w_(),a=S_(),u=Zr(),f=Aa(),d=I_(),c=O_(),l=ni(),p=Pr(),h=C_(),g=Ca(),m=A_(),y=Oa(),b=TE(),v=Vn(),_=DE(),S=xl(),E=Iu(),O=__(),R=new n.ContainerModule((w,M,I)=>{w(e.TYPES.ILogger).to(i.NullLogger).inSingletonScope(),w(e.TYPES.LogLevel).toConstantValue(i.LogLevel.warn),w(e.TYPES.SModelRegistry).to(u.SModelRegistry).inSingletonScope(),w(r.ActionHandlerRegistry).toSelf().inSingletonScope(),w(e.TYPES.ActionHandlerRegistryProvider).toProvider(C=>()=>new Promise(z=>{z(C.container.get(r.ActionHandlerRegistry))})),w(e.TYPES.ViewRegistry).to(g.ViewRegistry).inSingletonScope(),w(e.TYPES.IModelFactory).to(u.SModelFactory).inSingletonScope(),w(e.TYPES.IActionDispatcher).to(o.ActionDispatcher).inSingletonScope(),w(e.TYPES.IActionDispatcherProvider).toProvider(C=>()=>new Promise(z=>{z(C.container.get(e.TYPES.IActionDispatcher))})),w(e.TYPES.IDiagramLocker).to(O.DefaultDiagramLocker).inSingletonScope(),w(v.CommandActionHandlerInitializer).toSelf().inSingletonScope(),w(e.TYPES.IActionHandlerInitializer).toService(v.CommandActionHandlerInitializer),w(e.TYPES.ICommandStack).to(s.CommandStack).inSingletonScope(),w(e.TYPES.ICommandStackProvider).toProvider(C=>()=>new Promise(z=>{z(C.container.get(e.TYPES.ICommandStack))})),w(e.TYPES.CommandStackOptions).toConstantValue((0,a.defaultCommandStackOptions)()),w(d.ModelViewer).toSelf().inSingletonScope(),w(d.HiddenModelViewer).toSelf().inSingletonScope(),w(d.PopupModelViewer).toSelf().inSingletonScope(),w(e.TYPES.ModelViewer).toDynamicValue(C=>{const z=C.container.createChild();return z.bind(e.TYPES.IViewer).toService(d.ModelViewer),z.bind(m.ViewerCache).toSelf(),z.get(m.ViewerCache)}).inSingletonScope(),w(e.TYPES.PopupModelViewer).toDynamicValue(C=>{const z=C.container.createChild();return z.bind(e.TYPES.IViewer).toService(d.PopupModelViewer),z.bind(m.ViewerCache).toSelf(),z.get(m.ViewerCache)}).inSingletonScope(),w(e.TYPES.HiddenModelViewer).toService(d.HiddenModelViewer),w(e.TYPES.IViewerProvider).toDynamicValue(C=>({get modelViewer(){return C.container.get(e.TYPES.ModelViewer)},get hiddenModelViewer(){return C.container.get(e.TYPES.HiddenModelViewer)},get popupModelViewer(){return C.container.get(e.TYPES.PopupModelViewer)}})),w(e.TYPES.ViewerOptions).toConstantValue((0,c.defaultViewerOptions)()),w(e.TYPES.PatcherProvider).to(d.PatcherProvider).inSingletonScope(),w(e.TYPES.DOMHelper).to(y.DOMHelper).inSingletonScope(),w(e.TYPES.ModelRendererFactory).toFactory(C=>(z,G,N={})=>{const U=C.container.get(e.TYPES.ViewRegistry);return new d.ModelRenderer(U,z,G,N)}),w(b.IdPostprocessor).toSelf().inSingletonScope(),w(e.TYPES.IVNodePostprocessor).toService(b.IdPostprocessor),w(e.TYPES.HiddenVNodePostprocessor).toService(b.IdPostprocessor),w(_.CssClassPostprocessor).toSelf().inSingletonScope(),w(e.TYPES.IVNodePostprocessor).toService(_.CssClassPostprocessor),w(e.TYPES.HiddenVNodePostprocessor).toService(_.CssClassPostprocessor),w(l.MouseTool).toSelf().inSingletonScope(),w(e.TYPES.IVNodePostprocessor).toService(l.MouseTool),w(p.KeyTool).toSelf().inSingletonScope(),w(e.TYPES.IVNodePostprocessor).toService(p.KeyTool),w(h.FocusFixPostprocessor).toSelf().inSingletonScope(),w(e.TYPES.IVNodePostprocessor).toService(h.FocusFixPostprocessor),w(e.TYPES.PopupVNodePostprocessor).toService(b.IdPostprocessor),w(l.PopupMouseTool).toSelf().inSingletonScope(),w(e.TYPES.PopupVNodePostprocessor).toService(l.PopupMouseTool),w(e.TYPES.AnimationFrameSyncer).to(f.AnimationFrameSyncer).inSingletonScope();const D={bind:w,isBound:I};(0,v.configureCommand)(D,t.InitializeCanvasBoundsCommand),w(t.CanvasBoundsInitializer).toSelf().inSingletonScope(),w(e.TYPES.IVNodePostprocessor).toService(t.CanvasBoundsInitializer),(0,v.configureCommand)(D,S.SetModelCommand),w(e.TYPES.UIExtensionRegistry).to(E.UIExtensionRegistry).inSingletonScope(),(0,v.configureCommand)(D,E.SetUIExtensionVisibilityCommand),w(l.MousePositionTracker).toSelf().inSingletonScope(),w(e.TYPES.MouseListener).toService(l.MousePositionTracker)});return Pc.default=R,Pc}var un={},pd={},Ag;function tt(){return Ag||(Ag=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.SShapeElementImpl=n.findChildrenAtPosition=n.getAbsoluteClientBounds=n.getAbsoluteBounds=n.isAlignable=n.isSizeable=n.isLayoutableChild=n.isLayoutContainer=n.isBoundsAware=n.alignFeature=n.layoutableChildFeature=n.layoutContainerFeature=n.boundsFeature=void 0;const e=He(),t=Ke(),i=tn(),o=er();n.boundsFeature=Symbol("boundsFeature"),n.layoutContainerFeature=Symbol("layoutContainerFeature"),n.layoutableChildFeature=Symbol("layoutableChildFeature"),n.alignFeature=Symbol("alignFeature");function r(g){return"bounds"in g}n.isBoundsAware=r;function s(g){return r(g)&&g.hasFeature(n.layoutContainerFeature)&&"layout"in g}n.isLayoutContainer=s;function a(g){return r(g)&&g.hasFeature(n.layoutableChildFeature)}n.isLayoutableChild=a;function u(g){return g.hasFeature(n.boundsFeature)&&r(g)}n.isSizeable=u;function f(g){return g.hasFeature(n.alignFeature)&&"alignment"in g}n.isAlignable=f;function d(g){const m=(0,i.findParentByFeature)(g,r);if(m!==void 0){let y=m.bounds,b=m;for(;b instanceof t.SChildElementImpl;){const v=b.parent;y=v.localToParent(y),b=v}return y}else if(g instanceof t.SModelRootImpl){const y=g.canvasBounds;return{x:0,y:0,width:y.width,height:y.height}}else return e.Bounds.EMPTY}n.getAbsoluteBounds=d;function c(g,m,y){let b=0,v=0,_=0,S=0;const E=m.createUniqueDOMElementId(g),O=document.getElementById(E);if(O){const w=O.getBoundingClientRect(),M=(0,o.getWindowScroll)();b=w.left+M.x,v=w.top+M.y,_=w.width,S=w.height}let R=document.getElementById(y.baseDiv);if(R)for(;R.offsetParent instanceof HTMLElement&&(R=R.offsetParent);)b-=R.offsetLeft,v-=R.offsetTop;return{x:b,y:v,width:_,height:S}}n.getAbsoluteClientBounds=c;function l(g,m){const y=[];return p(g,m,y),y}n.findChildrenAtPosition=l;function p(g,m,y){g.children.forEach(b=>{if(r(b)&&e.Bounds.includes(b.bounds,m)&&y.push(b),b instanceof t.SParentElementImpl){const v=b.parentToLocal(m);p(b,v,y)}})}class h extends t.SChildElementImpl{constructor(){super(...arguments),this.position=e.Point.ORIGIN,this.size=e.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(m){this.position={x:m.x,y:m.y},this.size={width:m.width,height:m.height}}localToParent(m){const y={x:m.x+this.position.x,y:m.y+this.position.y,width:-1,height:-1};return(0,e.isBounds)(m)&&(y.width=m.width,y.height=m.height),y}parentToLocal(m){const y={x:m.x-this.position.x,y:m.y-this.position.y,width:-1,height:-1};return(0,e.isBounds)(m)&&(y.width=m.width,y.height=m.height),y}}n.SShapeElementImpl=h})(pd)),pd}var Og;function Bl(){if(Og)return un;Og=1;var n=un&&un.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g},e=un&&un.__metadata||function(d,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(d,c)},t=un&&un.__param||function(d,c){return function(l,p){c(l,p,d)}};Object.defineProperty(un,"__esModule",{value:!0}),un.RequestBoundsCommand=un.SetBoundsCommand=void 0;const i=se(),o=qe(),r=gt(),s=ge(),a=tt();let u=class extends r.SystemCommand{constructor(c){super(),this.action=c,this.bounds=[]}execute(c){return this.action.bounds.forEach(l=>{const p=c.root.index.getById(l.elementId);p&&(0,a.isBoundsAware)(p)&&this.bounds.push({element:p,oldBounds:p.bounds,newPosition:l.newPosition,newSize:l.newSize})}),this.redo(c)}undo(c){return this.bounds.forEach(l=>l.element.bounds=l.oldBounds),c.root}redo(c){return this.bounds.forEach(l=>{l.newPosition?l.element.bounds=Object.assign(Object.assign({},l.newPosition),l.newSize):l.element.bounds=Object.assign({x:l.element.bounds.x,y:l.element.bounds.y},l.newSize)}),c.root}};un.SetBoundsCommand=u,u.KIND=o.SetBoundsAction.KIND,un.SetBoundsCommand=u=n([(0,i.injectable)(),t(0,(0,i.inject)(s.TYPES.Action)),e("design:paramtypes",[Object])],u);let f=class extends r.HiddenCommand{constructor(c){super(),this.action=c}execute(c){return{model:c.modelFactory.createRoot(this.action.newRoot),modelChanged:!0,cause:this.action}}get blockUntil(){return c=>c.kind===o.ComputedBoundsAction.KIND}};return un.RequestBoundsCommand=f,f.KIND=o.RequestBoundsAction.KIND,un.RequestBoundsCommand=f=n([(0,i.injectable)(),t(0,(0,i.inject)(s.TYPES.Action)),e("design:paramtypes",[Object])],f),un}var fo={},Tt={},Ig;function Vl(){if(Ig)return Tt;Ig=1;var n=Tt&&Tt.__decorate||function(p,h,g,m){var y=arguments.length,b=y<3?h:m===null?m=Object.getOwnPropertyDescriptor(h,g):m,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(p,h,g,m);else for(var _=p.length-1;_>=0;_--)(v=p[_])&&(b=(y<3?v(b):y>3?v(h,g,b):v(h,g))||b);return y>3&&b&&Object.defineProperty(h,g,b),b},e=Tt&&Tt.__metadata||function(p,h){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(p,h)},t=Tt&&Tt.__param||function(p,h){return function(g,m){h(g,m,p)}};Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.configureLayout=Tt.StatefulLayouter=Tt.Layouter=Tt.LayoutRegistry=void 0;const i=se(),o=He(),r=ge(),s=Er(),a=tt(),u=ss();let f=class extends s.InstanceRegistry{constructor(h=[]){super(),h.forEach(g=>{this.hasKey(g.layoutKind)?this.logger.warn("Layout kind is already defined: ",g.layoutKind):this.register(g.layoutKind,g.factory())})}};Tt.LayoutRegistry=f,n([(0,i.inject)(r.TYPES.ILogger),e("design:type",Object)],f.prototype,"logger",void 0),Tt.LayoutRegistry=f=n([(0,i.injectable)(),t(0,(0,i.multiInject)(r.TYPES.LayoutRegistration)),t(0,(0,i.optional)()),e("design:paramtypes",[Array])],f);let d=class{layout(h){new c(h,this.layoutRegistry,this.logger).layout()}};Tt.Layouter=d,n([(0,i.inject)(r.TYPES.LayoutRegistry),e("design:type",f)],d.prototype,"layoutRegistry",void 0),n([(0,i.inject)(r.TYPES.ILogger),e("design:type",Object)],d.prototype,"logger",void 0),Tt.Layouter=d=n([(0,i.injectable)()],d);class c{constructor(h,g,m){this.element2boundsData=h,this.layoutRegistry=g,this.log=m,this.toBeLayouted=[],h.forEach((y,b)=>{(0,a.isLayoutContainer)(b)&&this.toBeLayouted.push(b)})}getBoundsData(h){let g=this.element2boundsData.get(h),m=h.bounds;return(0,a.isLayoutContainer)(h)&&this.toBeLayouted.indexOf(h)>=0&&(m=this.doLayout(h)),g||(g={bounds:m,boundsChanged:!1,alignmentChanged:!1},this.element2boundsData.set(h,g)),g}layout(){for(;this.toBeLayouted.length>0;){const h=this.toBeLayouted[0];this.doLayout(h)}}doLayout(h){const g=this.toBeLayouted.indexOf(h);g>=0&&this.toBeLayouted.splice(g,1);const m=this.layoutRegistry.get(h.layout);m&&m.layout(h,this);const y=this.element2boundsData.get(h);return y!==void 0&&y.bounds!==void 0?y.bounds:(this.log.error(h,"Layout failed"),o.Bounds.EMPTY)}}Tt.StatefulLayouter=c;function l(p,h,g){if(typeof g=="function"){if(!(0,u.isInjectable)(g))throw new Error(`Layouts be @injectable: ${g.name}`);p.isBound(g)||p.bind(g).toSelf()}p.bind(r.TYPES.LayoutRegistration).toDynamicValue(m=>({layoutKind:h,factory:()=>m.container.get(g)}))}return Tt.configureLayout=l,Tt}var Cg;function D_(){return Cg||(Cg=1,(function(n){var e=fo&&fo.__decorate||function(p,h,g,m){var y=arguments.length,b=y<3?h:m===null?m=Object.getOwnPropertyDescriptor(h,g):m,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(p,h,g,m);else for(var _=p.length-1;_>=0;_--)(v=p[_])&&(b=(y<3?v(b):y>3?v(h,g,b):v(h,g))||b);return y>3&&b&&Object.defineProperty(h,g,b),b},t=fo&&fo.__metadata||function(p,h){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(p,h)};Object.defineProperty(n,"__esModule",{value:!0}),n.ATTR_BBOX_ELEMENT=n.HiddenBoundsUpdater=n.BoundsData=void 0;const i=se(),o=qe(),r=He(),s=er(),a=Ke(),u=ge(),f=Vl(),d=tt();class c{}n.BoundsData=c;let l=class{constructor(){this.element2boundsData=new Map}decorate(h,g){return((0,d.isSizeable)(g)||(0,d.isLayoutContainer)(g))&&this.element2boundsData.set(g,{vnode:h,bounds:g.bounds,boundsChanged:!1,alignmentChanged:!1}),g instanceof a.SModelRootImpl&&(this.root=g),h}postUpdate(h){if(h===void 0||h.kind!==o.RequestBoundsAction.KIND)return;const g=h;this.getBoundsFromDOM(),this.layouter.layout(this.element2boundsData);const m=[],y=[];this.element2boundsData.forEach((v,_)=>{if(v.boundsChanged&&v.bounds!==void 0){const S={elementId:_.id,newSize:{width:v.bounds.width,height:v.bounds.height}};_ instanceof a.SChildElementImpl&&(0,d.isLayoutContainer)(_.parent)&&(S.newPosition={x:v.bounds.x,y:v.bounds.y}),m.push(S)}v.alignmentChanged&&v.alignment!==void 0&&y.push({elementId:_.id,newAlignment:v.alignment})});const b=this.root!==void 0?this.root.revision:void 0;this.actionDispatcher.dispatch(o.ComputedBoundsAction.create(m,{revision:b,alignments:y,requestId:g.requestId})),this.element2boundsData.clear()}getBoundsFromDOM(){this.element2boundsData.forEach((h,g)=>{if(h.bounds&&(0,d.isSizeable)(g)){const m=h.vnode;if(m&&m.elm){const y=this.getBounds(m.elm,g);(0,d.isAlignable)(g)&&!((0,r.almostEquals)(y.x,0)&&(0,r.almostEquals)(y.y,0))&&(h.alignment={x:-y.x,y:-y.y},h.alignmentChanged=!0);const b={x:g.bounds.x,y:g.bounds.y,width:y.width,height:y.height};(0,r.almostEquals)(b.x,g.bounds.x)&&(0,r.almostEquals)(b.y,g.bounds.y)&&(0,r.almostEquals)(b.width,g.bounds.width)&&(0,r.almostEquals)(b.height,g.bounds.height)||(h.bounds=b,h.boundsChanged=!0)}}})}getBounds(h,g){if(!(0,s.isSVGGraphicsElement)(h))return this.logger.error(this,"Not an SVG element:",h),r.Bounds.EMPTY;if(h.tagName==="g"){for(const y of Array.from(h.children))if(y.getAttribute(n.ATTR_BBOX_ELEMENT)!==null)return this.getBounds(y,g)}const m=h.getBBox();return{x:m.x,y:m.y,width:m.width,height:m.height}}};n.HiddenBoundsUpdater=l,e([(0,i.inject)(u.TYPES.ILogger),t("design:type",Object)],l.prototype,"logger",void 0),e([(0,i.inject)(u.TYPES.IActionDispatcher),t("design:type",Object)],l.prototype,"actionDispatcher",void 0),e([(0,i.inject)(u.TYPES.Layouter),t("design:type",f.Layouter)],l.prototype,"layouter",void 0),n.HiddenBoundsUpdater=l=e([(0,i.injectable)()],l),n.ATTR_BBOX_ELEMENT="bboxElement"})(fo)),fo}var Tr={},Dr={},Tg;function zl(){if(Tg)return Dr;Tg=1;var n=Dr&&Dr.__decorate||function(s,a,u,f){var d=arguments.length,c=d<3?a:f===null?f=Object.getOwnPropertyDescriptor(a,u):f,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,a,u,f);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(c=(d<3?l(c):d>3?l(a,u,c):l(a,u))||c);return d>3&&c&&Object.defineProperty(a,u,c),c};Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.AbstractLayout=void 0;const e=He(),t=Ke(),i=tt(),o=se();let r=class{layout(a,u){const f=u.getBoundsData(a),d=this.getLayoutOptions(a),c=this.getChildrenSize(a,d,u),l=d.paddingFactor*(d.resizeContainer?Math.max(c.width,d.minWidth):Math.max(0,this.getFixedContainerBounds(a,d,u).width)-d.paddingLeft-d.paddingRight),p=d.paddingFactor*(d.resizeContainer?Math.max(c.height,d.minHeight):Math.max(0,this.getFixedContainerBounds(a,d,u).height)-d.paddingTop-d.paddingBottom);if(l>0&&p>0){const h=this.layoutChildren(a,u,d,l,p);f.bounds=this.getFinalContainerBounds(a,h,d,l,p),f.boundsChanged=!0}}getFinalContainerBounds(a,u,f,d,c){return{x:a.bounds.x,y:a.bounds.y,width:Math.max(f.minWidth,d+f.paddingLeft+f.paddingRight),height:Math.max(f.minHeight,c+f.paddingTop+f.paddingBottom)}}getFixedContainerBounds(a,u,f){let d=a;for(;;){if((0,i.isBoundsAware)(d)){const c=d.bounds;if((0,i.isLayoutContainer)(d)&&u.resizeContainer&&f.log.error(d,"Resizable container found while detecting fixed bounds"),e.Dimension.isValid(c))return c}if(d instanceof t.SChildElementImpl)d=d.parent;else return f.log.error(d,"Cannot detect fixed bounds"),e.Bounds.EMPTY}}layoutChildren(a,u,f,d,c){let l={x:f.paddingLeft+.5*(d-d/f.paddingFactor),y:f.paddingTop+.5*(c-c/f.paddingFactor)};return a.children.forEach(p=>{if((0,i.isLayoutableChild)(p)){const h=u.getBoundsData(p),g=h.bounds,m=this.getChildLayoutOptions(p,f);g!==void 0&&e.Dimension.isValid(g)&&(l=this.layoutChild(p,h,g,m,f,l,d,c))}}),l}getDx(a,u,f){switch(a){case"left":return 0;case"center":return .5*(f-u.width);case"right":return f-u.width}}getDy(a,u,f){switch(a){case"top":return 0;case"center":return .5*(f-u.height);case"bottom":return f-u.height}}getChildLayoutOptions(a,u){const f=a.layoutOptions;return f===void 0?u:this.spread(u,f)}getLayoutOptions(a){let u=a;const f=[];for(;u!==void 0;){const d=u.layoutOptions;if(d!==void 0&&f.push(d),u instanceof t.SChildElementImpl)u=u.parent;else break}return f.reverse().reduce((d,c)=>this.spread(d,c),this.getDefaultLayoutOptions())}};return Dr.AbstractLayout=r,Dr.AbstractLayout=r=n([(0,o.injectable)()],r),Dr}var Dg;function x_(){if(Dg)return Tr;Dg=1;var n=Tr&&Tr.__decorate||function(s,a,u,f){var d=arguments.length,c=d<3?a:f===null?f=Object.getOwnPropertyDescriptor(a,u):f,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,a,u,f);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(c=(d<3?l(c):d>3?l(a,u,c):l(a,u))||c);return d>3&&c&&Object.defineProperty(a,u,c),c};Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.VBoxLayouter=void 0;const e=se(),t=He(),i=zl(),o=tt();let r=class extends i.AbstractLayout{getChildrenSize(a,u,f){let d=-1,c=0,l=!0;return a.children.forEach(p=>{if((0,o.isLayoutableChild)(p)){const h=f.getBoundsData(p).bounds;h!==void 0&&t.Dimension.isValid(h)&&(c+=h.height,l?l=!1:c+=u.vGap,d=Math.max(d,h.width))}}),{width:d,height:c}}layoutChild(a,u,f,d,c,l,p,h){const g=this.getDx(d.hAlign,f,p);return u.bounds={x:c.paddingLeft+a.bounds.x-f.x+g,y:l.y+a.bounds.y-f.y,width:f.width,height:f.height},u.boundsChanged=!0,{x:l.x,y:l.y+f.height+c.vGap}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,vGap:1,hAlign:"center",minWidth:0,minHeight:0}}spread(a,u){return Object.assign(Object.assign({},a),u)}};return Tr.VBoxLayouter=r,r.KIND="vbox",Tr.VBoxLayouter=r=n([(0,e.injectable)()],r),Tr}var xr={},xg;function j_(){if(xg)return xr;xg=1;var n=xr&&xr.__decorate||function(s,a,u,f){var d=arguments.length,c=d<3?a:f===null?f=Object.getOwnPropertyDescriptor(a,u):f,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,a,u,f);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(c=(d<3?l(c):d>3?l(a,u,c):l(a,u))||c);return d>3&&c&&Object.defineProperty(a,u,c),c};Object.defineProperty(xr,"__esModule",{value:!0}),xr.HBoxLayouter=void 0;const e=se(),t=He(),i=zl(),o=tt();let r=class extends i.AbstractLayout{getChildrenSize(a,u,f){let d=0,c=-1,l=!0;return a.children.forEach(p=>{if((0,o.isLayoutableChild)(p)){const h=f.getBoundsData(p).bounds;h!==void 0&&t.Dimension.isValid(h)&&(l?l=!1:d+=u.hGap,d+=h.width,c=Math.max(c,h.height))}}),{width:d,height:c}}layoutChild(a,u,f,d,c,l,p,h){const g=this.getDy(d.vAlign,f,h);return u.bounds={x:l.x+a.bounds.x-f.x,y:c.paddingTop+a.bounds.y-f.y+g,width:f.width,height:f.height},u.boundsChanged=!0,{x:l.x+f.width+c.hGap,y:l.y}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hGap:1,vAlign:"center",minWidth:0,minHeight:0}}spread(a,u){return Object.assign(Object.assign({},a),u)}};return xr.HBoxLayouter=r,r.KIND="hbox",xr.HBoxLayouter=r=n([(0,e.injectable)()],r),xr}var jr={},jg;function L_(){if(jg)return jr;jg=1;var n=jr&&jr.__decorate||function(s,a,u,f){var d=arguments.length,c=d<3?a:f===null?f=Object.getOwnPropertyDescriptor(a,u):f,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,a,u,f);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(c=(d<3?l(c):d>3?l(a,u,c):l(a,u))||c);return d>3&&c&&Object.defineProperty(a,u,c),c};Object.defineProperty(jr,"__esModule",{value:!0}),jr.StackLayouter=void 0;const e=se(),t=He(),i=zl(),o=tt();let r=class extends i.AbstractLayout{getChildrenSize(a,u,f){let d=-1,c=-1;return a.children.forEach(l=>{if((0,o.isLayoutableChild)(l)){const p=f.getBoundsData(l).bounds;p!==void 0&&t.Dimension.isValid(p)&&(d=Math.max(d,p.width),c=Math.max(c,p.height))}}),{width:d,height:c}}layoutChild(a,u,f,d,c,l,p,h){const g=this.getDx(d.hAlign,f,p),m=this.getDy(d.vAlign,f,h);return u.bounds={x:c.paddingLeft+a.bounds.x-f.x+g,y:c.paddingTop+a.bounds.y-f.y+m,width:f.width,height:f.height},u.boundsChanged=!0,l}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hAlign:"center",vAlign:"center",minWidth:0,minHeight:0}}spread(a,u){return Object.assign(Object.assign({},a),u)}};return jr.StackLayouter=r,r.KIND="stack",jr.StackLayouter=r=n([(0,e.injectable)()],r),jr}var Lr={},Lg;function Tu(){if(Lg)return Lr;Lg=1;var n=Lr&&Lr.__decorate||function(r,s,a,u){var f=arguments.length,d=f<3?s:u===null?u=Object.getOwnPropertyDescriptor(s,a):u,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(r,s,a,u);else for(var l=r.length-1;l>=0;l--)(c=r[l])&&(d=(f<3?c(d):f>3?c(s,a,d):c(s,a))||d);return f>3&&d&&Object.defineProperty(s,a,d),d};Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.ShapeView=void 0;const e=se(),t=He(),i=tt();let o=class{isVisible(s,a){if(a.targetKind==="hidden"||!t.Dimension.isValid(s.bounds))return!0;const u=(0,i.getAbsoluteBounds)(s),f=s.root.canvasBounds;return u.x<=f.width&&u.x+u.width>=0&&u.y<=f.height&&u.y+u.height>=0}};return Lr.ShapeView=o,Lr.ShapeView=o=n([(0,e.injectable)()],o),Lr}var bn={},Ng;function Du(){if(Ng)return bn;Ng=1;var n=bn&&bn.__decorate||function(f,d,c,l){var p=arguments.length,h=p<3?d:l===null?l=Object.getOwnPropertyDescriptor(d,c):l,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,d,c,l);else for(var m=f.length-1;m>=0;m--)(g=f[m])&&(h=(p<3?g(h):p>3?g(d,c,h):g(d,c))||h);return p>3&&h&&Object.defineProperty(d,c,h),h},e=bn&&bn.__metadata||function(f,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,d)},t=bn&&bn.__param||function(f,d){return function(c,l){d(c,l,f)}};Object.defineProperty(bn,"__esModule",{value:!0}),bn.configureButtonHandler=bn.ButtonHandlerRegistry=void 0;const i=se(),o=Er(),r=ge(),s=ss();let a=class extends o.InstanceRegistry{constructor(d){super(),d.forEach(c=>this.register(c.TYPE,c.factory()))}};bn.ButtonHandlerRegistry=a,bn.ButtonHandlerRegistry=a=n([(0,i.injectable)(),t(0,(0,i.multiInject)(r.TYPES.IButtonHandlerRegistration)),t(0,(0,i.optional)()),e("design:paramtypes",[Array])],a);function u(f,d,c){if(typeof c=="function"){if(!(0,s.isInjectable)(c))throw new Error(`Button handlers should be @injectable: ${c.name}`);f.isBound(c)||f.bind(c).toSelf()}f.bind(r.TYPES.IButtonHandlerRegistration).toDynamicValue(l=>({TYPE:d,factory:()=>l.container.get(c)}))}return bn.configureButtonHandler=u,bn}var Ks={},gd={},Fg;function Ta(){return Fg||(Fg=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isFadeable=n.fadeFeature=void 0,n.fadeFeature=Symbol("fadeFeature");function e(t){return t.hasFeature(n.fadeFeature)&&t.opacity!==void 0}n.isFadeable=e})(gd)),gd}var Bg;function N_(){if(Bg)return Ks;Bg=1,Object.defineProperty(Ks,"__esModule",{value:!0}),Ks.SButtonImpl=void 0;const n=tt(),e=Ta();class t extends n.SShapeElementImpl{constructor(){super(...arguments),this.enabled=!0}}return Ks.SButtonImpl=t,t.DEFAULT_FEATURES=[n.boundsFeature,n.layoutableChildFeature,e.fadeFeature],Ks}var dn={},md={},Vg;function F_(){return Vg||(Vg=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.name=n.isNameable=n.nameFeature=void 0,n.nameFeature=Symbol("nameableFeature");function e(i){return i.hasFeature(n.nameFeature)}n.isNameable=e;function t(i){if(e(i))return i.name}n.name=t})(md)),md}var zg;function ql(){if(zg)return dn;zg=1;var n=dn&&dn.__decorate||function(c,l,p,h){var g=arguments.length,m=g<3?l:h===null?h=Object.getOwnPropertyDescriptor(l,p):h,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(c,l,p,h);else for(var b=c.length-1;b>=0;b--)(y=c[b])&&(m=(g<3?y(m):g>3?y(l,p,m):y(l,p))||m);return g>3&&m&&Object.defineProperty(l,p,m),m},e=dn&&dn.__metadata||function(c,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(c,l)},t=dn&&dn.__param||function(c,l){return function(p,h){l(p,h,c)}};Object.defineProperty(dn,"__esModule",{value:!0}),dn.RevealNamedElementActionProvider=dn.CommandPaletteActionProviderRegistry=void 0;const i=se(),o=qe(),r=Ol(),s=ge(),a=os(),u=F_();let f=class{constructor(l=[]){this.actionProviders=l}getActions(l,p,h,g){const m=this.actionProviders.map(y=>y.getActions(l,p,h,g));return Promise.all(m).then(y=>y.reduce((b,v)=>v!==void 0?b.concat(v):b))}};dn.CommandPaletteActionProviderRegistry=f,dn.CommandPaletteActionProviderRegistry=f=n([(0,i.injectable)(),t(0,(0,i.multiInject)(s.TYPES.ICommandPaletteActionProvider)),t(0,(0,i.optional)()),e("design:paramtypes",[Array])],f);let d=class{constructor(l){this.logger=l}getActions(l,p,h,g){return g!==void 0&&g%2===0?Promise.resolve(this.createSelectActions(l)):Promise.resolve([new r.LabeledAction("Select all",[o.SelectAllAction.create()])])}createSelectActions(l){return(0,a.toArray)(l.index.all().filter(h=>(0,u.isNameable)(h))).map(h=>new r.LabeledAction(`Reveal ${(0,u.name)(h)}`,[o.SelectAction.create({selectedElementsIDs:[h.id]}),o.CenterAction.create([h.id])],"eye"))}};return dn.RevealNamedElementActionProvider=d,dn.RevealNamedElementActionProvider=d=n([(0,i.injectable)(),t(0,(0,i.inject)(s.TYPES.ILogger)),e("design:paramtypes",[Object])],d),dn}var Sn={},yd={},qg;function B_(){return qg||(qg=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.codiconCSSClasses=n.codiconCSSString=n.ANIMATION_SPIN=n.ACTION_ITEM=void 0,n.ACTION_ITEM="action-item",n.ANIMATION_SPIN="animation-spin";function e(i,o=!1,r=!1,s=[]){return t(i,o,r,s).join(" ")}n.codiconCSSString=e;function t(i,o=!1,r=!1,s=[]){const a=["codicon",`codicon-${i}`];return o&&a.push(n.ACTION_ITEM),r&&a.push(n.ANIMATION_SPIN),s.length>0&&a.push(...s),a}n.codiconCSSClasses=t})(yd)),yd}var ho={},Hg;function Jr(){if(Hg)return ho;Hg=1,Object.defineProperty(ho,"__esModule",{value:!0}),ho.getActualCode=ho.matchesKeystroke=void 0;const n=er();function e(o,r,...s){if(t(o)!==r)return!1;if((0,n.isMac)()){if(o.ctrlKey!==s.findIndex(a=>a==="ctrl")>=0||o.metaKey!==s.findIndex(a=>a==="meta"||a==="ctrlCmd")>=0)return!1}else if(o.ctrlKey!==s.findIndex(a=>a==="ctrl"||a==="ctrlCmd")>=0||o.metaKey!==s.findIndex(a=>a==="meta")>=0)return!1;return!(o.altKey!==s.findIndex(a=>a==="alt")>=0||o.shiftKey!==s.findIndex(a=>a==="shift")>=0)}ho.matchesKeystroke=e;function t(o){if(o.keyCode){const r=i[o.keyCode];if(r!==void 0)return r}return o.code}ho.getActualCode=t;const i=new Array(256);return(()=>{function o(r,s){i[s]===void 0&&(i[s]=r)}o("Pause",3),o("Backspace",8),o("Tab",9),o("Enter",13),o("ShiftLeft",16),o("ShiftRight",16),o("ControlLeft",17),o("ControlRight",17),o("AltLeft",18),o("AltRight",18),o("CapsLock",20),o("Escape",27),o("Space",32),o("PageUp",33),o("PageDown",34),o("End",35),o("Home",36),o("ArrowLeft",37),o("ArrowUp",38),o("ArrowRight",39),o("ArrowDown",40),o("Insert",45),o("Delete",46),o("Digit1",49),o("Digit2",50),o("Digit3",51),o("Digit4",52),o("Digit5",53),o("Digit6",54),o("Digit7",55),o("Digit8",56),o("Digit9",57),o("Digit0",48),o("KeyA",65),o("KeyB",66),o("KeyC",67),o("KeyD",68),o("KeyE",69),o("KeyF",70),o("KeyG",71),o("KeyH",72),o("KeyI",73),o("KeyJ",74),o("KeyK",75),o("KeyL",76),o("KeyM",77),o("KeyN",78),o("KeyO",79),o("KeyP",80),o("KeyQ",81),o("KeyR",82),o("KeyS",83),o("KeyT",84),o("KeyU",85),o("KeyV",86),o("KeyW",87),o("KeyX",88),o("KeyY",89),o("KeyZ",90),o("OSLeft",91),o("MetaLeft",91),o("OSRight",92),o("MetaRight",92),o("ContextMenu",93),o("Numpad0",96),o("Numpad1",97),o("Numpad2",98),o("Numpad3",99),o("Numpad4",100),o("Numpad5",101),o("Numpad6",102),o("Numpad7",103),o("Numpad8",104),o("Numpad9",105),o("NumpadMultiply",106),o("NumpadAdd",107),o("NumpadSeparator",108),o("NumpadSubtract",109),o("NumpadDecimal",110),o("NumpadDivide",111),o("F1",112),o("F2",113),o("F3",114),o("F4",115),o("F5",116),o("F6",117),o("F7",118),o("F8",119),o("F9",120),o("F10",121),o("F11",122),o("F12",123),o("F13",124),o("F14",125),o("F15",126),o("F16",127),o("F17",128),o("F18",129),o("F19",130),o("F20",131),o("F21",132),o("F22",133),o("F23",134),o("F24",135),o("NumLock",144),o("ScrollLock",145),o("Semicolon",186),o("Equal",187),o("Comma",188),o("Minus",189),o("Period",190),o("Slash",191),o("Backquote",192),o("IntlRo",193),o("BracketLeft",219),o("Backslash",220),o("BracketRight",221),o("Quote",222),o("IntlYen",255)})(),ho}var vd={},Kg;function zn(){return Kg||(Kg=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isSelected=n.isSelectable=n.selectFeature=void 0,n.selectFeature=Symbol("selectFeature");function e(i){return i.hasFeature(n.selectFeature)}n.isSelectable=e;function t(i){return i!==void 0&&e(i)&&i.selected}n.isSelected=t})(vd)),vd}var Wc={exports:{}},xE=Wc.exports,$g;function jE(){return $g||($g=1,(function(n,e){(function(t,i){n.exports=i()})(xE,(function(){function t(i){var o=document,r=i.container||o.createElement("div"),s=i.preventSubmit||0;r.id=r.id||"autocomplete-"+S();var a=r.style,u=i.debounceWaitMs||0,f=i.disableAutoSelect||!1,d=r.parentElement,c=[],l="",p=2,h=i.showOnFocus,g,m=0,y,b=!1,v=!1;if(i.minLength!==void 0&&(p=i.minLength),!i.input)throw new Error("input undefined");var _=i.input;r.className=[r.className,"autocomplete",i.className||""].join(" ").trim(),r.setAttribute("role","listbox"),_.setAttribute("role","combobox"),_.setAttribute("aria-expanded","false"),_.setAttribute("aria-autocomplete","list"),_.setAttribute("aria-controls",r.id),_.setAttribute("aria-owns",r.id),_.setAttribute("aria-activedescendant",""),_.setAttribute("aria-haspopup","listbox"),a.position="absolute";function S(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function E(){var Z=r.parentNode;Z&&Z.removeChild(r)}function O(){y&&window.clearTimeout(y)}function R(){r.parentNode||(d||o.body).appendChild(r)}function w(){return!!r.parentNode}function M(){m++,c=[],l="",g=void 0,_.setAttribute("aria-activedescendant",""),_.setAttribute("aria-expanded","false"),E()}function I(){if(!w())return;_.setAttribute("aria-expanded","true"),a.height="auto",a.width=_.offsetWidth+"px";var Z=0,ie;function he(){var Ae=o.documentElement,Oe=Ae.clientTop||o.body.clientTop||0,ye=Ae.clientLeft||o.body.clientLeft||0,Se=window.pageYOffset||Ae.scrollTop,Ie=window.pageXOffset||Ae.scrollLeft;ie=_.getBoundingClientRect();var pe=ie.top+_.offsetHeight+Se-Oe,Xe=ie.left+Ie-ye;a.top=pe+"px",a.left=Xe+"px",Z=window.innerHeight-(ie.top+_.offsetHeight),Z<0&&(Z=0),a.top=pe+"px",a.bottom="",a.left=Xe+"px",a.maxHeight=Z+"px"}he(),he(),i.customize&&ie&&i.customize(_,ie,r,Z)}function D(){r.textContent="",_.setAttribute("aria-activedescendant","");var Z=function(ye,Se,Ie){var pe=o.createElement("div");return pe.textContent=ye.label||"",pe};i.render&&(Z=i.render);var ie=function(ye,Se){var Ie=o.createElement("div");return Ie.textContent=ye,Ie};i.renderGroup&&(ie=i.renderGroup);var he=o.createDocumentFragment(),Ae=S();if(c.forEach(function(ye,Se){if(ye.group&&ye.group!==Ae){Ae=ye.group;var Ie=ie(ye.group,l);Ie&&(Ie.className+=" group",he.appendChild(Ie))}var pe=Z(ye,l,Se);pe&&(pe.id=r.id+"_"+Se,pe.setAttribute("role","option"),pe.addEventListener("click",function(Xe){v=!0;try{i.onSelect(ye,_)}finally{v=!1}M(),Xe.preventDefault(),Xe.stopPropagation()}),ye===g&&(pe.className+=" selected",pe.setAttribute("aria-selected","true"),_.setAttribute("aria-activedescendant",pe.id)),he.appendChild(pe))}),r.appendChild(he),c.length<1)if(i.emptyMsg){var Oe=o.createElement("div");Oe.id=r.id+"_"+S(),Oe.className="empty",Oe.textContent=i.emptyMsg,r.appendChild(Oe),_.setAttribute("aria-activedescendant",Oe.id)}else{M();return}R(),I(),U()}function C(){w()&&D()}function z(){C()}function G(Z){Z.target!==r?C():Z.preventDefault()}function N(){v||L(0)}function U(){var Z=r.getElementsByClassName("selected");if(Z.length>0){var ie=Z[0],he=ie.previousElementSibling;if(he&&he.className.indexOf("group")!==-1&&!he.previousElementSibling&&(ie=he),ie.offsetTop<r.scrollTop)r.scrollTop=ie.offsetTop;else{var Ae=ie.offsetTop+ie.offsetHeight,Oe=r.scrollTop+r.offsetHeight;Ae>Oe&&(r.scrollTop+=Ae-Oe)}}}function Q(){var Z=c.indexOf(g);g=Z===-1?void 0:c[(Z+c.length-1)%c.length],ce(Z)}function J(){var Z=c.indexOf(g);g=c.length<1?void 0:Z===-1?c[0]:c[(Z+1)%c.length],ce(Z)}function ce(Z){c.length>0&&(K(Z),we(c.indexOf(g)),U())}function we(Z){var ie=o.getElementById(r.id+"_"+Z);ie&&(ie.classList.add("selected"),ie.setAttribute("aria-selected","true"),_.setAttribute("aria-activedescendant",ie.id))}function K(Z){var ie=o.getElementById(r.id+"_"+Z);ie&&(ie.classList.remove("selected"),ie.removeAttribute("aria-selected"),_.removeAttribute("aria-activedescendant"))}function q(Z,ie){var he=w();if(ie==="Escape")M();else{if(!he||c.length<1)return;ie==="ArrowUp"?Q():J()}Z.preventDefault(),he&&Z.stopPropagation()}function ae(Z){if(g){s===2&&Z.preventDefault(),v=!0;try{i.onSelect(g,_)}finally{v=!1}M()}s===1&&Z.preventDefault()}function me(Z){var ie=Z.key;switch(ie){case"ArrowUp":case"ArrowDown":case"Escape":q(Z,ie);break;case"Enter":ae(Z);break}}function ve(){h&&L(1)}function L(Z){_.value.length>=p||Z===1?(O(),y=window.setTimeout(function(){return j(_.value,Z,_.selectionStart||0)},Z===0||Z===2?u:0)):M()}function j(Z,ie,he){if(!b){var Ae=++m;i.fetch(Z,function(Oe){m===Ae&&Oe&&(c=Oe,l=Z,g=c.length<1||f?void 0:c[0],D())},ie,he)}}function V(Z){if(i.keyup){i.keyup({event:Z,fetch:function(){return L(0)}});return}!w()&&Z.key==="ArrowDown"&&L(0)}function F(Z){i.click&&i.click({event:Z,fetch:function(){return L(2)}})}function X(){setTimeout(function(){o.activeElement!==_&&M()},200)}function ne(){j(_.value,3,_.selectionStart||0)}r.addEventListener("mousedown",function(Z){Z.stopPropagation(),Z.preventDefault()}),r.addEventListener("focus",function(){return _.focus()}),E();function re(){_.removeEventListener("focus",ve),_.removeEventListener("keyup",V),_.removeEventListener("click",F),_.removeEventListener("keydown",me),_.removeEventListener("input",N),_.removeEventListener("blur",X),window.removeEventListener("resize",z),o.removeEventListener("scroll",G,!0),_.removeAttribute("role"),_.removeAttribute("aria-expanded"),_.removeAttribute("aria-autocomplete"),_.removeAttribute("aria-controls"),_.removeAttribute("aria-activedescendant"),_.removeAttribute("aria-owns"),_.removeAttribute("aria-haspopup"),O(),M(),b=!0}return _.addEventListener("keyup",V),_.addEventListener("click",F),_.addEventListener("keydown",me),_.addEventListener("input",N),_.addEventListener("blur",X),_.addEventListener("focus",ve),window.addEventListener("resize",z),o.addEventListener("scroll",G,!0),{destroy:re,fetch:ne}}return t}))})(Wc)),Wc.exports}var Yg;function V_(){if(Yg)return Sn;Yg=1;var n=Sn&&Sn.__decorate||function(R,w,M,I){var D=arguments.length,C=D<3?w:I===null?I=Object.getOwnPropertyDescriptor(w,M):I,z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(R,w,M,I);else for(var G=R.length-1;G>=0;G--)(z=R[G])&&(C=(D<3?z(C):D>3?z(w,M,C):z(w,M))||C);return D>3&&C&&Object.defineProperty(w,M,C),C},e=Sn&&Sn.__metadata||function(R,w){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(R,w)},t=Sn&&Sn.__importDefault||function(R){return R&&R.__esModule?R:{default:R}},i;Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.CommandPaletteKeyListener=Sn.CommandPalette=void 0;const o=se(),r=qe(),s=Ol(),a=ge(),u=jl(),f=Iu(),d=Oa(),c=Pr(),l=B_(),p=os(),h=Jr(),g=tt(),m=zn(),y=ql(),b=ni(),v=t(jE());let _=i=class extends u.AbstractUIExtension{constructor(){super(...arguments),this.loadingIndicatorClasses=(0,l.codiconCSSClasses)("loading",!1,!0,["loading"]),this.xOffset=20,this.yOffset=20,this.defaultWidth=400,this.debounceWaitMs=100,this.noCommandsMsg="No commands available",this.paletteIndex=0}id(){return i.ID}containerClass(){return"command-palette"}show(w,...M){super.show(w,...M),this.paletteIndex=0,this.contextActions=void 0,this.inputElement.value="",this.autoCompleteResult=(0,v.default)(this.autocompleteSettings(w)),this.inputElement.focus()}initializeContents(w){w.style.position="absolute",this.inputElement=document.createElement("input"),this.inputElement.style.width="100%",this.inputElement.addEventListener("keydown",M=>this.hideIfEscapeEvent(M)),this.inputElement.addEventListener("keydown",M=>this.cylceIfInvokePaletteKey(M)),this.inputElement.onblur=()=>window.setTimeout(()=>this.hide(),200),w.appendChild(this.inputElement)}hideIfEscapeEvent(w){(0,h.matchesKeystroke)(w,"Escape")&&this.hide()}cylceIfInvokePaletteKey(w){i.isInvokePaletteKey(w)&&this.cycle()}cycle(){this.contextActions=void 0,this.paletteIndex++}onBeforeShow(w,M,...I){let D=this.xOffset,C=this.yOffset;const z=(0,p.toArray)(M.index.all().filter(G=>(0,m.isSelectable)(G)&&G.selected));if(z.length===1){const G=(0,g.getAbsoluteClientBounds)(z[0],this.domHelper,this.viewerOptions);D+=G.x+G.width,C+=G.y}else{const G=(0,g.getAbsoluteClientBounds)(M,this.domHelper,this.viewerOptions);D+=G.x,C+=G.y}w.style.left=`${D}px`,w.style.top=`${C}px`,w.style.width=`${this.defaultWidth}px`}autocompleteSettings(w){return{input:this.inputElement,emptyMsg:this.noCommandsMsg,className:"command-palette-suggestions",debounceWaitMs:this.debounceWaitMs,showOnFocus:!0,minLength:-1,fetch:(M,I)=>this.updateAutoCompleteActions(I,M,w),onSelect:M=>this.onSelect(M),render:(M,I)=>this.renderLabeledActionSuggestion(M,I),customize:(M,I,D,C)=>{this.customizeSuggestionContainer(D,I,C)}}}onSelect(w){this.executeAction(w),this.hide()}updateAutoCompleteActions(w,M,I){this.onLoading(),this.contextActions?(w(this.filterActions(M,this.contextActions)),this.onLoaded("success")):this.actionProviderRegistry.getActions(I,M,this.mousePositionTracker.lastPositionOnDiagram,this.paletteIndex).then(D=>{this.contextActions=D,w(this.filterActions(M,D)),this.onLoaded("success")}).catch(D=>{this.logger.error(this,"Failed to obtain actions from command palette action providers",D),this.onLoaded("error")})}onLoading(){this.loadingIndicator&&this.containerElement.contains(this.loadingIndicator)||(this.loadingIndicator=document.createElement("span"),this.loadingIndicator.classList.add(...this.loadingIndicatorClasses),this.containerElement.appendChild(this.loadingIndicator))}onLoaded(w){this.containerElement.contains(this.loadingIndicator)&&this.containerElement.removeChild(this.loadingIndicator)}renderLabeledActionSuggestion(w,M){const I=document.createElement("div"),D=E(M).split(" ").join("|"),C=new RegExp(D,"gi");return w.icon&&this.renderIcon(I,w.icon),M.length>0?I.innerHTML+=w.label.replace(C,z=>"<em>"+z+"</em>").replace(/ /g,"&nbsp;"):I.innerHTML+=w.label.replace(/ /g,"&nbsp;"),I}renderIcon(w,M){w.innerHTML+=`<span class="icon ${this.getCodicon(M)}"></span>`}getFontAwesomeIcon(w){return`fa fa-${w}`}getCodicon(w){return(0,l.codiconCSSString)(w)}filterActions(w,M){return(0,p.toArray)(M.filter(I=>{const D=I.label.toLowerCase();return w.split(" ").every(z=>D.indexOf(z.toLowerCase())!==-1)}))}customizeSuggestionContainer(w,M,I){w.style.position="fixed",this.containerElement&&this.containerElement.appendChild(w)}hide(){super.hide(),this.autoCompleteResult&&this.autoCompleteResult.destroy()}executeAction(w){this.actionDispatcherProvider().then(M=>M.dispatchAll(S(w))).catch(M=>this.logger.error(this,"No action dispatcher available to execute command palette action",M))}};Sn.CommandPalette=_,_.ID="command-palette",_.isInvokePaletteKey=R=>(0,h.matchesKeystroke)(R,"Space","ctrl"),n([(0,o.inject)(a.TYPES.IActionDispatcherProvider),e("design:type",Function)],_.prototype,"actionDispatcherProvider",void 0),n([(0,o.inject)(a.TYPES.ICommandPaletteActionProviderRegistry),e("design:type",y.CommandPaletteActionProviderRegistry)],_.prototype,"actionProviderRegistry",void 0),n([(0,o.inject)(a.TYPES.ViewerOptions),e("design:type",Object)],_.prototype,"viewerOptions",void 0),n([(0,o.inject)(a.TYPES.DOMHelper),e("design:type",d.DOMHelper)],_.prototype,"domHelper",void 0),n([(0,o.inject)(b.MousePositionTracker),e("design:type",b.MousePositionTracker)],_.prototype,"mousePositionTracker",void 0),Sn.CommandPalette=_=i=n([(0,o.injectable)()],_);function S(R){return(0,s.isLabeledAction)(R)?R.actions:(0,r.isAction)(R)?[R]:[]}function E(R){return R.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}class O extends c.KeyListener{keyDown(w,M){if((0,h.matchesKeystroke)(M,"Escape"))return[f.SetUIExtensionVisibilityAction.create({extensionId:_.ID,visible:!1,contextElementsId:[]})];if(_.isInvokePaletteKey(M)){const I=(0,p.toArray)(w.index.all().filter(D=>(0,m.isSelectable)(D)&&D.selected).map(D=>D.id));return[f.SetUIExtensionVisibilityAction.create({extensionId:_.ID,visible:!0,contextElementsId:I})]}return[]}}return Sn.CommandPaletteKeyListener=O,Sn}var $s={},kg;function LE(){if(kg)return $s;kg=1,Object.defineProperty($s,"__esModule",{value:!0}),$s.toAnchor=void 0;function n(e){return e instanceof HTMLElement?{x:e.offsetLeft,y:e.offsetTop}:e}return $s.toAnchor=n,$s}var ln={},dr={},Ug;function Da(){return Ug||(Ug=1,(function(n){var e=dr&&dr.__decorate||function(l,p,h,g){var m=arguments.length,y=m<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,h):g,b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(l,p,h,g);else for(var v=l.length-1;v>=0;v--)(b=l[v])&&(y=(m<3?b(y):m>3?b(p,h,y):b(p,h))||y);return m>3&&y&&Object.defineProperty(p,h,y),y},t=dr&&dr.__metadata||function(l,p){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(l,p)},i=dr&&dr.__param||function(l,p){return function(h,g){p(h,g,l)}};Object.defineProperty(n,"__esModule",{value:!0}),n.DeleteElementCommand=n.ResolvedDelete=n.isDeletable=n.deletableFeature=void 0;const o=se(),r=qe(),s=gt(),a=Ke(),u=ge();n.deletableFeature=Symbol("deletableFeature");function f(l){return l instanceof a.SChildElementImpl&&l.hasFeature(n.deletableFeature)}n.isDeletable=f;class d{}n.ResolvedDelete=d;let c=class extends s.Command{constructor(p){super(),this.action=p,this.resolvedDeletes=[]}execute(p){const h=p.root.index;for(const g of this.action.elementIds){const m=h.getById(g);m&&f(m)&&(this.resolvedDeletes.push({child:m,parent:m.parent}),m.parent.remove(m))}return p.root}undo(p){for(const h of this.resolvedDeletes)h.parent.add(h.child);return p.root}redo(p){for(const h of this.resolvedDeletes)h.parent.remove(h.child);return p.root}};n.DeleteElementCommand=c,c.KIND=r.DeleteElementAction.KIND,n.DeleteElementCommand=c=e([(0,o.injectable)(),i(0,(0,o.inject)(u.TYPES.Action)),t("design:paramtypes",[Object])],c)})(dr)),dr}var Gg;function Hl(){if(Gg)return ln;Gg=1;var n=ln&&ln.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g},e=ln&&ln.__metadata||function(d,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(d,c)},t=ln&&ln.__param||function(d,c){return function(l,p){c(l,p,d)}};Object.defineProperty(ln,"__esModule",{value:!0}),ln.DeleteContextMenuItemProvider=ln.ContextMenuProviderRegistry=void 0;const i=se(),o=ge(),r=Da(),s=zn(),a=ti();let u=class{constructor(c=[]){this.menuProviders=c}getItems(c,l){const p=this.menuProviders.map(h=>h.getItems(c,l));return Promise.all(p).then(this.flattenAndRestructure)}flattenAndRestructure(c){let l=c.reduce((h,g)=>g!==void 0?h.concat(g):h,[]);const p=l.filter(h=>h.parentId);for(const h of p)if(h.parentId){const g=h.parentId.split(".");let m,y=l;for(const b of g)m=y.find(v=>b===v.id),m&&m.children&&(y=m.children);m&&(m.children?m.children.push(h):m.children=[h],l=l.filter(b=>b!==h))}return l}};ln.ContextMenuProviderRegistry=u,ln.ContextMenuProviderRegistry=u=n([(0,i.injectable)(),t(0,(0,i.multiInject)(o.TYPES.IContextMenuItemProvider)),t(0,(0,i.optional)()),e("design:paramtypes",[Array])],u);let f=class{getItems(c,l){const p=Array.from(c.index.all().filter(s.isSelected).filter(r.isDeletable));return Promise.resolve([{id:"delete",label:"Delete",sortString:"d",group:"edit",actions:[a.DeleteElementAction.create(p.map(h=>h.id))],isEnabled:()=>p.length>0}])}};return ln.DeleteContextMenuItemProvider=f,ln.DeleteContextMenuItemProvider=f=n([(0,i.injectable)()],f),ln}var Un={},Xg;function z_(){if(Xg)return Un;Xg=1;var n=Un&&Un.__decorate||function(c,l,p,h){var g=arguments.length,m=g<3?l:h===null?h=Object.getOwnPropertyDescriptor(l,p):h,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(c,l,p,h);else for(var b=c.length-1;b>=0;b--)(y=c[b])&&(m=(g<3?y(m):g>3?y(l,p,m):y(l,p))||m);return g>3&&m&&Object.defineProperty(l,p,m),m},e=Un&&Un.__metadata||function(c,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(c,l)},t=Un&&Un.__param||function(c,l){return function(p,h){l(p,h,c)}};Object.defineProperty(Un,"__esModule",{value:!0}),Un.ContextMenuMouseListener=void 0;const i=se(),o=qe(),r=tn(),s=ge(),a=ni(),u=zn(),f=Hl();let d=class extends a.MouseListener{constructor(l,p){super(),this.contextMenuService=l,this.menuProvider=p}contextMenu(l,p){return this.showContextMenu(l,p),[]}async showContextMenu(l,p){let h;try{h=await this.contextMenuService()}catch{return}let g=!1;const m=(0,r.findParentByFeature)(l,u.isSelectable);m&&(g=m.selected,m.selected=!0);const y=l.root,b={x:p.x,y:p.y};if(l.id===y.id||(0,u.isSelected)(m)){const v=await this.menuProvider.getItems(y,b),_=()=>{m&&(m.selected=g)};h.show(v,b,_)}else{if((0,u.isSelectable)(l)){const _={selectedElementsIDs:[l.id],deselectedElementsIDs:Array.from(y.index.all().filter(u.isSelected),S=>S.id)};await this.actionDispatcher.dispatch(o.SelectAction.create(_))}const v=await this.menuProvider.getItems(y,b);h.show(v,b)}}};return Un.ContextMenuMouseListener=d,n([(0,i.inject)(s.TYPES.IActionDispatcher),e("design:type",Object)],d.prototype,"actionDispatcher",void 0),Un.ContextMenuMouseListener=d=n([t(0,(0,i.inject)(s.TYPES.IContextMenuServiceProvider)),t(1,(0,i.inject)(s.TYPES.IContextMenuProviderRegistry)),e("design:paramtypes",[Function,f.ContextMenuProviderRegistry])],d),Un}var Mc={},Bi={},Ut={},_d={},bd={},Sd={},Wg;function cs(){return Wg||(Wg=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.hasPopupFeature=n.popupFeature=n.isHoverable=n.hoverFeedbackFeature=void 0,n.hoverFeedbackFeature=Symbol("hoverFeedbackFeature");function e(i){return i.hasFeature(n.hoverFeedbackFeature)}n.isHoverable=e,n.popupFeature=Symbol("popupFeature");function t(i){return i.hasFeature(n.popupFeature)}n.hasPopupFeature=t})(Sd)),Sd}var wd={},Zg;function Qr(){return Zg||(Zg=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isMoveable=n.isLocateable=n.moveFeature=void 0;const e=Wr();n.moveFeature=Symbol("moveFeature");function t(o){return(0,e.hasOwnProperty)(o,"position")}n.isLocateable=t;function i(o){return o.hasFeature(n.moveFeature)&&t(o)}n.isMoveable=i})(wd)),wd}var Jg;function pt(){return Jg||(Jg=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.edgeInProgressTargetHandleID=n.edgeInProgressID=n.SDanglingAnchorImpl=n.SRoutingHandleImpl=n.SConnectableElementImpl=n.getRouteBounds=n.getAbsoluteRouteBounds=n.isConnectable=n.connectableFeature=n.SRoutableElementImpl=void 0;const e=He(),t=Ke(),i=tt(),o=Da(),r=zn(),s=cs(),a=Qr();class u extends t.SChildElementImpl{constructor(){super(...arguments),this.routingPoints=[]}get source(){return this.index.getById(this.sourceId)}get target(){return this.index.getById(this.targetId)}get bounds(){return this.routingPoints.reduce((m,y)=>e.Bounds.combine(m,{x:y.x,y:y.y,width:0,height:0}),e.Bounds.EMPTY)}}n.SRoutableElementImpl=u,n.connectableFeature=Symbol("connectableFeature");function f(g){return g.hasFeature(n.connectableFeature)&&g.canConnect}n.isConnectable=f;function d(g,m=g.routingPoints){let y=c(m),b=g;for(;b instanceof t.SChildElementImpl;){const v=b.parent;y=v.localToParent(y),b=v}return y}n.getAbsoluteRouteBounds=d;function c(g){const m={x:NaN,y:NaN,width:0,height:0};for(const y of g)isNaN(m.x)?(m.x=y.x,m.y=y.y):(y.x<m.x?(m.width+=m.x-y.x,m.x=y.x):y.x>m.x+m.width&&(m.width=y.x-m.x),y.y<m.y?(m.height+=m.y-y.y,m.y=y.y):y.y>m.y+m.height&&(m.height=y.y-m.y));return m}n.getRouteBounds=c;class l extends i.SShapeElementImpl{constructor(){super(...arguments),this.strokeWidth=0}get anchorKind(){}get incomingEdges(){return this.index.all().filter(y=>y instanceof u).filter(y=>y.targetId===this.id)}get outgoingEdges(){return this.index.all().filter(y=>y instanceof u).filter(y=>y.sourceId===this.id)}canConnect(m,y){return!0}}n.SConnectableElementImpl=l;class p extends t.SChildElementImpl{constructor(){super(...arguments),this.editMode=!1,this.hoverFeedback=!1,this.selected=!1}hasFeature(m){return p.DEFAULT_FEATURES.indexOf(m)!==-1}}n.SRoutingHandleImpl=p,p.DEFAULT_FEATURES=[r.selectFeature,a.moveFeature,s.hoverFeedbackFeature];class h extends l{constructor(){super(),this.type="dangling-anchor",this.size={width:0,height:0}}}n.SDanglingAnchorImpl=h,h.DEFAULT_FEATURES=[o.deletableFeature],n.edgeInProgressID="edge-in-progress",n.edgeInProgressTargetHandleID=n.edgeInProgressID+"-target-anchor"})(bd)),bd}var Qg;function xa(){return Qg||(Qg=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.DEFAULT_EDGE_PLACEMENT=n.EdgePlacement=n.checkEdgePlacement=n.isEdgeLayoutable=n.edgeLayoutFeature=void 0;const e=Ke(),t=tt(),i=pt();n.edgeLayoutFeature=Symbol("edgeLayout");function o(a){return a instanceof e.SChildElementImpl&&a.parent instanceof i.SRoutableElementImpl&&(0,t.isBoundsAware)(a)&&a.hasFeature(n.edgeLayoutFeature)}n.isEdgeLayoutable=o;function r(a){return"edgePlacement"in a}n.checkEdgePlacement=r;class s extends Object{}n.EdgePlacement=s,n.DEFAULT_EDGE_PLACEMENT={rotate:!0,side:"top",position:.5,offset:7}})(_d)),_d}var Ed={},em;function ja(){return em||(em=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isWithEditableLabel=n.withEditLabelFeature=n.isEditableLabel=n.editLabelFeature=n.canEditRouting=n.editFeature=void 0;const e=pt();n.editFeature=Symbol("editFeature");function t(r){return r instanceof e.SRoutableElementImpl&&r.hasFeature(n.editFeature)}n.canEditRouting=t,n.editLabelFeature=Symbol("editLabelFeature");function i(r){return"text"in r&&r.hasFeature(n.editLabelFeature)}n.isEditableLabel=i,n.withEditLabelFeature=Symbol("withEditLabelFeature");function o(r){return"editableLabel"in r&&r.hasFeature(n.withEditLabelFeature)}n.isWithEditableLabel=o})(Ed)),Ed}var Ys={},Pd={},pi={},tm;function eo(){if(tm)return pi;tm=1,Object.defineProperty(pi,"__esModule",{value:!0}),pi.limit=pi.intersection=pi.PointToPointLine=pi.Diamond=void 0;const n=ti();class e{constructor(s){this.bounds=s}get topPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y}}get rightPoint(){return{x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2}}get bottomPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y+this.bounds.height}}get leftPoint(){return{x:this.bounds.x,y:this.bounds.y+this.bounds.height/2}}get topRightSideLine(){return new t(this.topPoint,this.rightPoint)}get topLeftSideLine(){return new t(this.topPoint,this.leftPoint)}get bottomRightSideLine(){return new t(this.bottomPoint,this.rightPoint)}get bottomLeftSideLine(){return new t(this.bottomPoint,this.leftPoint)}closestSideLine(s){const a=n.Bounds.center(this.bounds);return s.x>a.x?s.y>a.y?this.bottomRightSideLine:this.topRightSideLine:s.y>a.y?this.bottomLeftSideLine:this.topLeftSideLine}}pi.Diamond=e;class t{constructor(s,a){this.p1=s,this.p2=a}get a(){return this.p1.y-this.p2.y}get b(){return this.p2.x-this.p1.x}get c(){return this.p2.x*this.p1.y-this.p1.x*this.p2.y}get angle(){return Math.atan2(-this.a,this.b)}get slope(){if(this.b!==0)return this.a/this.b}get slopeOrMax(){return this.slope===void 0?Number.MAX_SAFE_INTEGER:this.slope}get direction(){const s=(0,n.toDegrees)(this.angle),a=s<0?360+s:s;if(a===90)return"south";if(a===0||a===360)return"east";if(a===270)return"north";if(a===180)return"west";if(a>0&&a<90)return"south-east";if(a>90&&a<180)return"south-west";if(a>180&&a<270)return"north-west";if(a>270&&a<360)return"north-east";throw new Error(`Cannot determine direction of line (${this.p1.x},${this.p1.y}) to (${this.p2.x},${this.p2.y})`)}intersection(s){if(this.hasIndistinctPoints(s))return;const a=this.p1.x,u=this.p1.y,f=this.p2.x,d=this.p2.y,c=s.p1.x,l=s.p1.y,p=s.p2.x,h=s.p2.y,g=(h-l)*(f-a)-(p-c)*(d-u);if(g===0)return;const m=(p-c)*(u-l)-(h-l)*(a-c),y=(f-a)*(u-l)-(d-u)*(a-c);if(m===0&&y===0)return;const b=m/g,v=y/g;if(b<0||b>1||v<0||v>1)return;const _=a+b*(f-a),S=u+b*(d-u);return{x:_,y:S}}hasIndistinctPoints(s){return n.Point.equals(this.p1,s.p1)||n.Point.equals(this.p1,s.p2)||n.Point.equals(this.p2,s.p1)||n.Point.equals(this.p2,s.p2)}}pi.PointToPointLine=t;function i(r,s){return{x:(r.c*s.b-s.c*r.b)/(r.a*s.b-s.a*r.b),y:(r.a*s.c-s.a*r.c)/(r.a*s.b-s.a*r.b)}}pi.intersection=i;function o(r,s){return r<s.min?s.min:r>s.max?s.max:r}return pi.limit=o,pi}var nm;function Mr(){return nm||(nm=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.limitViewport=n.isViewport=n.viewportFeature=void 0;const e=ti(),t=Ke(),i=eo();n.viewportFeature=Symbol("viewportFeature");function o(s){return s instanceof t.SModelRootImpl&&s.hasFeature(n.viewportFeature)&&"zoom"in s&&"scroll"in s}n.isViewport=o;function r(s,a,u,f,d){a&&!e.Dimension.isValid(a)&&(a=void 0);let c=d?(0,i.limit)(s.zoom,d):s.zoom;if(a&&u){const h=a.width/(u.max-u.min);c<h&&(c=h)}if(a&&f){const h=a.height/(f.max-f.min);c<h&&(c=h)}let l;if(u){const h=u.min,g=a?u.max-a.width/c:u.max;l=(0,i.limit)(s.scroll.x,{min:h,max:g})}else l=s.scroll.x;let p;if(f){const h=f.min,g=a?f.max-a.height/c:f.max;p=(0,i.limit)(s.scroll.y,{min:h,max:g})}else p=s.scroll.y;return{scroll:{x:l,y:p},zoom:c}}n.limitViewport=r})(Pd)),Pd}var Md={},im;function Kl(){return im||(im=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isExportable=n.exportFeature=void 0,n.exportFeature=Symbol("exportFeature");function e(t){return t.hasFeature(n.exportFeature)}n.isExportable=e})(Md)),Md}var rm;function $l(){if(rm)return Ys;rm=1,Object.defineProperty(Ys,"__esModule",{value:!0}),Ys.ViewportRootElementImpl=void 0;const n=He(),e=Ke(),t=Mr(),i=Kl();class o extends e.SModelRootImpl{constructor(s){super(s),this.scroll={x:0,y:0},this.zoom=1,this.position=n.Point.ORIGIN,this.size=n.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(s){this.position={x:s.x,y:s.y},this.size={width:s.width,height:s.height}}localToParent(s){const a={x:(s.x-this.scroll.x)*this.zoom,y:(s.y-this.scroll.y)*this.zoom,width:-1,height:-1};return(0,n.isBounds)(s)&&(a.width=s.width*this.zoom,a.height=s.height*this.zoom),a}parentToLocal(s){const a={x:s.x/this.zoom+this.scroll.x,y:s.y/this.zoom+this.scroll.y,width:-1,height:-1};return(0,n.isBounds)(s)&&n.Dimension.isValid(s)&&(a.width=s.width/this.zoom,a.height=s.height/this.zoom),a}}return Ys.ViewportRootElementImpl=o,o.DEFAULT_FEATURES=[t.viewportFeature,i.exportFeature],Ys}var om;function us(){if(om)return Ut;om=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.SGraphIndex=Ut.SCompartmentImpl=Ut.SLabelImpl=Ut.SEdgeImpl=Ut.SPortImpl=Ut.SNodeImpl=Ut.SGraphImpl=void 0;const n=He(),e=Ke(),t=tt(),i=xa(),o=Da(),r=ja(),s=Ta(),a=cs(),u=Qr(),f=pt(),d=zn(),c=$l(),l=os();class p extends c.ViewportRootElementImpl{constructor(S=new v){super(S)}}Ut.SGraphImpl=p;class h extends f.SConnectableElementImpl{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}canConnect(S,E){return this.children.find(O=>O instanceof g)===void 0}get incomingEdges(){const S=this.index;return S instanceof v?S.getIncomingEdges(this):this.index.all().filter(O=>O instanceof m).filter(O=>O.targetId===this.id)}get outgoingEdges(){const S=this.index;return S instanceof v?S.getOutgoingEdges(this):this.index.all().filter(O=>O instanceof m).filter(O=>O.sourceId===this.id)}}Ut.SNodeImpl=h,h.DEFAULT_FEATURES=[f.connectableFeature,o.deletableFeature,d.selectFeature,t.boundsFeature,u.moveFeature,t.layoutContainerFeature,s.fadeFeature,a.hoverFeedbackFeature,a.popupFeature];class g extends f.SConnectableElementImpl{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}get incomingEdges(){const S=this.index;return S instanceof v?S.getIncomingEdges(this):super.incomingEdges.filter(E=>E instanceof m)}get outgoingEdges(){const S=this.index;return S instanceof v?S.getOutgoingEdges(this):super.outgoingEdges.filter(E=>E instanceof m)}}Ut.SPortImpl=g,g.DEFAULT_FEATURES=[f.connectableFeature,d.selectFeature,t.boundsFeature,s.fadeFeature,a.hoverFeedbackFeature];class m extends f.SRoutableElementImpl{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}}Ut.SEdgeImpl=m,m.DEFAULT_FEATURES=[r.editFeature,o.deletableFeature,d.selectFeature,s.fadeFeature,a.hoverFeedbackFeature];class y extends t.SShapeElementImpl{constructor(){super(...arguments),this.selected=!1,this.alignment=n.Point.ORIGIN,this.opacity=1}}Ut.SLabelImpl=y,y.DEFAULT_FEATURES=[t.boundsFeature,t.alignFeature,t.layoutableChildFeature,i.edgeLayoutFeature,s.fadeFeature];class b extends t.SShapeElementImpl{constructor(){super(...arguments),this.opacity=1}}Ut.SCompartmentImpl=b,b.DEFAULT_FEATURES=[t.boundsFeature,t.layoutContainerFeature,t.layoutableChildFeature,s.fadeFeature];class v extends e.ModelIndexImpl{constructor(){super(...arguments),this.outgoing=new Map,this.incoming=new Map}add(S){if(super.add(S),S instanceof m){if(S.sourceId){const E=this.outgoing.get(S.sourceId);E===void 0?this.outgoing.set(S.sourceId,[S]):E.push(S)}if(S.targetId){const E=this.incoming.get(S.targetId);E===void 0?this.incoming.set(S.targetId,[S]):E.push(S)}}}remove(S){if(super.remove(S),S instanceof m){const E=this.outgoing.get(S.sourceId);if(E!==void 0){const R=E.indexOf(S);R>=0&&(E.length===1?this.outgoing.delete(S.sourceId):E.splice(R,1))}const O=this.incoming.get(S.targetId);if(O!==void 0){const R=O.indexOf(S);R>=0&&(O.length===1?this.incoming.delete(S.targetId):O.splice(R,1))}}}getAttachedElements(S){return new l.FluentIterableImpl(()=>({outgoing:this.outgoing.get(S.id),incoming:this.incoming.get(S.id),nextOutgoingIndex:0,nextIncomingIndex:0}),E=>{let O=E.nextOutgoingIndex;if(E.outgoing!==void 0&&O<E.outgoing.length)return E.nextOutgoingIndex=O+1,{done:!1,value:E.outgoing[O]};if(O=E.nextIncomingIndex,E.incoming!==void 0)for(;O<E.incoming.length;){const R=E.incoming[O];if(R.sourceId!==R.targetId)return E.nextIncomingIndex=O+1,{done:!1,value:R};O++}return{done:!0,value:void 0}})}getIncomingEdges(S){return this.incoming.get(S.id)||[]}getOutgoingEdges(S){return this.outgoing.get(S.id)||[]}}return Ut.SGraphIndex=v,Ut}var wn={},Vi={},lr={},sm;function to(){return sm||(sm=1,(function(n){var e=lr&&lr.__decorate||function(u,f,d,c){var l=arguments.length,p=l<3?f:c===null?c=Object.getOwnPropertyDescriptor(f,d):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(u,f,d,c);else for(var g=u.length-1;g>=0;g--)(h=u[g])&&(p=(l<3?h(p):l>3?h(f,d,p):h(f,d))||p);return l>3&&p&&Object.defineProperty(f,d,p),p},t=lr&&lr.__metadata||function(u,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(u,f)},i=lr&&lr.__param||function(u,f){return function(d,c){f(d,c,u)}};Object.defineProperty(n,"__esModule",{value:!0}),n.AnchorComputerRegistry=n.RECTANGULAR_ANCHOR_KIND=n.ELLIPTIC_ANCHOR_KIND=n.DIAMOND_ANCHOR_KIND=void 0;const o=se(),r=ge(),s=Er();n.DIAMOND_ANCHOR_KIND="diamond",n.ELLIPTIC_ANCHOR_KIND="elliptic",n.RECTANGULAR_ANCHOR_KIND="rectangular";let a=class extends s.InstanceRegistry{constructor(f){super(),f.forEach(d=>this.register(d.kind,d))}get defaultAnchorKind(){return n.RECTANGULAR_ANCHOR_KIND}get(f,d){return super.get(`${f}:${d||this.defaultAnchorKind}`)}};n.AnchorComputerRegistry=a,n.AnchorComputerRegistry=a=e([(0,o.injectable)(),i(0,(0,o.multiInject)(r.TYPES.IAnchorComputer)),t("design:paramtypes",[Array])],a)})(lr)),lr}var En={},am;function xu(){if(am)return En;am=1;var n=En&&En.__decorate||function(c,l,p,h){var g=arguments.length,m=g<3?l:h===null?h=Object.getOwnPropertyDescriptor(l,p):h,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(c,l,p,h);else for(var b=c.length-1;b>=0;b--)(y=c[b])&&(m=(g<3?y(m):g>3?y(l,p,m):y(l,p))||m);return g>3&&m&&Object.defineProperty(l,p,m),m},e=En&&En.__metadata||function(c,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(c,l)};Object.defineProperty(En,"__esModule",{value:!0}),En.AbstractEdgeRouter=En.DefaultAnchors=En.Side=void 0;const t=se(),i=He(),o=tn(),r=pt(),s=to(),a=pt();var u;(function(c){c[c.RIGHT=0]="RIGHT",c[c.LEFT=1]="LEFT",c[c.TOP=2]="TOP",c[c.BOTTOM=3]="BOTTOM"})(u||(En.Side=u={}));class f{constructor(l,p,h){this.element=l,this.kind=h;const g=l.bounds;this.bounds=(0,o.translateBounds)(g,l.parent,p),this.left={x:this.bounds.x,y:this.bounds.y+.5*this.bounds.height,kind:h},this.right={x:this.bounds.x+this.bounds.width,y:this.bounds.y+.5*this.bounds.height,kind:h},this.top={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y,kind:h},this.bottom={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y+this.bounds.height,kind:h}}get(l){return this[u[l].toLowerCase()]}getNearestSide(l){const p=i.Point.euclideanDistance(l,this.left),h=i.Point.euclideanDistance(l,this.right),g=i.Point.euclideanDistance(l,this.top),m=i.Point.euclideanDistance(l,this.bottom);let y=u.LEFT,b=p;return h<b&&(b=h,y=u.RIGHT),g<b&&(b=g,y=u.TOP),m<b&&(b=m,y=u.BOTTOM),y}}En.DefaultAnchors=f;let d=class{findOrthogonalIntersection(l,p){const h=(v,_)=>{const S=i.Point.subtract(_,v),E=i.Point.subtract(p,v),O=i.Point.dotProduct(E,S)/i.Point.dotProduct(S,S);return O>=0&&O<=1?i.Point.linear(v,_,O):O<0?v:_},g=this.route(l);let m=g[0],y=0;for(let v=0;v<g.length-1;++v){const _=h(g[v],g[v+1]);i.Point.euclideanDistance(p,_)<i.Point.euclideanDistance(p,m)&&(m=_,y=v)}const b=i.Point.subtract(g[y+1],g[y]);return{point:m,derivative:b}}pointAt(l,p){const h=this.calculateSegment(l,p);if(!h)return;const{segmentStart:g,segmentEnd:m,lambda:y}=h;return i.Point.linear(g,m,y)}derivativeAt(l,p){const h=this.calculateSegment(l,p);if(!h)return;const{segmentStart:g,segmentEnd:m}=h;return{x:m.x-g.x,y:m.y-g.y}}calculateSegment(l,p){if(p<0||p>1)return;const h=this.route(l);if(h.length<2)return;const g=[];let m=0;for(let v=0;v<h.length-1;++v)g[v]=i.Point.euclideanDistance(h[v],h[v+1]),m+=g[v];let y=0;const b=p*m;for(let v=0;v<h.length-1;++v){const _=y+g[v];if(g[v]>1e-8&&_>=b){const S=Math.max(0,b-y)/g[v];return{segmentStart:h[v],segmentEnd:h[v+1],lambda:S}}y=_}return{segmentEnd:h.pop(),segmentStart:h.pop(),lambda:1}}addHandle(l,p,h,g){const m=new r.SRoutingHandleImpl;return m.kind=p,m.pointIndex=g,m.type=h,p==="target"&&l.id===r.edgeInProgressID&&(m.id=r.edgeInProgressTargetHandleID),l.add(m),m}getHandlePosition(l,p,h){switch(h.kind){case"source":return l.source instanceof r.SDanglingAnchorImpl?l.source.position:p[0];case"target":return l.target instanceof r.SDanglingAnchorImpl?l.target.position:p[p.length-1];default:const g=this.getInnerHandlePosition(l,p,h);if(g!==void 0)return g;if(h.pointIndex>=0&&h.pointIndex<l.routingPoints.length)return l.routingPoints[h.pointIndex]}}findRouteSegment(l,p,h){const g=b=>b.pointIndex!==void 0?b.pointIndex:b.kind==="target"?l.routingPoints.length:-2;let m,y;for(const b of p){const v=g(b);v<=h&&(m===void 0||v>g(m))&&(m=b),v>h&&(y===void 0||v<g(y))&&(y=b)}return{start:m,end:y}}getTranslatedAnchor(l,p,h,g,m=0){const y=(0,o.translatePoint)(p,h,l.parent),b=this.getAnchorComputer(l),v=.5*l.strokeWidth,_=b.getAnchor(l,y,m+v);return(0,o.translatePoint)(_,l.parent,g.parent)}getAnchorComputer(l){return this.anchorRegistry.get(this.kind,l.anchorKind)}applyHandleMoves(l,p){const h=p.slice();p.forEach(g=>{const m=g.handle;if(m.kind==="source"&&!(l.source instanceof r.SDanglingAnchorImpl)){const y=new r.SDanglingAnchorImpl;y.id=l.id+"_dangling-source",y.original=l.source,y.position=g.toPosition,m.root.add(y),m.danglingAnchor=y,l.sourceId=y.id}else if(m.kind==="target"&&!(l.target instanceof r.SDanglingAnchorImpl)){const y=new r.SDanglingAnchorImpl;y.id=l.id+"_dangling-target",y.original=l.target,y.position=g.toPosition,m.root.add(y),m.danglingAnchor=y,l.targetId=y.id}m.danglingAnchor&&(m.danglingAnchor.position=g.toPosition,h.splice(h.indexOf(g),1))}),h.length>0&&this.applyInnerHandleMoves(l,h),this.cleanupRoutingPoints(l,l.routingPoints,!0,!0)}cleanupRoutingPoints(l,p,h,g){const m=new f(l.source,l.parent,"source"),y=new f(l.target,l.parent,"target");this.resetRoutingPointsOnReconnect(l,p,h,m,y)}resetRoutingPointsOnReconnect(l,p,h,g,m){if(p.length===0||l.source instanceof r.SDanglingAnchorImpl||l.target instanceof r.SDanglingAnchorImpl){const y=this.getOptions(l),b=this.calculateDefaultCorners(l,g,m,y);if(p.splice(0,p.length,...b),h){let v=-2;l.children.forEach(_=>{_ instanceof r.SRoutingHandleImpl&&(_.kind==="target"?_.pointIndex=p.length:_.kind==="line"&&_.pointIndex>=p.length?l.remove(_):v=Math.max(_.pointIndex,v))});for(let _=v;_<p.length-1;++_)this.addHandle(l,"manhattan-50%","volatile-routing-point",_)}return!0}return!1}applyReconnect(l,p,h){let g=!1;if(p){const m=l.root.index.getById(p);m instanceof a.SConnectableElementImpl&&(l.sourceId=m.id,g=!0)}if(h){const m=l.root.index.getById(h);m instanceof a.SConnectableElementImpl&&(l.targetId=m.id,g=!0)}if(g){if(l.index.remove(l),l.id===r.edgeInProgressID){const m=_=>`${l.sourceId}_to_${l.targetId}_${_}`;let y=0,b=m(y);for(;l.index.getById(b)!==void 0;)b=m(++y);l.id=b;const v=l.children.find(_=>_.id===r.edgeInProgressTargetHandleID);v instanceof r.SRoutingHandleImpl&&(l.remove(v),v.danglingAnchor&&v.danglingAnchor.parent.remove(v.danglingAnchor))}l.index.add(l),this.getSelfEdgeIndex(l)>-1&&(l.routingPoints=[],this.cleanupRoutingPoints(l,l.routingPoints,!0,!0))}}takeSnapshot(l){return{routingPoints:l.routingPoints.slice(),routingHandles:l.children.filter(p=>p instanceof r.SRoutingHandleImpl).map(p=>p),routedPoints:this.route(l),router:this,source:l.source,target:l.target}}applySnapshot(l,p){l.routingPoints=p.routingPoints,l.removeAll(h=>h instanceof r.SRoutingHandleImpl),l.routerKind=p.router.kind,p.routingHandles.forEach(h=>l.add(h)),p.source&&(l.sourceId=p.source.id),p.target&&(l.targetId=p.target.id),l.root.index.remove(l),l.root.index.add(l)}calculateDefaultCorners(l,p,h,g){const m=this.getSelfEdgeIndex(l);if(m>=0){const y=g.standardDistance,b=g.selfEdgeOffset*Math.min(p.bounds.width,p.bounds.height);switch(m%4){case 0:return[{x:p.get(u.RIGHT).x+y,y:p.get(u.RIGHT).y+b},{x:p.get(u.RIGHT).x+y,y:p.get(u.BOTTOM).y+y},{x:p.get(u.BOTTOM).x+b,y:p.get(u.BOTTOM).y+y}];case 1:return[{x:p.get(u.BOTTOM).x-b,y:p.get(u.BOTTOM).y+y},{x:p.get(u.LEFT).x-y,y:p.get(u.BOTTOM).y+y},{x:p.get(u.LEFT).x-y,y:p.get(u.LEFT).y+b}];case 2:return[{x:p.get(u.LEFT).x-y,y:p.get(u.LEFT).y-b},{x:p.get(u.LEFT).x-y,y:p.get(u.TOP).y-y},{x:p.get(u.TOP).x-b,y:p.get(u.TOP).y-y}];case 3:return[{x:p.get(u.TOP).x+b,y:p.get(u.TOP).y-y},{x:p.get(u.RIGHT).x+y,y:p.get(u.TOP).y-y},{x:p.get(u.RIGHT).x+y,y:p.get(u.RIGHT).y-b}]}}return[]}getSelfEdgeIndex(l){return!l.source||l.source!==l.target?-1:l.source.outgoingEdges.filter(p=>p.target===l.source).indexOf(l)}commitRoute(l,p){const h=[];for(let g=1;g<p.length-1;++g)h.push({x:p[g].x,y:p[g].y});l.routingPoints=h}};return En.AbstractEdgeRouter=d,n([(0,t.inject)(s.AnchorComputerRegistry),e("design:type",s.AnchorComputerRegistry)],d.prototype,"anchorRegistry",void 0),En.AbstractEdgeRouter=d=n([(0,t.injectable)()],d),En}var cm;function ju(){if(cm)return Vi;cm=1;var n=Vi&&Vi.__decorate||function(f,d,c,l){var p=arguments.length,h=p<3?d:l===null?l=Object.getOwnPropertyDescriptor(d,c):l,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,d,c,l);else for(var m=f.length-1;m>=0;m--)(g=f[m])&&(h=(p<3?g(h):p>3?g(d,c,h):g(d,c))||h);return p>3&&h&&Object.defineProperty(d,c,h),h},e=Vi&&Vi.__metadata||function(f,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,d)},t;Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.PolylineEdgeRouter=void 0;const i=se(),o=He(),r=pt(),s=to(),a=xu();let u=t=class extends a.AbstractEdgeRouter{get kind(){return t.KIND}getOptions(d){return{minimalPointDistance:2,removeAngleThreshold:.1,standardDistance:20,selfEdgeOffset:.25}}route(d){const c=d.source,l=d.target;if(c===void 0||l===void 0)return[];let p,h;const g=this.getOptions(d),m=d.routingPoints.length>0?d.routingPoints:[];this.cleanupRoutingPoints(d,m,!1,!1);const y=m!==void 0?m.length:0;if(y===0){const v=o.Bounds.center(l.bounds);p=this.getTranslatedAnchor(c,v,l.parent,d,d.sourceAnchorCorrection);const _=o.Bounds.center(c.bounds);h=this.getTranslatedAnchor(l,_,c.parent,d,d.targetAnchorCorrection)}else{const v=m[0];p=this.getTranslatedAnchor(c,v,d.parent,d,d.sourceAnchorCorrection);const _=m[y-1];h=this.getTranslatedAnchor(l,_,d.parent,d,d.targetAnchorCorrection)}const b=[];b.push({kind:"source",x:p.x,y:p.y});for(let v=0;v<y;v++){const _=m[v];(v>0&&v<y-1||v===0&&o.Point.maxDistance(p,_)>=g.minimalPointDistance+(d.sourceAnchorCorrection||0)||v===y-1&&o.Point.maxDistance(_,h)>=g.minimalPointDistance+(d.targetAnchorCorrection||0))&&b.push({kind:"linear",x:_.x,y:_.y,pointIndex:v})}return b.push({kind:"target",x:h.x,y:h.y}),this.filterEditModeHandles(b,d,g)}filterEditModeHandles(d,c,l){if(c.children.length===0)return d;let p=0;for(;p<d.length;){const h=d[p];if(h.pointIndex!==void 0){const g=c.children.find(m=>m instanceof r.SRoutingHandleImpl&&m.kind==="junction"&&m.pointIndex===h.pointIndex);if(g!==void 0&&g.editMode&&p>0&&p<d.length-1){const m=d[p-1],y=d[p+1],b={x:m.x-h.x,y:m.y-h.y},v={x:y.x-h.x,y:y.y-h.y},_=(0,o.angleBetweenPoints)(b,v);if(Math.abs(Math.PI-_)<l.removeAngleThreshold){d.splice(p,1);continue}}}p++}return d}createRoutingHandles(d){const c=d.routingPoints.length;this.addHandle(d,"source","routing-point",-2),this.addHandle(d,"line","volatile-routing-point",-1);for(let l=0;l<c;l++)this.addHandle(d,"junction","routing-point",l),this.addHandle(d,"line","volatile-routing-point",l);this.addHandle(d,"target","routing-point",c)}getInnerHandlePosition(d,c,l){if(l.kind==="line"){const{start:p,end:h}=this.findRouteSegment(d,c,l.pointIndex);if(p!==void 0&&h!==void 0)return(0,o.centerOfLine)(p,h)}}applyInnerHandleMoves(d,c){c.forEach(l=>{const p=l.handle,h=d.routingPoints;let g=p.pointIndex;p.kind==="line"&&(p.kind="junction",p.type="routing-point",h.splice(g+1,0,l.fromPosition||h[Math.max(g,0)]),d.children.forEach(m=>{m instanceof r.SRoutingHandleImpl&&(m===p||m.pointIndex>g)&&m.pointIndex++}),this.addHandle(d,"line","volatile-routing-point",g),g++,this.addHandle(d,"line","volatile-routing-point",g)),g>=0&&g<h.length&&(h[g]=l.toPosition)})}};return Vi.PolylineEdgeRouter=u,u.KIND="polyline",n([(0,i.inject)(s.AnchorComputerRegistry),e("design:type",s.AnchorComputerRegistry)],u.prototype,"anchorRegistry",void 0),Vi.PolylineEdgeRouter=u=t=n([(0,i.injectable)()],u),Vi}var um;function nr(){if(um)return wn;um=1;var n=wn&&wn.__decorate||function(p,h,g,m){var y=arguments.length,b=y<3?h:m===null?m=Object.getOwnPropertyDescriptor(h,g):m,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(p,h,g,m);else for(var _=p.length-1;_>=0;_--)(v=p[_])&&(b=(y<3?v(b):y>3?v(h,g,b):v(h,g))||b);return y>3&&b&&Object.defineProperty(h,g,b),b},e=wn&&wn.__metadata||function(p,h){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(p,h)},t=wn&&wn.__param||function(p,h){return function(g,m){h(g,m,p)}};Object.defineProperty(wn,"__esModule",{value:!0}),wn.EdgeRouting=wn.EdgeRouterRegistry=void 0;const i=se(),o=Ke(),r=ge(),s=Ca(),a=Er(),u=pt(),f=ju();function d(p){return p.routeAll!==void 0}let c=class extends a.InstanceRegistry{constructor(h){super(),h.forEach(g=>this.register(g.kind,g))}get defaultKind(){return f.PolylineEdgeRouter.KIND}get(h){return super.get(h||this.defaultKind)}routeAllChildren(h){const g=this.doRouteAllChildren(h);for(const m of this.postProcessors)m.apply(g,h);return g}doRouteAllChildren(h){const g=new l,m=new Map,y=[h];for(;y.length>0;){const b=y.shift();for(const v of b.children){if(v instanceof u.SRoutableElementImpl){const _=v.routerKind||this.defaultKind;m.has(_)?m.get(_).push(v):m.set(_,[v])}v instanceof o.SParentElementImpl&&y.push(v)}}return m.forEach((b,v)=>{const _=this.get(v);if(d(_))g.setAll(_.routeAll(b,h));else for(const S of b)g.set(S.id,this.route(S))}),g}route(h,g){const m=(0,s.findArgValue)(g,"edgeRouting");if(m){const b=m.get(h.id);if(b)return b}return this.get(h.routerKind).route(h)}};wn.EdgeRouterRegistry=c,n([(0,i.multiInject)(r.TYPES.IEdgeRoutePostprocessor),(0,i.optional)(),e("design:type",Array)],c.prototype,"postProcessors",void 0),wn.EdgeRouterRegistry=c=n([(0,i.injectable)(),t(0,(0,i.multiInject)(r.TYPES.IEdgeRouter)),e("design:paramtypes",[Array])],c);class l{constructor(){this.routesMap=new Map}set(h,g){this.routesMap.set(h,g)}setAll(h){h.routes.forEach((g,m)=>this.set(m,g))}get(h){return this.routesMap.get(h)}get routes(){return this.routesMap}}return wn.EdgeRouting=l,wn}var dm;function q_(){if(dm)return Bi;dm=1;var n=Bi&&Bi.__decorate||function(p,h,g,m){var y=arguments.length,b=y<3?h:m===null?m=Object.getOwnPropertyDescriptor(h,g):m,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(p,h,g,m);else for(var _=p.length-1;_>=0;_--)(v=p[_])&&(b=(y<3?v(b):y>3?v(h,g,b):v(h,g))||b);return y>3&&b&&Object.defineProperty(h,g,b),b},e=Bi&&Bi.__metadata||function(p,h){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(p,h)};Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.EdgeLayoutPostprocessor=void 0;const t=se(),i=He(),o=Ke(),r=Wt(),s=us(),a=tt(),u=xa(),f=nr(),d=ge(),c=Qr();let l=class{decorate(h,g){var m,y,b,v;if((0,u.isEdgeLayoutable)(g)&&g.parent instanceof s.SEdgeImpl&&g.bounds!==i.Bounds.EMPTY){const _=g.bounds,S=(0,u.checkEdgePlacement)(g),E=this.getEdgePlacement(g),O=g.parent,R=Math.min(1,Math.max(0,E.position)),w=this.edgeRouterRegistry.get(O.routerKind),M=w.pointAt(O,R);let I="",D=w.derivativeAt(O,R);if(M)if(S){switch(E.moveMode){case"edge":const C=w.findOrthogonalIntersection(O,i.Point.add(M,_));C&&(D=C.derivative,I+=`translate(${C.point.x}, ${C.point.y})`);break;case"free":I+=`translate(${((m=M?.x)!==null&&m!==void 0?m:0)+_.x}, ${((y=M?.y)!==null&&y!==void 0?y:0)+_.y})`;break;case"none":I+=`translate(${M.x}, ${M.y})`;break;default:this.logger.error({},"No moveMode set for edge label. Skipping edge placement.");break}if(D){const C=(0,i.toDegrees)(Math.atan2(D.y,D.x));if(E.rotate){let z=C;Math.abs(C)>90&&(C<0?z+=180:C>0&&(z-=180)),I+=` rotate(${z})`;const G=this.getRotatedAlignment(g,E,z!==C);I+=` translate(${G.x}, ${G.y})`}else{const z=this.getAlignment(g,E,C);I+=` translate(${z.x}, ${z.y})`}}}else(0,c.isMoveable)(g)?I+=`translate(${((b=M?.x)!==null&&b!==void 0?b:0)+_.x}, ${((v=M?.y)!==null&&v!==void 0?v:0)+_.y})`:I+=`translate(${M.x}, ${M.y})`;(0,r.setAttr)(h,"transform",I)}return h}getRotatedAlignment(h,g,m){let y=(0,a.isAlignable)(h)?h.alignment.x:0,b=(0,a.isAlignable)(h)?h.alignment.y:0;const v=h.bounds;if(g.side==="on")return{x:y-.5*v.height,y:b-.5*v.height};if(m)switch(g.position<.3333333?y-=v.width+g.offset:g.position<.6666666?y-=.5*v.width:y+=g.offset,g.side){case"left":case"bottom":b-=g.offset+v.height;break;case"right":case"top":b+=g.offset}else switch(g.position<.3333333?y+=g.offset:g.position<.6666666?y-=.5*v.width:y-=v.width+g.offset,g.side){case"right":case"bottom":b+=-g.offset-v.height;break;case"left":case"top":b+=g.offset}return{x:y,y:b}}getEdgePlacement(h){let g=h;const m=[];for(;g!==void 0;){const b=g.edgePlacement;if(b!==void 0&&m.push(b),g instanceof o.SChildElementImpl)g=g.parent;else break}const y=m.reverse().reduce((b,v)=>Object.assign(Object.assign({},b),v),u.DEFAULT_EDGE_PLACEMENT);return y.moveMode||(y.moveMode=(0,c.isMoveable)(h)?"edge":"none"),y}getAlignment(h,g,m){const y=h.bounds,b=(0,a.isAlignable)(h)?h.alignment.x-y.width:0,v=(0,a.isAlignable)(h)?h.alignment.y-y.height:0;if(g.side==="on")return{x:b+.5*y.width,y:v+.5*y.height};const _=this.getQuadrant(m),S={x:g.offset,y:v+.5*y.height},E={x:g.offset,y:v+y.height+g.offset},O={x:-y.width-g.offset,y:v+y.height+g.offset},R={x:-y.width-g.offset,y:v+.5*y.height},w={x:-y.width-g.offset,y:v-g.offset},M={x:g.offset,y:v-g.offset};switch(g.side){case"left":switch(_.orientation){case"west":return i.Point.linear(E,O,_.position);case"north":return i.Point.linear(O,w,_.position);case"east":return i.Point.linear(w,M,_.position);case"south":return i.Point.linear(M,E,_.position)}break;case"right":switch(_.orientation){case"west":return i.Point.linear(w,M,_.position);case"north":return i.Point.linear(M,E,_.position);case"east":return i.Point.linear(E,O,_.position);case"south":return i.Point.linear(O,w,_.position)}break;case"top":switch(_.orientation){case"west":return i.Point.linear(w,M,_.position);case"north":return this.linearFlip(M,S,R,w,_.position);case"east":return i.Point.linear(w,M,_.position);case"south":return this.linearFlip(M,S,R,w,_.position)}break;case"bottom":switch(_.orientation){case"west":return i.Point.linear(E,O,_.position);case"north":return this.linearFlip(O,R,S,E,_.position);case"east":return i.Point.linear(E,O,_.position);case"south":return this.linearFlip(O,R,S,E,_.position)}break}return{x:0,y:0}}getQuadrant(h){return Math.abs(h)>135?{orientation:"west",position:(h>0?h-135:h+225)/90}:h<-45?{orientation:"north",position:(h+135)/90}:h<45?{orientation:"east",position:(h+45)/90}:{orientation:"south",position:(h-45)/90}}linearFlip(h,g,m,y,b){return b<.5?i.Point.linear(h,g,2*b):i.Point.linear(m,y,2*b-1)}postUpdate(){}};return Bi.EdgeLayoutPostprocessor=l,n([(0,t.inject)(f.EdgeRouterRegistry),e("design:type",f.EdgeRouterRegistry)],l.prototype,"edgeRouterRegistry",void 0),n([(0,t.inject)(d.TYPES.ILogger),e("design:type",Object)],l.prototype,"logger",void 0),Bi.EdgeLayoutPostprocessor=l=n([(0,t.injectable)()],l),Bi}var lm;function $d(){if(lm)return Mc;lm=1,Object.defineProperty(Mc,"__esModule",{value:!0});const n=se(),e=ge(),t=q_(),i=new n.ContainerModule(o=>{o(t.EdgeLayoutPostprocessor).toSelf().inSingletonScope(),o(e.TYPES.IVNodePostprocessor).toService(t.EdgeLayoutPostprocessor),o(e.TYPES.HiddenVNodePostprocessor).toService(t.EdgeLayoutPostprocessor)});return Mc.default=i,Mc}var Gn={},fm;function NE(){if(fm)return Gn;fm=1;var n=Gn&&Gn.__decorate||function(f,d,c,l){var p=arguments.length,h=p<3?d:l===null?l=Object.getOwnPropertyDescriptor(d,c):l,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,d,c,l);else for(var m=f.length-1;m>=0;m--)(g=f[m])&&(h=(p<3?g(h):p>3?g(d,c,h):g(d,c))||h);return p>3&&h&&Object.defineProperty(d,c,h),h},e=Gn&&Gn.__metadata||function(f,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,d)},t=Gn&&Gn.__param||function(f,d){return function(c,l){d(c,l,f)}};Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.CreateElementCommand=void 0;const i=se(),o=qe(),r=gt(),s=Ke(),a=ge();let u=class extends r.Command{constructor(d){super(),this.action=d}execute(d){const c=d.root.index.getById(this.action.containerId);return c instanceof s.SParentElementImpl&&(this.container=c,this.newElement=d.modelFactory.createElement(this.action.elementSchema),this.container.add(this.newElement)),d.root}undo(d){return this.container.remove(this.newElement),d.root}redo(d){return this.container.add(this.newElement),d.root}};return Gn.CreateElementCommand=u,u.KIND=o.CreateElementAction.KIND,Gn.CreateElementCommand=u=n([(0,i.injectable)(),t(0,(0,i.inject)(a.TYPES.Action)),e("design:paramtypes",[Object])],u),Gn}var Rd={},hm;function H_(){return hm||(hm=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isCreatingOnDrag=n.creatingOnDragFeature=void 0,n.creatingOnDragFeature=Symbol("creatingOnDragFeature");function e(t){return t.hasFeature(n.creatingOnDragFeature)&&t.createAction!==void 0}n.isCreatingOnDrag=e})(Rd)),Rd}var fr={},wt={},pm;function K_(){if(pm)return wt;pm=1;var n=wt&&wt.__decorate||function(l,p,h,g){var m=arguments.length,y=m<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,h):g,b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(l,p,h,g);else for(var v=l.length-1;v>=0;v--)(b=l[v])&&(y=(m<3?b(y):m>3?b(p,h,y):b(p,h))||y);return m>3&&y&&Object.defineProperty(p,h,y),y};Object.defineProperty(wt,"__esModule",{value:!0}),wt.EmptyGroupView=wt.DiamondNodeView=wt.RectangularNodeView=wt.CircularNodeView=wt.SvgViewportView=void 0;const e=tr(),t=us(),i=Tu(),o=eo(),r=se();let s=class{render(p,h,g){const m=`scale(${p.zoom}) translate(${-p.scroll.x},${-p.scroll.y})`;return(0,e.svg)("svg",null,(0,e.svg)("g",{transform:m},h.renderChildren(p)))}};wt.SvgViewportView=s,wt.SvgViewportView=s=n([(0,r.injectable)()],s);let a=class extends i.ShapeView{render(p,h,g){if(!this.isVisible(p,h))return;const m=this.getRadius(p);return(0,e.svg)("g",null,(0,e.svg)("circle",{"class-sprotty-node":p instanceof t.SNodeImpl,"class-sprotty-port":p instanceof t.SPortImpl,"class-mouseover":p.hoverFeedback,"class-selected":p.selected,r:m,cx:m,cy:m}),h.renderChildren(p))}getRadius(p){const h=Math.min(p.size.width,p.size.height);return h>0?h/2:0}};wt.CircularNodeView=a,wt.CircularNodeView=a=n([(0,r.injectable)()],a);let u=class extends i.ShapeView{render(p,h,g){if(this.isVisible(p,h))return(0,e.svg)("g",null,(0,e.svg)("rect",{"class-sprotty-node":p instanceof t.SNodeImpl,"class-sprotty-port":p instanceof t.SPortImpl,"class-mouseover":p.hoverFeedback,"class-selected":p.selected,x:"0",y:"0",width:Math.max(p.size.width,0),height:Math.max(p.size.height,0)}),h.renderChildren(p))}};wt.RectangularNodeView=u,wt.RectangularNodeView=u=n([(0,r.injectable)()],u);let f=class extends i.ShapeView{render(p,h,g){if(!this.isVisible(p,h))return;const m=new o.Diamond({height:Math.max(p.size.height,0),width:Math.max(p.size.width,0),x:0,y:0}),y=`${d(m.topPoint)} ${d(m.rightPoint)} ${d(m.bottomPoint)} ${d(m.leftPoint)}`;return(0,e.svg)("g",null,(0,e.svg)("polygon",{"class-sprotty-node":p instanceof t.SNodeImpl,"class-sprotty-port":p instanceof t.SPortImpl,"class-mouseover":p.hoverFeedback,"class-selected":p.selected,points:y}),h.renderChildren(p))}};wt.DiamondNodeView=f,wt.DiamondNodeView=f=n([(0,r.injectable)()],f);function d(l){return`${l.x},${l.y}`}let c=class{render(p,h){return(0,e.svg)("g",null)}};return wt.EmptyGroupView=c,wt.EmptyGroupView=c=n([(0,r.injectable)()],c),wt}var Je={},gm;function Yl(){if(gm)return Je;gm=1;var n=Je&&Je.__decorate||function(S,E,O,R){var w=arguments.length,M=w<3?E:R===null?R=Object.getOwnPropertyDescriptor(E,O):R,I;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(S,E,O,R);else for(var D=S.length-1;D>=0;D--)(I=S[D])&&(M=(w<3?I(M):w>3?I(E,O,M):I(E,O))||M);return w>3&&M&&Object.defineProperty(E,O,M),M},e=Je&&Je.__metadata||function(S,E){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(S,E)},t=Je&&Je.__param||function(S,E){return function(O,R){E(O,R,S)}};Object.defineProperty(Je,"__esModule",{value:!0}),Je.getEditableLabel=Je.EditLabelKeyListener=Je.EditLabelMouseListener=Je.ApplyLabelEditCommand=Je.ResolvedLabelEdit=Je.isApplyLabelEditAction=Je.isEditLabelAction=Je.EditLabelAction=void 0;const i=se(),o=qe(),r=gt(),s=ge(),a=ni(),u=Pr(),f=Jr(),d=zn(),c=os(),l=ja();var p;(function(S){S.KIND="EditLabel";function E(O){return{kind:S.KIND,labelId:O}}S.create=E})(p||(Je.EditLabelAction=p={}));function h(S){return(0,o.isAction)(S)&&S.kind===p.KIND&&"labelId"in S}Je.isEditLabelAction=h;function g(S){return(0,o.isAction)(S)&&S.kind===o.ApplyLabelEditAction.KIND&&"labelId"in S&&"text"in S}Je.isApplyLabelEditAction=g;class m{}Je.ResolvedLabelEdit=m;let y=class extends r.Command{constructor(E){super(),this.action=E}execute(E){const R=E.root.index.getById(this.action.labelId);return R&&(0,l.isEditableLabel)(R)&&(this.resolvedLabelEdit={label:R,oldLabel:R.text,newLabel:this.action.text},R.text=this.action.text),E.root}undo(E){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.oldLabel),E.root}redo(E){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.newLabel),E.root}};Je.ApplyLabelEditCommand=y,y.KIND=o.ApplyLabelEditAction.KIND,Je.ApplyLabelEditCommand=y=n([t(0,(0,i.inject)(s.TYPES.Action)),e("design:paramtypes",[Object])],y);class b extends a.MouseListener{doubleClick(E,O){const R=_(E);return R?[p.create(R.id)]:[]}}Je.EditLabelMouseListener=b;class v extends u.KeyListener{keyDown(E,O){if((0,f.matchesKeystroke)(O,"F2")){const R=(0,c.toArray)(E.index.all().filter(w=>(0,d.isSelectable)(w)&&w.selected)).map(_).filter(w=>w!==void 0);if(R.length===1)return[p.create(R[0].id)]}return[]}}Je.EditLabelKeyListener=v;function _(S){if((0,l.isEditableLabel)(S))return S;if((0,l.isWithEditableLabel)(S)&&S.editableLabel)return S.editableLabel}return Je.getEditableLabel=_,Je}var Ln={},Pn={},Nn={},mm;function ds(){if(mm)return Nn;mm=1;var n=Nn&&Nn.__decorate||function(u,f,d,c){var l=arguments.length,p=l<3?f:c===null?c=Object.getOwnPropertyDescriptor(f,d):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(u,f,d,c);else for(var g=u.length-1;g>=0;g--)(h=u[g])&&(p=(l<3?h(p):l>3?h(f,d,p):h(f,d))||p);return l>3&&p&&Object.defineProperty(f,d,p),p},e=Nn&&Nn.__metadata||function(u,f){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(u,f)};Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.ComputedBoundsApplicator=Nn.ModelSource=void 0;const t=se(),i=qe(),o=ns(),r=ge();let s=class{initialize(f){f.register(i.RequestModelAction.KIND,this),f.register(i.ExportSvgAction.KIND,this)}};Nn.ModelSource=s,n([(0,t.inject)(r.TYPES.IActionDispatcher),e("design:type",Object)],s.prototype,"actionDispatcher",void 0),n([(0,t.inject)(r.TYPES.ViewerOptions),e("design:type",Object)],s.prototype,"viewerOptions",void 0),Nn.ModelSource=s=n([(0,t.injectable)()],s);let a=class{apply(f,d){const c=new o.SModelIndex;c.add(f);for(const l of d.bounds){const p=c.getById(l.elementId);p!==void 0&&this.applyBounds(p,l.newPosition,l.newSize)}if(d.alignments!==void 0)for(const l of d.alignments){const p=c.getById(l.elementId);p!==void 0&&this.applyAlignment(p,l.newAlignment)}return c}applyAlignment(f,d){const c=f;c.alignment={x:d.x,y:d.y}}applyBounds(f,d,c){const l=f;d&&(l.position=Object.assign({},d)),l.size=Object.assign({},c)}};return Nn.ComputedBoundsApplicator=a,Nn.ComputedBoundsApplicator=a=n([(0,t.injectable)()],a),Nn}var ym;function Lu(){if(ym)return Pn;ym=1;var n=Pn&&Pn.__decorate||function(f,d,c,l){var p=arguments.length,h=p<3?d:l===null?l=Object.getOwnPropertyDescriptor(d,c):l,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,d,c,l);else for(var m=f.length-1;m>=0;m--)(g=f[m])&&(h=(p<3?g(h):p>3?g(d,c,h):g(d,c))||h);return p>3&&h&&Object.defineProperty(d,c,h),h},e=Pn&&Pn.__metadata||function(f,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,d)},t=Pn&&Pn.__param||function(f,d){return function(c,l){d(c,l,f)}};Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.CommitModelCommand=Pn.CommitModelAction=void 0;const i=se(),o=gt(),r=ge(),s=ds();var a;(function(f){f.KIND="commitModel";function d(){return{kind:f.KIND}}f.create=d})(a||(Pn.CommitModelAction=a={}));let u=class extends o.SystemCommand{constructor(d){super(),this.action=d}execute(d){return this.newModel=d.modelFactory.createSchema(d.root),this.doCommit(this.newModel,d.root,!0)}doCommit(d,c,l){const p=this.modelSource.commitModel(d);return p instanceof Promise?p.then(h=>(l&&(this.originalModel=h),c)):(l&&(this.originalModel=p),c)}undo(d){return this.doCommit(this.originalModel,d.root,!1)}redo(d){return this.doCommit(this.newModel,d.root,!1)}};return Pn.CommitModelCommand=u,u.KIND=a.KIND,n([(0,i.inject)(r.TYPES.ModelSource),e("design:type",s.ModelSource)],u.prototype,"modelSource",void 0),Pn.CommitModelCommand=u=n([(0,i.injectable)(),t(0,(0,i.inject)(r.TYPES.Action)),e("design:paramtypes",[Object])],u),Pn}var gi={},vm;function kl(){if(vm)return gi;vm=1;var n=gi&&gi.__decorate||function(p,h,g,m){var y=arguments.length,b=y<3?h:m===null?m=Object.getOwnPropertyDescriptor(h,g):m,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(p,h,g,m);else for(var _=p.length-1;_>=0;_--)(v=p[_])&&(b=(y<3?v(b):y>3?v(h,g,b):v(h,g))||b);return y>3&&b&&Object.defineProperty(h,g,b),b},e=gi&&gi.__metadata||function(p,h){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(p,h)};Object.defineProperty(gi,"__esModule",{value:!0}),gi.ZoomMouseListener=gi.getZoom=void 0;const t=se(),i=qe(),o=He(),r=tn(),s=ge(),a=ni(),u=er(),f=Mr(),d=eo();function c(p){let h=1;const g=(0,r.findParentByFeature)(p,f.isViewport);return g&&(h=g.zoom),h}gi.getZoom=c;class l extends a.MouseListener{wheel(h,g){const m=(0,r.findParentByFeature)(h,f.isViewport);if(!m)return[];const y=this.isScrollMode(g)?this.processScroll(m,g):this.processZoom(m,h,g);return y?[i.SetViewportAction.create(m.id,y,{animate:!1})]:[]}isScrollMode(h){return h.altKey}processScroll(h,g){return{scroll:{x:h.scroll.x+g.deltaX,y:h.scroll.y+g.deltaY},zoom:h.zoom}}processZoom(h,g,m){const y=this.getZoomFactor(m);if(y>1&&(0,o.almostEquals)(h.zoom,this.viewerOptions.zoomLimits.max)||y<1&&(0,o.almostEquals)(h.zoom,this.viewerOptions.zoomLimits.min))return;const b=(0,d.limit)(h.zoom*y,this.viewerOptions.zoomLimits),v=this.getViewportOffset(g.root,m),_=1/b-1/h.zoom;return{scroll:{x:h.scroll.x-_*v.x,y:h.scroll.y-_*v.y},zoom:b}}getViewportOffset(h,g){const m=h.canvasBounds,y=(0,u.getWindowScroll)();return{x:g.clientX+y.x-m.x,y:g.clientY+y.y-m.y}}getZoomFactor(h){return h.deltaMode===h.DOM_DELTA_PAGE?Math.exp(-h.deltaY*.5):h.deltaMode===h.DOM_DELTA_LINE?Math.exp(-h.deltaY*.05):Math.exp(-h.deltaY*.005)}}return gi.ZoomMouseListener=l,n([(0,t.inject)(s.TYPES.ViewerOptions),e("design:type",Object)],l.prototype,"viewerOptions",void 0),gi}var _m;function $_(){if(_m)return Ln;_m=1;var n=Ln&&Ln.__decorate||function(_,S,E,O){var R=arguments.length,w=R<3?S:O===null?O=Object.getOwnPropertyDescriptor(S,E):O,M;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(_,S,E,O);else for(var I=_.length-1;I>=0;I--)(M=_[I])&&(w=(R<3?M(w):R>3?M(S,E,w):M(S,E))||w);return R>3&&w&&Object.defineProperty(S,E,w),w},e=Ln&&Ln.__metadata||function(_,S){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(_,S)},t;Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.EditLabelUI=Ln.EditLabelActionHandler=void 0;const i=se(),o=qe(),r=ge(),s=jl(),a=Iu(),u=Oa(),f=Lu(),d=Jr(),c=tt(),l=kl(),p=Yl(),h=ja();let g=class{handle(S){if((0,p.isEditLabelAction)(S))return a.SetUIExtensionVisibilityAction.create({extensionId:m.ID,visible:!0,contextElementsId:[S.labelId]})}};Ln.EditLabelActionHandler=g,Ln.EditLabelActionHandler=g=n([(0,i.injectable)()],g);let m=t=class extends s.AbstractUIExtension{constructor(){super(...arguments),this.validationTimeout=void 0,this.isActive=!1,this.blockApplyEditOnInvalidInput=!0,this.isCurrentLabelValid=!0}id(){return t.ID}containerClass(){return"label-edit"}get labelId(){return this.label?this.label.id:"unknown"}initializeContents(S){S.style.position="absolute",this.inputElement=document.createElement("input"),this.textAreaElement=document.createElement("textarea"),[this.inputElement,this.textAreaElement].forEach(E=>{E.onkeydown=O=>this.applyLabelEditOnEvent(O,"Enter"),this.configureAndAdd(E,S)})}configureAndAdd(S,E){S.style.visibility="hidden",S.style.position="absolute",S.style.top="0px",S.style.left="0px",S.addEventListener("keydown",O=>this.hideIfEscapeEvent(O)),S.addEventListener("keyup",O=>this.validateLabelIfContentChange(O,S.value)),S.addEventListener("blur",()=>window.setTimeout(()=>this.applyLabelEdit(),200)),E.appendChild(S)}get editControl(){return this.label&&this.label.isMultiLine?this.textAreaElement:this.inputElement}hideIfEscapeEvent(S){(0,d.matchesKeystroke)(S,"Escape")&&this.hide()}applyLabelEditOnEvent(S,E,...O){(0,d.matchesKeystroke)(S,E||"Enter",...O)&&(S.preventDefault(),this.applyLabelEdit())}validateLabelIfContentChange(S,E){(this.previousLabelContent===void 0||this.previousLabelContent!==E)&&(this.previousLabelContent=E,this.performLabelValidation(S,this.editControl.value))}async applyLabelEdit(){var S;if(this.isActive){if(((S=this.label)===null||S===void 0?void 0:S.text)===this.editControl.value){this.hide();return}if(this.blockApplyEditOnInvalidInput&&(await this.validateLabel(this.editControl.value)).severity==="error"){this.editControl.focus();return}this.actionDispatcherProvider().then(E=>E.dispatchAll([o.ApplyLabelEditAction.create(this.labelId,this.editControl.value),f.CommitModelAction.create()])).catch(E=>this.logger.error(this,"No action dispatcher available to execute apply label edit action",E)),this.hide()}}performLabelValidation(S,E){this.validationTimeout&&window.clearTimeout(this.validationTimeout),this.validationTimeout=window.setTimeout(()=>this.validateLabel(E),200)}async validateLabel(S){if(this.labelValidator&&this.label)try{const E=await this.labelValidator.validate(S,this.label);return this.isCurrentLabelValid=E.severity!=="error",this.showValidationResult(E),E}catch(E){this.logger.error(this,"Error validating edited label",E)}return this.isCurrentLabelValid=!0,{severity:"ok",message:void 0}}showValidationResult(S){this.clearValidationResult(),this.validationDecorator&&this.validationDecorator.decorate(this.editControl,S)}clearValidationResult(){this.validationDecorator&&this.validationDecorator.dispose(this.editControl)}show(S,...E){!y(E,S)||this.isActive||(super.show(S,...E),this.isActive=!0)}hide(){this.editControl.style.visibility="hidden",super.hide(),this.clearValidationResult(),this.isActive=!1,this.isCurrentLabelValid=!0,this.previousLabelContent=void 0,this.labelElement&&(this.labelElement.style.visibility="visible")}onBeforeShow(S,E,...O){this.label=b(O,E)[0],this.previousLabelContent=this.label.text,this.setPosition(S),this.applyTextContents(),this.applyFontStyling(),this.editControl.style.visibility="visible",this.editControl.focus()}setPosition(S){let E=0,O=0,R=100,w=20;if(this.label){const M=(0,l.getZoom)(this.label),I=(0,c.getAbsoluteClientBounds)(this.label,this.domHelper,this.viewerOptions);E=I.x+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.x:0)*M,O=I.y+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.y:0)*M,w=(this.label.editControlDimension?this.label.editControlDimension.height:w)*M,R=(this.label.editControlDimension?this.label.editControlDimension.width:R)*M}S.style.left=`${E}px`,S.style.top=`${O}px`,S.style.width=`${R}px`,this.editControl.style.width=`${R}px`,S.style.height=`${w}px`,this.editControl.style.height=`${w}px`}applyTextContents(){this.label&&(this.editControl.value=this.label.text,this.editControl instanceof HTMLTextAreaElement?(this.editControl.selectionStart=0,this.editControl.selectionEnd=0,this.editControl.scrollTop=0,this.editControl.scrollLeft=0):this.editControl.setSelectionRange(0,this.editControl.value.length))}applyFontStyling(){if(this.label&&(this.labelElement=document.getElementById(this.domHelper.createUniqueDOMElementId(this.label)),this.labelElement)){this.labelElement.style.visibility="hidden";const S=window.getComputedStyle(this.labelElement);this.editControl.style.font=S.font,this.editControl.style.fontStyle=S.fontStyle,this.editControl.style.fontFamily=S.fontFamily,this.editControl.style.fontSize=v(S.fontSize,(0,l.getZoom)(this.label)),this.editControl.style.fontWeight=S.fontWeight,this.editControl.style.lineHeight=S.lineHeight}}};Ln.EditLabelUI=m,m.ID="editLabelUi",n([(0,i.inject)(r.TYPES.IActionDispatcherProvider),e("design:type",Function)],m.prototype,"actionDispatcherProvider",void 0),n([(0,i.inject)(r.TYPES.ViewerOptions),e("design:type",Object)],m.prototype,"viewerOptions",void 0),n([(0,i.inject)(r.TYPES.DOMHelper),e("design:type",u.DOMHelper)],m.prototype,"domHelper",void 0),n([(0,i.inject)(r.TYPES.IEditLabelValidator),(0,i.optional)(),e("design:type",Object)],m.prototype,"labelValidator",void 0),n([(0,i.inject)(r.TYPES.IEditLabelValidationDecorator),(0,i.optional)(),e("design:type",Object)],m.prototype,"validationDecorator",void 0),Ln.EditLabelUI=m=t=n([(0,i.injectable)()],m);function y(_,S){return b(_,S).length===1}function b(_,S){return _.map(E=>S.index.getById(E)).filter(h.isEditableLabel)}function v(_,S){return _.replace(/\d+(\.\d+)?/,E=>String(Number.parseInt(E,10)*S))}return Ln}var Mn={},bm;function Nu(){if(bm)return Mn;bm=1;var n=Mn&&Mn.__decorate||function(l,p,h,g){var m=arguments.length,y=m<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,h):g,b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(l,p,h,g);else for(var v=l.length-1;v>=0;v--)(b=l[v])&&(y=(m<3?b(y):m>3?b(p,h,y):b(p,h))||y);return m>3&&y&&Object.defineProperty(p,h,y),y},e=Mn&&Mn.__metadata||function(l,p){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(l,p)},t=Mn&&Mn.__param||function(l,p){return function(h,g){p(h,g,l)}};Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.SwitchEditModeCommand=Mn.SwitchEditModeAction=void 0;const i=se(),o=gt(),r=Ke(),s=ge(),a=pt(),u=nr(),f=ja();var d;(function(l){l.KIND="switchEditMode";function p(h){var g,m;return{kind:l.KIND,elementsToActivate:(g=h.elementsToActivate)!==null&&g!==void 0?g:[],elementsToDeactivate:(m=h.elementsToDeactivate)!==null&&m!==void 0?m:[]}}l.create=p})(d||(Mn.SwitchEditModeAction=d={}));let c=class extends o.Command{constructor(p){super(),this.action=p,this.elementsToActivate=[],this.elementsToDeactivate=[],this.handlesToRemove=[]}execute(p){const h=p.root.index;return this.action.elementsToActivate.forEach(g=>{const m=h.getById(g);m!==void 0&&this.elementsToActivate.push(m)}),this.action.elementsToDeactivate.forEach(g=>{const m=h.getById(g);if(m!==void 0&&this.elementsToDeactivate.push(m),m instanceof a.SRoutingHandleImpl&&m.parent instanceof a.SRoutableElementImpl){const y=m.parent;this.shouldRemoveHandle(m,y)&&(this.handlesToRemove.push({handle:m,parent:y}),this.elementsToDeactivate.push(y),this.elementsToActivate.push(y))}}),this.doExecute(p)}doExecute(p){return this.handlesToRemove.forEach(h=>{h.point=h.parent.routingPoints.splice(h.handle.pointIndex,1)[0]}),this.elementsToDeactivate.forEach(h=>{h instanceof a.SRoutableElementImpl?h.removeAll(g=>g instanceof a.SRoutingHandleImpl):h instanceof a.SRoutingHandleImpl&&(h.editMode=!1,h.danglingAnchor&&h.parent instanceof a.SRoutableElementImpl&&h.danglingAnchor.original&&(h.parent.source===h.danglingAnchor?h.parent.sourceId=h.danglingAnchor.original.id:h.parent.target===h.danglingAnchor&&(h.parent.targetId=h.danglingAnchor.original.id),h.danglingAnchor.parent.remove(h.danglingAnchor),h.danglingAnchor=void 0))}),this.elementsToActivate.forEach(h=>{(0,f.canEditRouting)(h)&&h instanceof r.SParentElementImpl?this.edgeRouterRegistry.get(h.routerKind).createRoutingHandles(h):h instanceof a.SRoutingHandleImpl&&(h.editMode=!0)}),p.root}shouldRemoveHandle(p,h){return p.kind==="junction"?this.edgeRouterRegistry.route(h).find(m=>m.pointIndex===p.pointIndex)===void 0:!1}undo(p){return this.handlesToRemove.forEach(h=>{h.point!==void 0&&h.parent.routingPoints.splice(h.handle.pointIndex,0,h.point)}),this.elementsToActivate.forEach(h=>{h instanceof a.SRoutableElementImpl?h.removeAll(g=>g instanceof a.SRoutingHandleImpl):h instanceof a.SRoutingHandleImpl&&(h.editMode=!1)}),this.elementsToDeactivate.forEach(h=>{(0,f.canEditRouting)(h)?this.edgeRouterRegistry.get(h.routerKind).createRoutingHandles(h):h instanceof a.SRoutingHandleImpl&&(h.editMode=!0)}),p.root}redo(p){return this.doExecute(p)}};return Mn.SwitchEditModeCommand=c,c.KIND=d.KIND,n([(0,i.inject)(u.EdgeRouterRegistry),e("design:type",u.EdgeRouterRegistry)],c.prototype,"edgeRouterRegistry",void 0),Mn.SwitchEditModeCommand=c=n([(0,i.injectable)(),t(0,(0,i.inject)(s.TYPES.Action)),e("design:paramtypes",[Object])],c),Mn}var Xn={},Sm;function Ul(){if(Sm)return Xn;Sm=1;var n=Xn&&Xn.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g},e=Xn&&Xn.__metadata||function(d,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(d,c)},t=Xn&&Xn.__param||function(d,c){return function(l,p){c(l,p,d)}};Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.ReconnectCommand=void 0;const i=se(),o=qe(),r=gt(),s=ge(),a=pt(),u=nr();let f=class extends r.Command{constructor(c){super(),this.action=c}execute(c){return this.doExecute(c),c.root}doExecute(c){const p=c.root.index.getById(this.action.routableId);if(p instanceof a.SRoutableElementImpl){const h=this.edgeRouterRegistry.get(p.routerKind),g=h.takeSnapshot(p);h.applyReconnect(p,this.action.newSourceId,this.action.newTargetId);const m=h.takeSnapshot(p);this.memento={edge:p,before:g,after:m}}}undo(c){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.before),c.root}redo(c){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.after),c.root}};return Xn.ReconnectCommand=f,f.KIND=o.ReconnectAction.KIND,n([(0,i.inject)(u.EdgeRouterRegistry),e("design:type",u.EdgeRouterRegistry)],f.prototype,"edgeRouterRegistry",void 0),Xn.ReconnectCommand=f=n([(0,i.injectable)(),t(0,(0,i.inject)(s.TYPES.Action)),e("design:paramtypes",[Object])],f),Xn}var wm;function Y_(){if(wm)return fr;wm=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.labelEditUiModule=fr.labelEditModule=fr.edgeEditModule=void 0;const n=se(),e=ge(),t=Vn(),i=Au(),o=Ca(),r=pt(),s=K_(),a=Da(),u=Yl(),f=$_(),d=Nu(),c=Ul();return fr.edgeEditModule=new n.ContainerModule((l,p,h)=>{const g={bind:l,isBound:h};(0,t.configureCommand)(g,d.SwitchEditModeCommand),(0,t.configureCommand)(g,c.ReconnectCommand),(0,t.configureCommand)(g,a.DeleteElementCommand),(0,o.configureModelElement)(g,"dangling-anchor",r.SDanglingAnchorImpl,s.EmptyGroupView)}),fr.labelEditModule=new n.ContainerModule((l,p,h)=>{l(u.EditLabelMouseListener).toSelf().inSingletonScope(),l(e.TYPES.MouseListener).toService(u.EditLabelMouseListener),l(u.EditLabelKeyListener).toSelf().inSingletonScope(),l(e.TYPES.KeyListener).toService(u.EditLabelKeyListener),(0,t.configureCommand)({bind:l,isBound:h},u.ApplyLabelEditCommand)}),fr.labelEditUiModule=new n.ContainerModule((l,p,h)=>{const g={bind:l,isBound:h};(0,i.configureActionHandler)(g,u.EditLabelAction.KIND,f.EditLabelActionHandler),l(f.EditLabelUI).toSelf().inSingletonScope(),l(e.TYPES.IUIExtension).toService(f.EditLabelUI)}),fr}var Nr={},Ad={},Em;function Gl(){return Em||(Em=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isExpandable=n.expandFeature=void 0,n.expandFeature=Symbol("expandFeature");function e(t){return t.hasFeature(n.expandFeature)&&"expanded"in t}n.isExpandable=e})(Ad)),Ad}var Pm;function k_(){if(Pm)return Nr;Pm=1;var n=Nr&&Nr.__decorate||function(s,a,u,f){var d=arguments.length,c=d<3?a:f===null?f=Object.getOwnPropertyDescriptor(a,u):f,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,a,u,f);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(c=(d<3?l(c):d>3?l(a,u,c):l(a,u))||c);return d>3&&c&&Object.defineProperty(a,u,c),c};Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.ExpandButtonHandler=void 0;const e=se(),t=qe(),i=tn(),o=Gl();let r=class{buttonPressed(a){const u=(0,i.findParentByFeature)(a,o.isExpandable);return u!==void 0?[t.CollapseExpandAction.create({expandIds:u.expanded?[]:[u.id],collapseIds:u.expanded?[u.id]:[]})]:[]}};return Nr.ExpandButtonHandler=r,r.TYPE="button:expand",Nr.ExpandButtonHandler=r=n([(0,e.injectable)()],r),Nr}var Fr={},Mm;function FE(){if(Mm)return Fr;Mm=1;var n=Fr&&Fr.__decorate||function(s,a,u,f){var d=arguments.length,c=d<3?a:f===null?f=Object.getOwnPropertyDescriptor(a,u):f,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,a,u,f);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(c=(d<3?l(c):d>3?l(a,u,c):l(a,u))||c);return d>3&&c&&Object.defineProperty(a,u,c),c};Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.ExpandButtonView=void 0;const e=tr(),t=Gl(),i=tn(),o=se();let r=class{render(a,u){const f=(0,i.findParentByFeature)(a,t.isExpandable),d=f!==void 0&&f.expanded?"M 1,5 L 8,12 L 15,5 Z":"M 1,8 L 8,15 L 8,1 Z";return(0,e.svg)("g",{"class-sprotty-button":"{true}","class-enabled":"{button.enabled}"},(0,e.svg)("rect",{x:0,y:0,width:16,height:16,opacity:0}),(0,e.svg)("path",{d}))}};return Fr.ExpandButtonView=r,Fr.ExpandButtonView=r=n([(0,o.injectable)()],r),Fr}var Et={},Wn={},Rm;function Xl(){if(Rm)return Wn;Rm=1;var n=Wn&&Wn.__decorate||function(f,d,c,l){var p=arguments.length,h=p<3?d:l===null?l=Object.getOwnPropertyDescriptor(d,c):l,g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(f,d,c,l);else for(var m=f.length-1;m>=0;m--)(g=f[m])&&(h=(p<3?g(h):p>3?g(d,c,h):g(d,c))||h);return p>3&&h&&Object.defineProperty(d,c,h),h},e=Wn&&Wn.__metadata||function(f,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(f,d)};Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.SvgExporter=Wn.ExportSvgAction=void 0;const t=se(),i=He(),o=Dl(),r=ge(),s=tt();var a;(function(f){f.KIND="exportSvg";function d(c,l,p){return{kind:f.KIND,svg:c,responseId:l,options:p}}f.create=d})(a||(Wn.ExportSvgAction=a={}));let u=class{constructor(){this.postprocessors=[]}export(d,c){var l;if(typeof document<"u"){const p=document.getElementById(this.options.hiddenDiv);if(p===null){this.log.warn(this,`Element with id ${this.options.hiddenDiv} not found. Nothing to export.`);return}const h=p.querySelector("svg");if(h===null){this.log.warn(this,`No svg element found in ${this.options.hiddenDiv} div. Nothing to export.`);return}const g=this.createSvg(h,d,(l=c?.options)!==null&&l!==void 0?l:{},c);this.actionDispatcher.dispatch(a.create(g,c?c.requestId:"",c?.options))}}createSvg(d,c,l,p){const h=new XMLSerializer,g=h.serializeToString(d),m=document.createElement("iframe");if(document.body.appendChild(m),!m.contentWindow)throw new Error("IFrame has no contentWindow");const y=m.contentWindow.document;y.open(),y.write(g),y.close();const b=y.querySelector("svg");b.removeAttribute("opacity"),l?.skipCopyStyles||this.copyStyles(d,b,["width","height","opacity","inline-size"]),b.setAttribute("version","1.1");const v=this.getBounds(c,y);b.setAttribute("viewBox",`${v.x} ${v.y} ${v.width} ${v.height}`),b.setAttribute("width",`${v.width}`),b.setAttribute("height",`${v.height}`),this.postprocessors.forEach(S=>{S.postUpdate(b,p)});const _=h.serializeToString(b);return document.body.removeChild(m),_}copyStyles(d,c,l){const p=getComputedStyle(d),h=getComputedStyle(c);let g="";for(let m=0;m<p.length;m++){const y=p[m];if(l.indexOf(y)===-1){const b=p.getPropertyValue(y);h.getPropertyValue(y)!==b&&(g+=y+":"+b+";")}}g!==""&&c.setAttribute("style",g);for(let m=0;m<d.childNodes.length;++m){const y=d.childNodes[m],b=c.childNodes[m];y instanceof Element&&this.copyStyles(y,b,[])}}getBounds(d,c){const l=c.querySelector("svg");if(l)return l.getBBox();const p=[i.Bounds.EMPTY];return d.children.forEach(h=>{(0,s.isBoundsAware)(h)&&p.push(h.bounds)}),p.reduce((h,g)=>i.Bounds.combine(h,g))}};return Wn.SvgExporter=u,n([(0,t.inject)(r.TYPES.ViewerOptions),e("design:type",Object)],u.prototype,"options",void 0),n([(0,t.inject)(r.TYPES.IActionDispatcher),e("design:type",o.ActionDispatcher)],u.prototype,"actionDispatcher",void 0),n([(0,t.inject)(r.TYPES.ILogger),e("design:type",Object)],u.prototype,"log",void 0),n([(0,t.multiInject)(r.TYPES.ISvgExportPostprocessor),(0,t.optional)(),e("design:type",Array)],u.prototype,"postprocessors",void 0),Wn.SvgExporter=u=n([(0,t.injectable)()],u),Wn}var Am;function U_(){if(Am)return Et;Am=1;var n=Et&&Et.__decorate||function(v,_,S,E){var O=arguments.length,R=O<3?_:E===null?E=Object.getOwnPropertyDescriptor(_,S):E,w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(v,_,S,E);else for(var M=v.length-1;M>=0;M--)(w=v[M])&&(R=(O<3?w(R):O>3?w(_,S,R):w(_,S))||R);return O>3&&R&&Object.defineProperty(_,S,R),R},e=Et&&Et.__metadata||function(v,_){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(v,_)},t=Et&&Et.__param||function(v,_){return function(S,E){_(S,E,v)}};Object.defineProperty(Et,"__esModule",{value:!0}),Et.ExportSvgPostprocessor=Et.ExportSvgCommand=Et.RequestExportSvgAction=Et.ExportSvgKeyListener=void 0;const i=se(),o=qe(),r=gt(),s=zn(),a=Ke(),u=Pr(),f=Jr(),d=Kl(),c=Xl(),l=Mr(),p=cs(),h=ge();let g=class extends u.KeyListener{keyDown(_,S){return(0,f.matchesKeystroke)(S,"KeyE","ctrlCmd","shift")?[m.create()]:[]}};Et.ExportSvgKeyListener=g,Et.ExportSvgKeyListener=g=n([(0,i.injectable)()],g);var m;(function(v){v.KIND="requestExportSvg";function _(S={}){return{kind:v.KIND,requestId:(0,o.generateRequestId)(),options:S}}v.create=_})(m||(Et.RequestExportSvgAction=m={}));let y=class extends r.HiddenCommand{constructor(_){super(),this.action=_}execute(_){if((0,d.isExportable)(_.root)){const S=_.modelFactory.createRoot(_.root);if((0,d.isExportable)(S))return(0,l.isViewport)(S)&&(S.zoom=1,S.scroll={x:0,y:0}),S.index.all().forEach(E=>{(0,s.isSelectable)(E)&&E.selected&&(E.selected=!1),(0,p.isHoverable)(E)&&E.hoverFeedback&&(E.hoverFeedback=!1)}),{model:S,modelChanged:!0,cause:this.action}}return{model:_.root,modelChanged:!1}}};Et.ExportSvgCommand=y,y.KIND=m.KIND,Et.ExportSvgCommand=y=n([t(0,(0,i.inject)(h.TYPES.Action)),e("design:paramtypes",[Object])],y);let b=class{decorate(_,S){return S instanceof a.SModelRootImpl&&(this.root=S),_}postUpdate(_){this.root&&_!==void 0&&_.kind===m.KIND&&this.svgExporter.export(this.root,_)}};return Et.ExportSvgPostprocessor=b,n([(0,i.inject)(h.TYPES.SvgExporter),e("design:type",c.SvgExporter)],b.prototype,"svgExporter",void 0),Et.ExportSvgPostprocessor=b=n([(0,i.injectable)()],b),Et}var Od={},Om;function BE(){return Om||(Om=1,Object.defineProperty(Od,"__esModule",{value:!0})),Od}var zi={},Im;function Wl(){if(Im)return zi;Im=1;var n=zi&&zi.__decorate||function(u,f,d,c){var l=arguments.length,p=l<3?f:c===null?c=Object.getOwnPropertyDescriptor(f,d):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(u,f,d,c);else for(var g=u.length-1;g>=0;g--)(h=u[g])&&(p=(l<3?h(p):l>3?h(f,d,p):h(f,d))||p);return l>3&&p&&Object.defineProperty(f,d,p),p};Object.defineProperty(zi,"__esModule",{value:!0}),zi.ElementFader=zi.FadeAnimation=void 0;const e=se(),t=as(),i=Ke(),o=Wt(),r=Ta();class s extends t.Animation{constructor(f,d,c,l=!1){super(c),this.model=f,this.elementFades=d,this.removeAfterFadeOut=l}tween(f,d){for(const c of this.elementFades){const l=c.element;c.type==="in"?l.opacity=f:c.type==="out"&&(l.opacity=1-f,f===1&&this.removeAfterFadeOut&&l instanceof i.SChildElementImpl&&l.parent.remove(l))}return this.model}}zi.FadeAnimation=s;let a=class{decorate(f,d){return(0,r.isFadeable)(d)&&d.opacity!==1&&(0,o.setAttr)(f,"opacity",d.opacity),f}postUpdate(){}};return zi.ElementFader=a,zi.ElementFader=a=n([(0,e.injectable)()],a),zi}var Ue={},Cm;function G_(){if(Cm)return Ue;Cm=1;var n=Ue&&Ue.__decorate||function(O,R,w,M){var I=arguments.length,D=I<3?R:M===null?M=Object.getOwnPropertyDescriptor(R,w):M,C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")D=Reflect.decorate(O,R,w,M);else for(var z=O.length-1;z>=0;z--)(C=O[z])&&(D=(I<3?C(D):I>3?C(R,w,D):C(R,w))||D);return I>3&&D&&Object.defineProperty(R,w,D),D},e=Ue&&Ue.__metadata||function(O,R){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(O,R)},t=Ue&&Ue.__param||function(O,R){return function(w,M){R(w,M,O)}};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.ClosePopupActionHandler=Ue.HoverKeyListener=Ue.PopupHoverMouseListener=Ue.HoverMouseListener=Ue.AbstractHoverMouseListener=Ue.SetPopupModelCommand=Ue.HoverFeedbackCommand=void 0;const i=se(),o=qe(),r=He(),s=Jr(),a=ge(),u=Ke(),f=ni(),d=gt(),c=Zr(),l=Pr(),p=tn(),h=tt(),g=cs();let m=class extends d.SystemCommand{constructor(R){super(),this.action=R}execute(R){const M=R.root.index.getById(this.action.mouseoverElement);return M&&(0,g.isHoverable)(M)&&(M.hoverFeedback=this.action.mouseIsOver),this.redo(R)}undo(R){return R.root}redo(R){return R.root}};Ue.HoverFeedbackCommand=m,m.KIND=o.HoverFeedbackAction.KIND,Ue.HoverFeedbackCommand=m=n([(0,i.injectable)(),t(0,(0,i.inject)(a.TYPES.Action)),e("design:paramtypes",[Object])],m);let y=class extends d.PopupCommand{constructor(R){super(),this.action=R}execute(R){return this.oldRoot=R.root,this.newRoot=R.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(R){return this.oldRoot}redo(R){return this.newRoot}};Ue.SetPopupModelCommand=y,y.KIND=o.SetPopupModelAction.KIND,Ue.SetPopupModelCommand=y=n([(0,i.injectable)(),t(0,(0,i.inject)(a.TYPES.Action)),e("design:paramtypes",[Object])],y);class b extends f.MouseListener{mouseDown(R,w){return this.mouseIsDown=!0,[]}mouseUp(R,w){return this.mouseIsDown=!1,[]}stopMouseOutTimer(){this.state.mouseOutTimer!==void 0&&(window.clearTimeout(this.state.mouseOutTimer),this.state.mouseOutTimer=void 0)}startMouseOutTimer(){return this.stopMouseOutTimer(),new Promise(R=>{this.state.mouseOutTimer=window.setTimeout(()=>{this.state.popupOpen=!1,this.state.previousPopupElement=void 0,R(o.SetPopupModelAction.create({type:c.EMPTY_ROOT.type,id:c.EMPTY_ROOT.id}))},this.options.popupCloseDelay)})}stopMouseOverTimer(){this.state.mouseOverTimer!==void 0&&(window.clearTimeout(this.state.mouseOverTimer),this.state.mouseOverTimer=void 0)}}Ue.AbstractHoverMouseListener=b,n([(0,i.inject)(a.TYPES.ViewerOptions),e("design:type",Object)],b.prototype,"options",void 0),n([(0,i.inject)(a.TYPES.HoverState),e("design:type",Object)],b.prototype,"state",void 0);let v=class extends b{computePopupBounds(R,w){let M={x:-5,y:20};const I=(0,h.getAbsoluteBounds)(R),D=R.root.canvasBounds,C=r.Bounds.translate(I,D),z=C.x+C.width-w.x,G=C.y+C.height-w.y;G<=z&&this.allowSidePosition(R,"below",G)?M={x:-5,y:Math.round(G+5)}:z<=G&&this.allowSidePosition(R,"right",z)&&(M={x:Math.round(z+5),y:-5});let N=w.x+M.x;const U=D.x+D.width;N>U&&(N=U);let Q=w.y+M.y;const J=D.y+D.height;return Q>J&&(Q=J),{x:N,y:Q,width:-1,height:-1}}allowSidePosition(R,w,M){return!(R instanceof u.SModelRootImpl)&&M<=150}startMouseOverTimer(R,w){return this.stopMouseOverTimer(),new Promise(M=>{this.state.mouseOverTimer=window.setTimeout(()=>{const I=this.computePopupBounds(R,{x:w.pageX,y:w.pageY});M(o.RequestPopupModelAction.create({elementId:R.id,bounds:I})),this.state.popupOpen=!0,this.state.previousPopupElement=R},this.options.popupOpenDelay)})}mouseOver(R,w){const M=[];if(!this.mouseIsDown){const I=(0,p.findParent)(R,g.hasPopupFeature);this.state.popupOpen&&(I===void 0||this.state.previousPopupElement!==void 0&&this.state.previousPopupElement.id!==I.id)?M.push(this.startMouseOutTimer()):(this.stopMouseOverTimer(),this.stopMouseOutTimer()),I!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==I.id)&&M.push(this.startMouseOverTimer(I,w)),this.lastHoverFeedbackElementId&&(M.push(o.HoverFeedbackAction.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0);const D=(0,p.findParentByFeature)(R,g.isHoverable);D!==void 0&&(M.push(o.HoverFeedbackAction.create({mouseoverElement:D.id,mouseIsOver:!0})),this.lastHoverFeedbackElementId=D.id)}return M}mouseOut(R,w){const M=[];if(!this.mouseIsDown){const I=this.getElementFromEventPosition(w);if(!this.isSprottyPopup(I)){if(this.state.popupOpen){const C=(0,p.findParent)(R,g.hasPopupFeature);this.state.previousPopupElement!==void 0&&C!==void 0&&this.state.previousPopupElement.id===C.id&&M.push(this.startMouseOutTimer())}this.stopMouseOverTimer();const D=(0,p.findParentByFeature)(R,g.isHoverable);D!==void 0&&(M.push(o.HoverFeedbackAction.create({mouseoverElement:D.id,mouseIsOver:!1})),this.lastHoverFeedbackElementId&&this.lastHoverFeedbackElementId!==D.id&&M.push(o.HoverFeedbackAction.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0)}}return M}getElementFromEventPosition(R){return document.elementFromPoint(R.x,R.y)}isSprottyPopup(R){return R?R.id===this.options.popupDiv||!!R.parentElement&&this.isSprottyPopup(R.parentElement):!1}mouseMove(R,w){const M=[];if(!this.mouseIsDown){this.state.previousPopupElement!==void 0&&this.closeOnMouseMove(this.state.previousPopupElement,w)&&M.push(this.startMouseOutTimer());const I=(0,p.findParent)(R,g.hasPopupFeature);I!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==I.id)&&M.push(this.startMouseOverTimer(I,w))}return M}closeOnMouseMove(R,w){return R instanceof u.SModelRootImpl}};Ue.HoverMouseListener=v,n([(0,i.inject)(a.TYPES.ViewerOptions),e("design:type",Object)],v.prototype,"options",void 0),Ue.HoverMouseListener=v=n([(0,i.injectable)()],v);let _=class extends b{mouseOut(R,w){return[this.startMouseOutTimer()]}mouseOver(R,w){return this.stopMouseOutTimer(),this.stopMouseOverTimer(),[]}};Ue.PopupHoverMouseListener=_,Ue.PopupHoverMouseListener=_=n([(0,i.injectable)()],_);class S extends l.KeyListener{keyDown(R,w){return(0,s.matchesKeystroke)(w,"Escape")?[o.SetPopupModelAction.create({type:c.EMPTY_ROOT.type,id:c.EMPTY_ROOT.id})]:[]}}Ue.HoverKeyListener=S;let E=class{constructor(){this.popupOpen=!1}handle(R){if(R.kind===y.KIND)this.popupOpen=R.newRoot.type!==c.EMPTY_ROOT.type;else if(this.popupOpen)return o.SetPopupModelAction.create({id:c.EMPTY_ROOT.id,type:c.EMPTY_ROOT.type})}};return Ue.ClosePopupActionHandler=E,Ue.ClosePopupActionHandler=E=n([(0,i.injectable)()],E),Ue}var Id={},Tm;function Zl(){return Tm||(Tm=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.SIssue=n.SIssueMarker=n.SIssueMarkerImpl=n.SDecoration=n.isDecoration=n.decorationFeature=void 0;const e=tt(),t=cs();n.decorationFeature=Symbol("decorationFeature");function i(a){return a.hasFeature(n.decorationFeature)}n.isDecoration=i;class o extends e.SShapeElementImpl{}n.SDecoration=o,o.DEFAULT_FEATURES=[n.decorationFeature,e.boundsFeature,t.hoverFeedbackFeature,t.popupFeature];class r extends o{}n.SIssueMarkerImpl=r,n.SIssueMarker=r;class s{}n.SIssue=s})(Id)),Id}var Br={},Dm;function X_(){if(Dm)return Br;Dm=1;var n=Br&&Br.__decorate||function(r,s,a,u){var f=arguments.length,d=f<3?s:u===null?u=Object.getOwnPropertyDescriptor(s,a):u,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(r,s,a,u);else for(var l=r.length-1;l>=0;l--)(c=r[l])&&(d=(f<3?c(d):f>3?c(s,a,d):c(s,a))||d);return f>3&&d&&Object.defineProperty(s,a,d),d};Object.defineProperty(Br,"__esModule",{value:!0}),Br.IssueMarkerView=void 0;const e=tr(),t=Wt(),i=se();let o=class{render(s,a){const u=.008928571428571428,f=`scale(${u}, ${u})`,d=this.getMaxSeverity(s),c=(0,e.svg)("g",{"class-sprotty-issue":!0},(0,e.svg)("g",{transform:f},(0,e.svg)("path",{d:this.getPath(d)})));return(0,t.setClass)(c,"sprotty-"+d,!0),c}getMaxSeverity(s){let a="info";for(const u of s.issues.map(f=>f.severity))(u==="error"||u==="warning"&&a==="info")&&(a=u);return a}getPath(s){switch(s){case"error":case"warning":return"M768 128q209 0 385.5 103t279.5 279.5 103 385.5-103 385.5-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103zm128 1247v-190q0-14-9-23.5t-22-9.5h-192q-13 0-23 10t-10 23v190q0 13 10 23t23 10h192q13 0 22-9.5t9-23.5zm-2-344l18-621q0-12-10-18-10-8-24-8h-220q-14 0-24 8-10 6-10 18l17 621q0 10 10 17.5t24 7.5h185q14 0 23.5-7.5t10.5-17.5z";case"info":return"M1024 1376v-160q0-14-9-23t-23-9h-96v-512q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v160q0 14 9 23t23 9h96v320h-96q-14 0-23 9t-9 23v160q0 14 9 23t23 9h448q14 0 23-9t9-23zm-128-896v-160q0-14-9-23t-23-9h-192q-14 0-23 9t-9 23v160q0 14 9 23t23 9h192q14 0 23-9t9-23zm640 416q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"}}};return Br.IssueMarkerView=o,Br.IssueMarkerView=o=n([(0,i.injectable)()],o),Br}var qi={},xm;function W_(){if(xm)return qi;xm=1;var n=qi&&qi.__decorate||function(c,l,p,h){var g=arguments.length,m=g<3?l:h===null?h=Object.getOwnPropertyDescriptor(l,p):h,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(c,l,p,h);else for(var b=c.length-1;b>=0;b--)(y=c[b])&&(m=(g<3?y(m):g>3?y(l,p,m):y(l,p))||m);return g>3&&m&&Object.defineProperty(l,p,m),m},e=qi&&qi.__metadata||function(c,l){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(c,l)};Object.defineProperty(qi,"__esModule",{value:!0}),qi.DecorationPlacer=void 0;const t=se(),i=Ke(),o=Zl(),r=Wt(),s=tt(),a=pt(),u=nr(),f=ti();let d=class{decorate(l,p){if((0,o.isDecoration)(p)){const h=this.getPosition(p),g="translate("+h.x+", "+h.y+")";(0,r.setAttr)(l,"transform",g)}return l}getPosition(l){if(l instanceof i.SChildElementImpl&&l.parent instanceof a.SRoutableElementImpl){const p=this.edgeRouterRegistry.route(l.parent);if(p.length>1){const h=Math.floor(.5*(p.length-1)),g=(0,s.isSizeable)(l)?{x:-.5*l.bounds.width,y:-.5*l.bounds.width}:f.Point.ORIGIN;return{x:.5*(p[h].x+p[h+1].x)+g.x,y:.5*(p[h].y+p[h+1].y)+g.y}}}return(0,s.isSizeable)(l)?{x:-.666*l.bounds.width,y:-.666*l.bounds.height}:f.Point.ORIGIN}postUpdate(){}};return qi.DecorationPlacer=d,n([(0,t.inject)(u.EdgeRouterRegistry),e("design:type",u.EdgeRouterRegistry)],d.prototype,"edgeRouterRegistry",void 0),qi.DecorationPlacer=d=n([(0,t.injectable)()],d),qi}var Pt={};class VE{constructor(e=[],t=zE){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,o=t[e];for(;e>0;){const r=e-1>>1,s=t[r];if(i(o,s)>=0)break;t[e]=s,e=r}t[e]=o}_down(e){const{data:t,compare:i}=this,o=this.length>>1,r=t[e];for(;e<o;){let s=(e<<1)+1,a=t[s];const u=s+1;if(u<this.length&&i(t[u],a)<0&&(s=u,a=t[u]),i(a,r)>=0)break;t[e]=a,e=s}t[e]=r}}function zE(n,e){return n<e?-1:n>e?1:0}const qE=Object.freeze(Object.defineProperty({__proto__:null,default:VE},Symbol.toStringTag,{value:"Module"})),Z_=rv(qE);var _t={},jm;function J_(){if(jm)return _t;jm=1;var n=_t&&_t.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(_t,"__esModule",{value:!0}),_t.intersectionOfSegments=_t.getSegmentIndex=_t.checkWhichSegmentHasRightEndpointFirst=_t.runSweep=_t.Segment=_t.SweepEvent=_t.checkWhichEventIsLeft=_t.addRoute=void 0;const e=n(Z_),t=eo();function i(c,l,p){if(l.length<1)return;let h=l[0],g;for(let m=0;m<l.length-1;m++){g=l[m+1];const y=new r(c,h,m),b=new r(c,g,m+1);y.otherEvent=b,b.otherEvent=y,o(y,b)>0?(b.isLeftEndpoint=!0,y.isLeftEndpoint=!1):(y.isLeftEndpoint=!0,b.isLeftEndpoint=!1),p.push(y),p.push(b),h=g}}_t.addRoute=i;function o(c,l){return c.point.x>l.point.x?1:c.point.x<l.point.x?-1:c.point.y!==l.point.y?c.point.y>l.point.y?1:-1:1}_t.checkWhichEventIsLeft=o;class r{constructor(l,p,h){this.edgeId=l,this.point=p,this.segmentIndex=h}}_t.SweepEvent=r;class s{constructor(l){this.leftSweepEvent=l,this.rightSweepEvent=l.otherEvent}}_t.Segment=s;function a(c){const l=[],p=new e.default([],u);for(;c.length;){const h=c.pop();if(h?.isLeftEndpoint){const g=new s(h);for(let m=0;m<p.data.length;m++){const y=p.data[m],b=d(g,y);b&&l.push({routable1:h.edgeId,routable2:y.leftSweepEvent.edgeId,segmentIndex1:f(g),segmentIndex2:f(y),intersectionPoint:b})}p.push(g)}else h?.isLeftEndpoint===!1&&p.pop()}return l}_t.runSweep=a;function u(c,l){return c.rightSweepEvent.point.x>l.rightSweepEvent.point.x?1:c.rightSweepEvent.point.x<l.rightSweepEvent.point.x?-1:c.rightSweepEvent.point.y!==l.rightSweepEvent.point.y?c.rightSweepEvent.point.y<l.rightSweepEvent.point.y?1:-1:1}_t.checkWhichSegmentHasRightEndpointFirst=u;function f(c){return Math.min(c.leftSweepEvent.segmentIndex,c.rightSweepEvent.segmentIndex)}_t.getSegmentIndex=f;function d(c,l){if(c.leftSweepEvent.edgeId===l.leftSweepEvent.edgeId)return;const p=new t.PointToPointLine(c.leftSweepEvent.point,c.rightSweepEvent.point),h=new t.PointToPointLine(l.leftSweepEvent.point,l.rightSweepEvent.point);return p.intersection(h)}return _t.intersectionOfSegments=d,_t}var Lm;function Jl(){if(Lm)return Pt;Lm=1;var n=Pt&&Pt.__decorate||function(c,l,p,h){var g=arguments.length,m=g<3?l:h===null?h=Object.getOwnPropertyDescriptor(l,p):h,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(c,l,p,h);else for(var b=c.length-1;b>=0;b--)(y=c[b])&&(m=(g<3?y(m):g>3?y(l,p,m):y(l,p))||m);return g>3&&m&&Object.defineProperty(l,p,m),m},e=Pt&&Pt.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.IntersectionFinder=Pt.BY_DESCENDING_X_THEN_DESCENDING_Y=Pt.BY_X_THEN_DESCENDING_Y=Pt.BY_DESCENDING_X_THEN_Y=Pt.BY_X_THEN_Y=Pt.isIntersectingRoutedPoint=void 0;const t=se(),i=e(Z_),o=J_();function r(c){return c!==void 0&&"intersections"in c&&"kind"in c}Pt.isIntersectingRoutedPoint=r;const s=(c,l)=>c.intersectionPoint.x===l.intersectionPoint.x?c.intersectionPoint.y-l.intersectionPoint.y:c.intersectionPoint.x-l.intersectionPoint.x;Pt.BY_X_THEN_Y=s;const a=(c,l)=>c.intersectionPoint.x===l.intersectionPoint.x?c.intersectionPoint.y-l.intersectionPoint.y:l.intersectionPoint.x-c.intersectionPoint.x;Pt.BY_DESCENDING_X_THEN_Y=a;const u=(c,l)=>c.intersectionPoint.x===l.intersectionPoint.x?l.intersectionPoint.y-c.intersectionPoint.y:c.intersectionPoint.x-l.intersectionPoint.x;Pt.BY_X_THEN_DESCENDING_Y=u;const f=(c,l)=>c.intersectionPoint.x===l.intersectionPoint.x?l.intersectionPoint.y-c.intersectionPoint.y:l.intersectionPoint.x-c.intersectionPoint.x;Pt.BY_DESCENDING_X_THEN_DESCENDING_Y=f;let d=class{apply(l){const p=this.find(l);this.addToRouting(p,l)}find(l){const p=new i.default(void 0,o.checkWhichEventIsLeft);return l.routes.forEach((h,g)=>{this.isSupportedRoute(h)&&(0,o.addRoute)(g,h,p)}),(0,o.runSweep)(p)}isSupportedRoute(l){return l.find(p=>p.kind!=="source"&&p.kind!=="target"&&p.kind!=="linear")===void 0}addToRouting(l,p){for(const h of l){const g=p.get(h.routable1),m=p.get(h.routable2);this.addIntersectionToRoutedPoint(h,g,h.segmentIndex1),this.addIntersectionToRoutedPoint(h,m,h.segmentIndex2)}}addIntersectionToRoutedPoint(l,p,h){if(p&&p.length>h){const g=p[h+1];if(r(g))g.intersections.push(l);else{const m=Object.assign(Object.assign({},g),{intersections:[l]});p[h+1]=m}}}};return Pt.IntersectionFinder=d,Pt.IntersectionFinder=d=n([(0,t.injectable)()],d),Pt}var Vr={},Nm;function Q_(){if(Nm)return Vr;Nm=1;var n=Vr&&Vr.__decorate||function(o,r,s,a){var u=arguments.length,f=u<3?r:a===null?a=Object.getOwnPropertyDescriptor(r,s):a,d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,r,s,a);else for(var c=o.length-1;c>=0;c--)(d=o[c])&&(f=(u<3?d(f):u>3?d(r,s,f):d(r,s))||f);return u>3&&f&&Object.defineProperty(r,s,f),f};Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.JunctionFinder=void 0;const e=se(),t=us();let i=class{constructor(){this.edgesMap=new Map,this.sourcesMap=new Map,this.targetsMap=new Map}apply(r,s){this.findJunctions(r,s)}findJunctions(r,s){Array.from(s.index.all().filter(u=>u instanceof t.SEdgeImpl)).forEach(u=>{this.edgesMap.set(u.id,u);const f=this.sourcesMap.get(u.sourceId);f?f.add(u.id):this.sourcesMap.set(u.sourceId,new Set([u.id]));const d=this.targetsMap.get(u.targetId);d?d.add(u.id):this.targetsMap.set(u.targetId,new Set([u.id]))}),r.routes.forEach((u,f)=>{const d=this.edgesMap.get(f);d&&(this.findJunctionPointsWithSameSource(d,u,r),this.findJunctionPointsWithSameTarget(d,u,r))})}findJunctionPointsWithSameSource(r,s,a){const u=this.sourcesMap.get(r.sourceId);if(!u)return;const d=Array.from(u).filter(c=>c!==r.id).map(c=>a.get(c)).filter(c=>c!==void 0);for(const c of d){const l=this.getJunctionIndex(s,c);l===-1||l===0||this.setJunctionPoints(s,c,l)}}findJunctionPointsWithSameTarget(r,s,a){const u=this.targetsMap.get(r.targetId);if(!u)return;const d=Array.from(u).filter(c=>c!==r.id).map(c=>a.get(c)).filter(c=>c!==void 0);s.reverse();for(const c of d){c.reverse();const l=this.getJunctionIndex(s,c);l===-1||l===0||(this.setJunctionPoints(s,c,l),c.reverse())}s.reverse()}setJunctionPoints(r,s,a){const u=this.getSegmentDirection(r[a-1],r[a]),f=this.getSegmentDirection(s[a-1],s[a]);if(u!==f)this.setPreviousPointAsJunction(r,s,a);else if(u==="left"||u==="right"){if(r[a].y!==s[a].y){this.setPreviousPointAsJunction(r,s,a);return}r[a].isJunction=u==="left"?r[a].x>s[a].x:r[a].x<s[a].x,s[a].isJunction=u==="left"?s[a].x>r[a].x:s[a].x<r[a].x}else{if(r[a].x!==s[a].x){this.setPreviousPointAsJunction(r,s,a);return}r[a].isJunction=u==="up"?r[a].y>s[a].y:r[a].y<s[a].y,s[a].isJunction=u==="up"?s[a].y>r[a].y:s[a].y<r[a].y}}setPreviousPointAsJunction(r,s,a){r[a-1].isJunction=!0,s[a-1].isJunction=!0}getSegmentDirection(r,s){const a=s.x-r.x,u=s.y-r.y;let f="horizontal";return Math.abs(a)<Math.abs(u)&&(f="vertical"),f==="horizontal"?a>0?"right":"left":u>0?"down":"up"}getJunctionIndex(r,s){let a=0;for(;a<r.length&&a<s.length;){if(r[a].x!==s[a].x||r[a].y!==s[a].y)return a;a++}return-1}};return Vr.JunctionFinder=i,Vr.JunctionFinder=i=n([(0,e.injectable)()],i),Vr}var Hi={},Fm;function eb(){if(Fm)return Hi;Fm=1;var n=Hi&&Hi.__decorate||function(a,u,f,d){var c=arguments.length,l=c<3?u:d===null?d=Object.getOwnPropertyDescriptor(u,f):d,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(a,u,f,d);else for(var h=a.length-1;h>=0;h--)(p=a[h])&&(l=(c<3?p(l):c>3?p(u,f,l):p(u,f))||l);return c>3&&l&&Object.defineProperty(u,f,l),l},e=Hi&&Hi.__metadata||function(a,u){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,u)};Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.JunctionPostProcessor=void 0;const t=se(),i=ti(),o=ge(),r=ds();let s=class{constructor(){this.isFirstRender=!0}decorate(u,f){return u}postUpdate(u){this.currentModel!==this.modelSource.model&&(this.isFirstRender=!0),u?.kind===i.RequestBoundsAction.KIND&&this.isFirstRender&&(document.querySelectorAll(`#${this.viewerOptions.hiddenDiv} > svg > g > g.sprotty-junction`).forEach(p=>p.remove()),document.querySelectorAll(`#${this.viewerOptions.baseDiv} > svg > g > g.sprotty-junction`).forEach(p=>p.remove()));const f=document.querySelector(`#${this.viewerOptions.hiddenDiv} > svg > g`),d=document.querySelector(`#${this.viewerOptions.baseDiv} > svg > g`);if(f){const c=Array.from(document.querySelectorAll(`#${this.viewerOptions.hiddenDiv} > svg > g > g > g.sprotty-junction`));c.forEach(l=>{l.remove()}),f.append(...c)}if(d){const c=Array.from(document.querySelectorAll(`#${this.viewerOptions.baseDiv} > svg > g > g > g.sprotty-junction`));c.forEach(l=>{l.remove()}),d.append(...c)}this.currentModel=this.modelSource.model,this.isFirstRender=!1}};return Hi.JunctionPostProcessor=s,n([(0,t.inject)(o.TYPES.ViewerOptions),e("design:type",Object)],s.prototype,"viewerOptions",void 0),n([(0,t.inject)(o.TYPES.ModelSource),e("design:type",r.ModelSource)],s.prototype,"modelSource",void 0),Hi.JunctionPostProcessor=s=n([(0,t.injectable)()],s),Hi}var bt={},Bm;function Fu(){if(Bm)return bt;Bm=1;var n=bt&&bt.__decorate||function(G,N,U,Q){var J=arguments.length,ce=J<3?N:Q===null?Q=Object.getOwnPropertyDescriptor(N,U):Q,we;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")ce=Reflect.decorate(G,N,U,Q);else for(var K=G.length-1;K>=0;K--)(we=G[K])&&(ce=(J<3?we(ce):J>3?we(N,U,ce):we(N,U))||ce);return J>3&&ce&&Object.defineProperty(N,U,ce),ce},e=bt&&bt.__metadata||function(G,N){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(G,N)},t=bt&&bt.__param||function(G,N){return function(U,Q){N(U,Q,G)}},i;Object.defineProperty(bt,"__esModule",{value:!0}),bt.LocationPostprocessor=bt.MoveMouseListener=bt.MorphEdgesAnimation=bt.MoveAnimation=bt.MoveCommand=void 0;const o=se(),r=He(),s=qe(),a=as(),u=gt(),f=Ke(),d=tn(),c=ge(),l=ni(),p=Wt(),h=us(),g=Lu(),m=tt(),y=H_(),b=Nu(),v=Ul(),_=pt(),S=nr(),E=xa(),O=zn(),R=Mr(),w=Qr();let M=i=class extends u.MergeableCommand{constructor(N){super(),this.action=N,this.resolvedMoves=new Map,this.edgeMementi=[],this.stoppableCommandKey=i.KIND}stopExecution(){this.animation&&(this.animation.stop(),this.animation=void 0)}execute(N){const U=N.root.index,Q=new Map,J=new Map;return this.action.moves.forEach(ce=>{const we=U.getById(ce.elementId);if(we instanceof _.SRoutingHandleImpl&&this.edgeRouterRegistry){const K=we.parent;if(K instanceof _.SRoutableElementImpl){const q=this.resolveHandleMove(we,K,ce);if(q){let ae=Q.get(K);ae||(ae=[],Q.set(K,ae)),ae.push(q)}}}else if(we&&(0,w.isLocateable)(we)){const K=this.resolveElementMove(we,ce);if(K&&(this.resolvedMoves.set(K.element.id,K),this.edgeRouterRegistry)){const q=me=>{U.getAttachedElements(me).forEach(ve=>{if(ve instanceof _.SRoutableElementImpl&&!this.isChildOfMovedElements(ve)){const L=J.get(ve),j=r.Point.subtract(K.toPosition,K.fromPosition),V=L?r.Point.linear(L,j,.5):j;J.set(ve,V)}})},ae=me=>{(0,f.isParent)(me)&&me.children.forEach(ve=>{ve instanceof f.SModelElementImpl&&(ve instanceof _.SConnectableElementImpl&&q(ve),ae(ve))})};ae(we),q(we)}}}),this.doMove(Q,J),this.action.animate?(this.undoMove(),(this.animation=new a.CompoundAnimation(N.root,N,[new I(N.root,this.resolvedMoves,N,!1),new D(N.root,this.edgeMementi,N,!1)])).start()):N.root}resolveHandleMove(N,U,Q){let J=Q.fromPosition;if(!J){const ce=this.edgeRouterRegistry.get(U.routerKind);J=ce.getHandlePosition(U,ce.route(U),N)}if(J)return{handle:N,fromPosition:J,toPosition:Q.toPosition}}resolveElementMove(N,U){const Q=U.fromPosition||{x:N.position.x,y:N.position.y};return{element:N,fromPosition:Q,toPosition:U.toPosition}}doMove(N,U){this.resolvedMoves.forEach(Q=>{Q.element.position=Q.toPosition}),N.forEach((Q,J)=>{const ce=this.edgeRouterRegistry.get(J.routerKind),we=ce.takeSnapshot(J);ce.applyHandleMoves(J,Q);const K=ce.takeSnapshot(J);this.edgeMementi.push({edge:J,before:we,after:K})}),U.forEach((Q,J)=>{if(!N.get(J)){const ce=this.edgeRouterRegistry.get(J.routerKind),we=ce.takeSnapshot(J);if(this.isAttachedEdge(J))J.routingPoints=J.routingPoints.map(q=>r.Point.add(q,Q));else{const q=(0,O.isSelectable)(J)&&J.selected;ce.cleanupRoutingPoints(J,J.routingPoints,q,this.action.finished)}const K=ce.takeSnapshot(J);this.edgeMementi.push({edge:J,before:we,after:K})}})}isChildOfMovedElements(N){const U=N.parent;return Array.from(this.resolvedMoves.values()).map(Q=>Q.element.id).includes(U.id)?!0:U instanceof f.SChildElementImpl?this.isChildOfMovedElements(U):!1}isAttachedEdge(N){const U=N.source,Q=N.target,J=ce=>!!this.resolvedMoves.get(ce.id)||this.isChildOfMovedElements(ce);return!!(U&&Q&&J(U)&&J(Q))}undoMove(){this.resolvedMoves.forEach(N=>{N.element.position=N.fromPosition}),this.edgeMementi.forEach(N=>{this.edgeRouterRegistry.get(N.edge.routerKind).applySnapshot(N.edge,N.before)})}undo(N){return new a.CompoundAnimation(N.root,N,[new I(N.root,this.resolvedMoves,N,!0),new D(N.root,this.edgeMementi,N,!0)]).start()}redo(N){return new a.CompoundAnimation(N.root,N,[new I(N.root,this.resolvedMoves,N,!1),new D(N.root,this.edgeMementi,N,!1)]).start()}merge(N,U){if(!this.action.animate&&N instanceof i)return N.resolvedMoves.forEach((Q,J)=>{const ce=this.resolvedMoves.get(J);ce?ce.toPosition=Q.toPosition:this.resolvedMoves.set(J,Q)}),N.edgeMementi.forEach(Q=>{const J=this.edgeMementi.find(ce=>ce.edge.id===Q.edge.id);J?J.after=Q.after:this.edgeMementi.push(Q)}),!0;if(N instanceof v.ReconnectCommand){const Q=N.memento;if(Q){const J=this.edgeMementi.find(ce=>ce.edge.id===Q.edge.id);J?J.after=Q.after:this.edgeMementi.push(Q)}return!0}return!1}};bt.MoveCommand=M,M.KIND=s.MoveAction.KIND,n([(0,o.inject)(S.EdgeRouterRegistry),(0,o.optional)(),e("design:type",S.EdgeRouterRegistry)],M.prototype,"edgeRouterRegistry",void 0),bt.MoveCommand=M=i=n([(0,o.injectable)(),t(0,(0,o.inject)(c.TYPES.Action)),e("design:paramtypes",[Object])],M);class I extends a.Animation{constructor(N,U,Q,J=!1){super(Q),this.model=N,this.elementMoves=U,this.reverse=J}tween(N){return this.elementMoves.forEach(U=>{this.reverse?U.element.position={x:(1-N)*U.toPosition.x+N*U.fromPosition.x,y:(1-N)*U.toPosition.y+N*U.fromPosition.y}:U.element.position={x:(1-N)*U.fromPosition.x+N*U.toPosition.x,y:(1-N)*U.fromPosition.y+N*U.toPosition.y}}),this.model}}bt.MoveAnimation=I;class D extends a.Animation{constructor(N,U,Q,J=!1){super(Q),this.model=N,this.reverse=J,this.expanded=[],U.forEach(ce=>{const we=this.reverse?ce.after:ce.before,K=this.reverse?ce.before:ce.after,q=we.routedPoints,ae=K.routedPoints,me=Math.max(q.length,ae.length);this.expanded.push({startExpandedRoute:this.growToSize(q,me),endExpandedRoute:this.growToSize(ae,me),memento:ce})})}midPoint(N){const U=N.edge,Q=N.edge.source,J=N.edge.target;return r.Point.linear((0,d.translatePoint)(r.Bounds.center(Q.bounds),Q.parent,U.parent),(0,d.translatePoint)(r.Bounds.center(J.bounds),J.parent,U.parent),.5)}start(){return this.expanded.forEach(N=>{N.memento.edge.removeAll(U=>U instanceof _.SRoutingHandleImpl)}),super.start()}tween(N){return N===1?this.expanded.forEach(U=>{const Q=U.memento;this.reverse?Q.before.router.applySnapshot(Q.edge,Q.before):Q.after.router.applySnapshot(Q.edge,Q.after)}):this.expanded.forEach(U=>{const Q=[];for(let we=1;we<U.startExpandedRoute.length-1;++we)Q.push(r.Point.linear(U.startExpandedRoute[we],U.endExpandedRoute[we],N));const J=N<.5?U.memento.before:U.memento.after,ce=Object.assign(Object.assign({},J),{routingPoints:Q,routingHandles:[]});J.router.applySnapshot(U.memento.edge,ce)}),this.model}growToSize(N,U){const Q=U-N.length;if(Q<=0)return N;const J=[];J.push(N[0]);const ce=1/(Q+1),we=1/(N.length-1);let K=1;for(let q=1;q<N.length;++q){const ae=we*q;let me=0;for(;ae>(K+me)*ce;)++me;K+=me;for(let ve=0;ve<me;++ve){const L=r.Point.linear(N[q-1],N[q],(ve+1)/(me+1));J.push(L)}J.push(N[q])}return J}}bt.MorphEdgesAnimation=D;class C extends l.MouseListener{constructor(){super(...arguments),this.hasDragged=!1,this.elementId2startPos=new Map}mouseDown(N,U){if(U.button===0){const Q=(0,d.findParentByFeature)(N,w.isMoveable),J=N instanceof _.SRoutingHandleImpl;if(Q!==void 0||J||(0,y.isCreatingOnDrag)(N)?this.startDragPosition={x:U.pageX,y:U.pageY}:this.startDragPosition=void 0,this.hasDragged=!1,(0,y.isCreatingOnDrag)(N))return this.startCreatingOnDrag(N,U);if(J)return this.activateRoutingHandle(N,U)}return[]}startCreatingOnDrag(N,U){const Q=[];return Q.push(s.SelectAllAction.create({select:!1})),Q.push(N.createAction(_.edgeInProgressID)),Q.push(s.SelectAction.create({selectedElementsIDs:[_.edgeInProgressID]})),Q.push(b.SwitchEditModeAction.create({elementsToActivate:[_.edgeInProgressID]})),Q.push(s.SelectAction.create({selectedElementsIDs:[_.edgeInProgressTargetHandleID]})),Q.push(b.SwitchEditModeAction.create({elementsToActivate:[_.edgeInProgressTargetHandleID]})),Q}activateRoutingHandle(N,U){return[b.SwitchEditModeAction.create({elementsToActivate:[N.id]})]}mouseMove(N,U){const Q=[];if(U.buttons===0)this.mouseUp(N,U);else if(this.startDragPosition){this.elementId2startPos.size===0&&this.collectStartPositions(N.root),this.hasDragged=!0;const J=this.getElementMoves(N,U,!1);J&&Q.push(J)}return Q}collectStartPositions(N){const U=new Set(N.index.all().filter(Q=>(0,O.isSelectable)(Q)&&Q.selected));U.forEach(Q=>{if(!this.isChildOfSelected(U,Q)){if((0,w.isMoveable)(Q))this.elementId2startPos.set(Q.id,Q.position);else if(Q instanceof _.SRoutingHandleImpl){const J=this.getHandlePosition(Q);J&&this.elementId2startPos.set(Q.id,J)}}})}isChildOfSelected(N,U){for(;U instanceof f.SChildElementImpl;)if(U=U.parent,(0,w.isMoveable)(U)&&N.has(U))return!0;return!1}getElementMoves(N,U,Q){if(!this.startDragPosition)return;const J=[],ce=(0,d.findParentByFeature)(N,R.isViewport),we=ce?ce.zoom:1,K={x:(U.pageX-this.startDragPosition.x)/we,y:(U.pageY-this.startDragPosition.y)/we};if(this.elementId2startPos.forEach((q,ae)=>{const me=N.root.index.getById(ae);if(me){const ve=this.createElementMove(me,q,K,U);ve&&J.push(ve)}}),J.length>0)return s.MoveAction.create(J,{animate:!1,finished:Q})}createElementMove(N,U,Q,J){const ce=this.snap({x:U.x+Q.x,y:U.y+Q.y},N,!J.shiftKey);if((0,w.isMoveable)(N))return{elementId:N.id,elementType:N.type,fromPosition:{x:N.position.x,y:N.position.y},toPosition:ce};if(N instanceof _.SRoutingHandleImpl){const we=this.getHandlePosition(N);if(we!==void 0)return{elementId:N.id,elementType:N.type,fromPosition:we,toPosition:ce}}}snap(N,U,Q){return Q&&this.snapper?this.snapper.snap(N,U):N}getHandlePosition(N){if(this.edgeRouterRegistry){const U=N.parent;if(!(U instanceof _.SRoutableElementImpl))return;const Q=this.edgeRouterRegistry.get(U.routerKind),J=Q.route(U);return Q.getHandlePosition(U,J,N)}}mouseEnter(N,U){return N instanceof f.SModelRootImpl&&U.buttons===0&&!this.startDragPosition&&this.mouseUp(N,U),[]}mouseUp(N,U){const Q=[];if(this.startDragPosition){const J=this.getElementMoves(N,U,!0);J&&Q.push(J),N.root.index.all().forEach(ce=>{ce instanceof _.SRoutingHandleImpl&&Q.push(...this.deactivateRoutingHandle(ce,N,U))})}if(!Q.some(J=>J.kind===s.ReconnectAction.KIND)){const J=N.root.index.getById(_.edgeInProgressID);J instanceof f.SChildElementImpl&&Q.push(this.deleteEdgeInProgress(J))}return this.hasDragged&&Q.push(g.CommitModelAction.create()),this.hasDragged=!1,this.startDragPosition=void 0,this.elementId2startPos.clear(),Q}deactivateRoutingHandle(N,U,Q){const J=[],ce=N.parent;if(ce instanceof _.SRoutableElementImpl&&N.danglingAnchor){const we=this.getHandlePosition(N);if(we){const K=(0,d.translatePoint)(we,N.parent,N.root),q=(0,m.findChildrenAtPosition)(U.root,K).find(ae=>(0,_.isConnectable)(ae)&&ae.canConnect(ce,N.kind));q&&this.hasDragged&&J.push(s.ReconnectAction.create({routableId:N.parent.id,newSourceId:N.kind==="source"?q.id:ce.sourceId,newTargetId:N.kind==="target"?q.id:ce.targetId}))}}return N.editMode&&J.push(b.SwitchEditModeAction.create({elementsToDeactivate:[N.id]})),J}deleteEdgeInProgress(N){const U=[];return U.push(_.edgeInProgressID),N.children.forEach(Q=>{Q instanceof _.SRoutingHandleImpl&&Q.danglingAnchor&&U.push(Q.danglingAnchor.id)}),s.DeleteElementAction.create(U)}decorate(N,U){return N}}bt.MoveMouseListener=C,n([(0,o.inject)(S.EdgeRouterRegistry),(0,o.optional)(),e("design:type",S.EdgeRouterRegistry)],C.prototype,"edgeRouterRegistry",void 0),n([(0,o.inject)(c.TYPES.ISnapper),(0,o.optional)(),e("design:type",Object)],C.prototype,"snapper",void 0);let z=class{decorate(N,U){if((0,E.isEdgeLayoutable)(U)&&U.parent instanceof h.SEdgeImpl)return N;let Q="";if((0,w.isLocateable)(U)&&U instanceof f.SChildElementImpl&&U.parent!==void 0){const J=U.position;(J.x!==0||J.y!==0)&&(Q="translate("+J.x+", "+J.y+")")}if((0,m.isAlignable)(U)){const J=U.alignment;(J.x!==0||J.y!==0)&&(Q.length>0&&(Q+=" "),Q+="translate("+J.x+", "+J.y+")")}return Q.length>0&&(0,p.setAttr)(N,"transform",Q),N}postUpdate(){}};return bt.LocationPostprocessor=z,bt.LocationPostprocessor=z=n([(0,o.injectable)()],z),bt}var zr={},Vm;function HE(){if(Vm)return zr;Vm=1;var n=zr&&zr.__decorate||function(o,r,s,a){var u=arguments.length,f=u<3?r:a===null?a=Object.getOwnPropertyDescriptor(r,s):a,d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,r,s,a);else for(var c=o.length-1;c>=0;c--)(d=o[c])&&(f=(u<3?d(f):u>3?d(r,s,f):d(r,s))||f);return u>3&&f&&Object.defineProperty(r,s,f),f};Object.defineProperty(zr,"__esModule",{value:!0}),zr.CenterGridSnapper=void 0;const e=se(),t=tt();let i=class{get gridX(){return 10}get gridY(){return 10}snap(r,s){return s&&(0,t.isBoundsAware)(s)?{x:Math.round((r.x+.5*s.bounds.width)/this.gridX)*this.gridX-.5*s.bounds.width,y:Math.round((r.y+.5*s.bounds.height)/this.gridY)*this.gridY-.5*s.bounds.height}:{x:Math.round(r.x/this.gridX)*this.gridX,y:Math.round(r.y/this.gridY)*this.gridY}}};return zr.CenterGridSnapper=i,zr.CenterGridSnapper=i=n([(0,e.injectable)()],i),zr}var ks={},Cd={},zm;function tb(){return zm||(zm=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isOpenable=n.openFeature=void 0,n.openFeature=Symbol("openFeature");function e(t){return t.hasFeature(n.openFeature)}n.isOpenable=e})(Cd)),Cd}var qm;function nb(){if(qm)return ks;qm=1,Object.defineProperty(ks,"__esModule",{value:!0}),ks.OpenMouseListener=void 0;const n=qe(),e=ni(),t=tn(),i=tb();class o extends e.MouseListener{doubleClick(s,a){const u=(0,t.findParentByFeature)(s,i.isOpenable);return u!==void 0?[n.OpenAction.create(u.id)]:[]}}return ks.OpenMouseListener=o,ks}var mi={},Hm;function Ql(){if(Hm)return mi;Hm=1,Object.defineProperty(mi,"__esModule",{value:!0}),mi.getModelBounds=mi.getProjectedBounds=mi.getProjections=mi.isProjectable=void 0;const n=He(),e=Wr(),t=tn(),i=tt();function o(f){return(0,e.hasOwnProperty)(f,"projectionCssClasses")}mi.isProjectable=o;function r(f){let d;for(const c of f.children){if(o(c)&&c.projectionCssClasses.length>0){const l=s(c);if(l){const p={elementId:c.id,projectedBounds:l,cssClasses:c.projectionCssClasses};d?d.push(p):d=[p]}}if(c.children.length>0){const l=r(c);l&&(d?d.push(...l):d=l)}}return d}mi.getProjections=r;function s(f){const d=f.parent;if(f.projectedBounds){let c=f.projectedBounds;return(0,i.isBoundsAware)(d)&&(c=(0,t.transformToRootBounds)(d,c)),c}else if((0,i.isBoundsAware)(f)){let c=f.bounds;return c=(0,t.transformToRootBounds)(d,c),c}}mi.getProjectedBounds=s;const a=1e9;function u(f){let d=a,c=a,l=-a,p=-a;const h=(0,i.isBoundsAware)(f)?f.bounds:void 0;if(h&&n.Dimension.isValid(h))d=h.x,c=h.y,l=d+h.width,p=c+h.height;else for(const g of f.children)if((0,i.isBoundsAware)(g)){const m=g.bounds;d=Math.min(d,m.x),c=Math.min(c,m.y),l=Math.max(l,m.x+m.width),p=Math.max(p,m.y+m.height)}if(d=Math.min(d,f.scroll.x),c=Math.min(c,f.scroll.y),l=Math.max(l,f.scroll.x+f.canvasBounds.width/f.zoom),p=Math.max(p,f.scroll.y+f.canvasBounds.height/f.zoom),d<l&&c<p)return{x:d,y:c,width:l-d,height:p-c}}return mi.getModelBounds=u,mi}var qr={},Km;function KE(){if(Km)return qr;Km=1;var n=qr&&qr.__decorate||function(a,u,f,d){var c=arguments.length,l=c<3?u:d===null?d=Object.getOwnPropertyDescriptor(u,f):d,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(a,u,f,d);else for(var h=a.length-1;h>=0;h--)(p=a[h])&&(l=(c<3?p(l):c>3?p(u,f,l):p(u,f))||l);return c>3&&l&&Object.defineProperty(u,f,l),l};Object.defineProperty(qr,"__esModule",{value:!0}),qr.ProjectedViewportView=void 0;const e=tr(),t=se(),i=Ia,o=Wt(),r=Ql();let s=class{render(u,f,d){const c=(0,e.html)("div",{"class-sprotty-root":!0},this.renderSvg(u,f,d),this.renderProjections(u,f,d));return(0,o.setAttr)(c,"tabindex",0),c}renderSvg(u,f,d){const c=`scale(${u.zoom}) translate(${-u.scroll.x},${-u.scroll.y})`,l="http://www.w3.org/2000/svg";return(0,i.h)("svg",{ns:l},(0,i.h)("g",{ns:l,attrs:{transform:c}},f.renderChildren(u)))}renderProjections(u,f,d){var c;if(u.zoom<=0)return[];const l=(0,r.getModelBounds)(u);if(!l)return[];const p=(c=(0,r.getProjections)(u))!==null&&c!==void 0?c:[];return[this.renderProjectionBar(p,u,l,"vertical"),this.renderProjectionBar(p,u,l,"horizontal")]}renderProjectionBar(u,f,d,c){const l={modelBounds:d,orientation:c};return l.factor=c==="horizontal"?f.canvasBounds.width/d.width:f.canvasBounds.height/d.height,l.zoomedFactor=l.factor/f.zoom,(0,e.html)("div",{"class-sprotty-projection-bar":!0,"class-horizontal":c==="horizontal","class-vertical":c==="vertical"},this.renderViewport(f,l),u.map(p=>this.renderProjection(p,f,l)))}renderViewport(u,f){let d,c;f.orientation==="horizontal"?(d=u.canvasBounds.width,c=(u.scroll.x-f.modelBounds.x)*f.factor):(d=u.canvasBounds.height,c=(u.scroll.y-f.modelBounds.y)*f.factor);let l=d*f.zoomedFactor;c<0?(l+=c,c=0):c>d&&(c=d),l<0?l=0:c+l>d&&(l=d-c);const p=f.orientation==="horizontal"?{left:`${c}px`,width:`${l}px`}:{top:`${c}px`,height:`${l}px`};return(0,e.html)("div",{"class-sprotty-viewport":!0,style:p})}renderProjection(u,f,d){let c,l,p;d.orientation==="horizontal"?(c=f.canvasBounds.width,l=(u.projectedBounds.x-d.modelBounds.x)*d.factor,p=u.projectedBounds.width*d.factor):(c=f.canvasBounds.height,l=(u.projectedBounds.y-d.modelBounds.y)*d.factor,p=u.projectedBounds.height*d.factor),l<0?(p+=l,l=0):l>c&&(l=c),p<0?p=0:l+p>c&&(p=c-l);const h=d.orientation==="horizontal"?{left:`${l}px`,width:`${p}px`}:{top:`${l}px`,height:`${p}px`},g=(0,e.html)("div",{id:`${d.orientation}-projection:${u.elementId}`,"class-sprotty-projection":!0,style:h});return u.cssClasses.forEach(m=>(0,o.setClass)(g,m,!0)),g}};return qr.ProjectedViewportView=s,qr.ProjectedViewportView=s=n([(0,t.injectable)()],s),qr}var Rn={},An={},$m;function ef(){if($m)return An;$m=1;var n=An&&An.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g};Object.defineProperty(An,"__esModule",{value:!0}),An.DiamondAnchor=An.RectangleAnchor=An.EllipseAnchor=void 0;const e=to(),t=eo(),i=se(),o=ju(),r=He();let s=class{get kind(){return o.PolylineEdgeRouter.KIND+":"+e.ELLIPTIC_ANCHOR_KIND}getAnchor(c,l,p=0){const h=c.bounds,g=r.Bounds.center(h),m=g.x-l.x,y=g.y-l.y,b=Math.sqrt(m*m+y*y),v=m/b||0,_=y/b||0;return{x:g.x-v*(.5*h.width+p),y:g.y-_*(.5*h.height+p)}}};An.EllipseAnchor=s,An.EllipseAnchor=s=n([(0,i.injectable)()],s);let a=class{get kind(){return o.PolylineEdgeRouter.KIND+":"+e.RECTANGULAR_ANCHOR_KIND}getAnchor(c,l,p=0){const h=c.bounds,g=r.Bounds.center(h),m=new u(g,l);if(!(0,r.almostEquals)(g.y,l.y)){const y=this.getXIntersection(h.y,g,l);y>=h.x&&y<=h.x+h.width&&m.addCandidate(y,h.y-p);const b=this.getXIntersection(h.y+h.height,g,l);b>=h.x&&b<=h.x+h.width&&m.addCandidate(b,h.y+h.height+p)}if(!(0,r.almostEquals)(g.x,l.x)){const y=this.getYIntersection(h.x,g,l);y>=h.y&&y<=h.y+h.height&&m.addCandidate(h.x-p,y);const b=this.getYIntersection(h.x+h.width,g,l);b>=h.y&&b<=h.y+h.height&&m.addCandidate(h.x+h.width+p,b)}return m.best}getXIntersection(c,l,p){const h=(c-l.y)/(p.y-l.y);return(p.x-l.x)*h+l.x}getYIntersection(c,l,p){const h=(c-l.x)/(p.x-l.x);return(p.y-l.y)*h+l.y}};An.RectangleAnchor=a,An.RectangleAnchor=a=n([(0,i.injectable)()],a);class u{constructor(c,l){this.centerPoint=c,this.refPoint=l,this.currentDist=-1}addCandidate(c,l){const p=this.refPoint.x-c,h=this.refPoint.y-l,g=p*p+h*h;(this.currentDist<0||g<this.currentDist)&&(this.currentBest={x:c,y:l},this.currentDist=g)}get best(){return this.currentBest===void 0?this.centerPoint:this.currentBest}}let f=class{get kind(){return o.PolylineEdgeRouter.KIND+":"+e.DIAMOND_ANCHOR_KIND}getAnchor(c,l,p){const h=c.bounds,g=new t.PointToPointLine(r.Bounds.center(h),l),m=new t.Diamond(h).closestSideLine(l),y=(0,t.intersection)(m,g);return r.Point.shiftTowards(y,l,p)}};return An.DiamondAnchor=f,An.DiamondAnchor=f=n([(0,i.injectable)()],f),An}var Dt={},Ym;function tf(){if(Ym)return Dt;Ym=1;var n=Dt&&Dt.__decorate||function(m,y,b,v){var _=arguments.length,S=_<3?y:v===null?v=Object.getOwnPropertyDescriptor(y,b):v,E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(m,y,b,v);else for(var O=m.length-1;O>=0;O--)(E=m[O])&&(S=(_<3?E(S):_>3?E(y,b,S):E(y,b))||S);return _>3&&S&&Object.defineProperty(y,b,S),S},e=Dt&&Dt.__metadata||function(m,y){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(m,y)},t=Dt&&Dt.__param||function(m,y){return function(b,v){y(b,v,m)}},i;Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.AddRemoveBezierSegmentCommand=Dt.AddRemoveBezierSegmentAction=Dt.BezierMouseListener=Dt.BezierEdgeRouter=void 0;const o=se(),r=He(),s=pt(),a=nr(),u=xu(),f=ni(),d=gt(),c=ge();let l=i=class extends u.AbstractEdgeRouter{get kind(){return i.KIND}route(y){if(!y.source||!y.target)return[];const b=y.routingPoints.length,v=y.source,_=y.target,S=[];if(S.push({kind:"source",x:0,y:0}),b===0){const[M,I]=this.createDefaultBezierHandles(v.position,_.position);S.push({kind:"bezier-control-after",x:M.x,y:M.y,pointIndex:0}),S.push({kind:"bezier-control-before",x:I.x,y:I.y,pointIndex:1}),y.routingPoints.push(M),y.routingPoints.push(I)}else if(b>=2)for(let M=0;M<b;M++){const I=y.routingPoints[M];M%3===0&&S.push({kind:"bezier-control-after",x:I.x,y:I.y,pointIndex:M}),(M+1)%3===0?S.push({kind:"bezier-junction",x:I.x,y:I.y,pointIndex:M}):(M+2)%3===0&&S.push({kind:"bezier-control-before",x:I.x,y:I.y,pointIndex:M})}S.push({kind:"target",x:0,y:0});const E=b>2?y.routingPoints[2]:_.position,O=b>2?y.routingPoints[y.routingPoints.length-3]:v.position,R=this.getTranslatedAnchor(v,E,_.parent,y,y.sourceAnchorCorrection),w=this.getTranslatedAnchor(_,O,v.parent,y,y.targetAnchorCorrection);return S[0]={kind:"source",x:R.x,y:R.y},S[S.length-1]={kind:"target",x:w.x,y:w.y},S}createDefaultBezierHandles(y,b){const v={x:y.x-i.DEFAULT_BEZIER_HANDLE_OFFSET,y:y.y},_={x:b.x+i.DEFAULT_BEZIER_HANDLE_OFFSET,y:b.y};return[v,_]}createRoutingHandles(y){this.route(y),this.rebuildHandles(y)}rebuildHandles(y){this.addHandle(y,"source","routing-point",-2),this.addHandle(y,"bezier-control-after","bezier-routing-point",0),this.addHandle(y,"bezier-add","bezier-create-routing-point",0);const b=y.routingPoints.length;if(b>2)for(let v=1;v<b-1;v+=3)this.addHandle(y,"bezier-control-before","bezier-routing-point",v),this.addHandle(y,"bezier-add","bezier-create-routing-point",v+1),this.addHandle(y,"bezier-junction","routing-point",v+1),this.addHandle(y,"bezier-remove","bezier-remove-routing-point",v+1),this.addHandle(y,"bezier-control-after","bezier-routing-point",v+2),this.moveBezierControlPair(y.routingPoints[v],v,y);this.addHandle(y,"bezier-control-before","bezier-routing-point",b-1),this.addHandle(y,"target","routing-point",-1)}getInnerHandlePosition(y,b,v){if(v.kind==="bezier-control-before"||v.kind==="bezier-junction"||v.kind==="bezier-control-after")for(let _=0;_<b.length;_++){const S=b[_];if(S.pointIndex===v.pointIndex&&S.kind===v.kind)return S}else if(v.kind==="bezier-add"){const _=this.findBezierControl(y,b,v.pointIndex);return{x:_.x,y:_.y+12.5}}else if(v.kind==="bezier-remove"){const _=this.findBezierControl(y,b,v.pointIndex);return{x:_.x,y:_.y-12.5}}}findBezierControl(y,b,v){let _={x:b[0].x,y:b[0].y};if(v>0){for(const S of b)if(S.pointIndex!==void 0&&S.pointIndex===v&&S.kind==="bezier-junction"){_={x:S.x,y:S.y};break}}return _}applyHandleMoves(y,b){b.forEach(v=>{const _=v.handle;let S={x:0,y:0},E,O,R;const w=v.toPosition;switch(_.kind){case"bezier-control-before":case"bezier-control-after":this.moveBezierControlPair(w,v.handle.pointIndex,y);break;case"bezier-junction":const M=_.pointIndex;M>=0&&M<y.routingPoints.length&&(R=M-1,S=y.routingPoints[M],E=y.routingPoints[R],O=this.calcRelativeMove(S,w,E),y.routingPoints[M]=w,this.moveBezierControlPair(O,R,y));break;case"source":if(R=0,E=y.routingPoints[R],y.source instanceof s.SDanglingAnchorImpl)_.danglingAnchor&&(S=_.danglingAnchor.position,_.danglingAnchor.position=w);else{const I=new s.SDanglingAnchorImpl;I.id=y.id+"_dangling-source",I.original=y.source,I.position=v.toPosition,_.root.add(I),_.danglingAnchor=I,y.sourceId=I.id,y.source&&(S=y.source.position)}O=this.calcRelativeMove(S,w,E),this.moveBezierControlPair(O,R,y);break;case"target":if(R=y.routingPoints.length-1,E=y.routingPoints[R],y.target instanceof s.SDanglingAnchorImpl)_.danglingAnchor&&(S=_.danglingAnchor.position,_.danglingAnchor.position=w);else{const I=new s.SDanglingAnchorImpl;I.id=y.id+"_dangling-target",I.original=y.target,I.position=w,_.root.add(I),_.danglingAnchor=I,y.targetId=I.id,y.target&&(S=y.target.position)}O=this.calcRelativeMove(S,w,E),this.moveBezierControlPair(O,R,y);break}})}applyInnerHandleMoves(y,b){}getOptions(y){return{minimalPointDistance:2,standardDistance:.1,selfEdgeOffset:20}}calcRelativeMove(y,b,v){return{x:v.x-(y.x-b.x),y:v.y-(y.y-b.y)}}createNewBezierSegment(y,b){const v=b.routingPoints;let _,S,E;v.length===2?(S=v[y<0?0:y],E=v[v.length-1],_=(0,r.centerOfLine)(S,E)):(S=v[y],E=v[y+2],_=(0,r.centerOfLine)(S,E));const[O,R]=this.createDefaultBezierHandles(_,_);v.splice(y+1,0,O),v.splice(y+2,0,_),v.splice(y+3,0,R),this.moveBezierControlPair(O,y+1,b),b.removeAll(w=>w instanceof s.SRoutingHandleImpl),this.rebuildHandles(b)}removeBezierSegment(y,b){b.routingPoints.splice(y-1,3),b.removeAll(_=>_ instanceof s.SRoutingHandleImpl),this.rebuildHandles(b)}moveBezierControlPair(y,b,v){if(b>=0&&b<v.routingPoints.length){const _=b-1,S=b+1;_<0||S===v.routingPoints.length?v.routingPoints[b]=y:b%3===0?this.setBezierMirror(v,y,b,!1):(b+2)%3===0&&this.setBezierMirror(v,y,b,!0)}}setBezierMirror(y,b,v,_){y.routingPoints[v]=b;const S=y.routingPoints[_?v+1:v-1];y.routingPoints[_?v+2:v-2]={x:S.x-(b.x-S.x),y:S.y-(b.y-S.y)}}};Dt.BezierEdgeRouter=l,l.KIND="bezier",l.DEFAULT_BEZIER_HANDLE_OFFSET=25,Dt.BezierEdgeRouter=l=i=n([(0,o.injectable)()],l);class p extends f.MouseListener{mouseDown(y,b){const v=[];return y instanceof s.SRoutingHandleImpl&&(y.kind==="bezier-add"||y.kind==="bezier-remove")&&(y.type==="bezier-create-routing-point"?v.push(h.create("add",y.id)):y.type==="bezier-remove-routing-point"&&v.push(h.create("remove",y.id))),v}}Dt.BezierMouseListener=p;var h;(function(m){m.KIND="addRemoveBezierSegment";function y(b,v){return{kind:m.KIND,actionTask:b,targetId:v}}m.create=y})(h||(Dt.AddRemoveBezierSegmentAction=h={}));let g=class extends d.Command{constructor(y,b){super(),this.action=y,this.edgeRouterRegistry=b}execute(y){const v=y.root.index.getById(this.action.targetId);if(this.edgeRouterRegistry&&v instanceof s.SRoutingHandleImpl){const _=this.edgeRouterRegistry.get(v.parent.routerKind);if(_ instanceof l){const S=_;for(const E of y.root.children)if(E.id===v.parent.id){this.action.actionTask==="add"?S.createNewBezierSegment(v.pointIndex,E):this.action.actionTask==="remove"&&S.removeBezierSegment(v.pointIndex,E);break}}}return y.root}undo(y){throw new Error("Method not implemented.")}redo(y){throw new Error("Method not implemented.")}};return Dt.AddRemoveBezierSegmentCommand=g,g.KIND=h.KIND,Dt.AddRemoveBezierSegmentCommand=g=n([(0,o.injectable)(),t(0,(0,o.inject)(c.TYPES.Action)),t(1,(0,o.inject)(a.EdgeRouterRegistry)),e("design:paramtypes",[Object,a.EdgeRouterRegistry])],g),Dt}var km;function ib(){if(km)return Rn;km=1;var n=Rn&&Rn.__decorate||function(u,f,d,c){var l=arguments.length,p=l<3?f:c===null?c=Object.getOwnPropertyDescriptor(f,d):c,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(u,f,d,c);else for(var g=u.length-1;g>=0;g--)(h=u[g])&&(p=(l<3?h(p):l>3?h(f,d,p):h(f,d))||p);return l>3&&p&&Object.defineProperty(f,d,p),p};Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.BezierDiamondAnchor=Rn.BezierRectangleAnchor=Rn.BezierEllipseAnchor=void 0;const e=to(),t=se(),i=ef(),o=tf();let r=class extends i.EllipseAnchor{get kind(){return o.BezierEdgeRouter.KIND+":"+e.ELLIPTIC_ANCHOR_KIND}};Rn.BezierEllipseAnchor=r,Rn.BezierEllipseAnchor=r=n([(0,t.injectable)()],r);let s=class extends i.RectangleAnchor{get kind(){return o.BezierEdgeRouter.KIND+":"+e.RECTANGULAR_ANCHOR_KIND}};Rn.BezierRectangleAnchor=s,Rn.BezierRectangleAnchor=s=n([(0,t.injectable)()],s);let a=class extends i.DiamondAnchor{get kind(){return o.BezierEdgeRouter.KIND+":"+e.DIAMOND_ANCHOR_KIND}};return Rn.BezierDiamondAnchor=a,Rn.BezierDiamondAnchor=a=n([(0,t.injectable)()],a),Rn}var On={},Us={},Um;function nf(){if(Um)return Us;Um=1,Object.defineProperty(Us,"__esModule",{value:!0}),Us.ManhattanEdgeRouter=void 0;const n=He(),e=tn(),t=xu(),i=pt();class o extends t.AbstractEdgeRouter{get kind(){return o.KIND}getOptions(s){return{standardDistance:20,minimalPointDistance:3,selfEdgeOffset:.25}}route(s){if(!s.source||!s.target)return[];const a=this.createRoutedCorners(s),u=a[0]||(0,e.translatePoint)(n.Bounds.center(s.target.bounds),s.target.parent,s.parent),f=this.getTranslatedAnchor(s.source,u,s.parent,s,s.sourceAnchorCorrection),d=a[a.length-1]||(0,e.translatePoint)(n.Bounds.center(s.source.bounds),s.source.parent,s.parent),c=this.getTranslatedAnchor(s.target,d,s.parent,s,s.targetAnchorCorrection);if(!f||!c)return[];const l=[];return l.push(Object.assign({kind:"source"},f)),a.forEach(p=>l.push(p)),l.push(Object.assign({kind:"target"},c)),l}createRoutedCorners(s){const a=new t.DefaultAnchors(s.source,s.parent,"source"),u=new t.DefaultAnchors(s.target,s.parent,"target");if(s.routingPoints.length>0){const c=s.routingPoints.slice();if(this.cleanupRoutingPoints(s,c,!1,!0),c.length>0)return c.map((l,p)=>Object.assign({kind:"linear",pointIndex:p},l))}const f=this.getOptions(s);return this.calculateDefaultCorners(s,a,u,f).map(c=>Object.assign({kind:"linear"},c))}createRoutingHandles(s){const a=this.route(s);if(this.commitRoute(s,a),a.length>0){this.addHandle(s,"source","routing-point",-2);for(let u=0;u<a.length-1;++u)this.addHandle(s,"manhattan-50%","volatile-routing-point",u-1);this.addHandle(s,"target","routing-point",a.length-2)}}getInnerHandlePosition(s,a,u){const f=this.getFraction(u.kind);if(f!==void 0){const{start:d,end:c}=this.findRouteSegment(s,a,u.pointIndex);if(d!==void 0&&c!==void 0)return n.Point.linear(d,c,f)}}getFraction(s){switch(s){case"manhattan-50%":return .5;default:return}}applyInnerHandleMoves(s,a){const u=this.route(s),f=s.routingPoints,d=this.getOptions(s).minimalPointDistance;a.forEach(c=>{const l=c.handle,p=l.pointIndex,h=this.correctX(f,p,c.toPosition.x,d),g=this.correctY(f,p,c.toPosition.y,d);switch(l.kind){case"manhattan-50%":p<0?f.length===0?(f.push({x:h,y:g}),l.pointIndex=0):(0,n.almostEquals)(u[0].x,u[1].x)?this.alignX(f,0,h):this.alignY(f,0,g):p<f.length-1?(0,n.almostEquals)(f[p].x,f[p+1].x)?(this.alignX(f,p,h),this.alignX(f,p+1,h)):(this.alignY(f,p,g),this.alignY(f,p+1,g)):(0,n.almostEquals)(u[u.length-2].x,u[u.length-1].x)?this.alignX(f,f.length-1,h):this.alignY(f,f.length-1,g);break}})}correctX(s,a,u,f){return a>0&&Math.abs(u-s[a-1].x)<f?s[a-1].x:a<s.length-2&&Math.abs(u-s[a+2].x)<f?s[a+2].x:u}alignX(s,a,u){a>=0&&a<s.length&&(s[a]={x:u,y:s[a].y})}correctY(s,a,u,f){return a>0&&Math.abs(u-s[a-1].y)<f?s[a-1].y:a<s.length-2&&Math.abs(u-s[a+2].y)<f?s[a+2].y:u}alignY(s,a,u){a>=0&&a<s.length&&(s[a]={x:s[a].x,y:u})}cleanupRoutingPoints(s,a,u,f){const d=new t.DefaultAnchors(s.source,s.parent,"source"),c=new t.DefaultAnchors(s.target,s.parent,"target");if(!this.resetRoutingPointsOnReconnect(s,a,u,d,c)){for(let l=0;l<a.length&&n.Bounds.includes(d.bounds,a[l]);++l)a.splice(0,1),u&&this.removeHandle(s,-1);for(let l=a.length-1;l>=0&&n.Bounds.includes(c.bounds,a[l]);--l)a.splice(l,1),u&&this.removeHandle(s,l);if(a.length>=2){const l=this.getOptions(s);for(let p=a.length-2;p>=0;--p)n.Point.manhattanDistance(a[p],a[p+1])<l.minimalPointDistance&&(a.splice(p,2),--p,u&&(this.removeHandle(s,p-1),this.removeHandle(s,p)))}f&&(this.addAdditionalCorner(s,a,d,c,u),this.addAdditionalCorner(s,a,c,d,u),this.manhattanify(s,a))}}removeHandle(s,a){const u=[];s.children.forEach(f=>{f instanceof i.SRoutingHandleImpl&&(f.pointIndex>a?--f.pointIndex:f.pointIndex===a&&u.push(f))}),u.forEach(f=>s.remove(f))}addAdditionalCorner(s,a,u,f,d){if(a.length===0)return;const c=u.kind==="source"?a[0]:a[a.length-1],l=u.kind==="source"?0:a.length,p=l-(u.kind==="source"?1:0);let h;if(a.length>1)h=l===0?(0,n.almostEquals)(a[0].x,a[1].x):(0,n.almostEquals)(a[a.length-1].x,a[a.length-2].x);else{const g=f.getNearestSide(c);h=g===t.Side.TOP||g===t.Side.BOTTOM}if(h){if(c.y<u.get(t.Side.TOP).y||c.y>u.get(t.Side.BOTTOM).y){const g={x:u.get(t.Side.TOP).x,y:c.y};a.splice(l,0,g),d&&(s.children.forEach(m=>{m instanceof i.SRoutingHandleImpl&&m.pointIndex>=p&&++m.pointIndex}),this.addHandle(s,"manhattan-50%","volatile-routing-point",p))}}else if(c.x<u.get(t.Side.LEFT).x||c.x>u.get(t.Side.RIGHT).x){const g={x:c.x,y:u.get(t.Side.LEFT).y};a.splice(l,0,g),d&&(s.children.forEach(m=>{m instanceof i.SRoutingHandleImpl&&m.pointIndex>=p&&++m.pointIndex}),this.addHandle(s,"manhattan-50%","volatile-routing-point",p))}}manhattanify(s,a){for(let u=1;u<a.length;++u){const f=Math.abs(a[u-1].x-a[u].x)<1,d=Math.abs(a[u-1].y-a[u].y)<1;!f&&!d&&(a.splice(u,0,{x:a[u-1].x,y:a[u].y}),++u)}}calculateDefaultCorners(s,a,u,f){const d=super.calculateDefaultCorners(s,a,u,f);if(d.length>0)return d;const c=this.getBestConnectionAnchors(s,a,u,f),l=c.source,p=c.target,h=[],g=a.get(l);let m=u.get(p);switch(l){case t.Side.RIGHT:switch(p){case t.Side.BOTTOM:h.push({x:m.x,y:g.y});break;case t.Side.TOP:h.push({x:m.x,y:g.y});break;case t.Side.RIGHT:h.push({x:Math.max(g.x,m.x)+1.5*f.standardDistance,y:g.y}),h.push({x:Math.max(g.x,m.x)+1.5*f.standardDistance,y:m.y});break;case t.Side.LEFT:m.y!==g.y&&(h.push({x:(g.x+m.x)/2,y:g.y}),h.push({x:(g.x+m.x)/2,y:m.y}));break}break;case t.Side.LEFT:switch(p){case t.Side.BOTTOM:h.push({x:m.x,y:g.y});break;case t.Side.TOP:h.push({x:m.x,y:g.y});break;default:m=u.get(t.Side.RIGHT),m.y!==g.y&&(h.push({x:(g.x+m.x)/2,y:g.y}),h.push({x:(g.x+m.x)/2,y:m.y}));break}break;case t.Side.TOP:switch(p){case t.Side.RIGHT:m.x-g.x>0?(h.push({x:g.x,y:g.y-f.standardDistance}),h.push({x:m.x+1.5*f.standardDistance,y:g.y-f.standardDistance}),h.push({x:m.x+1.5*f.standardDistance,y:m.y})):h.push({x:g.x,y:m.y});break;case t.Side.LEFT:m.x-g.x<0?(h.push({x:g.x,y:g.y-f.standardDistance}),h.push({x:m.x-1.5*f.standardDistance,y:g.y-f.standardDistance}),h.push({x:m.x-1.5*f.standardDistance,y:m.y})):h.push({x:g.x,y:m.y});break;case t.Side.TOP:h.push({x:g.x,y:Math.min(g.y,m.y)-1.5*f.standardDistance}),h.push({x:m.x,y:Math.min(g.y,m.y)-1.5*f.standardDistance});break;case t.Side.BOTTOM:m.x!==g.x&&(h.push({x:g.x,y:(g.y+m.y)/2}),h.push({x:m.x,y:(g.y+m.y)/2}));break}break;case t.Side.BOTTOM:switch(p){case t.Side.RIGHT:m.x-g.x>0?(h.push({x:g.x,y:g.y+f.standardDistance}),h.push({x:m.x+1.5*f.standardDistance,y:g.y+f.standardDistance}),h.push({x:m.x+1.5*f.standardDistance,y:m.y})):h.push({x:g.x,y:m.y});break;case t.Side.LEFT:m.x-g.x<0?(h.push({x:g.x,y:g.y+f.standardDistance}),h.push({x:m.x-1.5*f.standardDistance,y:g.y+f.standardDistance}),h.push({x:m.x-1.5*f.standardDistance,y:m.y})):h.push({x:g.x,y:m.y});break;default:m=u.get(t.Side.TOP),m.x!==g.x&&(h.push({x:g.x,y:(g.y+m.y)/2}),h.push({x:m.x,y:(g.y+m.y)/2}));break}break}return h}getBestConnectionAnchors(s,a,u,f){let d=a.get(t.Side.RIGHT),c=u.get(t.Side.LEFT);if(c.x-d.x>f.standardDistance)return{source:t.Side.RIGHT,target:t.Side.LEFT};if(d=a.get(t.Side.LEFT),c=u.get(t.Side.RIGHT),d.x-c.x>f.standardDistance)return{source:t.Side.LEFT,target:t.Side.RIGHT};if(d=a.get(t.Side.TOP),c=u.get(t.Side.BOTTOM),d.y-c.y>f.standardDistance)return{source:t.Side.TOP,target:t.Side.BOTTOM};if(d=a.get(t.Side.BOTTOM),c=u.get(t.Side.TOP),c.y-d.y>f.standardDistance)return{source:t.Side.BOTTOM,target:t.Side.TOP};if(d=a.get(t.Side.RIGHT),c=u.get(t.Side.TOP),c.x-d.x>.5*f.standardDistance&&c.y-d.y>f.standardDistance)return{source:t.Side.RIGHT,target:t.Side.TOP};if(c=u.get(t.Side.BOTTOM),c.x-d.x>.5*f.standardDistance&&d.y-c.y>f.standardDistance)return{source:t.Side.RIGHT,target:t.Side.BOTTOM};if(d=a.get(t.Side.LEFT),c=u.get(t.Side.BOTTOM),d.x-c.x>.5*f.standardDistance&&d.y-c.y>f.standardDistance)return{source:t.Side.LEFT,target:t.Side.BOTTOM};if(c=u.get(t.Side.TOP),d.x-c.x>.5*f.standardDistance&&c.y-d.y>f.standardDistance)return{source:t.Side.LEFT,target:t.Side.TOP};if(d=a.get(t.Side.TOP),c=u.get(t.Side.RIGHT),d.y-c.y>.5*f.standardDistance&&d.x-c.x>f.standardDistance)return{source:t.Side.TOP,target:t.Side.RIGHT};if(c=u.get(t.Side.LEFT),d.y-c.y>.5*f.standardDistance&&c.x-d.x>f.standardDistance)return{source:t.Side.TOP,target:t.Side.LEFT};if(d=a.get(t.Side.BOTTOM),c=u.get(t.Side.RIGHT),c.y-d.y>.5*f.standardDistance&&d.x-c.x>f.standardDistance)return{source:t.Side.BOTTOM,target:t.Side.RIGHT};if(c=u.get(t.Side.LEFT),c.y-d.y>.5*f.standardDistance&&c.x-d.x>f.standardDistance)return{source:t.Side.BOTTOM,target:t.Side.LEFT};if(d=a.get(t.Side.TOP),c=u.get(t.Side.TOP),!n.Bounds.includes(u.bounds,d)&&!n.Bounds.includes(a.bounds,c)){if(d.y-c.y<0){if(Math.abs(d.x-c.x)>(a.bounds.width+f.standardDistance)/2)return{source:t.Side.TOP,target:t.Side.TOP}}else if(Math.abs(d.x-c.x)>u.bounds.width/2)return{source:t.Side.TOP,target:t.Side.TOP}}if(d=a.get(t.Side.RIGHT),c=u.get(t.Side.RIGHT),!n.Bounds.includes(u.bounds,d)&&!n.Bounds.includes(a.bounds,c)){if(d.x-c.x>0){if(Math.abs(d.y-c.y)>(a.bounds.height+f.standardDistance)/2)return{source:t.Side.RIGHT,target:t.Side.RIGHT}}else if(Math.abs(d.y-c.y)>u.bounds.height/2)return{source:t.Side.RIGHT,target:t.Side.RIGHT}}return d=a.get(t.Side.TOP),c=u.get(t.Side.RIGHT),!n.Bounds.includes(u.bounds,d)&&!n.Bounds.includes(a.bounds,c)?{source:t.Side.TOP,target:t.Side.RIGHT}:(c=u.get(t.Side.LEFT),!n.Bounds.includes(u.bounds,d)&&!n.Bounds.includes(a.bounds,c)?{source:t.Side.TOP,target:t.Side.LEFT}:(d=a.get(t.Side.BOTTOM),c=u.get(t.Side.RIGHT),!n.Bounds.includes(u.bounds,d)&&!n.Bounds.includes(a.bounds,c)?{source:t.Side.BOTTOM,target:t.Side.RIGHT}:(c=u.get(t.Side.LEFT),!n.Bounds.includes(u.bounds,d)&&!n.Bounds.includes(a.bounds,c)?{source:t.Side.BOTTOM,target:t.Side.LEFT}:{source:t.Side.RIGHT,target:t.Side.BOTTOM})))}}return Us.ManhattanEdgeRouter=o,o.KIND="manhattan",Us}var Gm;function rb(){if(Gm)return On;Gm=1;var n=On&&On.__decorate||function(l,p,h,g){var m=arguments.length,y=m<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,h):g,b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(l,p,h,g);else for(var v=l.length-1;v>=0;v--)(b=l[v])&&(y=(m<3?b(y):m>3?b(p,h,y):b(p,h))||y);return m>3&&y&&Object.defineProperty(p,h,y),y},e,t,i;Object.defineProperty(On,"__esModule",{value:!0}),On.ManhattanEllipticAnchor=On.ManhattanDiamondAnchor=On.ManhattanRectangularAnchor=void 0;const o=He(),r=eo(),s=to(),a=nf(),u=se();let f=e=class{get kind(){return e.KIND}getAnchor(p,h,g){const m=p.bounds;if(m.width<=0||m.height<=0)return m;const y={x:m.x-g,y:m.y-g,width:m.width+2*g,height:m.height+2*g};return h.x>=y.x&&y.x+y.width>=h.x?h.y<y.y+.5*y.height?{x:h.x,y:y.y}:{x:h.x,y:y.y+y.height}:h.y>=y.y&&y.y+y.height>=h.y?h.x<y.x+.5*y.width?{x:y.x,y:h.y}:{x:y.x+y.width,y:h.y}:o.Bounds.center(y)}};On.ManhattanRectangularAnchor=f,f.KIND=a.ManhattanEdgeRouter.KIND+":"+s.RECTANGULAR_ANCHOR_KIND,On.ManhattanRectangularAnchor=f=e=n([(0,u.injectable)()],f);let d=t=class{get kind(){return t.KIND}getAnchor(p,h,g=0){const m=p.bounds;if(m.width<=0||m.height<=0)return m;const y={x:m.x-g,y:m.y-g,width:m.width+2*g,height:m.height+2*g},b=o.Bounds.center(y);let v,_;return h.x>=y.x&&h.x<=y.x+y.width?y.x+.5*y.width>=h.x?(_=new r.PointToPointLine(h,{x:h.x,y:b.y}),h.y<b.y?v=new r.PointToPointLine({x:y.x,y:b.y},{x:b.x,y:y.y}):v=new r.PointToPointLine({x:y.x,y:b.y},{x:b.x,y:y.y+y.height})):(_=new r.PointToPointLine(h,{x:h.x,y:b.y}),h.y<b.y?v=new r.PointToPointLine({x:y.x+y.width,y:b.y},{x:b.x,y:y.y}):v=new r.PointToPointLine({x:y.x+y.width,y:b.y},{x:b.x,y:y.y+y.height})):h.y>=y.y&&h.y<=y.y+y.height&&(y.y+.5*y.height>=h.y?(_=new r.PointToPointLine(h,{x:b.x,y:h.y}),h.x<b.x?v=new r.PointToPointLine({x:y.x,y:b.y},{x:b.x,y:y.y}):v=new r.PointToPointLine({x:y.x+y.width,y:b.y},{x:b.x,y:y.y})):(_=new r.PointToPointLine(h,{x:b.x,y:h.y}),h.x<b.x?v=new r.PointToPointLine({x:y.x,y:b.y},{x:b.x,y:y.y+y.height}):v=new r.PointToPointLine({x:y.x+y.width,y:b.y},{x:b.x,y:y.y+y.height}))),_&&v?(0,r.intersection)(v,_):b}};On.ManhattanDiamondAnchor=d,d.KIND=a.ManhattanEdgeRouter.KIND+":"+s.DIAMOND_ANCHOR_KIND,On.ManhattanDiamondAnchor=d=t=n([(0,u.injectable)()],d);let c=i=class{get kind(){return i.KIND}getAnchor(p,h,g=0){const m=p.bounds;if(m.width<=0||m.height<=0)return m;const y={x:m.x-g,y:m.y-g,width:m.width+2*g,height:m.height+2*g},b=o.Bounds.center(y),v=o.Point.subtract(h,b);let _=b.x,S=b.y;if(h.x>=y.x&&y.x+y.width>=h.x){_+=v.x;const E=.5*y.height*Math.sqrt(1-v.x*v.x/(.25*y.width*y.width));v.y<0?S-=E:S+=E}else if(h.y>=y.y&&y.y+y.height>=h.y){S+=v.y;const E=.5*y.width*Math.sqrt(1-v.y*v.y/(.25*y.height*y.height));v.x<0?_-=E:_+=E}return{x:_,y:S}}};return On.ManhattanEllipticAnchor=c,c.KIND=a.ManhattanEdgeRouter.KIND+":"+s.ELLIPTIC_ANCHOR_KIND,On.ManhattanEllipticAnchor=c=i=n([(0,u.injectable)()],c),On}var Hr={},Xm;function ob(){if(Xm)return Hr;Xm=1;var n=Hr&&Hr.__decorate||function(o,r,s,a){var u=arguments.length,f=u<3?r:a===null?a=Object.getOwnPropertyDescriptor(r,s):a,d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,r,s,a);else for(var c=o.length-1;c>=0;c--)(d=o[c])&&(f=(u<3?d(f):u>3?d(r,s,f):d(r,s))||f);return u>3&&f&&Object.defineProperty(r,s,f),f};Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.RoutableView=void 0;const e=se(),t=pt();let i=class{isVisible(r,s,a){if(a.targetKind==="hidden"||s.length===0)return!0;const u=(0,t.getAbsoluteRouteBounds)(r,s),f=r.root.canvasBounds;return u.x<=f.width&&u.x+u.width>=0&&u.y<=f.height&&u.y+u.height>=0}};return Hr.RoutableView=i,Hr.RoutableView=i=n([(0,e.injectable)()],i),Hr}var lt={},Ki={},Wm;function sb(){if(Wm)return Ki;Wm=1;var n=Ki&&Ki.__decorate||function(s,a,u,f){var d=arguments.length,c=d<3?a:f===null?f=Object.getOwnPropertyDescriptor(a,u):f,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,a,u,f);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(c=(d<3?l(c):d>3?l(a,u,c):l(a,u))||c);return d>3&&c&&Object.defineProperty(a,u,c),c},e=Ki&&Ki.__metadata||function(s,a){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,a)};Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.ModelRequestCommand=void 0;const t=se(),i=ge(),o=gt();let r=class extends o.SystemCommand{execute(a){const u=this.retrieveResult(a);return this.actionDispatcher.dispatch(u),{model:a.root,modelChanged:!1}}undo(a){return{model:a.root,modelChanged:!1}}redo(a){return{model:a.root,modelChanged:!1}}};return Ki.ModelRequestCommand=r,n([(0,t.inject)(i.TYPES.IActionDispatcher),e("design:type",Object)],r.prototype,"actionDispatcher",void 0),Ki.ModelRequestCommand=r=n([(0,t.injectable)()],r),Ki}var yi={},Zm;function rf(){if(Zm)return yi;Zm=1;var n=yi&&yi.__decorate||function(m,y,b,v){var _=arguments.length,S=_<3?y:v===null?v=Object.getOwnPropertyDescriptor(y,b):v,E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(m,y,b,v);else for(var O=m.length-1;O>=0;O--)(E=m[O])&&(S=(_<3?E(S):_>3?E(y,b,S):E(y,b))||S);return _>3&&S&&Object.defineProperty(y,b,S),S},e=yi&&yi.__metadata||function(m,y){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(m,y)};Object.defineProperty(yi,"__esModule",{value:!0}),yi.findViewportScrollbar=yi.ScrollMouseListener=void 0;const t=se(),i=qe(),o=He(),r=Ke(),s=ni(),a=tn(),u=Mr(),f=Qr(),d=pt(),c=Ql(),l=er(),p=ge();class h extends s.MouseListener{constructor(){super(...arguments),this.scrollbarMouseDownDelay=200}mouseDown(y,b){if((0,a.findParentByFeature)(y,f.isMoveable)===void 0&&!(y instanceof d.SRoutingHandleImpl)){const _=(0,a.findParentByFeature)(y,u.isViewport);if(_){if(this.lastScrollPosition={x:b.pageX,y:b.pageY},this.scrollbar=this.getScrollbar(b),this.scrollbar)return window.clearTimeout(this.scrollbarMouseDownTimeout),this.moveScrollBar(_,b,this.scrollbar,!0).map(S=>new Promise(E=>{this.scrollbarMouseDownTimeout=window.setTimeout(()=>E(S),this.scrollbarMouseDownDelay)}))}else this.lastScrollPosition=void 0,this.scrollbar=void 0}return[]}mouseMove(y,b){if(b.buttons===0)return this.mouseUp(y,b);if(this.scrollbar){window.clearTimeout(this.scrollbarMouseDownTimeout);const v=(0,a.findParentByFeature)(y,u.isViewport);if(v)return this.moveScrollBar(v,b,this.scrollbar)}if(this.lastScrollPosition){const v=(0,a.findParentByFeature)(y,u.isViewport);if(v)return this.dragCanvas(v,b,this.lastScrollPosition)}return[]}mouseEnter(y,b){return y instanceof r.SModelRootImpl&&b.buttons===0&&this.mouseUp(y,b),[]}mouseUp(y,b){return this.lastScrollPosition=void 0,this.scrollbar=void 0,[]}doubleClick(y,b){if((0,a.findParentByFeature)(y,u.isViewport)){const _=this.getScrollbar(b);if(_){window.clearTimeout(this.scrollbarMouseDownTimeout);const S=this.findClickTarget(_,b);let E;if(S&&S.id.startsWith("horizontal-projection:")?E=S.id.substring(22):S&&S.id.startsWith("vertical-projection:")&&(E=S.id.substring(20)),E)return[i.CenterAction.create([E],{animate:!0,retainZoom:!0})]}}return[]}dragCanvas(y,b,v){let _=(b.pageX-v.x)/y.zoom;(_>0&&(0,o.almostEquals)(y.scroll.x,this.viewerOptions.horizontalScrollLimits.min)||_<0&&(0,o.almostEquals)(y.scroll.x,this.viewerOptions.horizontalScrollLimits.max-y.canvasBounds.width/y.zoom))&&(_=0);let S=(b.pageY-v.y)/y.zoom;if((S>0&&(0,o.almostEquals)(y.scroll.y,this.viewerOptions.verticalScrollLimits.min)||S<0&&(0,o.almostEquals)(y.scroll.y,this.viewerOptions.verticalScrollLimits.max-y.canvasBounds.height/y.zoom))&&(S=0),_===0&&S===0)return[];const E={scroll:{x:y.scroll.x-_,y:y.scroll.y-S},zoom:y.zoom};return this.lastScrollPosition={x:b.pageX,y:b.pageY},[i.SetViewportAction.create(y.id,E,{animate:!1})]}moveScrollBar(y,b,v,_=!1){const S=(0,c.getModelBounds)(y);if(!S||y.zoom<=0)return[];const E=v.getBoundingClientRect();let O;if(this.getScrollbarOrientation(v)==="horizontal"){if(E.width<=0)return[];const R=y.canvasBounds.width/(y.zoom*S.width)*E.width;let w=b.clientX-E.x-R/2;if(w<0?w=0:w>E.width-R&&(w=E.width-R),O={x:S.x+w/E.width*S.width,y:y.scroll.y},O.x<this.viewerOptions.horizontalScrollLimits.min?O.x=this.viewerOptions.horizontalScrollLimits.min:O.x>this.viewerOptions.horizontalScrollLimits.max-y.canvasBounds.width/y.zoom&&(O.x=this.viewerOptions.horizontalScrollLimits.max-y.canvasBounds.width/y.zoom),(0,o.almostEquals)(O.x,y.scroll.x))return[]}else{if(E.height<=0)return[];const R=y.canvasBounds.height/(y.zoom*S.height)*E.height;let w=b.clientY-E.y-R/2;if(w<0?w=0:w>E.height-R&&(w=E.height-R),O={x:y.scroll.x,y:S.y+w/E.height*S.height},O.y<this.viewerOptions.verticalScrollLimits.min?O.y=this.viewerOptions.verticalScrollLimits.min:O.y>this.viewerOptions.verticalScrollLimits.max-y.canvasBounds.height/y.zoom&&(O.y=this.viewerOptions.verticalScrollLimits.max-y.canvasBounds.height/y.zoom),(0,o.almostEquals)(O.y,y.scroll.y))return[]}return[i.SetViewportAction.create(y.id,{scroll:O,zoom:y.zoom},{animate:_})]}getScrollbar(y){return g(y)}getScrollbarOrientation(y){return y.classList.contains("horizontal")?"horizontal":"vertical"}findClickTarget(y,b){const v=Array.from(y.children).filter(_=>_.id&&_.classList.contains("sprotty-projection")&&(0,l.hitsMouseEvent)(_,b));if(v.length>0)return v[v.length-1]}}yi.ScrollMouseListener=h,n([(0,t.inject)(p.TYPES.ViewerOptions),e("design:type",Object)],h.prototype,"viewerOptions",void 0);function g(m){let y=m.target;for(;y;){if(y.classList&&y.classList.contains("sprotty-projection-bar"))return y;y=y.parentElement}}return yi.findViewportScrollbar=g,yi}var Jm;function ab(){if(Jm)return lt;Jm=1;var n=lt&&lt.__decorate||function(D,C,z,G){var N=arguments.length,U=N<3?C:G===null?G=Object.getOwnPropertyDescriptor(C,z):G,Q;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")U=Reflect.decorate(D,C,z,G);else for(var J=D.length-1;J>=0;J--)(Q=D[J])&&(U=(N<3?Q(U):N>3?Q(C,z,U):Q(C,z))||U);return N>3&&U&&Object.defineProperty(C,z,U),U},e=lt&&lt.__metadata||function(D,C){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(D,C)},t=lt&&lt.__param||function(D,C){return function(z,G){C(z,G,D)}};Object.defineProperty(lt,"__esModule",{value:!0}),lt.SelectKeyboardListener=lt.GetSelectionCommand=lt.SelectMouseListener=lt.SelectAllCommand=lt.SelectCommand=void 0;const i=se(),o=qe(),r=gt(),s=sb(),a=Ke(),u=tn(),f=ge(),d=Pr(),c=ni(),l=Wt(),p=er(),h=os(),g=Jr(),m=Du(),y=N_(),b=Nu(),v=pt(),_=pt(),S=rf(),E=zn();let O=class extends r.Command{constructor(C){super(),this.action=C,this.selected=[],this.deselected=[]}execute(C){const z=C.root;return this.action.selectedElementsIDs.forEach(G=>{const N=z.index.getById(G);N instanceof a.SChildElementImpl&&(0,E.isSelectable)(N)&&this.selected.push(N)}),this.action.deselectedElementsIDs.forEach(G=>{const N=z.index.getById(G);N instanceof a.SChildElementImpl&&(0,E.isSelectable)(N)&&this.deselected.push(N)}),this.redo(C)}undo(C){for(const z of this.selected)z.selected=!1;for(const z of this.deselected)z.selected=!0;return C.root}redo(C){for(const z of this.deselected)z.selected=!1;for(const z of this.selected)z.selected=!0;return C.root}};lt.SelectCommand=O,O.KIND=o.SelectAction.KIND,lt.SelectCommand=O=n([(0,i.injectable)(),t(0,(0,i.inject)(f.TYPES.Action)),e("design:paramtypes",[Object])],O);let R=class extends r.Command{constructor(C){super(),this.action=C,this.previousSelection={}}execute(C){return this.selectAll(C.root,this.action.select),C.root}selectAll(C,z){(0,E.isSelectable)(C)&&(this.previousSelection[C.id]=C.selected,C.selected=z);for(const G of C.children)this.selectAll(G,z)}undo(C){const z=C.root.index;return Object.keys(this.previousSelection).forEach(G=>{const N=z.getById(G);N!==void 0&&(0,E.isSelectable)(N)&&(N.selected=this.previousSelection[G])}),C.root}redo(C){return this.selectAll(C.root,this.action.select),C.root}};lt.SelectAllCommand=R,R.KIND=o.SelectAllAction.KIND,lt.SelectAllCommand=R=n([(0,i.injectable)(),t(0,(0,i.inject)(f.TYPES.Action)),e("design:paramtypes",[Object])],R);class w extends c.MouseListener{constructor(){super(...arguments),this.wasSelected=!1,this.hasDragged=!1,this.isMouseDown=!1}mouseDown(C,z){if(z.button!==0)return[];this.isMouseDown=!0;const G=this.handleButton(C,z);if(G)return G;const N=(0,u.findParentByFeature)(C,E.isSelectable);if((N!==void 0||C instanceof a.SModelRootImpl)&&(this.hasDragged=!1),N!==void 0){let U=[];if((0,p.isCtrlOrCmd)(z)||(U=this.collectElementsToDeselect(C,N)),N.selected){if((0,p.isCtrlOrCmd)(z))return this.wasSelected=!1,this.handleDeselectTarget(N,z);this.wasSelected=!0}else return this.wasSelected=!1,this.handleSelectTarget(N,U,z)}return[]}collectElementsToDeselect(C,z){return(0,h.toArray)(C.root.index.all().filter(G=>(0,E.isSelectable)(G)&&G.selected&&!(z instanceof v.SRoutingHandleImpl&&G===z.parent)))}handleButton(C,z){if(this.buttonHandlerRegistry!==void 0&&C instanceof y.SButtonImpl&&C.enabled){const G=this.buttonHandlerRegistry.get(C.type);if(G!==void 0)return G.buttonPressed(C)}}handleSelectTarget(C,z,G){const N=[];N.push(o.SelectAction.create({selectedElementsIDs:[C.id],deselectedElementsIDs:z.map(Q=>Q.id)})),N.push(o.BringToFrontAction.create([C.id]));const U=z.filter(Q=>Q instanceof _.SRoutableElementImpl).map(Q=>Q.id);return C instanceof _.SRoutableElementImpl?N.push(b.SwitchEditModeAction.create({elementsToActivate:[C.id],elementsToDeactivate:U})):U.length>0&&N.push(b.SwitchEditModeAction.create({elementsToDeactivate:U})),N}handleDeselectTarget(C,z){const G=[];return G.push(o.SelectAction.create({selectedElementsIDs:[],deselectedElementsIDs:[C.id]})),C instanceof _.SRoutableElementImpl&&G.push(b.SwitchEditModeAction.create({elementsToDeactivate:[C.id]})),G}handleDeselectAll(C,z){const G=[];G.push(o.SelectAction.create({selectedElementsIDs:[],deselectedElementsIDs:C.map(U=>U.id)}));const N=C.filter(U=>U instanceof _.SRoutableElementImpl).map(U=>U.id);return N.length>0&&G.push(b.SwitchEditModeAction.create({elementsToDeactivate:N})),G}mouseMove(C,z){return this.hasDragged=this.isMouseDown,[]}mouseUp(C,z){if(z.button===0&&!this.hasDragged){const G=(0,u.findParentByFeature)(C,E.isSelectable);if(G!==void 0){if(this.wasSelected)return[o.SelectAction.create({selectedElementsIDs:[G.id],deselectedElementsIDs:[]})]}else if(C instanceof a.SModelRootImpl&&!(0,S.findViewportScrollbar)(z)||!(C instanceof a.SModelRootImpl))return this.handleDeselectAll(this.collectElementsToDeselect(C,void 0),z)}return this.isMouseDown=!1,this.hasDragged=!1,[]}decorate(C,z){const G=(0,u.findParentByFeature)(z,E.isSelectable);return G!==void 0&&(0,l.setClass)(C,"selected",G.selected),C}}lt.SelectMouseListener=w,n([(0,i.inject)(m.ButtonHandlerRegistry),(0,i.optional)(),e("design:type",m.ButtonHandlerRegistry)],w.prototype,"buttonHandlerRegistry",void 0);let M=class extends s.ModelRequestCommand{constructor(C){super(),this.action=C,this.previousSelection={}}retrieveResult(C){const z=C.root.index.all().filter(G=>(0,E.isSelectable)(G)&&G.selected).map(G=>G.id);return o.SelectionResult.create((0,h.toArray)(z),this.action.requestId)}};lt.GetSelectionCommand=M,M.KIND=o.GetSelectionAction.KIND,lt.GetSelectionCommand=M=n([(0,i.injectable)(),t(0,(0,i.inject)(f.TYPES.Action)),e("design:paramtypes",[Object])],M);class I extends d.KeyListener{keyDown(C,z){return(0,g.matchesKeystroke)(z,"KeyA","ctrlCmd")?[o.SelectAllAction.create()]:[]}}return lt.SelectKeyboardListener=I,lt}var Gs={},Qm;function cb(){if(Qm)return Gs;Qm=1,Object.defineProperty(Gs,"__esModule",{value:!0}),Gs.UndoRedoKeyListener=void 0;const n=qe(),e=Jr(),t=Pr(),i=er();class o extends t.KeyListener{keyDown(s,a){return(0,e.matchesKeystroke)(a,"KeyZ","ctrlCmd")?[n.UndoAction.create()]:(0,e.matchesKeystroke)(a,"KeyZ","ctrlCmd","shift")||!(0,i.isMac)()&&(0,e.matchesKeystroke)(a,"KeyY","ctrlCmd")?[n.RedoAction.create()]:[]}}return Gs.UndoRedoKeyListener=o,Gs}var hr={},ey;function of(){if(ey)return hr;ey=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.applyMatches=hr.ModelMatcher=hr.forEachMatch=void 0;const n=Ke(),e=ti();function t(r,s){Object.keys(r).forEach(a=>s(a,r[a]))}hr.forEachMatch=t;class i{match(s,a){const u={};return this.matchLeft(s,u),this.matchRight(a,u),u}matchLeft(s,a,u){let f=a[s.id];if(f!==void 0?(f.left=s,f.leftParentId=u):(f={left:s,leftParentId:u},a[s.id]=f),(0,n.isParent)(s))for(const d of s.children)this.matchLeft(d,a,s.id)}matchRight(s,a,u){let f=a[s.id];if(f!==void 0?(f.right=s,f.rightParentId=u):(f={right:s,rightParentId:u},a[s.id]=f),(0,n.isParent)(s))for(const d of s.children)this.matchRight(d,a,s.id)}}hr.ModelMatcher=i;function o(r,s,a){r instanceof n.SModelRootImpl?a=r.index:a===void 0&&(a=new e.SModelIndex,a.add(r));for(const u of s){let f=!1;if(u.left!==void 0&&u.leftParentId!==void 0){const d=a.getById(u.leftParentId);if(d!==void 0&&d.children!==void 0){const c=d.children.indexOf(u.left);c>=0&&(u.right!==void 0&&u.leftParentId===u.rightParentId?(d.children.splice(c,1,u.right),f=!0):d.children.splice(c,1)),a.remove(u.left)}}if(!f&&u.right!==void 0&&u.rightParentId!==void 0){const d=a.getById(u.rightParentId);d!==void 0&&(d.children===void 0&&(d.children=[]),d.children.push(u.right))}}}return hr.applyMatches=o,hr}var Zn={},Xs={},ty;function $E(){if(ty)return Xs;ty=1,Object.defineProperty(Xs,"__esModule",{value:!0}),Xs.ResizeAnimation=void 0;const n=as();class e extends n.Animation{constructor(i,o,r,s=!1){super(r),this.model=i,this.elementResizes=o,this.reverse=s}tween(i){return this.elementResizes.forEach(o=>{const r=o.element,s=this.reverse?{width:(1-i)*o.toDimension.width+i*o.fromDimension.width,height:(1-i)*o.toDimension.height+i*o.fromDimension.height}:{width:(1-i)*o.fromDimension.width+i*o.toDimension.width,height:(1-i)*o.fromDimension.height+i*o.toDimension.height};r.bounds={x:r.bounds.x,y:r.bounds.y,width:s.width,height:s.height}}),this.model}}return Xs.ResizeAnimation=e,Xs}var ny;function sf(){if(ny)return Zn;ny=1;var n=Zn&&Zn.__decorate||function(R,w,M,I){var D=arguments.length,C=D<3?w:I===null?I=Object.getOwnPropertyDescriptor(w,M):I,z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(R,w,M,I);else for(var G=R.length-1;G>=0;G--)(z=R[G])&&(C=(D<3?z(C):D>3?z(w,M,C):z(w,M))||C);return D>3&&C&&Object.defineProperty(w,M,C),C},e=Zn&&Zn.__metadata||function(R,w){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(R,w)},t=Zn&&Zn.__param||function(R,w){return function(M,I){w(M,I,R)}};Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.UpdateModelCommand=void 0;const i=se(),o=qe(),r=He(),s=as(),a=gt(),u=Wl(),f=Ke(),d=Fu(),c=Ta(),l=Qr(),p=tt(),h=$l(),g=zn(),m=of(),y=$E(),b=ge(),v=Mr(),_=nr(),S=pt(),E=tn();let O=class extends a.Command{constructor(w){super(),this.action=w}execute(w){let M;return this.action.newRoot!==void 0?M=w.modelFactory.createRoot(this.action.newRoot):(M=w.modelFactory.createRoot(w.root),this.action.matches!==void 0&&this.applyMatches(M,this.action.matches,w)),this.oldRoot=w.root,this.newRoot=M,this.performUpdate(this.oldRoot,this.newRoot,w)}performUpdate(w,M,I){if((this.action.animate===void 0||this.action.animate)&&w.id===M.id){let D;this.action.matches===void 0?D=new m.ModelMatcher().match(w,M):D=this.convertToMatchResult(this.action.matches,w,M);const C=this.computeAnimation(M,D,I);return C instanceof s.Animation?C.start():C}else return w.type===M.type&&r.Dimension.isValid(w.canvasBounds)&&(M.canvasBounds=w.canvasBounds),(0,v.isViewport)(w)&&(0,v.isViewport)(M)&&(M.zoom=w.zoom,M.scroll=w.scroll),M}applyMatches(w,M,I){const D=w.index;for(const C of M)if(C.left!==void 0){const z=D.getById(C.left.id);z instanceof f.SChildElementImpl&&z.parent.remove(z)}for(const C of M)if(C.right!==void 0){const z=I.modelFactory.createElement(C.right);let G;C.rightParentId!==void 0&&(G=D.getById(C.rightParentId)),G instanceof f.SParentElementImpl?G.add(z):w.add(z)}}convertToMatchResult(w,M,I){const D={};for(const C of w){const z={};let G;C.left!==void 0&&(G=C.left.id,z.left=M.index.getById(G),z.leftParentId=C.leftParentId),C.right!==void 0&&(G=C.right.id,z.right=I.index.getById(G),z.rightParentId=C.rightParentId),G!==void 0&&(D[G]=z)}return D}computeAnimation(w,M,I){const D={fades:[]};(0,m.forEachMatch)(M,(z,G)=>{if(G.left!==void 0&&G.right!==void 0)this.updateElement(G.left,G.right,D);else if(G.right!==void 0){const N=G.right;(0,c.isFadeable)(N)&&(N.opacity=0,D.fades.push({element:N,type:"in"}))}else if(G.left instanceof f.SChildElementImpl){const N=G.left;if((0,c.isFadeable)(N)&&G.leftParentId!==void 0&&!(0,E.containsSome)(w,N)){const U=w.index.getById(G.leftParentId);if(U instanceof f.SParentElementImpl){const Q=I.modelFactory.createElement(N);U.add(Q),D.fades.push({element:Q,type:"out"})}}}});const C=this.createAnimations(D,w,I);return C.length>=2?new s.CompoundAnimation(w,I,C):C.length===1?C[0]:w}updateElement(w,M,I){if((0,l.isLocateable)(w)&&(0,l.isLocateable)(M)){const D=w.position,C=M.position;(!(0,r.almostEquals)(D.x,C.x)||!(0,r.almostEquals)(D.y,C.y))&&(I.moves===void 0&&(I.moves=[]),I.moves.push({element:M,fromPosition:D,toPosition:C}),M.position=D)}(0,p.isSizeable)(w)&&(0,p.isSizeable)(M)&&(r.Dimension.isValid(M.bounds)?(!(0,r.almostEquals)(w.bounds.width,M.bounds.width)||!(0,r.almostEquals)(w.bounds.height,M.bounds.height))&&(I.resizes===void 0&&(I.resizes=[]),I.resizes.push({element:M,fromDimension:{width:w.bounds.width,height:w.bounds.height},toDimension:{width:M.bounds.width,height:M.bounds.height}})):M.bounds={x:M.bounds.x,y:M.bounds.y,width:w.bounds.width,height:w.bounds.height}),w instanceof S.SRoutableElementImpl&&M instanceof S.SRoutableElementImpl&&this.edgeRouterRegistry&&(I.edgeMementi===void 0&&(I.edgeMementi=[]),I.edgeMementi.push({edge:M,before:this.takeSnapshot(w),after:this.takeSnapshot(M)})),(0,g.isSelectable)(w)&&(0,g.isSelectable)(M)&&(M.selected=w.selected),w instanceof f.SModelRootImpl&&M instanceof f.SModelRootImpl&&(M.canvasBounds=w.canvasBounds),w instanceof h.ViewportRootElementImpl&&M instanceof h.ViewportRootElementImpl&&(M.scroll=w.scroll,M.zoom=w.zoom)}takeSnapshot(w){return this.edgeRouterRegistry.get(w.routerKind).takeSnapshot(w)}createAnimations(w,M,I){const D=[];if(w.fades.length>0&&D.push(new u.FadeAnimation(M,w.fades,I,!0)),w.moves!==void 0&&w.moves.length>0){const C=new Map;for(const z of w.moves)C.set(z.element.id,z);D.push(new d.MoveAnimation(M,C,I,!1))}if(w.resizes!==void 0&&w.resizes.length>0){const C=new Map;for(const z of w.resizes)C.set(z.element.id,z);D.push(new y.ResizeAnimation(M,C,I,!1))}return w.edgeMementi!==void 0&&w.edgeMementi.length>0&&D.push(new d.MorphEdgesAnimation(M,w.edgeMementi,I,!1)),D}undo(w){return this.performUpdate(this.newRoot,this.oldRoot,w)}redo(w){return this.performUpdate(this.oldRoot,this.newRoot,w)}};return Zn.UpdateModelCommand=O,O.KIND=o.UpdateModelAction.KIND,n([(0,i.inject)(_.EdgeRouterRegistry),(0,i.optional)(),e("design:type",_.EdgeRouterRegistry)],O.prototype,"edgeRouterRegistry",void 0),Zn.UpdateModelCommand=O=n([(0,i.injectable)(),t(0,(0,i.inject)(b.TYPES.Action)),e("design:paramtypes",[Object])],O),Zn}var Mt={},Gt={},iy;function Bu(){if(iy)return Gt;iy=1;var n=Gt&&Gt.__decorate||function(g,m,y,b){var v=arguments.length,_=v<3?m:b===null?b=Object.getOwnPropertyDescriptor(m,y):b,S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(g,m,y,b);else for(var E=g.length-1;E>=0;E--)(S=g[E])&&(_=(v<3?S(_):v>3?S(m,y,_):S(m,y))||_);return v>3&&_&&Object.defineProperty(m,y,_),_},e=Gt&&Gt.__metadata||function(g,m){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(g,m)},t=Gt&&Gt.__param||function(g,m){return function(y,b){m(y,b,g)}},i;Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.ViewportAnimation=Gt.GetViewportCommand=Gt.SetViewportCommand=void 0;const o=se(),r=qe(),s=He(),a=gt(),u=as(),f=Mr(),d=ge(),c=sb();let l=i=class extends a.MergeableCommand{constructor(m){super(),this.action=m,this.newViewport=m.newViewport}execute(m){const y=m.root,b=y.index.getById(this.action.elementId);if(b&&(0,f.isViewport)(b)){this.element=b,this.oldViewport={scroll:this.element.scroll,zoom:this.element.zoom};const{zoomLimits:v,horizontalScrollLimits:_,verticalScrollLimits:S}=this.viewerOptions;return this.newViewport=(0,f.limitViewport)(this.newViewport,y.canvasBounds,_,S,v),this.setViewport(b,this.oldViewport,this.newViewport,m)}return m.root}setViewport(m,y,b,v){if(m&&(0,f.isViewport)(m)){if(this.action.animate)return new h(m,y,b,v).start();m.scroll=b.scroll,m.zoom=b.zoom}return v.root}undo(m){return this.setViewport(this.element,this.newViewport,this.oldViewport,m)}redo(m){return this.setViewport(this.element,this.oldViewport,this.newViewport,m)}merge(m,y){return!this.action.animate&&m instanceof i&&this.element===m.element?(this.newViewport=m.newViewport,!0):!1}};Gt.SetViewportCommand=l,l.KIND=r.SetViewportAction.KIND,n([(0,o.inject)(d.TYPES.ViewerOptions),e("design:type",Object)],l.prototype,"viewerOptions",void 0),Gt.SetViewportCommand=l=i=n([(0,o.injectable)(),t(0,(0,o.inject)(d.TYPES.Action)),e("design:paramtypes",[Object])],l);let p=class extends c.ModelRequestCommand{constructor(m){super(),this.action=m}retrieveResult(m){const y=m.root;let b;return(0,f.isViewport)(y)?b={scroll:y.scroll,zoom:y.zoom}:b={scroll:s.Point.ORIGIN,zoom:1},r.ViewportResult.create(b,y.canvasBounds,this.action.requestId)}};Gt.GetViewportCommand=p,p.KIND=r.GetViewportAction.KIND,Gt.GetViewportCommand=p=n([t(0,(0,o.inject)(d.TYPES.Action)),e("design:paramtypes",[Object])],p);class h extends u.Animation{constructor(m,y,b,v){super(v),this.element=m,this.oldViewport=y,this.newViewport=b,this.context=v,this.zoomFactor=Math.log(b.zoom/y.zoom)}tween(m,y){return this.element.scroll={x:(1-m)*this.oldViewport.scroll.x+m*this.newViewport.scroll.x,y:(1-m)*this.oldViewport.scroll.y+m*this.newViewport.scroll.y},this.element.zoom=this.oldViewport.zoom*Math.exp(m*this.zoomFactor),y.root}}return Gt.ViewportAnimation=h,Gt}var ry;function af(){if(ry)return Mt;ry=1;var n=Mt&&Mt.__decorate||function(v,_,S,E){var O=arguments.length,R=O<3?_:E===null?E=Object.getOwnPropertyDescriptor(_,S):E,w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")R=Reflect.decorate(v,_,S,E);else for(var M=v.length-1;M>=0;M--)(w=v[M])&&(R=(O<3?w(R):O>3?w(_,S,R):w(_,S))||R);return O>3&&R&&Object.defineProperty(_,S,R),R},e=Mt&&Mt.__metadata||function(v,_){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(v,_)},t=Mt&&Mt.__param||function(v,_){return function(S,E){_(S,E,v)}};Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.CenterKeyboardListener=Mt.FitToScreenCommand=Mt.CenterCommand=Mt.BoundsAwareViewportCommand=void 0;const i=qe(),o=He(),r=Jr(),s=Ke(),a=gt(),u=Pr(),f=tt(),d=zn(),c=Bu(),l=Mr(),p=se(),h=ge();let g=class extends a.Command{constructor(_){super(),this.animate=_}initialize(_){if(!(0,l.isViewport)(_))return;this.oldViewport={scroll:_.scroll,zoom:_.zoom};const S=[];if(this.getElementIds().forEach(E=>{const O=_.index.getById(E);O&&(0,f.isBoundsAware)(O)&&S.push(this.boundsInViewport(O,O.bounds,_))}),S.length===0&&_.index.all().forEach(E=>{(0,d.isSelectable)(E)&&E.selected&&(0,f.isBoundsAware)(E)&&S.push(this.boundsInViewport(E,E.bounds,_))}),S.length===0&&_.index.all().forEach(E=>{(0,f.isBoundsAware)(E)&&S.push(this.boundsInViewport(E,E.bounds,_))}),S.length!==0){const E=S.reduce((O,R)=>o.Bounds.combine(O,R));if(o.Dimension.isValid(E)){const O=this.getNewViewport(E,_);if(O){const{zoomLimits:R,horizontalScrollLimits:w,verticalScrollLimits:M}=this.viewerOptions;this.newViewport=(0,l.limitViewport)(O,_.canvasBounds,w,M,R)}}}}boundsInViewport(_,S,E){return _ instanceof s.SChildElementImpl&&_.parent!==E?this.boundsInViewport(_.parent,_.parent.localToParent(S),E):S}execute(_){return this.initialize(_.root),this.redo(_)}undo(_){const S=_.root;if((0,l.isViewport)(S)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new c.ViewportAnimation(S,this.newViewport,this.oldViewport,_).start();S.scroll=this.oldViewport.scroll,S.zoom=this.oldViewport.zoom}return S}redo(_){const S=_.root;if((0,l.isViewport)(S)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new c.ViewportAnimation(S,this.oldViewport,this.newViewport,_).start();S.scroll=this.newViewport.scroll,S.zoom=this.newViewport.zoom}return S}equal(_,S){return(0,o.almostEquals)(_.zoom,S.zoom)&&(0,o.almostEquals)(_.scroll.x,S.scroll.x)&&(0,o.almostEquals)(_.scroll.y,S.scroll.y)}};Mt.BoundsAwareViewportCommand=g,n([(0,p.inject)(h.TYPES.ViewerOptions),e("design:type",Object)],g.prototype,"viewerOptions",void 0),Mt.BoundsAwareViewportCommand=g=n([(0,p.injectable)(),e("design:paramtypes",[Boolean])],g);let m=class extends g{constructor(_){super(_.animate),this.action=_}getElementIds(){return this.action.elementIds}getNewViewport(_,S){if(!o.Dimension.isValid(S.canvasBounds))return;let E=1;this.action.retainZoom&&(0,l.isViewport)(S)?E=S.zoom:this.action.zoomScale&&(E=this.action.zoomScale);const O=o.Bounds.center(_);return{scroll:{x:O.x-.5*S.canvasBounds.width/E,y:O.y-.5*S.canvasBounds.height/E},zoom:E}}};Mt.CenterCommand=m,m.KIND=i.CenterAction.KIND,Mt.CenterCommand=m=n([t(0,(0,p.inject)(h.TYPES.Action)),e("design:paramtypes",[Object])],m);let y=class extends g{constructor(_){super(_.animate),this.action=_}getElementIds(){return this.action.elementIds}getNewViewport(_,S){if(!o.Dimension.isValid(S.canvasBounds))return;const E=o.Bounds.center(_),O=this.action.padding===void 0?0:2*this.action.padding;let R=Math.min(S.canvasBounds.width/(_.width+O),S.canvasBounds.height/(_.height+O));return this.action.maxZoom!==void 0&&(R=Math.min(R,this.action.maxZoom)),R===1/0&&(R=1),{scroll:{x:E.x-.5*S.canvasBounds.width/R,y:E.y-.5*S.canvasBounds.height/R},zoom:R}}};Mt.FitToScreenCommand=y,y.KIND=i.FitToScreenAction.KIND,Mt.FitToScreenCommand=y=n([t(0,(0,p.inject)(h.TYPES.Action)),e("design:paramtypes",[Object])],y);class b extends u.KeyListener{keyDown(_,S){return(0,r.matchesKeystroke)(S,"KeyC","ctrlCmd","shift")?[i.CenterAction.create([])]:(0,r.matchesKeystroke)(S,"KeyF","ctrlCmd","shift")?[i.FitToScreenAction.create([])]:[]}}return Mt.CenterKeyboardListener=b,Mt}var Jn={},oy;function ub(){if(oy)return Jn;oy=1;var n=Jn&&Jn.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g},e=Jn&&Jn.__metadata||function(d,c){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(d,c)},t=Jn&&Jn.__param||function(d,c){return function(l,p){c(l,p,d)}};Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.BringToFrontCommand=void 0;const i=se(),o=qe(),r=ge(),s=Ke(),a=gt(),u=pt();let f=class extends a.Command{constructor(c){super(),this.action=c,this.selected=[]}execute(c){const l=c.root;return this.action.elementIDs.forEach(p=>{const h=l.index.getById(p);h instanceof u.SRoutableElementImpl&&(h.source&&this.addToSelection(h.source),h.target&&this.addToSelection(h.target)),h instanceof s.SChildElementImpl&&this.addToSelection(h),this.includeConnectedEdges(h)}),this.redo(c)}includeConnectedEdges(c){if(c instanceof u.SConnectableElementImpl&&(c.incomingEdges.forEach(l=>this.addToSelection(l)),c.outgoingEdges.forEach(l=>this.addToSelection(l))),c instanceof s.SParentElementImpl)for(const l of c.children)this.includeConnectedEdges(l)}addToSelection(c){this.selected.push({element:c,index:c.parent.children.indexOf(c)})}undo(c){for(let l=this.selected.length-1;l>=0;l--){const p=this.selected[l],h=p.element;h.parent.move(h,p.index)}return c.root}redo(c){for(let l=0;l<this.selected.length;l++)this.bringToFront(this.selected[l]);return c.root}bringToFront(c){const l=c.element,p=l.parent.children.length;l.parent.move(l,p-1)}};return Jn.BringToFrontCommand=f,f.KIND=o.BringToFrontAction.KIND,Jn.BringToFrontCommand=f=n([(0,i.injectable)(),t(0,(0,i.inject)(r.TYPES.Action)),e("design:paramtypes",[Object])],f),Jn}var Rc={},sy;function db(){if(sy)return Rc;sy=1,Object.defineProperty(Rc,"__esModule",{value:!0});const n=se(),e=ge(),t=Bl(),i=D_(),o=Vl(),r=Vn(),s=j_(),a=x_(),u=L_(),f=new n.ContainerModule((d,c,l)=>{(0,r.configureCommand)({bind:d,isBound:l},t.SetBoundsCommand),(0,r.configureCommand)({bind:d,isBound:l},t.RequestBoundsCommand),d(i.HiddenBoundsUpdater).toSelf().inSingletonScope(),d(e.TYPES.HiddenVNodePostprocessor).toService(i.HiddenBoundsUpdater),d(e.TYPES.Layouter).to(o.Layouter).inSingletonScope(),d(e.TYPES.LayoutRegistry).to(o.LayoutRegistry).inSingletonScope(),(0,o.configureLayout)({bind:d,isBound:l},a.VBoxLayouter.KIND,a.VBoxLayouter),(0,o.configureLayout)({bind:d,isBound:l},s.HBoxLayouter.KIND,s.HBoxLayouter),(0,o.configureLayout)({bind:d,isBound:l},u.StackLayouter.KIND,u.StackLayouter)});return Rc.default=f,Rc}var Ac={},ay;function lb(){if(ay)return Ac;ay=1,Object.defineProperty(Ac,"__esModule",{value:!0});const n=se(),e=Du(),t=new n.ContainerModule(i=>{i(e.ButtonHandlerRegistry).toSelf().inSingletonScope()});return Ac.default=t,Ac}var Oc={},cy;function fb(){if(cy)return Oc;cy=1,Object.defineProperty(Oc,"__esModule",{value:!0});const n=se(),e=ge(),t=ql(),i=V_(),o=new n.ContainerModule(r=>{r(i.CommandPalette).toSelf().inSingletonScope(),r(e.TYPES.IUIExtension).toService(i.CommandPalette),r(i.CommandPaletteKeyListener).toSelf().inSingletonScope(),r(e.TYPES.KeyListener).toService(i.CommandPaletteKeyListener),r(t.CommandPaletteActionProviderRegistry).toSelf().inSingletonScope(),r(e.TYPES.ICommandPaletteActionProviderRegistry).toService(t.CommandPaletteActionProviderRegistry)});return Oc.default=o,Oc}var Ic={},uy;function hb(){if(uy)return Ic;uy=1,Object.defineProperty(Ic,"__esModule",{value:!0});const n=se(),e=Hl(),t=z_(),i=ge(),o=new n.ContainerModule(r=>{r(i.TYPES.IContextMenuServiceProvider).toProvider(s=>()=>new Promise((a,u)=>{s.container.isBound(i.TYPES.IContextMenuService)?a(s.container.get(i.TYPES.IContextMenuService)):u()})),r(t.ContextMenuMouseListener).toSelf().inSingletonScope(),r(i.TYPES.MouseListener).toService(t.ContextMenuMouseListener),r(i.TYPES.IContextMenuProviderRegistry).to(e.ContextMenuProviderRegistry)});return Ic.default=o,Ic}var Cc={},dy;function pb(){if(dy)return Cc;dy=1,Object.defineProperty(Cc,"__esModule",{value:!0});const n=Ca(),e=se(),t=Zl(),i=X_(),o=ge(),r=W_(),s=new e.ContainerModule((a,u,f)=>{(0,n.configureModelElement)({bind:a,isBound:f},"marker",t.SIssueMarkerImpl,i.IssueMarkerView),a(r.DecorationPlacer).toSelf().inSingletonScope(),a(o.TYPES.IVNodePostprocessor).toService(r.DecorationPlacer)});return Cc.default=s,Cc}var Tc={},ly;function YE(){if(ly)return Tc;ly=1,Object.defineProperty(Tc,"__esModule",{value:!0});const n=se(),e=ge(),t=Jl(),i=new n.ContainerModule(o=>{o(t.IntersectionFinder).toSelf().inSingletonScope(),o(e.TYPES.IEdgeRoutePostprocessor).toService(t.IntersectionFinder)});return Tc.default=i,Tc}var Dc={},fy;function kE(){if(fy)return Dc;fy=1,Object.defineProperty(Dc,"__esModule",{value:!0});const n=se(),e=ge(),t=Q_(),i=eb(),o=new n.ContainerModule(r=>{r(t.JunctionFinder).toSelf().inSingletonScope(),r(e.TYPES.IEdgeRoutePostprocessor).toService(t.JunctionFinder),r(i.JunctionPostProcessor).toSelf().inSingletonScope(),r(e.TYPES.IVNodePostprocessor).toService(i.JunctionPostProcessor),r(e.TYPES.HiddenVNodePostprocessor).toService(i.JunctionPostProcessor)});return Dc.default=o,Dc}var xc={},hy;function gb(){if(hy)return xc;hy=1,Object.defineProperty(xc,"__esModule",{value:!0});const n=se(),e=Du(),t=k_(),i=new n.ContainerModule((o,r,s)=>{(0,e.configureButtonHandler)({bind:o,isBound:s},t.ExpandButtonHandler.TYPE,t.ExpandButtonHandler)});return xc.default=i,xc}var jc={},py;function mb(){if(py)return jc;py=1,Object.defineProperty(jc,"__esModule",{value:!0});const n=se(),e=ge(),t=U_(),i=Xl(),o=Vn(),r=new n.ContainerModule((s,a,u)=>{s(t.ExportSvgKeyListener).toSelf().inSingletonScope(),s(e.TYPES.KeyListener).toService(t.ExportSvgKeyListener),s(t.ExportSvgPostprocessor).toSelf().inSingletonScope(),s(e.TYPES.HiddenVNodePostprocessor).toService(t.ExportSvgPostprocessor),(0,o.configureCommand)({bind:s,isBound:u},t.ExportSvgCommand),s(e.TYPES.SvgExporter).to(i.SvgExporter).inSingletonScope()});return jc.default=r,jc}var Lc={},gy;function yb(){if(gy)return Lc;gy=1,Object.defineProperty(Lc,"__esModule",{value:!0});const n=se(),e=ge(),t=Wl(),i=new n.ContainerModule(o=>{o(t.ElementFader).toSelf().inSingletonScope(),o(e.TYPES.IVNodePostprocessor).toService(t.ElementFader)});return Lc.default=i,Lc}var Nc={},$i={},my;function UE(){if(my)return $i;my=1;var n=$i&&$i.__decorate||function(r,s,a,u){var f=arguments.length,d=f<3?s:u===null?u=Object.getOwnPropertyDescriptor(s,a):u,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(r,s,a,u);else for(var l=r.length-1;l>=0;l--)(c=r[l])&&(d=(f<3?c(d):f>3?c(s,a,d):c(s,a))||d);return f>3&&d&&Object.defineProperty(s,a,d),d},e=$i&&$i.__metadata||function(r,s){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,s)};Object.defineProperty($i,"__esModule",{value:!0}),$i.PopupPositionUpdater=void 0;const t=se(),i=ge();let o=class{decorate(s,a){return s}postUpdate(){const s=document.getElementById(this.options.popupDiv);if(s!==null&&typeof window<"u"){const a=s.getBoundingClientRect();window.innerHeight<a.height+a.top&&(s.style.top=window.pageYOffset+window.innerHeight-a.height-5+"px"),window.innerWidth<a.left+a.width&&(s.style.left=window.pageXOffset+window.innerWidth-a.width-5+"px"),a.left<0&&(s.style.left="0px"),a.top<0&&(s.style.top="0px")}}};return $i.PopupPositionUpdater=o,n([(0,t.inject)(i.TYPES.ViewerOptions),e("design:type",Object)],o.prototype,"options",void 0),$i.PopupPositionUpdater=o=n([(0,t.injectable)()],o),$i}var yy;function vb(){if(yy)return Nc;yy=1,Object.defineProperty(Nc,"__esModule",{value:!0});const n=se(),e=ge(),t=G_(),i=UE(),o=Vn(),r=Au(),s=af(),a=Bu(),u=Fu(),f=new n.ContainerModule((d,c,l)=>{d(i.PopupPositionUpdater).toSelf().inSingletonScope(),d(e.TYPES.PopupVNodePostprocessor).toService(i.PopupPositionUpdater),d(t.HoverMouseListener).toSelf().inSingletonScope(),d(e.TYPES.MouseListener).toService(t.HoverMouseListener),d(t.PopupHoverMouseListener).toSelf().inSingletonScope(),d(e.TYPES.PopupMouseListener).toService(t.PopupHoverMouseListener),d(t.HoverKeyListener).toSelf().inSingletonScope(),d(e.TYPES.KeyListener).toService(t.HoverKeyListener),d(e.TYPES.HoverState).toConstantValue({mouseOverTimer:void 0,mouseOutTimer:void 0,popupOpen:!1,previousPopupElement:void 0}),d(t.ClosePopupActionHandler).toSelf().inSingletonScope();const p={bind:d,isBound:l};(0,o.configureCommand)(p,t.HoverFeedbackCommand),(0,o.configureCommand)(p,t.SetPopupModelCommand),(0,r.configureActionHandler)(p,t.SetPopupModelCommand.KIND,t.ClosePopupActionHandler),(0,r.configureActionHandler)(p,s.FitToScreenCommand.KIND,t.ClosePopupActionHandler),(0,r.configureActionHandler)(p,s.CenterCommand.KIND,t.ClosePopupActionHandler),(0,r.configureActionHandler)(p,a.SetViewportCommand.KIND,t.ClosePopupActionHandler),(0,r.configureActionHandler)(p,u.MoveCommand.KIND,t.ClosePopupActionHandler)});return Nc.default=f,Nc}var Fc={},vy;function _b(){if(vy)return Fc;vy=1,Object.defineProperty(Fc,"__esModule",{value:!0});const n=se(),e=ge(),t=Fu(),i=Vn(),o=new n.ContainerModule((r,s,a)=>{r(t.MoveMouseListener).toSelf().inSingletonScope(),r(e.TYPES.MouseListener).toService(t.MoveMouseListener),(0,i.configureCommand)({bind:r,isBound:a},t.MoveCommand),r(t.LocationPostprocessor).toSelf().inSingletonScope(),r(e.TYPES.IVNodePostprocessor).toService(t.LocationPostprocessor),r(e.TYPES.HiddenVNodePostprocessor).toService(t.LocationPostprocessor)});return Fc.default=o,Fc}var Bc={},_y;function bb(){if(_y)return Bc;_y=1,Object.defineProperty(Bc,"__esModule",{value:!0});const n=se(),e=ge(),t=nb(),i=new n.ContainerModule(o=>{o(t.OpenMouseListener).toSelf().inSingletonScope(),o(e.TYPES.MouseListener).toService(t.OpenMouseListener)});return Bc.default=i,Bc}var Vc={},by;function Sb(){if(by)return Vc;by=1,Object.defineProperty(Vc,"__esModule",{value:!0});const n=se(),e=ge(),t=nf(),i=ju(),o=rb(),r=ef(),s=to(),a=nr(),u=tf(),f=ib(),d=Vn(),c=new n.ContainerModule((l,p,h)=>{l(a.EdgeRouterRegistry).toSelf().inSingletonScope(),l(s.AnchorComputerRegistry).toSelf().inSingletonScope(),l(t.ManhattanEdgeRouter).toSelf().inSingletonScope(),l(e.TYPES.IEdgeRouter).toService(t.ManhattanEdgeRouter),l(o.ManhattanEllipticAnchor).toSelf().inSingletonScope(),l(e.TYPES.IAnchorComputer).toService(o.ManhattanEllipticAnchor),l(o.ManhattanRectangularAnchor).toSelf().inSingletonScope(),l(e.TYPES.IAnchorComputer).toService(o.ManhattanRectangularAnchor),l(o.ManhattanDiamondAnchor).toSelf().inSingletonScope(),l(e.TYPES.IAnchorComputer).toService(o.ManhattanDiamondAnchor),l(i.PolylineEdgeRouter).toSelf().inSingletonScope(),l(e.TYPES.IEdgeRouter).toService(i.PolylineEdgeRouter),l(r.EllipseAnchor).toSelf().inSingletonScope(),l(e.TYPES.IAnchorComputer).toService(r.EllipseAnchor),l(r.RectangleAnchor).toSelf().inSingletonScope(),l(e.TYPES.IAnchorComputer).toService(r.RectangleAnchor),l(r.DiamondAnchor).toSelf().inSingletonScope(),l(e.TYPES.IAnchorComputer).toService(r.DiamondAnchor),l(u.BezierEdgeRouter).toSelf().inSingletonScope(),l(e.TYPES.IEdgeRouter).toService(u.BezierEdgeRouter),l(f.BezierEllipseAnchor).toSelf().inSingletonScope(),l(e.TYPES.IAnchorComputer).toService(f.BezierEllipseAnchor),l(f.BezierRectangleAnchor).toSelf().inSingletonScope(),l(e.TYPES.IAnchorComputer).toService(f.BezierRectangleAnchor),l(f.BezierDiamondAnchor).toSelf().inSingletonScope(),l(e.TYPES.IAnchorComputer).toService(f.BezierDiamondAnchor),(0,d.configureCommand)({bind:l,isBound:h},u.AddRemoveBezierSegmentCommand)});return Vc.default=c,Vc}var zc={},Sy;function wb(){if(Sy)return zc;Sy=1,Object.defineProperty(zc,"__esModule",{value:!0});const n=se(),e=ge(),t=ab(),i=Vn(),o=new n.ContainerModule((r,s,a)=>{(0,i.configureCommand)({bind:r,isBound:a},t.SelectCommand),(0,i.configureCommand)({bind:r,isBound:a},t.SelectAllCommand),(0,i.configureCommand)({bind:r,isBound:a},t.GetSelectionCommand),r(t.SelectKeyboardListener).toSelf().inSingletonScope(),r(e.TYPES.KeyListener).toService(t.SelectKeyboardListener),r(t.SelectMouseListener).toSelf().inSingletonScope(),r(e.TYPES.MouseListener).toService(t.SelectMouseListener)});return zc.default=o,zc}var qc={},wy;function Eb(){if(wy)return qc;wy=1,Object.defineProperty(qc,"__esModule",{value:!0});const n=se(),e=ge(),t=cb(),i=new n.ContainerModule(o=>{o(t.UndoRedoKeyListener).toSelf().inSingletonScope(),o(e.TYPES.KeyListener).toService(t.UndoRedoKeyListener)});return qc.default=i,qc}var Hc={},Ey;function Pb(){if(Ey)return Hc;Ey=1,Object.defineProperty(Hc,"__esModule",{value:!0});const n=se(),e=Vn(),t=sf(),i=new n.ContainerModule((o,r,s)=>{(0,e.configureCommand)({bind:o,isBound:s},t.UpdateModelCommand)});return Hc.default=i,Hc}var Kc={},Py;function Mb(){if(Py)return Kc;Py=1,Object.defineProperty(Kc,"__esModule",{value:!0});const n=se(),e=ge(),t=af(),i=Bu(),o=rf(),r=kl(),s=Vn(),a=new n.ContainerModule((u,f,d)=>{(0,s.configureCommand)({bind:u,isBound:d},t.CenterCommand),(0,s.configureCommand)({bind:u,isBound:d},t.FitToScreenCommand),(0,s.configureCommand)({bind:u,isBound:d},i.SetViewportCommand),(0,s.configureCommand)({bind:u,isBound:d},i.GetViewportCommand),u(t.CenterKeyboardListener).toSelf().inSingletonScope(),u(e.TYPES.KeyListener).toService(t.CenterKeyboardListener),u(o.ScrollMouseListener).toSelf().inSingletonScope(),u(r.ZoomMouseListener).toSelf().inSingletonScope(),u(e.TYPES.MouseListener).toService(o.ScrollMouseListener),u(e.TYPES.MouseListener).toService(r.ZoomMouseListener)});return Kc.default=a,Kc}var $c={},My;function Rb(){if(My)return $c;My=1,Object.defineProperty($c,"__esModule",{value:!0});const n=se(),e=Vn(),t=ub(),i=new n.ContainerModule((o,r,s)=>{(0,e.configureCommand)({bind:o,isBound:s},t.BringToFrontCommand)});return $c.default=i,$c}var Fe={},Ry;function GE(){if(Ry)return Fe;Ry=1;var n=Fe&&Fe.__decorate||function(R,w,M,I){var D=arguments.length,C=D<3?w:I===null?I=Object.getOwnPropertyDescriptor(w,M):I,z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(R,w,M,I);else for(var G=R.length-1;G>=0;G--)(z=R[G])&&(C=(D<3?z(C):D>3?z(w,M,C):z(w,M))||C);return D>3&&C&&Object.defineProperty(w,M,C),C},e=Fe&&Fe.__metadata||function(R,w){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(R,w)};Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.SBezierControlHandleView=Fe.SBezierCreateHandleView=Fe.SCompartmentView=Fe.SLabelView=Fe.SRoutingHandleView=Fe.BezierCurveEdgeView=Fe.PolylineEdgeViewWithGapsOnIntersections=Fe.JumpingPolylineEdgeView=Fe.PolylineEdgeView=Fe.SGraphView=void 0;const t=se(),i=He(),o=ns(),r=Wt(),s=Tu(),a=Jl(),u=xa(),f=pt(),d=nr(),c=ob(),l=tr(),p=eo();let h=class{render(w,M){const I=this.edgeRouterRegistry.routeAllChildren(w),D=`scale(${w.zoom}) translate(${-w.scroll.x},${-w.scroll.y})`;return(0,l.svg)("svg",{"class-sprotty-graph":!0},(0,l.svg)("g",{transform:D},M.renderChildren(w,{edgeRouting:I})))}};Fe.SGraphView=h,n([(0,t.inject)(d.EdgeRouterRegistry),e("design:type",d.EdgeRouterRegistry)],h.prototype,"edgeRouterRegistry",void 0),Fe.SGraphView=h=n([(0,t.injectable)()],h);let g=class extends c.RoutableView{render(w,M,I){const D=this.edgeRouterRegistry.route(w,I);return D.length===0?this.renderDanglingEdge("Cannot compute route",w,M):this.isVisible(w,D,M)?(0,l.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":w.hoverFeedback},this.renderLine(w,D,M,I),this.renderAdditionals(w,D,M),this.renderJunctionPoints(w,D,M,I),M.renderChildren(w,{route:D})):w.children.length===0?void 0:(0,l.svg)("g",null,M.renderChildren(w,{route:D}))}renderJunctionPoints(w,M,I,D){const z=[];for(let G=1;G<M.length;G++)M[G].isJunction&&z.push((0,l.svg)("circle",{cx:M[G].x,cy:M[G].y,r:5}));if(z.length>0)return(0,l.svg)("g",{"class-sprotty-junction":!0},z)}renderLine(w,M,I,D){const C=M[0];let z=`M ${C.x},${C.y}`;for(let G=1;G<M.length;G++){const N=M[G];z+=` L ${N.x},${N.y}`}return(0,l.svg)("path",{d:z})}renderAdditionals(w,M,I){return[]}renderDanglingEdge(w,M,I){return(0,l.svg)("text",{"class-sprotty-edge-dangling":!0,title:w},"?")}};Fe.PolylineEdgeView=g,n([(0,t.inject)(d.EdgeRouterRegistry),e("design:type",d.EdgeRouterRegistry)],g.prototype,"edgeRouterRegistry",void 0),Fe.PolylineEdgeView=g=n([(0,t.injectable)()],g);let m=class extends g{constructor(){super(...arguments),this.jumpOffsetBefore=5,this.jumpOffsetAfter=5,this.skipOffsetBefore=3,this.skipOffsetAfter=2}renderLine(w,M,I,D){let C="";for(let z=0;z<M.length;z++){const G=M[z];z===0&&(C=`M ${G.x},${G.y}`),(0,a.isIntersectingRoutedPoint)(G)&&(C+=this.intersectionPath(w,M,G,D)),z!==0&&(C+=` L ${G.x},${G.y}`)}return(0,l.svg)("path",{d:C})}intersectionPath(w,M,I,D){if(I.intersections.length<1)return"";const C=this.getLineSegment(w,I.intersections[0],D,M),z=this.getIntersectionsSortedBySegmentDirection(C,I);let G="";for(const N of z){const U=this.getOtherLineSegment(w,N,D);if(U===void 0)continue;const Q=this.getLineSegment(w,N,D,M),J=N.intersectionPoint;this.shouldDrawLineJumpOnIntersection(Q,U)?G+=this.createJumpPath(J,Q):this.shouldDrawLineGapOnIntersection(Q,U)&&(G+=this.createGapPath(J,Q))}return G}getIntersectionsSortedBySegmentDirection(w,M){switch(w.direction){case"north":case"north-east":return M.intersections.sort(a.BY_X_THEN_DESCENDING_Y);case"south":case"south-east":case"east":return M.intersections.sort(a.BY_X_THEN_Y);case"south-west":case"west":return M.intersections.sort(a.BY_DESCENDING_X_THEN_Y);case"north-west":return M.intersections.sort(a.BY_DESCENDING_X_THEN_DESCENDING_Y)}}shouldDrawLineJumpOnIntersection(w,M){return Math.abs(w.slopeOrMax)<Math.abs(M.slopeOrMax)}shouldDrawLineGapOnIntersection(w,M){return!this.shouldDrawLineJumpOnIntersection(w,M)}getLineSegment(w,M,I,D){const C=D||this.edgeRouterRegistry.route(w,I),z=M.routable1===w.id?M.segmentIndex1:M.segmentIndex2;return new p.PointToPointLine(C[z],C[z+1])}getOtherLineSegment(w,M,I){const D=M.routable1===w.id?M.routable2:M.routable1,C=w.index.getById(D);if(C instanceof f.SRoutableElementImpl)return this.getLineSegment(C,M,I)}createJumpPath(w,M){const I=i.Point.shiftTowards(w,M.p1,this.jumpOffsetBefore),D=i.Point.shiftTowards(w,M.p2,this.jumpOffsetAfter),C=M.p1.x<M.p2.x?1:0;return` L ${I.x},${I.y} A 1,1 0,0 ${C} ${D.x},${D.y}`}createGapPath(w,M){let I,D;w.y<M.p1.y?(I=-this.skipOffsetBefore,D=this.jumpOffsetAfter+this.skipOffsetAfter):(I=this.jumpOffsetBefore+this.skipOffsetAfter,D=-this.skipOffsetBefore);const C=i.Point.shiftTowards(w,M.p1,I),z=i.Point.shiftTowards(w,M.p2,D);return` L ${C.x},${C.y} M ${z.x},${z.y}`}};Fe.JumpingPolylineEdgeView=m,Fe.JumpingPolylineEdgeView=m=n([(0,t.injectable)()],m);let y=class extends m{constructor(){super(...arguments),this.skipOffsetBefore=3,this.skipOffsetAfter=3}shouldDrawLineJumpOnIntersection(w,M){return!1}shouldDrawLineGapOnIntersection(w,M){return Math.abs(w.slopeOrMax)>=Math.abs(M.slopeOrMax)}createGapPath(w,M){const I=i.Point.shiftTowards(w,M.p1,this.skipOffsetBefore),D=i.Point.shiftTowards(w,M.p2,this.skipOffsetAfter);return` L ${I.x},${I.y} M ${D.x},${D.y}`}};Fe.PolylineEdgeViewWithGapsOnIntersections=y,Fe.PolylineEdgeViewWithGapsOnIntersections=y=n([(0,t.injectable)()],y);let b=class extends c.RoutableView{render(w,M,I){const D=this.edgeRouterRegistry.route(w,I);return D.length===0?this.renderDanglingEdge("Cannot compute route",w,M):this.isVisible(w,D,M)?(0,l.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":w.hoverFeedback},this.renderLine(w,D,M,I),this.renderAdditionals(w,D,M),M.renderChildren(w,{route:D})):w.children.length===0?void 0:(0,l.svg)("g",null,M.renderChildren(w,{route:D}))}renderLine(w,M,I,D){let C="";if(M.length>=4){C+=this.buildMainSegment(M);const z=M.length-4;if(z>0&&z%3===0)for(let G=4;G<M.length;G+=3)C+=this.addSpline(M,G)}return(0,l.svg)("path",{d:C})}buildMainSegment(w){const M=w[0],I=w[1],D=w[2],C=w[3];return`M${M.x},${M.y} C${I.x},${I.y} ${D.x},${D.y} ${C.x},${C.y}`}addSpline(w,M){const I=w[M+1],D=w[M+2];return` S${I.x},${I.y} ${D.x},${D.y}`}renderAdditionals(w,M,I){return[]}renderDanglingEdge(w,M,I){return(0,l.svg)("text",{"class-sprotty-edge-dangling":!0,title:w},"?")}};Fe.BezierCurveEdgeView=b,n([(0,t.inject)(d.EdgeRouterRegistry),e("design:type",d.EdgeRouterRegistry)],b.prototype,"edgeRouterRegistry",void 0),Fe.BezierCurveEdgeView=b=n([(0,t.injectable)()],b);let v=class{constructor(){this.minimalPointDistance=10}render(w,M,I){if(I&&I.route&&w.parent instanceof f.SRoutableElementImpl){const D=this.edgeRouterRegistry.get(w.parent.routerKind),C=I.route===void 0?this.edgeRouterRegistry.route(w.parent,I):I.route,z=D.getHandlePosition(w.parent,C,w);if(z!==void 0){const G=(0,l.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":w.selected,"class-mouseover":w.hoverFeedback,cx:z.x,cy:z.y,r:this.getRadius()});return(0,r.setAttr)(G,"data-kind",w.kind),G}}return(0,l.svg)("g",null)}getRadius(){return 7}};Fe.SRoutingHandleView=v,n([(0,t.inject)(d.EdgeRouterRegistry),e("design:type",d.EdgeRouterRegistry)],v.prototype,"edgeRouterRegistry",void 0),Fe.SRoutingHandleView=v=n([(0,t.injectable)()],v);let _=class extends s.ShapeView{render(w,M){if(!(0,u.isEdgeLayoutable)(w)&&!this.isVisible(w,M))return;const I=(0,l.svg)("text",{"class-sprotty-label":!0},w.text),D=(0,o.getSubType)(w);return D&&(0,r.setAttr)(I,"class",D),I}};Fe.SLabelView=_,Fe.SLabelView=_=n([(0,t.injectable)()],_);let S=class{render(w,M,I){const D=`translate(${w.bounds.x}, ${w.bounds.y})`,C=(0,l.svg)("g",{transform:D,"class-sprotty-comp":"{true}"},M.renderChildren(w)),z=(0,o.getSubType)(w);return z&&(0,r.setAttr)(C,"class",z),C}};Fe.SCompartmentView=S,Fe.SCompartmentView=S=n([(0,t.injectable)()],S);let E=class extends v{render(w,M,I){if(I){const D=I.route;if(D&&w.parent instanceof f.SRoutableElementImpl){const z=this.edgeRouterRegistry.get(w.parent.routerKind).getHandlePosition(w.parent,D,w);if(z!==void 0){const G="translate("+z.x+", "+z.y+")",N=-5.5,U=5.5,Q=w.kind==="bezier-add"?"+":"-",J=(0,l.svg)("g",{transform:G,"class-sprotty-routing-handle":!0,"class-selected":w.selected,"class-mouseover":w.hoverFeedback},(0,l.svg)("circle",{r:this.getRadius()}),(0,l.svg)("text",{x:N,y:U,"attrs-text-align":"middle","style-font-family":"monospace","style-pointer-events":"none","style-fill":"white"},Q));return(0,r.setAttr)(J,"data-kind",w.kind),J}}}return(0,l.svg)("g",null)}};Fe.SBezierCreateHandleView=E,Fe.SBezierCreateHandleView=E=n([(0,t.injectable)()],E);let O=class extends v{render(w,M,I){if(I){const D=I.route;if(D&&w.parent instanceof f.SRoutableElementImpl){const z=this.edgeRouterRegistry.get(w.parent.routerKind).getHandlePosition(w.parent,D,w);if(z!==void 0){let G;for(let U=0;U<D.length;U++){const Q=D[U];if(Q.kind===z.kind&&Q.pointIndex===z.pointIndex){w.kind==="bezier-control-before"?G=D[U+1]:G=D[U-1];break}}let N;if(G){const U=`M ${z.x}, ${z.y} L ${G.x}, ${G.y}`;N=(0,l.svg)("g",{"class-sprotty-routing-handle":!0,"class-selected":w.selected,"class-mouseover":w.hoverFeedback},(0,l.svg)("path",{d:U,stroke:"grey","style-stroke-width":"2px"}),(0,l.svg)("circle",{cx:z.x,cy:z.y,r:this.getRadius()}))}else N=(0,l.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":w.selected,"class-mouseover":w.hoverFeedback,cx:z.x,cy:z.y,r:this.getRadius()});return(0,r.setAttr)(N,"data-kind",w.kind),N}}}return(0,l.svg)("g",null)}};return Fe.SBezierControlHandleView=O,Fe.SBezierControlHandleView=O=n([(0,t.injectable)()],O),Fe}var po={},Yc={},Ay;function Ab(){if(Ay)return Yc;Ay=1,Object.defineProperty(Yc,"__esModule",{value:!0});const n=se(),e=Vn(),t=ge(),i=Lu(),o=ds(),r=new n.ContainerModule((s,a,u)=>{s(t.TYPES.ModelSourceProvider).toProvider(f=>()=>new Promise(d=>{d(f.container.get(t.TYPES.ModelSource))})),(0,e.configureCommand)({bind:s,isBound:u},i.CommitModelCommand),s(t.TYPES.IActionHandlerInitializer).toService(t.TYPES.ModelSource),s(o.ComputedBoundsApplicator).toSelf().inSingletonScope()});return Yc.default=r,Yc}var Oy;function XE(){if(Oy)return po;Oy=1;var n=po&&po.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(po,"__esModule",{value:!0}),po.loadDefaultModules=void 0;const e=n(T_()),t=n(Ab()),i=n(db()),o=n(lb()),r=n(fb()),s=n(hb()),a=n(pb()),u=n($d()),f=Y_(),d=n(gb()),c=n(mb()),l=n(yb()),p=n(vb()),h=n(_b()),g=n(bb()),m=n(Sb()),y=n(wb()),b=n(Eb()),v=n(Pb()),_=n(Mb()),S=n(Rb());function E(O,R){const w=[e.default,t.default,i.default,o.default,r.default,s.default,a.default,f.edgeEditModule,u.default,d.default,c.default,l.default,p.default,f.labelEditModule,f.labelEditUiModule,h.default,g.default,m.default,y.default,b.default,v.default,_.default,S.default];if(R&&R.exclude)for(const M of R.exclude){const I=w.indexOf(M);I>=0&&w.splice(I,1)}O.load(...w)}return po.loadDefaultModules=E,po}var Fn={},kc={},Iy;function WE(){if(Iy)return kc;Iy=1,Object.defineProperty(kc,"__esModule",{value:!0});const n=Ia;function e(g){const m={},y=(S,E)=>{if(E!=="style"&&E!=="class"){const O=a(g[E]);S?S[E]=O:S={[E]:O}}return S},b=Object.keys(g).reduce(y,null);b&&(m.attrs=b);const v=t(g);v&&(m.style=v);const _=i(g);return _&&(m.class=_),m}function t(g){const m=(y,b)=>{const v=b.split(":"),_=o(v[0].trim());if(_){const S=v[1].replace("!important","").trim();y?y[_]=S:y={[_]:S}}return y};try{return g.style.split(";").reduce(m,null)}catch{return null}}function i(g){const m=(y,b)=>(b=b.trim(),b&&(y?y[b]=!0:y={[b]:!0}),y);try{return g.class.split(" ").reduce(m,null)}catch{return null}}function o(g){return g=g.replace(/-(\w)/g,function(b,v){return v.toUpperCase()}),`${g.charAt(0).toLowerCase()}${g.substring(1)}`}const r=new RegExp("&[a-z0-9#]+;","gi");let s=null;function a(g){return s||(s=document.createElement("div")),g.replace(r,m=>s===null?"":(s.innerHTML=m,s.textContent===null?"":s.textContent))}function u(g,m){let y=g,b=null;const v=[],_=S=>{const E=S.firstChild;E!==null&&(b=S),y=E};for(m(y,b),_(y);;){for(;y;)v.push(y),m(y,b),_(y);const S=v.pop();if(y=S||null,!v.length)break;if(b=v[v.length-1],y){const E=y.nextSibling;E==null&&(b=v[v.length-1]),y=E}}}let f=null;const d=new Map;let c=!1;function l(g,m){let y;switch(m!==null&&(y=d.get(m)),g?.nodeType){case 1:{if(y===void 0)return;y.children=y.children?y.children:[];const b=y.children,v=g.attributes,_={};for(let E=0;E<v.length;E++){const O=v.item(E);O&&(_[O.name]=O.value)}const S=(0,n.h)(g.nodeName,e(_));b.push(S),d.set(g,S);break}case 3:{const b=g.textContent;if(b!==null&&y!==void 0){y.children=y.children?y.children:[];const v=y.children,_=v.length>0?v[v.length-1]:null;!c&&typeof _!="string"&&_!==null&&_.sel===void 0?_.text=_.text+b:v.push((0,n.vnode)(void 0,void 0,void 0,b,void 0)),c=!1}break}case 8:{c=!0;break}case 9:{f=(0,n.vnode)(void 0,void 0,[],void 0,void 0),d.set(g,f);break}}}function p(g){const m=g?.children;return typeof m>"u"?null:m.length===1&&typeof m[0]!="string"?m[0]:null}function h(g){var m,y;const b=new window.DOMParser;if(b===void 0||g===void 0||g==="")return null;const v=b.parseFromString(g,"application/xml");if(((m=v?.firstChild)===null||m===void 0?void 0:m.nodeName)==="parsererror"){const _=`${(y=v?.firstChild)===null||y===void 0?void 0:y.textContent}`;return(0,n.h)("parsererror",[_])}return c=!1,f=null,u(v,l),f===null?null:p(f)}return kc.default=h,kc}var ke={},Cy;function Ob(){if(Cy)return ke;Cy=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.ForeignObjectElement=ke.ForeignObjectElementImpl=ke.ShapedPreRenderedElement=ke.ShapedPreRenderedElementImpl=ke.PreRenderedElement=ke.PreRenderedElementImpl=ke.HtmlRoot=ke.HtmlRootImpl=ke.RectangularPort=ke.CircularPort=ke.DiamondNode=ke.RectangularNode=ke.CircularNode=void 0;const n=He(),e=Ke(),t=tt(),i=Qr(),o=zn(),r=us(),s=to();class a extends r.SNodeImpl{get anchorKind(){return s.ELLIPTIC_ANCHOR_KIND}}ke.CircularNode=a;class u extends r.SNodeImpl{get anchorKind(){return s.RECTANGULAR_ANCHOR_KIND}}ke.RectangularNode=u;class f extends r.SNodeImpl{get anchorKind(){return s.DIAMOND_ANCHOR_KIND}}ke.DiamondNode=f;class d extends r.SPortImpl{get anchorKind(){return s.ELLIPTIC_ANCHOR_KIND}}ke.CircularPort=d;class c extends r.SPortImpl{get anchorKind(){return s.RECTANGULAR_ANCHOR_KIND}}ke.RectangularPort=c;class l extends e.SModelRootImpl{constructor(){super(...arguments),this.classes=[]}}ke.HtmlRootImpl=l,ke.HtmlRoot=l;class p extends e.SChildElementImpl{}ke.PreRenderedElementImpl=p,ke.PreRenderedElement=p;class h extends p{constructor(){super(...arguments),this.position=n.Point.ORIGIN,this.size=n.Dimension.EMPTY,this.selected=!1,this.alignment=n.Point.ORIGIN}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(y){this.position={x:y.x,y:y.y},this.size={width:y.width,height:y.height}}}ke.ShapedPreRenderedElementImpl=h,h.DEFAULT_FEATURES=[i.moveFeature,t.boundsFeature,o.selectFeature,t.alignFeature],ke.ShapedPreRenderedElement=h;class g extends h{get bounds(){return n.Dimension.isValid(this.size)?{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}:(0,t.isBoundsAware)(this.parent)?{x:this.position.x,y:this.position.y,width:this.parent.bounds.width,height:this.parent.bounds.height}:n.Bounds.EMPTY}}return ke.ForeignObjectElementImpl=g,ke.ForeignObjectElement=g,ke}var Ty;function ZE(){if(Ty)return Fn;Ty=1;var n=Fn&&Fn.__decorate||function(d,c,l,p){var h=arguments.length,g=h<3?c:p===null?p=Object.getOwnPropertyDescriptor(c,l):p,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(d,c,l,p);else for(var y=d.length-1;y>=0;y--)(m=d[y])&&(g=(h<3?m(g):h>3?m(c,l,g):m(c,l))||g);return h>3&&g&&Object.defineProperty(c,l,g),g},e=Fn&&Fn.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.ForeignObjectView=Fn.PreRenderedView=void 0;const t=tr(),i=se(),o=e(WE()),r=Wt(),s=Tu(),a=Ob();let u=class extends s.ShapeView{render(c,l){if(c instanceof a.ShapedPreRenderedElementImpl&&!this.isVisible(c,l))return;const p=(0,o.default)(c.code);if(p!==null)return this.correctNamespace(p),p}correctNamespace(c){(c.sel==="svg"||c.sel==="g")&&(0,r.setNamespace)(c,"http://www.w3.org/2000/svg")}};Fn.PreRenderedView=u,Fn.PreRenderedView=u=n([(0,i.injectable)()],u);let f=class{render(c,l){const p=(0,o.default)(c.code);if(p===null)return;const h=(0,t.svg)("g",null,(0,t.svg)("foreignObject",{requiredFeatures:"http://www.w3.org/TR/SVG11/feature#Extensibility",height:c.bounds.height,width:c.bounds.width,x:0,y:0},p),l.renderChildren(c));return(0,r.setAttr)(h,"class",c.type),(0,r.setNamespace)(p,c.namespace),h}};return Fn.ForeignObjectView=f,Fn.ForeignObjectView=f=n([(0,i.injectable)()],f),Fn}var Kr={},Dy;function JE(){if(Dy)return Kr;Dy=1;var n=Kr&&Kr.__decorate||function(r,s,a,u){var f=arguments.length,d=f<3?s:u===null?u=Object.getOwnPropertyDescriptor(s,a):u,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(r,s,a,u);else for(var l=r.length-1;l>=0;l--)(c=r[l])&&(d=(f<3?c(d):f>3?c(s,a,d):c(s,a))||d);return f>3&&d&&Object.defineProperty(s,a,d),d};Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.HtmlRootView=void 0;const e=tr(),t=se(),i=Wt();let o=class{render(s,a){const u=(0,e.html)("div",null,a.renderChildren(s));for(const f of s.classes)(0,i.setClass)(u,f,!0);return u}};return Kr.HtmlRootView=o,Kr.HtmlRootView=o=n([(0,t.injectable)()],o),Kr}var Qn={},xy;function Ib(){if(xy)return Qn;xy=1;var n=Qn&&Qn.__decorate||function(p,h,g,m){var y=arguments.length,b=y<3?h:m===null?m=Object.getOwnPropertyDescriptor(h,g):m,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(p,h,g,m);else for(var _=p.length-1;_>=0;_--)(v=p[_])&&(b=(y<3?v(b):y>3?v(h,g,b):v(h,g))||b);return y>3&&b&&Object.defineProperty(h,g,b),b},e=Qn&&Qn.__metadata||function(p,h){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(p,h)};Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.DiagramServerProxy=Qn.ServerStatusAction=void 0;const t=dv(),i=se(),o=qe(),r=xl(),s=ge(),a=Bl(),u=sf(),f=ds();class d{constructor(){this.kind=d.KIND}}Qn.ServerStatusAction=d,d.KIND="serverStatus";const c="__receivedFromServer";let l=class extends f.ModelSource{constructor(){super(...arguments),this.currentRoot={type:"NONE",id:"ROOT"}}get model(){return this.currentRoot}initialize(h){super.initialize(h),h.register(o.ComputedBoundsAction.KIND,this),h.register(a.RequestBoundsCommand.KIND,this),h.register(o.RequestPopupModelAction.KIND,this),h.register(o.CollapseExpandAction.KIND,this),h.register(o.CollapseExpandAllAction.KIND,this),h.register(o.OpenAction.KIND,this),h.register(d.KIND,this),this.clientId||(this.clientId=this.viewerOptions.baseDiv)}handle(h){this.handleLocally(h)&&this.forwardToServer(h)}forwardToServer(h){const g={clientId:this.clientId,action:h};this.logger.log(this,"sending",g),this.sendMessage(g)}messageReceived(h){const g=typeof h=="string"?JSON.parse(h):h;(0,o.isActionMessage)(g)&&g.action?(!g.clientId||g.clientId===this.clientId)&&(g.action[c]=!0,this.logger.log(this,"receiving",g),this.actionDispatcher.dispatch(g.action).then(()=>{this.storeNewModel(g.action)})):this.logger.error(this,"received data is not an action message",g)}handleLocally(h){switch(this.storeNewModel(h),h.kind){case o.ComputedBoundsAction.KIND:return this.handleComputedBounds(h);case o.RequestModelAction.KIND:return this.handleRequestModel(h);case a.RequestBoundsCommand.KIND:return!1;case o.ExportSvgAction.KIND:return this.handleExportSvgAction(h);case d.KIND:return this.handleServerStateAction(h)}return!h[c]}storeNewModel(h){if(h.kind===r.SetModelCommand.KIND||h.kind===u.UpdateModelCommand.KIND||h.kind===a.RequestBoundsCommand.KIND){const g=h.newRoot;g&&(this.currentRoot=g,(h.kind===r.SetModelCommand.KIND||h.kind===u.UpdateModelCommand.KIND)&&(this.lastSubmittedModelType=g.type))}}handleRequestModel(h){const g=Object.assign({needsClientLayout:this.viewerOptions.needsClientLayout,needsServerLayout:this.viewerOptions.needsServerLayout},h.options),m=Object.assign(Object.assign({},h),{options:g});return this.forwardToServer(m),!1}handleComputedBounds(h){if(this.viewerOptions.needsServerLayout)return!0;{const g=this.currentRoot;return this.computedBoundsApplicator.apply(g,h),g.type===this.lastSubmittedModelType?this.actionDispatcher.dispatch(o.UpdateModelAction.create(g)):this.actionDispatcher.dispatch(o.SetModelAction.create(g)),this.lastSubmittedModelType=g.type,!1}}handleExportSvgAction(h){const g=new Blob([h.svg],{type:"text/plain;charset=utf-8"});return(0,t.saveAs)(g,"diagram.svg"),!1}handleServerStateAction(h){return!1}commitModel(h){const g=this.currentRoot;return this.currentRoot=h,g}};return Qn.DiagramServerProxy=l,n([(0,i.inject)(s.TYPES.ILogger),e("design:type",Object)],l.prototype,"logger",void 0),n([(0,i.inject)(f.ComputedBoundsApplicator),e("design:type",f.ComputedBoundsApplicator)],l.prototype,"computedBoundsApplicator",void 0),Qn.DiagramServerProxy=l=n([(0,i.injectable)()],l),Qn}var Yi={},jy;function QE(){if(jy)return Yi;jy=1;var n=Yi&&Yi.__decorate||function(l,p,h,g){var m=arguments.length,y=m<3?p:g===null?g=Object.getOwnPropertyDescriptor(p,h):g,b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(l,p,h,g);else for(var v=l.length-1;v>=0;v--)(b=l[v])&&(y=(m<3?b(y):m>3?b(p,h,y):b(p,h))||y);return m>3&&y&&Object.defineProperty(p,h,y),y},e=Yi&&Yi.__metadata||function(l,p){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(l,p)};Object.defineProperty(Yi,"__esModule",{value:!0}),Yi.LocalModelSource=void 0;const t=dv(),i=se(),o=qe(),r=ti(),s=ns(),a=ge(),u=Zr(),f=of(),d=ds();let c=class extends d.ModelSource{constructor(){super(...arguments),this.currentRoot=u.EMPTY_ROOT}get model(){return this.currentRoot}set model(p){this.setModel(p)}initialize(p){super.initialize(p),p.register(o.ComputedBoundsAction.KIND,this),p.register(o.RequestPopupModelAction.KIND,this)}setModel(p){return this.currentRoot=p,this.submitModel(p,!1)}commitModel(p){const h=this.currentRoot;return this.currentRoot=p,h}updateModel(p){return p===void 0?this.submitModel(this.currentRoot,!0):(this.currentRoot=p,this.submitModel(p,!0))}async getSelection(){const p=await this.actionDispatcher.request(r.GetSelectionAction.create()),h=[];return this.gatherSelectedElements(this.currentRoot,new Set(p.selectedElementsIDs),h),h}gatherSelectedElements(p,h,g){if(h.has(p.id)&&g.push(p),p.children)for(const m of p.children)this.gatherSelectedElements(m,h,g)}async getViewport(){const p=await this.actionDispatcher.request(r.GetViewportAction.create());return{scroll:p.viewport.scroll,zoom:p.viewport.zoom,canvasBounds:p.canvasBounds}}async submitModel(p,h,g){if(this.viewerOptions.needsClientLayout){const m=await this.actionDispatcher.request(o.RequestBoundsAction.create(p)),y=this.computedBoundsApplicator.apply(this.currentRoot,m);await this.doSubmitModel(p,h,g,y)}else await this.doSubmitModel(p,h,g)}async doSubmitModel(p,h,g,m){if(this.layoutEngine!==void 0)try{const b=this.layoutEngine.layout(p,m);b instanceof Promise?p=await b:b!==void 0&&(p=b)}catch(b){this.logger.error(this,b.toString(),b.stack)}const y=this.lastSubmittedModelType;if(this.lastSubmittedModelType=p.type,g&&g.kind===o.RequestModelAction.KIND&&g.requestId){const b=g;await this.actionDispatcher.dispatch(o.SetModelAction.create(p,b.requestId))}else if(h&&p.type===y){const b=Array.isArray(h)?h:p;await this.actionDispatcher.dispatch(o.UpdateModelAction.create(b,{animate:!0,cause:g}))}else await this.actionDispatcher.dispatch(o.SetModelAction.create(p))}applyMatches(p){const h=this.currentRoot;return(0,f.applyMatches)(h,p),this.submitModel(h,p)}addElements(p){const h=[];for(const g of p){const m=g;typeof m.element=="object"&&typeof m.parentId=="string"?h.push({right:m.element,rightParentId:m.parentId}):typeof m.id=="string"&&h.push({right:m,rightParentId:this.currentRoot.id})}return this.applyMatches(h)}removeElements(p){const h=[],g=new s.SModelIndex;g.add(this.currentRoot);for(const m of p){const y=m;if(y.elementId!==void 0&&y.parentId!==void 0){const b=g.getById(y.elementId);b!==void 0&&h.push({left:b,leftParentId:y.parentId})}else{const b=g.getById(y);b!==void 0&&h.push({left:b,leftParentId:this.currentRoot.id})}}return this.applyMatches(h)}handle(p){switch(p.kind){case o.RequestModelAction.KIND:this.handleRequestModel(p);break;case o.ComputedBoundsAction.KIND:this.computedBoundsApplicator.apply(this.currentRoot,p);break;case o.RequestPopupModelAction.KIND:this.handleRequestPopupModel(p);break;case o.ExportSvgAction.KIND:this.handleExportSvgAction(p);break}}handleRequestModel(p){this.submitModel(this.currentRoot,!1,p)}handleRequestPopupModel(p){if(this.popupModelProvider!==void 0){const h=(0,s.findElement)(this.currentRoot,p.elementId),g=this.popupModelProvider.getPopupModel(p,h);g!==void 0&&(g.canvasBounds=p.bounds,this.actionDispatcher.dispatch(o.SetPopupModelAction.create(g,p.requestId)))}}handleExportSvgAction(p){const h=new Blob([p.svg],{type:"text/plain;charset=utf-8"});(0,t.saveAs)(h,"diagram.svg")}};return Yi.LocalModelSource=c,n([(0,i.inject)(a.TYPES.ILogger),e("design:type",Object)],c.prototype,"logger",void 0),n([(0,i.inject)(d.ComputedBoundsApplicator),e("design:type",d.ComputedBoundsApplicator)],c.prototype,"computedBoundsApplicator",void 0),n([(0,i.inject)(a.TYPES.IPopupModelProvider),(0,i.optional)(),e("design:type",Object)],c.prototype,"popupModelProvider",void 0),n([(0,i.inject)(a.TYPES.IModelLayoutEngine),(0,i.optional)(),e("design:type",Object)],c.prototype,"layoutEngine",void 0),Yi.LocalModelSource=c=n([(0,i.injectable)()],c),Yi}var ki={},Ly;function eP(){if(Ly)return ki;Ly=1;var n=ki&&ki.__decorate||function(a,u,f,d){var c=arguments.length,l=c<3?u:d===null?d=Object.getOwnPropertyDescriptor(u,f):d,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(a,u,f,d);else for(var h=a.length-1;h>=0;h--)(p=a[h])&&(l=(c<3?p(l):c>3?p(u,f,l):p(u,f))||l);return c>3&&l&&Object.defineProperty(u,f,l),l},e=ki&&ki.__metadata||function(a,u){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,u)};Object.defineProperty(ki,"__esModule",{value:!0}),ki.ForwardingLogger=void 0;const t=se(),i=qe(),o=Fl(),r=ge();let s=class{error(u,f,...d){this.logLevel>=o.LogLevel.error&&this.forward(u,f,o.LogLevel.error,d)}warn(u,f,...d){this.logLevel>=o.LogLevel.warn&&this.forward(u,f,o.LogLevel.warn,d)}info(u,f,...d){this.logLevel>=o.LogLevel.info&&this.forward(u,f,o.LogLevel.info,d)}log(u,f,...d){if(this.logLevel>=o.LogLevel.log)try{const c=typeof u=="object"?u.constructor.name:String(u);console.log.apply(u,[c+": "+f,...d])}catch{}}forward(u,f,d,c){const l=new Date,p=i.LoggingAction.create({message:f,severity:o.LogLevel[d],time:l.toLocaleTimeString(),caller:typeof u=="object"?u.constructor.name:String(u),params:c.map(h=>JSON.stringify(h))});this.modelSourceProvider().then(h=>{try{h.handle(p)}catch(g){try{console.log.apply(u,[f,p,g])}catch{}}})}};return ki.ForwardingLogger=s,n([(0,t.inject)(r.TYPES.ModelSourceProvider),e("design:type",Function)],s.prototype,"modelSourceProvider",void 0),n([(0,t.inject)(r.TYPES.LogLevel),e("design:type",Number)],s.prototype,"logLevel",void 0),ki.ForwardingLogger=s=n([(0,t.injectable)()],s),ki}var $r={},Ny;function tP(){if(Ny)return $r;Ny=1;var n=$r&&$r.__decorate||function(o,r,s,a){var u=arguments.length,f=u<3?r:a===null?a=Object.getOwnPropertyDescriptor(r,s):a,d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(o,r,s,a);else for(var c=o.length-1;c>=0;c--)(d=o[c])&&(f=(u<3?d(f):u>3?d(r,s,f):d(r,s))||f);return u>3&&f&&Object.defineProperty(r,s,f),f};Object.defineProperty($r,"__esModule",{value:!0}),$r.WebSocketDiagramServerProxy=void 0;const e=se(),t=Ib();let i=class extends t.DiagramServerProxy{listen(r){r.addEventListener("message",s=>{this.messageReceived(s.data)}),r.addEventListener("error",s=>{this.logger.error(this,"error event received",s)}),this.webSocket=r}disconnect(){this.webSocket&&(this.webSocket.close(),this.webSocket=void 0)}sendMessage(r){if(this.webSocket)this.webSocket.send(JSON.stringify(r));else throw new Error("WebSocket is not connected")}};return $r.WebSocketDiagramServerProxy=i,$r.WebSocketDiagramServerProxy=i=n([(0,e.injectable)()],i),$r}var pr={},Fy;function nP(){if(Fy)return pr;Fy=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.ColorMap=pr.toSVG=pr.rgb=void 0;function n(i,o,r){return{red:i,green:o,blue:r}}pr.rgb=n;function e(i){return"rgb("+i.red+","+i.green+","+i.blue+")"}pr.toSVG=e;class t{constructor(o){this.stops=o}getColor(o){o=Math.max(0,Math.min(.99999999,o));const r=Math.floor(o*this.stops.length);return this.stops[r]}}return pr.ColorMap=t,pr}var By;function iP(){return By||(By=1,(function(n){var e=or&&or.__createBinding||(Object.create?(function(M,I,D,C){C===void 0&&(C=D);var z=Object.getOwnPropertyDescriptor(I,D);(!z||("get"in z?!I.__esModule:z.writable||z.configurable))&&(z={enumerable:!0,get:function(){return I[D]}}),Object.defineProperty(M,C,z)}):(function(M,I,D,C){C===void 0&&(C=D),M[C]=I[D]})),t=or&&or.__exportStar||function(M,I){for(var D in M)D!=="default"&&!Object.prototype.hasOwnProperty.call(I,D)&&e(I,M,D)},i=or&&or.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(n,"__esModule",{value:!0}),n.modelSourceModule=n.zorderModule=n.viewportModule=n.updateModule=n.undoRedoModule=n.selectModule=n.routingModule=n.openModule=n.moveModule=n.hoverModule=n.fadeModule=n.exportModule=n.expandModule=n.edgeLayoutModule=n.edgeJunctionModule=n.edgeIntersectionModule=n.decorationModule=n.contextMenuModule=n.commandPaletteModule=n.buttonModule=n.boundsModule=n.defaultModule=void 0,t(Ol(),n),t(Dl(),n),t(Au(),n),t(__(),n),t(Aa(),n),t(as(),n),t(b_(),n),t(gt(),n),t(Vn(),n),t(S_(),n),t(w_(),n),t(Ou(),n),t(xl(),n),t(Zr(),n),t(tn(),n),t(Ke(),n),t(Iu(),n),t(jl(),n),t(Pr(),n),t(ni(),n),t(R_(),n),t(Ca(),n),t(A_(),n),t(O_(),n),t(I_(),n),t(C_(),n),t(Wt(),n),t(ge(),n);const o=i(T_());n.defaultModule=o.default,t(Bl(),n),t(D_(),n),t(Vl(),n),t(tt(),n),t(x_(),n),t(j_(),n),t(L_(),n),t(Tu(),n),t(Du(),n),t(N_(),n),t(ql(),n),t(V_(),n),t(LE(),n),t(Hl(),n),t(z_(),n),t($d(),n),t(q_(),n),t(xa(),n),t(NE(),n),t(H_(),n),t(Y_(),n),t(Da(),n),t(Yl(),n),t($_(),n),t(Nu(),n),t(ja(),n),t(Ul(),n),t(k_(),n),t(Gl(),n),t(FE(),n),t(U_(),n),t(Kl(),n),t(Xl(),n),t(BE(),n),t(Wl(),n),t(Ta(),n),t(G_(),n),t(cs(),n),t(Zl(),n),t(X_(),n),t(W_(),n),t(Jl(),n),t(J_(),n),t(Q_(),n),t(eb(),n),t(Qr(),n),t(Fu(),n),t(HE(),n),t(F_(),n),t(nb(),n),t(tb(),n),t(Ql(),n),t(KE(),n),t(to(),n),t(xu(),n),t(ib(),n),t(tf(),n),t(rb(),n),t(nf(),n),t(pt(),n),t(ef(),n),t(ju(),n),t(nr(),n),t(ob(),n),t(zn(),n),t(ab(),n),t(cb(),n),t(of(),n),t(sf(),n),t(af(),n),t(Mr(),n),t(rf(),n),t($l(),n),t(Bu(),n),t(kl(),n),t(ub(),n);const r=i(db());n.boundsModule=r.default;const s=i(lb());n.buttonModule=s.default;const a=i(fb());n.commandPaletteModule=a.default;const u=i(hb());n.contextMenuModule=u.default;const f=i(pb());n.decorationModule=f.default;const d=i(YE());n.edgeIntersectionModule=d.default;const c=i(kE());n.edgeJunctionModule=c.default;const l=i($d());n.edgeLayoutModule=l.default;const p=i(gb());n.expandModule=p.default;const h=i(mb());n.exportModule=h.default;const g=i(yb());n.fadeModule=g.default;const m=i(vb());n.hoverModule=m.default;const y=i(_b());n.moveModule=y.default;const b=i(bb());n.openModule=b.default;const v=i(Sb());n.routingModule=v.default;const _=i(wb());n.selectModule=_.default;const S=i(Eb());n.undoRedoModule=S.default;const E=i(Pb());n.updateModule=E.default;const O=i(Mb());n.viewportModule=O.default;const R=i(Rb());n.zorderModule=R.default,t(us(),n),t(GE(),n),t(XE(),n),t(ZE(),n),t(JE(),n),t(tr(),n),t(Ob(),n),t(K_(),n),t(Lu(),n),t(Ib(),n),t(QE(),n),t(eP(),n),t(ds(),n),t(tP(),n);const w=i(Ab());n.modelSourceModule=w.default,t(er(),n),t(B_(),n),t(nP(),n),t(eo(),n),t(ss(),n),t(Fl(),n),t(Er(),n)})(or)),or}var W=iP(),Fo;(function(n){function e(r){return"cancelState"in r}n.is=e;function t(r){return e(r)&&r.cancelState.cancelUntil>=r.commandSequenceNumber}n.isCanceled=t;function i(r){return e(r)&&t(r)&&r.cancelState.skipUntil>=r.commandSequenceNumber}n.isCanceledAndSkipped=i;function o(r,s,a){r.cancelState.cancelUntil=a,s&&(r.cancelState.skipUntil=a)}n.setCanceled=o})(Fo||(Fo={}));function rP(n){return oP(n)}function oP(n){return`matrix(${n.a},${n.b},${n.c},${n.d},${n.e},${n.f})`}function sP(n,e){const t=e.x-n.x,i=e.y-n.y;return Ji(t,i)}function aP(n,e,t,i){const o=sP(n,t),r=Le(o,e),s=t,a=i,u=Math.atan2(a.y-s.y,a.x-s.x)-Math.atan2(r.y-s.y,r.x-s.x),f=lv(u,s.x,s.y),d=Math.sqrt(Math.pow(r.x-s.x,2)+Math.pow(r.y-s.y,2)),l=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2))/d,p=Su(l,l,s.x,s.y);return Xi([o,p,f])}class cP extends $0{constructor(e){super(),this.root=e}getElement(e){return this.root.index.getById(e)}getParentElement(e){return this.root.index.getById(e).parent.id}}class La extends W.SChildElementImpl{get root(){return super.root}cachedProperty(e,t){let i=Number.NaN,o;Object.defineProperty(this,e,{enumerable:!0,get:()=>{const r=this.root.changeRevision;return(o===void 0||r!=i)&&(i=r,o=t()),o}})}getMouseTransformationMatrix(){const e=this.root.getMouseTransformationMatrix(),t=this.root.layoutEngine.localToAncestor(this.id,this.root.id),i=gl(t);return Xi(i,e)}}class Na extends La{constructor(){super(),this.cachedProperty("endPosition",()=>this.index.getById(this.end).position)}}class Fa extends La{constructor(){super(...arguments),this._selected=!1}get selected(){return this._selected}set selected(e){this._selected=e,this.parent.pointVisibilityManager.setSelectionState(this,e)}get hoverData(){const e=this.root.createConnectionHoverData;if(e!=null&&"target"in e&&e.target===this.id)return e}}class yo extends La{constructor(){super(...arguments),this._selected=!1}get selected(){return this._selected}set selected(e){this._selected=e,this.parent.parent.pointVisibilityManager.setSelectionState(this,e)}get posId(){return this.pos==="start"?this.parent.start:this.parent.segments.at(-1).end}get dependencies(){return[this.posId]}}const uP=new Set([]);class gn extends Fa{constructor(){super(),this.animatedFields=uP,this.position=null,this.cachedProperty("startMarker",()=>{var e;return(e=this.children.find(i=>i instanceof yo&&i.pos==="start"))!==null&&e!==void 0?e:null}),this.cachedProperty("endMarker",()=>{var e;return(e=this.children.find(i=>i instanceof yo&&i.pos==="end"))!==null&&e!==void 0?e:null}),this.cachedProperty("segments",()=>this.children.filter(e=>e instanceof Na)),this.cachedProperty("layout",()=>this.root.layoutEngine.layoutConnection(this)),this.cachedProperty("line",()=>this.root.layoutEngine.layoutLine(this,this.parent.id))}get showControlElements(){return this.parent.pointVisibilityManager.isVisible(this.id)}get dependencies(){const e=this.children.flatMap(t=>t.dependencies);return[this.start,...e]}}class Cb{constructor(e){this.visibleContents=new Map,this.dependents=new Map,this.dependencies=new Map,this.peerDependencies=new Map;for(const t of e.children)t instanceof Fa&&this.registerElement(t)}registerElement(e){const t=e.id,i=e.dependencies;for(const o of i)this.getDependantsList(o).push(t);if(this.getDependenciesList(t).push(...i),e instanceof gn){for(const o of i)this.getPeerDependenciesList(o).push(t);e.startMarker!=null&&this.registerElement(e.startMarker),e.endMarker!=null&&this.registerElement(e.endMarker)}}getDependantsList(e){return this.dependents.has(e)||this.dependents.set(e,[]),this.dependents.get(e)}getDependenciesList(e){return this.dependencies.has(e)||this.dependencies.set(e,[]),this.dependencies.get(e)}getPeerDependenciesList(e){return this.peerDependencies.has(e)||this.peerDependencies.set(e,[]),this.peerDependencies.get(e)}isVisible(e){return this.visibleContents.has(e)}setSelectionState(e,t){t?this.setSelected(e):this.setUnselected(e)}setSelected(e){const t=this.getOrCreateVisibilityReason(e.id);t.self=!0,this.makeDependenciesVisible(e.id),this.makeDependentsVisible(e.id),this.makePeerDependenciesVisible(e.id)}setUnselected(e){const t=this.visibleContents.get(e.id);t!==void 0&&(t.self=!1,this.updatePeerDependencies(e.id),ta.isVisible(t)||this.visibleContents.delete(e.id),t.visibleDependencies.size===0&&this.updateDependants(e.id),t.visibleDependants.size===0&&this.updateDependencies(e.id))}makeDependenciesVisible(e){for(const t of this.getDependenciesList(e))this.makeDependencyVisible(e,t)}makeDependencyVisible(e,t){const i=this.getOrCreateVisibilityReason(t);i.visibleDependants.add(e),i.visibleDependants.size===1&&!i.self&&this.makeDependenciesVisible(t)}makePeerDependenciesVisible(e){for(const t of this.getPeerDependenciesList(e))this.makeDependencyVisible(e,t)}makeDependentsVisible(e){for(const t of this.getDependantsList(e)){const i=this.getOrCreateVisibilityReason(t);i.visibleDependencies.add(e),i.visibleDependencies.size===1&&!i.self&&this.makeDependentsVisible(t)}}getOrCreateVisibilityReason(e){return this.visibleContents.has(e)||this.visibleContents.set(e,{visibleDependants:new Set,visibleDependencies:new Set,self:!1}),this.visibleContents.get(e)}updateDependants(e){for(const t of this.getDependantsList(e)){const i=this.visibleContents.get(t);i!==void 0&&(i.visibleDependencies.delete(e),ta.isVisible(i)||this.visibleContents.delete(t),!i.self&&i.visibleDependencies.size===0&&this.updateDependants(t))}}updateDependencies(e){for(const t of this.getDependenciesList(e))this.updateDependency(e,t)}updateDependency(e,t){const i=this.visibleContents.get(t);i!==void 0&&(i.visibleDependants.delete(e),ta.isVisible(i)||this.visibleContents.delete(t),!i.self&&i.visibleDependants.size===0&&this.updateDependencies(t))}updatePeerDependencies(e){for(const t of this.getPeerDependenciesList(e))this.updateDependency(e,t)}}var ta;(function(n){function e(t){return t.self||t.visibleDependants.size>0||t.visibleDependencies.size>0}n.isVisible=e})(ta||(ta={}));class Yd extends W.ViewportRootElementImpl{get pointVisibilityManager(){return this._pointVisibilityManager||(this._pointVisibilityManager=new Cb(this)),this._pointVisibilityManager}constructor(e=new W.ModelIndexImpl){super(e),this.changeRevision=0,this.sequenceNumber=0,this.layoutEngineVersion=-1,this.globalRotation=0,this.incrementalUpdateCount=0}get layoutEngine(){return(this.currentLayoutEngine==null||this.layoutEngineVersion!=this.changeRevision)&&(this.currentLayoutEngine=new cP(this),this.layoutEngineVersion=this.changeRevision),this.currentLayoutEngine}get bounds(){return{x:this.rootBounds.position.x,y:this.rootBounds.position.y,width:this.rootBounds.size.width,height:this.rootBounds.size.height}}get selectedElements(){return[...this.index.all().filter(e=>W.isSelectable(e)&&e.selected)]}getMouseTransformationMatrix(){const e=this.canvasBounds;return Xi(Ji(this.scroll.x,this.scroll.y),Su(1/this.zoom),Ji(-e.x,-e.y))}getPosition(e){const t=this.getMouseTransformationMatrix();return Le(t,{x:e.pageX,y:e.pageY})}}class dP extends W.Animation{constructor(e,t){super(t),this.newModel=e}tween(e,t){return Fo.isCanceled(t)?Fo.isCanceledAndSkipped(t)?this.tweenAndUpdateChangeRevision(1,t):this.newModel:this.tweenAndUpdateChangeRevision(e,t)}tweenAndUpdateChangeRevision(e,t){const i=this.tweenInternal(e,t);return i.changeRevision++,i}}class lP extends dP{constructor(e,t,i){super(e,i),this.elementAnimations=t}tweenInternal(e,t){for(const i of this.elementAnimations)i.interpolations.forEach(([o,r],s)=>{let a=r;e<1&&(a=(1-e)*o+e*r),i.element[s]=a});return this.newModel}}function Vy(n){return"animatedFields"in n}function fP(n,e){return[...n.animatedFields].filter(t=>e.animatedFields.has(t))}function cf(n=void 0){return ft.FitToScreenAction.create([],{padding:50,maxZoom:2,animate:n})}const le=Object.assign(Object.assign({},W.TYPES),{TransactionIdProvider:Symbol("TransactionIdProvider"),TransactionStateProvider:Symbol("TransactionStateProvider"),CreateAndMoveMouseListener:Symbol("CreateAndMoveMouseListener"),ConfigManager:Symbol("ConfigManager"),SettingsProvider:Symbol("SettingsProvider"),ConnectionEditProvider:Symbol("ConnectionEditProvider"),ToolTypeProvider:Symbol("ToolTypeProvider"),MoveCursorProvider:Symbol("MoveCursorProvider"),BoxSelectProvider:Symbol("BoxSelectProvider"),KeyState:Symbol("KeyState"),ITouchListener:Symbol("ITouchListener"),IPointerListener:Symbol("IPointerListener"),SnapLinesStateManager:Symbol("SnapLinesStateManager")});var uf=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Tb=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let Bo=class extends W.UpdateModelCommand{computeAnimation(e,t,i){const o={},r=[];W.forEachMatch(t,(f,d)=>{if(d.left!==void 0&&d.right!==void 0){const c=this._updateElement(d.left,d.right);c!==void 0&&r.push(c)}else o[f]=d});const s=[];r.length>0&&s.push(new lP(e,r,i));const a=super.computeAnimation(e,o,i);a instanceof W.Animation&&s.push(a);const{distance:u}=Db(this.oldRoot.index,e.index);return u>0||s.length===0||this.transactionStateProvider.isInTransaction&&this.oldRoot.incrementalUpdateCount<3?e:s.length>1?new W.CompoundAnimation(e,i,s):s[0]}_updateElement(e,t){if(W.isSelectable(e)&&W.isSelectable(t)&&(t.selected=e.selected),e instanceof W.SModelRootImpl&&t instanceof W.SModelRootImpl&&(t.canvasBounds=e.canvasBounds),e instanceof W.ViewportRootElementImpl&&t instanceof W.ViewportRootElementImpl&&(t.scroll=e.scroll,t.zoom=e.zoom),e instanceof Yd&&t instanceof Yd&&(t.createConnectionHoverData=e.createConnectionHoverData),e instanceof gn&&t instanceof gn&&(e.splitPreviewDataProvider=t.splitPreviewDataProvider),Vy(e)&&Vy(t)){const i=fP(e,t);if(i.length>0){const o=new Map;for(const r of i){const s=e[r],a=t[r];s!=a&&o.set(r,[s,a])}return{element:t,interpolations:o}}}}performUpdate(e,t,i){return t.changeRevision=e.changeRevision+1,t.sequenceNumber=e.sequenceNumber,this.transactionStateProvider.isInTransaction||hP(e.index,t.index,this.dispatcher),super.performUpdate(e,t,i)}};uf([Ee(le.IActionDispatcher),Tb("design:type",Object)],Bo.prototype,"dispatcher",void 0);uf([Ee(le.TransactionStateProvider),Tb("design:type",Function)],Bo.prototype,"transactionStateProvider",void 0);Bo=uf([Re()],Bo);function hP(n,e,t){const{ratioOfDivergence:i}=Db(n,e);i>=.5&&t.dispatch(cf())}function Db(n,e){let t=0,i=0;return n.all().forEach(o=>{const r=e.getById(o.id);(r==null||o.type!==r.type)&&t++,i++}),e.all().forEach(o=>{const r=n.getById(o.id);(r==null||o.type!==r.type)&&(t++,i++)}),{distance:t,ratioOfDivergence:t/i}}var xb=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},pP=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let bo=class extends W.Command{execute(e){const t=e.root;t.changeRevision++,t.sequenceNumber=this.action.sequenceNumber,t.incrementalUpdateCount++;for(const i of this.action.updates){const o=e.root.index.getById(i.target);o!==void 0&&Object.assign(o,i.changes)}return e.root}undo(e){throw new Error("Undo is not supported")}redo(e){throw new Error("Redo is not supported")}};bo.KIND=j0.KIND;xb([Ee(le.Action),pP("design:type",Object)],bo.prototype,"action",void 0);bo=xb([Re()],bo);var gP=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let kd=class extends W.CommandStack{constructor(){super(...arguments),this.cancelCounter=-1}handleCommand(e,t,i){(e instanceof Bo||e instanceof bo)&&this.lastContext!=null&&Fo.setCanceled(this.lastContext,e instanceof bo,this.cancelCounter),this.cancelCounter++,super.handleCommand(e,t,i)}createContext(e){var t,i,o,r;const s=super.createContext(e),a={root:s.root,modelFactory:s.modelFactory,logger:s.logger,modelChanged:s.modelChanged,syncer:s.syncer,commandSequenceNumber:((i=(t=this.lastContext)===null||t===void 0?void 0:t.commandSequenceNumber)!==null&&i!==void 0?i:-1)+1,get duration(){return Fo.isCanceled(this)?0:s.duration},set duration(u){s.duration=u},cancelState:(r=(o=this.lastContext)===null||o===void 0?void 0:o.cancelState)!==null&&r!==void 0?r:{cancelUntil:-1,skipUntil:-1}};return this.lastContext=a,a}};kd=gP([Re()],kd);var mP=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let Ud=class extends W.DiagramServerProxy{constructor(){super(...arguments),this.inTransaction=!1}initialize(e){super.initialize(e),e.register(Zi.KIND,this),e.register(sv.KIND,this),e.register(Nd.KIND,this),e.register(Fd.KIND,this),e.register(av.KIND,this),e.register(cv.KIND,this)}handleLocally(e){return Nd.isRemoteUndoAction(e)?(this.handleUndo(),!1):Fd.isRemoteRedoAction(e)?(this.handleRedo(),!1):Zi.isTransactionalAction(e)?(e.committed?(this.handleTransactionCommit(),this.inTransaction=!1):this.inTransaction||(this.handleTransactionStart(),this.inTransaction=!0),!0):super.handleLocally(e)}};Ud=mP([Re()],Ud);function Si(n){const e=n.root;return W.isViewport(e)?e.zoom:1}var xe;(function(n){n.HAND="hand",n.CURSOR="cursor",n.CONNECT="connect",n.ADD_ELEMENT="add-element",n.BOX_SELECT="box-select",n.AUTOLAYOUT="autolayout"})(xe||(xe={}));function Gd(n){return n===xe.CURSOR||n===xe.ADD_ELEMENT||n===xe.AUTOLAYOUT}var jb=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Lb=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};class Ba extends W.MouseListener{isRegularInteractionTool(){return Gd(this.toolTypeProvider.toolType)}isForcedScroll(e){return this.keyState.isSpacePressed||e.button===1}}jb([Ee(le.ToolTypeProvider),Lb("design:type",Object)],Ba.prototype,"toolTypeProvider",void 0);jb([Ee(le.KeyState),Lb("design:type",Function)],Ba.prototype,"keyState",void 0);function Vo(n,e,t,i){const o=jt.DEFAULT.projectPoint(n,e,i),{settings:{linePointPosPrecision:r},hasSegment:s}=t;if(r==null&&s)return o;const a=s?o.relativePos:o.pos,u=[];if(r==null){const f=Number(a.toPrecision(15));u.push(f,f+10**-15,f-10**-15)}else{const f=Math.min(Math.max(bi.roundToPrecision(a,r),0),1);u.push(f,f+r,f-r)}return i!==void 0?yP(n,e,u,o,s,i):vP(n,e,u,o,s,t.settings)}function yP(n,e,t,i,o,r){let s=i,a=Number.POSITIVE_INFINITY;for(const u of t){if(u<0||u>1)continue;const f=Fb(u,o,e,r,i.segment),d=o?jt.DEFAULT.getPoint(f.relativePos,f.segment,r,e):jt.DEFAULT.getPoint(f.pos,void 0,r,e),c=fn.distance(n,d);c<a&&(a=c,s=f)}return s}function vP(n,e,t,i,o,r){let s=i,a=Number.POSITIVE_INFINITY;for(const u of t){const f=Fb(u,o,e,0,i.segment),d=Nb(o?f.relativePos:f.pos,o?f.segment:void 0,e,n),c=Object.assign(Object.assign({},f),{distance:d}),l=o?jt.DEFAULT.getPoint(c.relativePos,c.segment,d,e):jt.DEFAULT.getPoint(c.pos,void 0,d,e),p=fn.distance(n,l);p<a&&(a=p,s=c)}return s.distance=bi.roundToLinePointDistancePrecision(r,s.distance),s}function Nb(n,e,t,i){const o=jt.DEFAULT.getPoint(n,e,0,t),r=jt.DEFAULT.getNormalVector(n,e,t),s=i.x-o.x,a=i.y-o.y,u=r.x**2+r.y**2;return(s*r.x+a*r.y)/u}function Fb(n,e,t,i,o){if(e)return{relativePos:n,segment:o,pos:(o+n)/t.line.segments.length,distance:i};{const r=Math.floor(n*t.line.segments.length);return{pos:n,segment:r,relativePos:n*t.line.segments.length-r,distance:i}}}var au;(function(n){n.KIND="resetCanvasBoundsAction"})(au||(au={}));var Bb=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},_P=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let ca=class extends W.Command{execute(e){return e.root.canvasBounds=ft.Bounds.EMPTY,e.root}undo(e){return e.root}redo(e){return e.root}};ca.KIND=au.KIND;Bb([Ee(le.Action),_P("design:type",Object)],ca.prototype,"action",void 0);ca=Bb([Re()],ca);const bP=new At((n,e,t)=>{W.configureCommand({bind:n,isBound:t},ca)});var Vu=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Vb=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let ua=class{};ua=Vu([Re()],ua);var So;(function(n){n.KIND="updateCursor"})(So||(So={}));let zo=class extends W.Command{execute(e){return this.action.toolCursor===null?this.moveCursorProvider.toolCursor=void 0:this.action.toolCursor!=null&&(this.moveCursorProvider.toolCursor=this.action.toolCursor),this.action.moveCursor===null?this.moveCursorProvider.moveCursor=void 0:this.action.moveCursor!=null&&(this.moveCursorProvider.moveCursor=this.action.moveCursor),e.root}undo(e){throw new Error("Undo is not supported")}redo(e){throw new Error("Redo is not supported")}};zo.KIND=So.KIND;Vu([Ee(le.Action),Vb("design:type",Object)],zo.prototype,"action",void 0);Vu([Ee(le.MoveCursorProvider),Vb("design:type",ua)],zo.prototype,"moveCursorProvider",void 0);zo=Vu([Re()],zo);var da;(function(n){n.KIND="updateSnapLines";function e(t){return t.kind===n.KIND}n.is=e})(da||(da={}));class Va{constructor(e,t,i=!0){this.transformationMatrix=e,this.moveCursor=t,this.requiresMove=i,this.hasMoved=!1}generateActions(e,t,i,o,r){if(i&&this.requiresMove&&!this.hasMoved)return[];const s=[];if(this.moveCursor!=null&&(!this.hasMoved||i)){const c={kind:So.KIND,moveCursor:i?null:this.moveCursor};s.push(c)}i||(this.hasMoved=!0);const{x:a,y:u}=Le(this.transformationMatrix,{x:t.pageX,y:t.pageY}),f=this.handleMove(a,u,t,e),d={kind:Zi.KIND,transactionId:o,sequenceNumber:r,committed:i,edits:f.edits};if(s.push(d),f.snapLines!=null&&!i){const c={kind:da.KIND,snapLines:f.snapLines,transactionId:o,sequenceNumber:r};s.push(c)}return s}}const qo=10**-6;function No(n,e){return[Le(n,{x:e.dx,y:e.dy}),Le(n,{x:e.dx+e.width,y:e.dy}),Le(n,{x:e.dx,y:e.dy+e.height}),Le(n,{x:e.dx+e.width,y:e.dy+e.height})]}function zb(n,e){return Le(n,{x:e.dx+e.width/2,y:e.dy+e.height/2})}function Ce(n){return Math.round(n*10**6)/10**6}function zy(n){const e=new Map;for(const t of n){const i=`${t.x},${t.y}`;e.has(i)||e.set(i,t)}return Array.from(e.values())}function Ho([n,e],[t,i]){return n<=t?e>=t:n>=t?i>=n:!1}function cu([n,e],[t,i]){const o=Math.max(n,t),r=Math.min(e,i);return o<=r?[o,r]:null}function qy(n,e,t){const i=[];let o=0,r=0;for(;o<n.length&&r<e.length;){const s=t(n[o],e[r]);s===0?(i.push(n[o]),o++,r++):s<0?o++:r++}return i}function na(n,e){const t=Math.abs(e);return t<n.minOffset.x?(t+qo<n.minOffset.x&&(n.nearestSnapsX.length=0),n.minOffset.x=t,!0):t-qo<n.minOffset.x}function ia(n,e){const t=Math.abs(e);return t<n.minOffset.y?(t+qo<n.minOffset.y&&(n.nearestSnapsY.length=0),n.minOffset.y=t,!0):t-qo<n.minOffset.y}function SP(n,e){n.nearestSnapsX=n.nearestSnapsX.filter(t=>t.offset-e.x-qo<=n.minOffset.x),n.nearestSnapsY=n.nearestSnapsY.filter(t=>t.offset-e.y-qo<=n.minOffset.y)}function qb(n,e,t){const i=wP(e),o=new Map,r=n.layoutEngine;for(const[s,a]of i.entries()){const u=n.index.getById(s);if(EP(u,n,t))continue;const f=PP(u,a,r);o.set(s,f)}return o}function wP(n){const e=new Map;for(const t of n)(gv.isCanvasPoint(t)||ts.isCanvasElement(t))&&(e.has(t.parent.id)?e.get(t.parent.id).push(t):e.set(t.parent.id,[t]));return e}function EP(n,e,t){let i=n;for(;i!==e;){if(t.has(i.id))return!0;i=i.parent}return!1}function PP(n,e,t){const i=kr(n.globalRotation),o=n.id;return e.length===1?MP(e[0],o,i,t):RP(e,o,i,t)}function MP(n,e,t,i){if(ts.isCanvasElement(n)){const o=Xi(t,i.localToAncestor(n.id,e)),r=No(o,n),s=zb(o,n),a=hn.ofPoints(r);return{points:[...r,s].sort(ei.compare),bounds:a}}else{const o=i.getPoint(n.id,e);return{points:[Le(t,o)],bounds:void 0}}}function RP(n,e,t,i){const o=[];for(const s of n)if(ts.isCanvasElement(s)){const a=Xi(t,i.localToAncestor(s.id,e)),u=No(a,s);o.push(...u)}else{const a=i.getPoint(s.id,e);o.push(Le(t,a))}const r=hn.ofPoints(o);return{points:[r.position,{x:r.position.x+r.size.width,y:r.position.y},{x:r.position.x+r.size.width,y:r.position.y+r.size.height},{x:r.position.x,y:r.position.y+r.size.height}].sort(ei.compare),bounds:r}}function ls(n,e,t){const i=new Map,o=new Set,r=new Set,s={position:n.scroll,size:{width:n.canvasBounds.width/n.zoom,height:n.canvasBounds.height/n.zoom}},a=n.layoutEngine;for(const u of e){const f=n.index.getById(u),d=[],c=[],l=[];d.push(...f.children);const p=kr(f.globalRotation),h=[];for(;d.length>0;){const g=d.pop();if(!t.has(g.id))if(ts.isCanvasElement(g)){if(t.has(g.id)||o.has(g.id)&&!r.has(g.id))continue;const m=a.localToAncestor(g.id,u),y=No(m,g);if(!o.has(g.id)){if(o.add(g.id),!y.some(v=>hn.contains(s,Le(p,v))))continue;r.add(g.id)}const b=y.map(v=>Le(p,v));c.push(...b),c.push(Le(p,zb(m,g))),l.push(hn.ofPoints(b)),d.push(...g.children)}else if(ml.isCanvasConnection(g)){if(t.has(g.id))continue;h.push(g.start),d.push(...g.children)}else if(fv.isCanvasLineSegment(g)||hv.isCanvasAxisAlignedSegment(g)||pv.isCanvasBezierSegment(g)){if(t.has(g.id))continue;h.push(g.end)}else d.push(...g.children)}for(const g of h)if(!t.has(g)&&(o.has(g)||(o.add(g),hn.contains(s,a.getPoint(g,n.id))&&r.add(g)),r.has(g))){const m=a.getPoint(g,u);c.push(Le(p,m))}i.set(u,{points:c.sort(ei.compare),bounds:l.sort(hn.compare),globalRotation:f.globalRotation})}return i}function AP(n,e){const t=new Map;for(const[i,o]of n.entries()){const r=e.get(i);if(!r||o.globalRotation!==r.globalRotation)continue;const s=qy(o.points,r.points,ei.compare),a=qy(o.bounds,r.bounds,hn.compare);t.set(i,{points:s,bounds:a,globalRotation:o.globalRotation})}return t}class za{constructor(e,t){this.referenceData=e,this.settings=t??{}}updateReferenceData(e){const t=ls(e,new Set(this.referenceData.keys()),new Set);this.referenceData=AP(this.referenceData,t)}}var Ge;(function(n){n.GAP="gap",n.POINT="point",n.SIZE="size"})(Ge||(Ge={}));var ht;(function(n){n.CENTER_HORIZONTAL="center_horizontal",n.CENTER_VERTICAL="center_vertical",n.SIDE_LEFT="side_left",n.SIDE_RIGHT="side_right",n.SIDE_TOP="side_top",n.SIDE_BOTTOM="side_bottom"})(ht||(ht={}));var ct;(function(n){n.POINTS="points",n.GAP="gap",n.SIZE="size"})(ct||(ct={}));var ot;(function(n){n.VERTICAL="vertical",n.HORIZONTAL="horizontal"})(ot||(ot={}));function OP(n,e,t,i,o,r){const{nearestSnapsX:s,nearestSnapsY:a}=i;for(const u of e)for(const f of n){const d=f.x-u.x,c=f.y-u.y,l=d-t.x,p=c-t.y;r.snapX&&na(i,l)&&s.push({type:Ge.POINT,context:o,point:u,referencePoint:f,offset:d}),r.snapY&&ia(i,p)&&a.push({type:Ge.POINT,context:o,point:u,referencePoint:f,offset:c})}}function IP(n,e,t,i,o){const r=new Map,s=new Map,a=(u,f,d,c)=>{u.has(f)||u.set(f,new Map);const l=u.get(f);l.has(d)||l.set(d,[]);const p=l.get(d),h=i.get(f),g=kr(-h);for(const m of c)p.push(Le(g,m))};for(const u of n)if(u.type===Ge.POINT){const f=Ce(u.point.x),d=Le(t,u.point);a(r,u.context,f,[{x:Ce(u.referencePoint.x),y:Ce(d.y)},{x:Ce(u.referencePoint.x),y:Ce(u.referencePoint.y)}])}for(const u of e)if(u.type===Ge.POINT){const f=Ce(u.point.y),d=Le(t,u.point);a(s,u.context,f,[{x:Ce(d.x),y:Ce(u.referencePoint.y)},{x:Ce(u.referencePoint.x),y:Ce(u.referencePoint.y)}])}for(const[u,f]of r.entries()){o.has(u)||o.set(u,[]);for(const[,d]of f.entries()){const c={type:ct.POINTS,points:zy(d.sort(ei.compare))};o.get(u).push(c)}}for(const[u,f]of s.entries()){o.has(u)||o.set(u,[]);for(const[,d]of f.entries()){const c={type:ct.POINTS,points:zy(d.sort(ei.compare))};o.get(u).push(c)}}}const Hb=99999;function CP(n){return{horizontalGaps:TP(n),verticalGaps:DP(n)}}function TP(n){const e=n.sort((i,o)=>i.position.x-o.position.x),t=[];for(let i=0;i<e.length;i++){const o=e[i];for(let r=i+1;r<e.length;r++){if(t.length>=Hb)return t;const s=e[r],a=o.position.y,u=a+o.size.height,f=o.position.x+o.size.width,d=s.position.x,c=s.position.y,l=c+s.size.height;f<d&&Ho([a,u],[c,l])&&t.push({startBounds:o,endBounds:s,startSide:[{x:f,y:a},{x:f,y:u}],endSide:[{x:d,y:c},{x:d,y:l}],length:d-f,overlap:cu([a,u],[c,l])})}}return t}function DP(n){const e=n.sort((i,o)=>i.position.y-o.position.y),t=[];for(let i=0;i<e.length;i++){const o=e[i];for(let r=i+1;r<e.length;r++){if(t.length>=Hb)return t;const s=e[r],a=o.position.x,u=a+o.size.width,f=o.position.y+o.size.height,d=s.position.x,c=s.position.y,l=d+s.size.width;f<c&&Ho([a,u],[d,l])&&t.push({startBounds:o,endBounds:s,startSide:[{x:a,y:f},{x:u,y:f}],endSide:[{x:d,y:c},{x:l,y:c}],length:c-f,overlap:cu([a,u],[d,l])})}}return t}function xP(n,e,t,i,o,r){const{horizontalGaps:s,verticalGaps:a}=t;let u;r.snapGaps===!0?u={left:!0,right:!0,top:!0,bottom:!0,centerHorizontal:!0,centerVertical:!0}:u=r.snapGaps,r.snapX&&jP(n,e,s,i,o,u),r.snapY&&LP(n,e,a,i,o,u)}function jP(n,e,t,i,o,r){const{nearestSnapsX:s}=i,a=Ce(n.position.x),u=Ce(n.position.x+n.size.width),f=(a+u)/2,d=Ce(n.position.y),c=Ce(n.position.y+n.size.height),l=[d+e.y,c+e.y];for(const p of t){if(!Ho(l,p.overlap))continue;const h=p.startSide[0].x+p.length/2,g=Ce(h-f),m=p.length>u-a;if(r.centerHorizontal&&m&&na(i,g-e.x)){const O={type:Ge.GAP,context:o,direction:ht.CENTER_HORIZONTAL,gap:p,offset:g,bounds:n};s.push(O);continue}const y=p.endBounds.position.x+p.endBounds.size.width,b=a-y,v=Ce(p.length-b);if(r.right&&na(i,v-e.x)){const O={type:Ge.GAP,context:o,direction:ht.SIDE_RIGHT,gap:p,offset:v,bounds:n};s.push(O);continue}const S=p.startBounds.position.x-u,E=Ce(S-p.length);if(r.left&&na(i,E-e.x)){const O={type:Ge.GAP,context:o,direction:ht.SIDE_LEFT,gap:p,offset:E,bounds:n};s.push(O);continue}}}function LP(n,e,t,i,o,r){const{nearestSnapsY:s}=i,a=Ce(n.position.y),u=Ce(n.position.y+n.size.height),f=(a+u)/2,d=Ce(n.position.x),c=Ce(n.position.x+n.size.width),l=[d+e.x,c+e.x];for(const p of t){if(!Ho(l,p.overlap))continue;const h=p.startSide[0].y+p.length/2,g=Ce(h-f),m=p.length>u-a;if(r.centerVertical&&m&&ia(i,g-e.y)){const O={type:Ge.GAP,context:o,direction:ht.CENTER_VERTICAL,gap:p,offset:g,bounds:n};s.push(O);continue}const b=p.startBounds.position.y-u,v=Ce(b-p.length);if(r.top&&ia(i,v-e.y)){const O={type:Ge.GAP,context:o,direction:ht.SIDE_TOP,gap:p,offset:v,bounds:n};s.push(O);continue}const _=p.endBounds.position.y+p.endBounds.size.height,S=Ce(a-_),E=p.length-S;if(r.bottom&&ia(i,E-e.y)){const O={type:Ge.GAP,context:o,direction:ht.SIDE_BOTTOM,gap:p,offset:E,bounds:n};s.push(O);continue}}}function NP(n,e,t,i){const o=FP(n,e);VP(o,t,i)}function FP(n,e){const t=new Map;for(const i of n){t.has(i.context)||t.set(i.context,[]);const o=t.get(i.context),r=i.bounds,{x:s,y:a}=Le(e,r.position),{x:u,y:f}=Le(e,{x:r.position.x+r.size.width,y:r.position.y+r.size.height}),d=cu([a,f],i.gap.overlap),c=cu([s,u],i.gap.overlap);BP(i,d,c,s,u,a,f,o)}return t}function BP(n,e,t,i,o,r,s,a){switch(n.direction){case ht.CENTER_HORIZONTAL:zP(n,e,i,o,a);break;case ht.CENTER_VERTICAL:qP(n,t,r,s,a);break;case ht.SIDE_RIGHT:HP(n,e,i,a);break;case ht.SIDE_LEFT:KP(n,e,o,a);break;case ht.SIDE_TOP:$P(n,t,s,a);break;case ht.SIDE_BOTTOM:YP(n,t,r,a);break}}function VP(n,e,t){for(const[i,o]of n.entries()){t.has(i)||t.set(i,[]);const r=t.get(i),s=e.get(i),a=kr(-s);r.push(...kP(o.map(u=>Object.assign(Object.assign({},u),{points:u.points.map(f=>Le(a,{x:Ce(f.x),y:Ce(f.y)}))}))))}}function zP(n,e,t,i,o){if(e){const r=(e[0]+e[1])/2;o.push({type:ct.GAP,direction:ot.HORIZONTAL,points:[{x:n.gap.startSide[0].x,y:r},{x:t,y:r}]},{type:ct.GAP,direction:ot.HORIZONTAL,points:[{x:i,y:r},{x:n.gap.endSide[0].x,y:r}]})}}function qP(n,e,t,i,o){if(e){const r=(e[0]+e[1])/2;o.push({type:ct.GAP,direction:ot.VERTICAL,points:[{x:r,y:n.gap.startSide[0].y},{x:r,y:t}]},{type:ct.GAP,direction:ot.VERTICAL,points:[{x:r,y:i},{x:r,y:n.gap.endSide[0].y}]})}}function HP(n,e,t,i){if(e){const o=(e[0]+e[1])/2,r=n.gap.startBounds.position.x+n.gap.startBounds.size.width,s=n.gap.endBounds.position.x,a=s+n.gap.endBounds.size.width;i.push({type:ct.GAP,direction:ot.HORIZONTAL,points:[{x:r,y:o},{x:s,y:o}]},{type:ct.GAP,direction:ot.HORIZONTAL,points:[{x:a,y:o},{x:t,y:o}]})}}function KP(n,e,t,i){if(e){const o=(e[0]+e[1])/2,r=n.gap.startBounds.position.x,s=r+n.gap.startBounds.size.width,a=n.gap.endBounds.position.x;i.push({type:ct.GAP,direction:ot.HORIZONTAL,points:[{x:t,y:o},{x:r,y:o}]},{type:ct.GAP,direction:ot.HORIZONTAL,points:[{x:s,y:o},{x:a,y:o}]})}}function $P(n,e,t,i){if(e){const o=(e[0]+e[1])/2,r=n.gap.startBounds.position.y,s=r+n.gap.startBounds.size.height,a=n.gap.endBounds.position.y;i.push({type:ct.GAP,direction:ot.VERTICAL,points:[{x:o,y:t},{x:o,y:r}]},{type:ct.GAP,direction:ot.VERTICAL,points:[{x:o,y:s},{x:o,y:a}]})}}function YP(n,e,t,i){if(e){const o=(e[0]+e[1])/2,r=n.gap.startBounds.position.y+n.gap.startBounds.size.height,s=n.gap.endBounds.position.y,a=s+n.gap.endBounds.size.height;i.push({type:ct.GAP,direction:ot.VERTICAL,points:[{x:o,y:r},{x:o,y:s}]},{type:ct.GAP,direction:ot.VERTICAL,points:[{x:o,y:a},{x:o,y:t}]})}}function kP(n){const e=new Map;for(const t of n){const i=t.points.flatMap(o=>[Ce(o.x),Ce(o.y)]).join(",");e.has(i)||e.set(i,t)}return Array.from(e.values())}function UP(n,e,t,i,o,r){const s=Ce(n.position.x),a=Ce(n.position.y),u=Ce(n.position.x+n.size.width),f=Ce(n.position.y+n.size.height),d=[s+e.x,u+e.x],c=[a+e.y,f+e.y],l=t.filter(p=>Ho([p.position.x,p.position.x+p.size.width],d)||Ho([p.position.y,p.position.y+p.size.height],c));r.snapX&&GP(n,e,l,i,o,r),r.snapY&&XP(n,e,l,i,o,r)}function GP(n,e,t,i,o,r){const s=r.snapSize.horizontal;for(const a of t){const u=(n.size.width-a.size.width)*s;na(i,u)&&i.nearestSnapsX.push({type:Ge.SIZE,context:o,offset:e.x+u,targetBounds:a,bounds:n})}}function XP(n,e,t,i,o,r){const s=r.snapSize.vertical;for(const a of t){const u=(n.size.height-a.size.height)*s;ia(i,u)&&i.nearestSnapsY.push({type:Ge.SIZE,context:o,offset:e.y+u,targetBounds:a,bounds:n})}}function WP(n,e,t,i,o){const r=new Map;ZP(n,t,r),JP(e,t,r);for(const[s,a]of r.entries()){o.has(s)||o.set(s,[]);const u=o.get(s),f=i.get(s),d=kr(-f);u.push(...QP(a.map(c=>Object.assign(Object.assign({},c),{points:c.points.map(l=>Le(d,l))}))))}}function ZP(n,e,t){for(const i of n){if(i.type!==Ge.SIZE)continue;const o=i.context,r=i.targetBounds,s=i.bounds;t.has(o)||t.set(o,[]);const a=t.get(o);a.push({type:ct.SIZE,points:[{x:Ce(s.position.x),y:Ce(s.position.y+s.size.height/2)},{x:Ce(s.position.x+s.size.width),y:Ce(s.position.y+s.size.height/2)}].map(u=>Le(e,u))}),a.push({type:ct.SIZE,points:[{x:Ce(r.position.x),y:Ce(r.position.y+r.size.height/2)},{x:Ce(r.position.x+r.size.width),y:Ce(r.position.y+r.size.height/2)}]})}}function JP(n,e,t){for(const i of n){if(i.type!==Ge.SIZE)continue;const o=i.context,r=i.targetBounds,s=i.bounds;t.has(o)||t.set(o,[]);const a=t.get(o);a.push({type:ct.SIZE,points:[{x:Ce(s.position.x+s.size.width/2),y:Ce(s.position.y)},{x:Ce(s.position.x+s.size.width/2),y:Ce(s.position.y+s.size.height)}].map(u=>Le(e,u))}),a.push({type:ct.SIZE,points:[{x:Ce(r.position.x+r.size.width/2),y:Ce(r.position.y)},{x:Ce(r.position.x+r.size.width/2),y:Ce(r.position.y+r.size.height)}]})}}function QP(n){const e=new Map;for(const t of n){const i=t.points.flatMap(o=>[Ce(o.x),Ce(o.y)]).join(",");e.has(i)||e.set(i,t)}return Array.from(e.values())}function eM(n,e){const{scale:t}=wa(e);return n.filter(i=>{let o;if(i.type===Ge.POINT)o=Le(e,i.point).x-i.referencePoint.x;else if(i.type===Ge.GAP){const r=i.gap;let s,a;i.direction===ht.CENTER_HORIZONTAL?(s=i.bounds.position.x+i.bounds.size.width/2,a=r.startSide[0].x+r.length/2):i.direction===ht.SIDE_LEFT?(s=i.bounds.position.x+i.bounds.size.width,a=r.startBounds.position.x-r.length):(s=i.bounds.position.x,a=r.endBounds.position.x+r.endBounds.size.width+r.length),o=Le(e,{x:s,y:0}).x-a}else o=i.bounds.size.width*t.sx-i.targetBounds.size.width;return Math.abs(o)<zu})}function tM(n,e){const{scale:t}=wa(e);return n.filter(i=>{let o;if(i.type===Ge.POINT)o=Le(e,i.point).y-i.referencePoint.y;else if(i.type===Ge.GAP){const r=i.gap;let s,a;i.direction===ht.CENTER_VERTICAL?(s=i.bounds.position.y+i.bounds.size.height/2,a=r.startSide[0].y+r.length/2):i.direction===ht.SIDE_TOP?(s=i.bounds.position.y+i.bounds.size.height,a=r.startBounds.position.y-r.length):(s=i.bounds.position.y,a=r.endBounds.position.y+r.endBounds.size.height+r.length),o=Le(e,{x:0,y:s}).y-a}else o=i.bounds.size.height*t.sy-i.targetBounds.size.height;return Math.abs(o)<zu})}const nM=8,zu=2.5;function qa(n,e,t,i,o){var r,s,a,u;const f=Kb(t),d={nearestSnapsX:[],nearestSnapsY:[],minOffset:{x:f,y:f}};for(const[l,p]of n.entries()){const h=e.get(l);if(!h)continue;const g=CP(h.bounds);o.snapGaps!=!1&&p.bounds!=null&&xP(p.bounds,i,g,d,l,o),o.snapPoints&&OP(h.points,p.points,i,d,l,o),o.snapSize!=!1&&p.bounds!=null&&UP(p.bounds,i,h.bounds,d,l,o)}SP(d,i);const c=new Map;for(const[l,p]of e.entries())c.set(l,p.globalRotation);return{snapOffset:{x:(s=(r=d.nearestSnapsX[0])===null||r===void 0?void 0:r.offset)!==null&&s!==void 0?s:i.x,y:(u=(a=d.nearestSnapsY[0])===null||a===void 0?void 0:a.offset)!==null&&u!==void 0?u:i.y},nearestSnapsX:d.nearestSnapsX,nearestSnapsY:d.nearestSnapsY,contextGlobalRotations:c,elementOffset:i}}function la(n,e){var t,i,o,r;const s=eM(n.nearestSnapsX,e),a=tM(n.nearestSnapsY,e);n.nearestSnapsX=s,n.nearestSnapsY=a;const u={x:(i=(t=s[0])===null||t===void 0?void 0:t.offset)!==null&&i!==void 0?i:n.elementOffset.x,y:(r=(o=a[0])===null||o===void 0?void 0:o.offset)!==null&&r!==void 0?r:n.elementOffset.y},f=!ei.equals(u,n.snapOffset);return n.snapOffset=u,f}function Ko(n,e){const{nearestSnapsX:t,nearestSnapsY:i}=n,o=new Map;if(IP(t,i,e,n.contextGlobalRotations,o),NP([...t,...i].filter(r=>r.type===Ge.GAP),e,n.contextGlobalRotations,o),WP(t,i,e,n.contextGlobalRotations,o),o.size!==0)return o}function Kb(n){return nM/n}class Ha extends Va{constructor(e,t,i,o=void 0,r=!0){super(i,o,r),this.snapHandler=e,this.snappingEnabled=t}isSnappingEnabled(e){return this.snappingEnabled!=e.altKey}}class iM extends Ha{constructor(e,t,i,o,r,s,a,u,f,d,c){const l=r.parent,p=l.parent.globalRotation;let h;p%90===0&&(h=new rM(l,o,s,o?a:i,u)),super(h,f,d,c),this.original=e,this.start=t,this.end=i,this.vertical=o,this.element=r.id}handleMove(e,t,i,o){const s=(this.original+(this.vertical?e:t)-this.start)/(this.end-this.start);let a=Math.min(1,Math.max(0,s)),u;if(this.snapHandler!=null&&this.isSnappingEnabled(i)){const d=o.root,c=Si(d);this.snapHandler.updateReferenceData(d);const l=this.snapHandler.snap(a,this.start,this.end,c);l!=null&&(a=l.snappedPos,u=l.snapLines)}return{edits:[{types:[Be.AXIS_ALIGNED_SEGMENT_POS],values:{pos:this.vertical?a:a-1},elements:[this.element]}],snapLines:u}}}class rM extends za{constructor(e,t,i,o,r){const s=e.root,a=e.parent;super(ls(s,new Set([a.id]),new Set),r),this.vertical=t,this.otherStart=i,this.otherEnd=o,this.context=a.id,this.contextToTargetMatrix=kr(a.globalRotation),this.targetToContextMatrix=kr(-a.globalRotation),a.globalRotation%180===0?this.effectivelyVertical=t:this.effectivelyVertical=!t}snap(e,t,i,o){const r=bi.roundToAxisAlignedPosPrecision(this.settings,e)*(i-t)+t,s=this.getSnapResult(r,o),a=Le(this.targetToContextMatrix,s.snapOffset),u=this.vertical?a.x:a.y,f=(u-t)/(i-t);if(f<0&&f>1)return;const d=bi.roundToAxisAlignedPosPrecision(this.settings,f),c=d*(i-t)+t;if(Math.abs(c-u)>=zu)return;const l=Ko(s,Ji(s.snapOffset.x,s.snapOffset.y));return{snappedPos:d,snapLines:l}}getSnapResult(e,t){const i={bounds:void 0,points:[{x:this.vertical?0:this.otherStart,y:this.vertical?this.otherStart:0},{x:this.vertical?0:this.otherEnd,y:this.vertical?this.otherEnd:0}].map(r=>Le(this.contextToTargetMatrix,r))},o=Le(this.contextToTargetMatrix,{x:this.vertical?e:0,y:this.vertical?0:e});return qa(new Map([[this.context,i]]),this.referenceData,t,o,{snapX:this.effectivelyVertical,snapY:!this.effectivelyVertical,snapGaps:!1,snapPoints:!0,snapSize:!1})}}class oM extends Ha{constructor(e,t,i,o,r,s,a,u,f,d,c,l,p){const h=new sM(u,f,d,c,o,r);super(h,l,p,"cursor-move"),this.point=e,this.editPos=t,this.editDist=i,this.line=o,this.settings=r,this.initialPos=s,this.initialDistance=a,this.hasSegment=Array.isArray(s)}handleMove(e,t,i,o){let r,s,a;const u=o.root;if(this.isSnappingEnabled(i)&&this.snapHandler.updateReferenceData(u),this.editPos){const f=this.handlePositionEdit(e,t,u,i);r=f.pos,s=f.dist,a=f.snapLines}else{const f=this.handleDistanceEdit(e,t,u,i);r=f.pos,s=f.dist,a=f.snapLines}return this.createEditResult(r,s,a)}handlePositionEdit(e,t,i,o){let r,s,a;if(this.isSnappingEnabled(o)){const u=this.trySnapPosition(e,t,i);u!=null&&(r=u.pos,s=u.dist,a=u.snapLines)}if(r==null||s==null){const u=this.calculateNearestPoint(e,t);this.hasSegment?r=[u.segment,u.relativePos]:r=u.pos,s=u.distance}return{pos:r,dist:s,snapLines:a}}trySnapPosition(e,t,i){var o;const r=Vo({x:e,y:t},this.line,{settings:{},hasSegment:this.hasSegment},this.editDist?void 0:(o=this.initialDistance)!==null&&o!==void 0?o:0),s=jt.DEFAULT.getNormalVector(r.pos,r.segment,this.line),a=jt.DEFAULT.getPoint(r.pos,void 0,r.distance,this.line);if(Math.abs((e-a.x)*s.y-(t-a.y)*s.x)/Math.hypot(s.x,s.y)<=zu){const f=Si(i),[d,c]=this.hasSegment?[r.segment,r.relativePos]:[void 0,r.pos],l=this.snapHandler.snap(c,d,r.distance,f,this.editPos,this.editDist);if(l!=null)return{pos:l.pos,dist:l.dist,snapLines:l.snapLines}}}calculateNearestPoint(e,t){var i;return Vo({x:e,y:t},this.line,{settings:this.settings,hasSegment:this.hasSegment},this.editDist?void 0:(i=this.initialDistance)!==null&&i!==void 0?i:0)}handleDistanceEdit(e,t,i,o){const r=this.initialPos,[s,a]=Array.isArray(r)?r:[void 0,r??0];let u=Nb(a,s,this.line,{x:e,y:t}),f;if(this.isSnappingEnabled(o)){const d=this.snapHandler.snap(a,s,u,Si(i),this.editPos,this.editDist);d!=null&&(u=d.dist,f=d.snapLines)}return{pos:r,dist:u,snapLines:f}}createEditResult(e,t,i){var o;const r=[];this.editPos&&r.push(Be.MOVE_LPOS_POS),this.editDist&&r.push(Be.MOVE_LPOS_DIST);const s=this.editPos?e??this.initialPos:this.initialPos;return{edits:[{types:r,values:{pos:s,dist:(o=this.editDist?t:this.initialDistance)!==null&&o!==void 0?o:0},elements:[this.point]}],snapLines:i}}}class sM extends za{constructor(e,t,i,o,r,s){const a=qb(i,e,t);super(ls(i,new Set(a.keys()),t),s),this.originalPoint=o,this.line=r,this.snapElementData=a}snap(e,t,i,o,r,s){const a=jt.DEFAULT.getPoint(e,t,i,this.line),u=fn.sub(a,this.originalPoint),f=t!=null,d=this.calculateSnapResult(o,u),c=fn.add(this.originalPoint,d.snapOffset);return r?this.handlePositionSnap(i,f,s,d,c):s?this.handleDistanceSnap(e,t,i,a,d,c,o):void 0}calculateSnapResult(e,t){return qa(this.snapElementData,this.referenceData,e,t,{snapX:!0,snapY:!0,snapGaps:!1,snapPoints:!0,snapSize:!1})}handlePositionSnap(e,t,i,o,r){const s=Vo(r,this.line,{settings:this.settings,hasSegment:t},i?void 0:e),a=this.calculateSnappedTransform(s);if(la(o,a),o.nearestSnapsX.length==0&&o.nearestSnapsY.length==0)return;const u=Ko(o,a);return{pos:t?[s.segment,s.relativePos]:s.pos,dist:i?s.distance:e,snapLines:u}}calculateSnappedTransform(e){const t=jt.DEFAULT.getPoint(e.pos,void 0,e.distance,this.line),i=fn.sub(t,this.originalPoint);return Ji(i.x,i.y)}handleDistanceSnap(e,t,i,o,r,s,a){const u=jt.DEFAULT.getNormalVector(e,t,this.line),f=jt.DEFAULT.getPoint(e,t,0,this.line),d=this.calculateSnappedDistance(f,u,i,r,s);if(d==null)return;const c=bi.roundToLinePointDistancePrecision(this.settings,d),l=jt.DEFAULT.getPoint(e,t,c,this.line);if(fn.distance(o,l)>Kb(a))return;const p=fn.sub(l,this.originalPoint),h=Ji(p.x,p.y);if(la(r,h),r.nearestSnapsX.length==0&&r.nearestSnapsY.length==0)return;const g=Ko(r,h);return{pos:t!=null?[t,e]:e,dist:c,snapLines:g}}calculateSnappedDistance(e,t,i,o,r){let s;if(o.nearestSnapsX.length>0&&t.x!=0&&(s=(r.x-e.x)/t.x/fn.length(t)),o.nearestSnapsY.length>0&&t.y!=0){const a=(r.y-e.y)/t.y/fn.length(t);(s==null||Math.abs(a-i)<Math.abs(s-i))&&(s=a)}return s}}class aM extends Va{generateActions(){return[]}handleMove(){return{edits:[]}}}class cM extends Ha{constructor(e,t,i,o,r,s,a,u,f){const d=e.parent.globalRotation+e.rotation;let c;if(d%90===0){const l=(d/90%4+4)%4;c=new uM(e,o,r,t,l,i)}super(c,a,u,f),this.scaleX=o,this.scaleY=r,this.groupedElements=s,this.originalWidth=e.width,this.originalHeight=e.height}handleMove(e,t,i,o){let r,s;this.scaleX!==void 0&&(r=Math.abs((e*this.scaleX+this.originalWidth)/this.originalWidth)),this.scaleY!==void 0&&(s=Math.abs((t*this.scaleY+this.originalHeight)/this.originalHeight));const a=i.shiftKey&&r!=null&&s!=null;if(a){const d=Math.max(r,s);r=d,s=d}let u;if(this.snapHandler!=null&&this.isSnappingEnabled(i)){this.snapHandler.updateReferenceData(o.root);const d=this.snapHandler.snap(Si(o),r,s,a);r=d.factorX,s=d.factorY,u=d.snapLines}const f=[];for(const d of this.groupedElements){const c={},l=[];r!=null&&(c.width=d.originalWidth*r,c.dw=c.width-d.originalWidth,l.push(Be.RESIZE_WIDTH)),s!=null&&(c.height=d.originalHeight*s,c.dh=c.height-d.originalHeight,l.push(Be.RESIZE_HEIGHT)),f.push({types:l,elements:d.elements,values:c})}return{edits:f,snapLines:u}}}class uM extends za{constructor(e,t,i,o,r,s){const a=e.parent.id,u=e.root;super(ls(u,new Set([a]),o),s),this.scaleX=t,this.scaleY=i,this.effectiveRotation=r;const f=u.layoutEngine;this.context=a,this.elementToTargetMatrix=Xi(kr(e.parent.globalRotation),f.localToAncestor(e.id,this.context)),this.targetToElementMatrix=gl(this.elementToTargetMatrix),this.current={width:e.width,height:e.height,dx:e.dx,dy:e.dy},this.corners=No(this.elementToTargetMatrix,this.current);const d=hn.ofPoints(this.corners),c=t!=null?(e.width+1)/e.width:1,l=i!=null?(e.height+1)/e.height:1,p={width:this.current.width*c,height:this.current.height*l,dx:this.current.dx*c,dy:this.current.dy*l},h=No(this.elementToTargetMatrix,p),g=hn.ofPoints(h);this.gapSnapOptions=this.calculateGapSnapOptions(d,g),this.snapPointIndices=[0,1,2,3].filter(m=>Math.abs(h[m].x-this.corners[m].x)>0||Math.abs(h[m].y-this.corners[m].y)>0),this.dxRelative=-e.dx/e.width,this.dyRelative=-e.dy/e.height}calculateGapSnapOptions(e,t){const i=Math.abs(t.position.x+t.size.width-(e.position.x+e.size.width))>0,o=Math.abs(t.position.x-e.position.x)>0,r=Math.abs(t.position.y+t.size.height-(e.position.y+e.size.height))>0,s=Math.abs(t.position.y-e.position.y)>0;return{right:o,left:i,centerHorizontal:i!=o,bottom:s,top:r,centerVertical:r!=s}}snap(e,t,i,o){var r,s;const{factorX:a,factorY:u}=this.calculateRoundedFactors({factorX:t,factorY:i}),f={width:this.current.width*(a??1),height:this.current.height*(u??1),dx:this.current.dx*(a??1),dy:this.current.dy*(u??1)},d=No(this.elementToTargetMatrix,f),c={bounds:hn.ofPoints(d),points:this.snapPointIndices.map(y=>d[y])},l=this.effectiveRotation%2===1,p=qa(new Map([[this.context,c]]),this.referenceData,e,{x:0,y:0},{snapX:this.gapSnapOptions.left||this.gapSnapOptions.right,snapY:this.gapSnapOptions.top||this.gapSnapOptions.bottom,snapGaps:this.gapSnapOptions,snapPoints:!0,snapSize:{horizontal:1/((r=l?this.scaleY:this.scaleX)!==null&&r!==void 0?r:1),vertical:1/((s=l?this.scaleX:this.scaleY)!==null&&s!==void 0?s:1)}});let h=this.processSnaps(p,a,u,o,d);la(p,this.createRoundedScale(a,u,h))&&(h=this.processSnaps(p,a,u,o,d));const m=Ko(p,this.createRoundedScale(a,u,h));return{factorX:h.factorX,factorY:h.factorY,snapLines:m}}createRoundedScale(e,t,i){var o,r;const s=this.calculateRoundedFactors(i);return Xi(this.elementToTargetMatrix,Su(((o=s.factorX)!==null&&o!==void 0?o:1)/(e??1),((r=s.factorY)!==null&&r!==void 0?r:1)/(t??1)),this.targetToElementMatrix)}calculateRoundedFactors(e){let t,i;if(e.factorX!=null){const o=this.current.width*e.factorX-this.current.width;t=(this.current.width+bi.roundToResizePrecision(this.settings,o))/this.current.width}if(e.factorY!=null){const o=this.current.height*e.factorY-this.current.height;i=(this.current.height+bi.roundToResizePrecision(this.settings,o))/this.current.height}return{factorX:t,factorY:i}}processSnaps(e,t,i,o,r){const s={};this.adaptFactorsBasedOnSnaps(e,t,i,r,s);const a=this.calculateFinalResizeFactors(t,i,o,s);return s.factorXDirection!==ot.HORIZONTAL&&s.factorYDirection!==ot.HORIZONTAL&&(e.nearestSnapsX.length=0),s.factorXDirection!==ot.VERTICAL&&s.factorYDirection!==ot.VERTICAL&&(e.nearestSnapsY.length=0),a}adaptFactorsBasedOnSnaps(e,t,i,o,r){if(e.nearestSnapsX.length>0){const s=e.nearestSnapsX[0];this.adaptFactorsBasedOnXSnap(s,e,t,i,o,r)}if(e.nearestSnapsY.length>0){const s=e.nearestSnapsY[0];this.adaptFactorsBasedOnYSnap(s,e,t,i,o,r)}}adaptFactorsBasedOnXSnap(e,t,i,o,r,s){if(e.type===Ge.SIZE)this.effectiveRotation%2===0&&i!=null?(s.overrideFactorX=e.targetBounds.size.width/this.current.width,s.factorXDirection=ot.HORIZONTAL):this.effectiveRotation%2===1&&o!=null&&(s.overrideFactorY=e.targetBounds.size.width/this.current.height,s.factorYDirection=ot.HORIZONTAL);else{const a=this.getHorizontalSnapTarget(e),u=Hy(r,h=>Math.abs(h.x-a)),f=this.corners[u].x,d=this.corners[(u+1)%4].x,c=this.corners[(u+2)%4].x,l=u%2===0?this.dxRelative:1-this.dxRelative,p=u<2?this.dyRelative:1-this.dyRelative;this.adaptFactor(f,a,d,l,c,p,ot.HORIZONTAL,i,o,s)||(t.nearestSnapsX.length=0)}}adaptFactorsBasedOnYSnap(e,t,i,o,r,s){if(e.type===Ge.SIZE)this.effectiveRotation%2===0&&o!=null?(s.overrideFactorY=e.targetBounds.size.height/this.current.height,s.factorYDirection=ot.VERTICAL):this.effectiveRotation%2===1&&i!=null&&(s.overrideFactorX=e.targetBounds.size.height/this.current.width,s.factorXDirection=ot.VERTICAL);else{const a=this.getVerticalSnapTarget(e),u=Hy(r,h=>Math.abs(h.y-a)),f=this.corners[u].y,d=this.corners[(u+1)%4].y,c=this.corners[(u+2)%4].y,l=u%2===0?this.dxRelative:1-this.dxRelative,p=u<2?this.dyRelative:1-this.dyRelative;this.adaptFactor(f,a,d,l,c,p,ot.VERTICAL,i,o,s)||(t.nearestSnapsY.length=0)}}calculateFinalResizeFactors(e,t,i,o){var r,s;let a=(r=o.overrideFactorX)!==null&&r!==void 0?r:e,u=(s=o.overrideFactorY)!==null&&s!==void 0?s:t;return i&&(o.overrideFactorX!=null||o.overrideFactorY!=null)&&(o.overrideFactorX!=null&&o.overrideFactorY!=null?o.overrideFactorX>o.overrideFactorY?(u=o.overrideFactorX,o.factorYDirection=o.factorXDirection):(a=o.overrideFactorY,o.factorXDirection=o.factorYDirection):o.overrideFactorX!=null?u=o.overrideFactorX:o.overrideFactorY!=null&&(a=o.overrideFactorY)),{factorX:a,factorY:u}}adaptFactor(e,t,i,o,r,s,a,u,f,d){const c=(t-(e+(i-e)*o))/((e-i)*o),l=(t-(e+(r-e)*s))/((e-r)*s);return u!=null&&(f==null||Math.abs(c-u)<Math.abs(l-f))?(d.overrideFactorX=c,d.factorXDirection=a,!0):f!=null&&(u==null||Math.abs(l-f)<Math.abs(c-u))?(d.overrideFactorY=l,d.factorYDirection=a,!0):!1}getHorizontalSnapTarget(e){if(e.type===Ge.SIZE)throw new Error("Unexpected snap type");if(e.type===Ge.POINT)return e.referencePoint.x;if(e.direction===ht.SIDE_RIGHT)return e.bounds.position.x+e.offset;if(e.direction===ht.SIDE_LEFT)return e.bounds.position.x+e.bounds.size.width+e.offset;{const{startBounds:t,endBounds:i}=e.gap;return i.position.x+t.position.x+t.size.width-(this.gapSnapOptions.left?e.bounds.position.x:e.bounds.position.x+e.bounds.size.width)}}getVerticalSnapTarget(e){if(e.type===Ge.SIZE)throw new Error("Unexpected snap type");if(e.type===Ge.POINT)return e.referencePoint.y;if(e.direction===ht.SIDE_BOTTOM)return e.bounds.position.y+e.offset;if(e.direction===ht.SIDE_TOP)return e.bounds.position.y+e.bounds.size.height+e.offset;{const{startBounds:t,endBounds:i}=e.gap;return i.position.y+t.position.y+t.size.height-(this.gapSnapOptions.top?e.bounds.position.y:e.bounds.position.y+e.bounds.size.height)}}}function Hy(n,e){let t=-1,i=Number.POSITIVE_INFINITY;for(let o=0;o<n.length;o++){const r=e(n[o]);r<i&&(i=r,t=o)}return t}class dM extends Va{constructor(e,t,i){super(i,"cursor-grab"),this.element=e,this.currentRotation=t}handleMove(e,t){const i={x:0,y:-1},o={x:e,y:t},{rotation:r}=wa(aP(ei.ORIGIN,i,ei.ORIGIN,o));let s=this.currentRotation+r.angle*(180/Math.PI);return s=(s%360+360)%360,{edits:[{types:[Be.ROTATE],values:{rotation:s},elements:[this.element]}]}}}class lM extends Ha{constructor(e,t,i,o,r,s,a){const u=new fM(t,i,o,r);if(super(u,s,a,"cursor-move"),this.elementsByTransformation=e,e.some(({moveX:f,moveY:d})=>f&&d))this.snapX=!0,this.snapY=!0;else{const f=new Set;for(const{globalRotation:d,moveX:c,moveY:l}of e)c&&f.add(d%360),l&&f.add((d+90)%360);if(f.size===1){const d=f.values().next().value;this.snapX=d===0||d===180,this.snapY=d===90||d===270}else this.snapX=!0,this.snapY=!0}}handleMove(e,t,i,o){let r,s,a;this.snapX&&this.snapY?(r=!(i.shiftKey&&Math.abs(e)<Math.abs(t)),s=!(i.shiftKey&&Math.abs(e)>=Math.abs(t)),a={x:r?e:0,y:s?t:0}):(r=this.snapX,s=this.snapY,a={x:e,y:t});let u;if(this.isSnappingEnabled(i)){const d=o.root;this.snapHandler.updateReferenceData(d);const c=Si(d),{snappedDragVector:l,snapLines:p}=this.snapHandler.snap(a,r,s,c);a=l,u=p}return{edits:this.elementsByTransformation.map(({elements:d,transformation:c,moveX:l,moveY:p})=>{const h=Le(c,a),g=[];return l&&g.push(Be.MOVE_X),p&&g.push(Be.MOVE_Y),{types:g,values:{dx:h.x,dy:h.y},elements:d}}),snapLines:u}}}class fM extends za{constructor(e,t,i,o){const r=qb(i,e,t);super(ls(i,new Set(r.keys()),t),o),this.snapElementData=r}snap(e,t,i,o){const r=qa(this.snapElementData,this.referenceData,o,this.roundToTranslationPrecision(e),{snapX:t,snapY:i,snapGaps:!0,snapPoints:!0,snapSize:!1});la(r,this.createRoundedTranslation(r.snapOffset));const s=Ko(r,this.createRoundedTranslation(r.snapOffset));return{snappedDragVector:r.snapOffset,snapLines:s}}createRoundedTranslation(e){const t=this.roundToTranslationPrecision(e);return Ji(t.x,t.y)}roundToTranslationPrecision(e){return{x:bi.roundToTranslationPrecision(this.settings,e.x),y:bi.roundToTranslationPrecision(this.settings,e.y)}}}const hM=new Set(["width","height","dx","dy","rotation"]);class Bn extends Fa{constructor(){super(),this.animatedFields=hM,this.cachedProperty("position",()=>this.pos!=null?this.root.layoutEngine.layoutElement(this):ei.ORIGIN)}get dependencies(){return this.pos!=null?[this.pos]:[]}isIncluded(e){const t=this.root.layoutEngine.localToAncestor(this.id,this.root.id);return!hn.contains(e,Le(t,{x:this.dx,y:this.dy}))||!hn.contains(e,Le(t,{x:this.dx+this.width,y:this.dy}))||!hn.contains(e,Le(t,{x:this.dx,y:this.dy+this.height}))?!1:hn.contains(e,Le(t,{x:this.dx+this.width,y:this.dy+this.height}))}}class Ft extends Fa{get isVisible(){return this.parent.pointVisibilityManager.isVisible(this.id)}constructor(){super(),this.cachedProperty("position",()=>this.root.layoutEngine.getPoint(this.id,this.parent.id))}isIncluded(e){const t=this.root.layoutEngine.getPoint(this.id,this.root.id);return hn.contains(e,t)}}Ft.POINT_SIZE=16;Ft.INNER_POINT_SIZE=8;const pM=new Set(["pos"]);class uu extends Ft{constructor(){super(),this.animatedFields=pM,this.cachedProperty("rootPosition",()=>{const e=this.root.layoutEngine.layoutLine(this.index.getById(this.lineProvider),this.parent.id);return jt.DEFAULT.getPoint(this.pos,this.segment,0,e)})}get dependencies(){return[]}}var gM=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let fa=class{render(e){if(e.isVisible)return this.renderInternal(e)}renderPoint(e,t){return df(t,Si(e),e.selected)}};fa=gM([Re()],fa);function df(n,e,t){return[W.svg("circle.canvas-point.selectable",{attrs:{cx:n.x,cy:n.y,r:Ft.POINT_SIZE/2/e},class:{selected:t}}),W.svg("circle.canvas-point-inner.selectable",{attrs:{cx:n.x,cy:n.y,r:Ft.INNER_POINT_SIZE/2/e}})]}var lf=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},$b=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let wo=class{renderCreateConnection(e){if(this.toolTypeProvider.toolType!==xe.CONNECT&&!this.transactionStateProvider.isInCreateConnectionTransaction)return;const t=e.hoverData;if(!(t==null||e.editExpression==null))return W.svg("g",null,this.renderCreateConnectionOutline(t),...this.renderCreateConnectionStartSymbol(e,t))}renderCreateConnectionStartSymbol(e,t){if(this.transactionStateProvider.isInTransaction)return[];const i=jt.DEFAULT.getPoint(t.position,void 0,0,t.line);return df(i,Si(e),!0)}renderCreateConnectionOutline(e){const t=jt.DEFAULT.getSvgPath(e.line.line);return W.svg("path.create-connection-outline",{attrs:{d:t,transform:rP(e.line.transform)},class:{target:this.transactionStateProvider.isInTransaction}})}};wo.CREATE_CONNECTION_CLASS="create-connection-target";lf([Ee(le.TransactionStateProvider),$b("design:type",Function)],wo.prototype,"transactionStateProvider",void 0);lf([Ee(le.ToolTypeProvider),$b("design:type",Object)],wo.prototype,"toolTypeProvider",void 0);wo=lf([Re()],wo);function Xd(n,e){const t=n.globalRotation;return Math.round((e+t)/45%8)}function Ky(n){for(let e=0;e<n.length;e++){const t=n.item(e);if(t?.startsWith("cursor-resize-"))return t}}var mM=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ui;let wi=Ui=class extends wo{render(e,t,i){const o=e.position,r=t.renderChildren(e);e.selected&&r.push(...this.generateSelectedRect(e));const s=this.renderCreateConnection(e),a=W.svg("g.canvas-element.selectable",{attrs:{transform:`translate(${o.x}, ${o.y}) rotate(${e.rotation})`},class:{selected:e.selected}},...r);return W.svg("g",{attrs:{"pointer-events":"visible"}},a,s)}generateSelectedRect(e){const t=Si(e),i=[W.svg("rect.selected-outline",{attrs:Object.assign(Object.assign({},this.generatePoint(e,t,0)),{width:e.width+Ui.SELECTION_OFFSET*2/t,height:e.height+Ui.SELECTION_OFFSET*2/t})}),...[0,1,2,3].map(o=>this.generateSelectedOutlineCorner(e,t,o)),...this.generateResizeBorder(e,t)];return Be.ROTATE in e.edits&&Wi.isConsistent([[e.edits[Be.ROTATE]]])&&i.push(this.generateRotationIcon(e,t)),i}generateSelectedOutlineCorner(e,t,i){const o=this.generatePoint(e,t,i);return W.svg("rect.selected-outline-corner",{attrs:{x:o.x-Ft.INNER_POINT_SIZE/2/t,y:o.y-Ft.INNER_POINT_SIZE/2/t,width:Ft.INNER_POINT_SIZE/t,height:Ft.INNER_POINT_SIZE/t,rx:Ft.INNER_POINT_SIZE/4/t}})}generateRotationIcon(e,t){return W.svg("rect",{class:{[Ui.ROTATE_ICON_CLASS]:!0},attrs:{x:-Ft.INNER_POINT_SIZE/2/t,y:e.dy-Ui.ROTATE_ICON_DISTANCE/t,width:Ft.INNER_POINT_SIZE/t,height:Ft.INNER_POINT_SIZE/t}})}generateResizeBorder(e,t){const i=[],o=this.computeResizeIconOffset(e),r=Be.RESIZE_WIDTH in e.edits,s=Be.RESIZE_HEIGHT in e.edits;return r&&(i.push(this.generateResizeLine(e,t,1,2,o,Rt.RIGHT)),i.push(this.generateResizeLine(e,t,3,4,o,Rt.LEFT))),s&&(i.push(this.generateResizeLine(e,t,0,1,o,Rt.TOP)),i.push(this.generateResizeLine(e,t,2,3,o,Rt.BOTTOM))),r&&s&&i.push(this.generateResizeLine(e,t,0,0,o,Rt.TOP,Rt.LEFT),this.generateResizeLine(e,t,1,1,o,Rt.TOP,Rt.RIGHT),this.generateResizeLine(e,t,2,2,o,Rt.BOTTOM,Rt.RIGHT),this.generateResizeLine(e,t,3,3,o,Rt.BOTTOM,Rt.LEFT)),i}computeResizeIconOffset(e){return Xd(e.parent,e.rotation)}generateResizeLine(e,t,i,o,r,...s){const a=this.generatePoint(e,t,i),u=this.generatePoint(e,t,o);return W.svg("line",{attrs:{x1:a.x,y1:a.y,x2:u.x,y2:u.y},class:Object.assign(Object.assign({},Object.fromEntries(s.map(f=>[f,!0]))),{[Ui.RESIZE_BORDER_CLASS]:i!==o,[Ui.RESIZE_CORNER_CLASS]:i===o,[Ui.RESIZE_CLASS]:!0,[`cursor-resize-${(i+o+r)%8}`]:!0})})}generatePoint(e,t,i){i=i%4;const o=Ui.SELECTION_OFFSET/t,r=i===1||i===2?e.width+o:-o,s=i<2?-o:e.height+o;return{x:e.dx+r,y:e.dy+s}}};wi.ROTATE_ICON_CLASS="canvas-rotate-icon";wi.RESIZE_CLASS="resize";wi.RESIZE_BORDER_CLASS="resize-border";wi.RESIZE_CORNER_CLASS="resize-corner";wi.SELECTION_OFFSET=6;wi.ROTATE_ICON_DISTANCE=30;wi=Ui=mM([Re()],wi);var Rt;(function(n){n.TOP="resize-top",n.RIGHT="resize-right",n.BOTTOM="resize-bottom",n.LEFT="resize-left"})(Rt||(Rt={}));const yM=new Set(["x","y"]);class Yb extends Ft{constructor(){super(...arguments),this.animatedFields=yM}get dependencies(){return[]}}const vM=new Set(["offsetX","offsetY"]);class Zc extends Ft{constructor(){super(),this.animatedFields=vM,this.cachedProperty("targetXPosition",()=>this.root.layoutEngine.getPoint(this.targetX,this.parent.id)),this.cachedProperty("targetYPosition",()=>this.root.layoutEngine.getPoint(this.targetY,this.parent.id))}get dependencies(){return[this.targetX,this.targetY]}}class ff extends Na{constructor(){super(),this.cachedProperty("startControlPointPosition",()=>this.index.getById(this.startControlPoint).position),this.cachedProperty("endControlPointPosition",()=>this.index.getById(this.endControlPoint).position)}get dependencies(){return[this.end,this.startControlPoint,this.endControlPoint]}generateControlViewElements(e,t){const i=this.startControlPointPosition,o=this.endControlPointPosition,r="bezier-handle-line",s=t.originalStart,a=t.originalEnd;return[W.svg("line",{attrs:{x1:s.x,x2:i.x,y1:s.y,y2:i.y},class:{[r]:!0}}),W.svg("line",{attrs:{x1:a.x,x2:o.x,y1:a.y,y2:o.y},class:{[r]:!0}})]}canSplitSegment(){return Wi.isConsistent([[this.edits[Be.SPLIT_CANVAS_BEZIER_SEGMENT]]])}}class _M{get affectedElementIds(){const e=new Set,t=new Set,i=new Set;let o=new Set,r=new Set;for(const s of this.movedElementsX)o.add(s);for(const s of this.movedElementsY)r.add(s);for(const s of this.implicitlyMovedElementsX)o.add(s);for(const s of this.implicitlyMovedElementsY)r.add(s);for(;o.size>0||r.size>0;){const s=new Set,a=new Set;for(const u of o){if(t.has(u))continue;t.add(u),e.add(u.id);const f=this.dependsOnX.get(u);if(f!=null){for(const d of f.x)s.add(d);for(const d of f.y)a.add(d)}}for(const u of r){if(i.has(u))continue;i.add(u),e.add(u.id);const f=this.dependsOnY.get(u);if(f!=null){for(const d of f.x)s.add(d);for(const d of f.y)a.add(d)}}o=s,r=a}return e}constructor(e,t){this.selected=e,this.index=t,this.actualSelected=new Set,this.movedElementsX=new Set,this.movedElementsY=new Set,this.implicitlyMovedElementsX=new Set,this.implicitlyMovedElementsY=new Set,this.hasConflict=!1,this.isMovedXLookup=new Map,this.isMovedYLookup=new Map,this.dependedOnX=new Map,this.dependedOnY=new Map,this.dependsOnX=new Map,this.dependsOnY=new Map;for(const i of e)if(i instanceof Bn||i instanceof Ft)this.actualSelected.add(i);else if(i instanceof yo){const o=this.index.getById(i.posId);this.actualSelected.add(o)}this.registerDependencies()}initialize(e,t){this.isMovedXLookup.clear(),this.isMovedYLookup.clear(),this.movedElementsX.clear(),this.movedElementsY.clear(),this.implicitlyMovedElementsX.clear(),this.implicitlyMovedElementsY.clear(),this.hasConflict=!1,this.validateConsistency(e,t),!this.hasConflict&&(this.registerElements(this.actualSelected,e,t),this.fixPartiallyMovedElements(),this.pruneMovedElements())}validateConsistency(e,t){if(e&&t)return;const i=new Set;for(const s of this.actualSelected)i.add((s.parent.globalRotation%360+360)%180);if(i.size>2){this.hasConflict=!0;return}if(i.size<2)return;const[o,r]=Array.from(i);if(Math.abs(o-r)%180!==90){this.hasConflict=!0;return}}registerElements(e,t,i){let o=new Set,r=new Set;for(const s of e){const a=(s.parent.globalRotation%360+360)%180<90;t&&(a?o.add(s):r.add(s)),i&&(a?r.add(s):o.add(s))}for(;o.size>0||r.size>0;){const s=new Set,a=new Set;for(const u of o){let f;if(u instanceof gn?f=this.index.getById(u.segments.at(-1).end):(this.movedElementsX.add(u),u instanceof Bn?u.pos!=null&&(f=this.index.getById(u.pos)):u instanceof Zc&&(Be.MOVE_X in u.edits||(f=this.index.getById(u.targetX)))),f!=null){const d=this.getRotationDelta(u.parent,f.parent);d%180!==90&&s.add(f),d%180!==0&&a.add(f)}}for(const u of r){let f;if(u instanceof gn?f=this.index.getById(u.segments.at(-1).end):(this.movedElementsY.add(u),u instanceof Bn?u.pos!=null&&(f=this.index.getById(u.pos)):u instanceof Zc&&(Be.MOVE_Y in u.edits||(f=this.index.getById(u.targetY)))),f!=null){const d=this.getRotationDelta(u.parent,f.parent);d%180!==90&&a.add(f),d%180!==0&&s.add(f)}}o=s,r=a}}getRotationDelta(e,t){return((e.globalRotation-t.globalRotation)%360+360)%360}registerDependencies(){const e=new Set;for(const t of this.index.all())t instanceof Fa&&e.add(t);for(const t of e){const i=[],o=[];if(t instanceof gn){const r=this.index.getById(t.segments.at(-1).end);i.push(r),o.push(r)}else if(t instanceof Bn)if(t.pos==null){const r=this.getCanvasDependencies(t.parent);i.push(...r),o.push(...r)}else{const r=this.index.getById(t.pos);i.push(r),o.push(r)}else if(t instanceof Yb){const r=this.getCanvasDependencies(t.parent);i.push(...r),o.push(...r)}else if(t instanceof Zc)i.push(this.index.getById(t.targetX)),o.push(this.index.getById(t.targetY));else if(t instanceof uu){const r=this.index.getById(t.lineProvider);if(r instanceof Bn)i.push(r),o.push(r);else if(r instanceof gn){const s=mv.calcSegmentIndex(t.pos,r.segments.length),a=this.getCanvasConnectionSegmentDependencies(r,s);i.push(...a),o.push(...a)}}for(const r of i){const s=this.getRotationDelta(t.parent,r.parent);s%180!==90&&this.addDependency(t,r,!0,!0),s%180!==0&&this.addDependency(t,r,!0,!1)}for(const r of o){const s=this.getRotationDelta(t.parent,r.parent);s%180!==90&&this.addDependency(t,r,!1,!1),s%180!==0&&this.addDependency(t,r,!1,!0)}}}addDependency(e,t,i,o){let r;i?(r=this.dependsOnX.get(e),r==null&&(r={x:new Set,y:new Set},this.dependsOnX.set(e,r))):(r=this.dependsOnY.get(e),r==null&&(r={x:new Set,y:new Set},this.dependsOnY.set(e,r))),o?r.x.add(t):r.y.add(t);let s;o?(s=this.dependedOnX.get(t),s==null&&(s={x:new Set,y:new Set},this.dependedOnX.set(t,s))):(s=this.dependedOnY.get(t),s==null&&(s={x:new Set,y:new Set},this.dependedOnY.set(t,s))),i?s.x.add(e):s.y.add(e)}getCanvasDependencies(e){const t=W.findParentByFeature(e,i=>i instanceof yo||i instanceof Bn);if(t instanceof Bn)return[t];if(t instanceof yo){const i=t.parent,o=t.pos=="start"?0:i.segments.length-1;return this.getCanvasConnectionSegmentDependencies(i,o)}else return[]}getCanvasConnectionSegmentDependencies(e,t){const i=[];t===0?i.push(e.start):i.push(e.segments[t-1].end);const o=e.segments[t];return i.push(o.end),o instanceof ff&&i.push(o.startControlPoint,o.endControlPoint),i.map(r=>this.index.getById(r))}fixPartiallyMovedElements(){let e=!0;for(;e;){e=!1;const t=new Set,i=new Set;for(const o of this.movedElementsX)this.movedElementsY.has(o)||this.isInconsitentlyMoved(o)&&t.add(o);for(const o of this.movedElementsY)this.movedElementsX.has(o)||this.isInconsitentlyMoved(o)&&i.add(o);t.size>0&&(e=!0,this.registerElements(t,!1,!0)),i.size>0&&(e=!0,this.registerElements(i,!0,!1))}}isInconsitentlyMoved(e){const t=this.dependedOnX.get(e),i=this.dependedOnY.get(e);if(t==null||i==null)return!1;let o=$y(t.x,i.x),r=$y(t.y,i.y);const s=new Set,a=new Set;for(;o.size>0||r.size>0;){const u=new Set,f=new Set;for(const d of o){if(s.has(d))continue;if(s.add(d),this.movedElementsX.has(d))return!0;const c=this.dependedOnX.get(d);if(c!=null){for(const l of c.x)u.add(l);for(const l of c.y)f.add(l)}}for(const d of r){if(a.has(d))continue;if(a.add(d),this.movedElementsY.has(d))return!0;const c=this.dependedOnY.get(d);if(c!=null){for(const l of c.x)u.add(l);for(const l of c.y)f.add(l)}}o=u,r=f}return!1}pruneMovedElements(){for(const e of this.movedElementsX)this.isElementImplicitlyMoved(this.dependsOnX.get(e))&&this.implicitlyMovedElementsX.add(e);for(const e of this.movedElementsY)this.isElementImplicitlyMoved(this.dependsOnY.get(e))&&this.implicitlyMovedElementsY.add(e);for(const e of this.implicitlyMovedElementsX)this.movedElementsX.delete(e);for(const e of this.implicitlyMovedElementsY)this.movedElementsY.delete(e)}isMovedX(e){const t=this.isMovedXLookup.get(e);if(t!=null)return t;const i=this.movedElementsX.has(e)||this.isElementImplicitlyMoved(this.dependsOnX.get(e));return this.isMovedXLookup.set(e,i),i}isMovedY(e){const t=this.isMovedYLookup.get(e);if(t!=null)return t;const i=this.movedElementsY.has(e)||this.isElementImplicitlyMoved(this.dependsOnY.get(e));return this.isMovedYLookup.set(e,i),i}isElementImplicitlyMoved(e){if(e==null)return!1;let t=!0,i=!1;for(const o of e.x)this.isMovedX(o)?i=!0:t=!1;for(const o of e.y)this.isMovedY(o)?i=!0:t=!1;return!t&&i&&(this.hasConflict=!0),t&&i}}function $y(n,e){const t=new Set;for(const i of n)e.has(i)&&t.add(i);return t}function Yy(n){return"pointVisibilityManager"in n&&"globalRotation"in n}var Eo;(function(n){n.KIND="transactionalMoveAction";function e(t){return t.kind===n.KIND}n.isMoveAction=e})(Eo||(Eo={}));var hf=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},kb=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Wd;const ky=10;let Gr=Wd=class extends Ba{mouseDown(e,t){if(t.button===0&&!(t.ctrlKey||t.altKey)&&this.isRegularInteractionTool()&&!this.isForcedScroll(t)){const i=W.findParentByFeature(e,W.isMoveable);if(i!=null&&i instanceof La){if(W.findParentByFeature(e,Yy)==null)throw new Error("Cannot move an element without a parent canvas");return[{kind:Eo.KIND,handlerProvider:()=>{var s;return(s=this.createHandler(i,t))!==null&&s!==void 0?s:new aM(k0(),void 0)},maxUpdatesPerRevision:Wd.MAX_UPDATES_PER_REVISION}]}}return[]}createHandler(e,t){const i=t.target,o=i?.classList;if(e instanceof Bn&&o!=null){if(o.contains(wi.ROTATE_ICON_CLASS))return this.createRotationHandler(e);if(o.contains(wi.RESIZE_CLASS))return this.createResizeHandler(e,o,t)}else if(e instanceof gn&&o!=null)return this.createAxisAlignedSegmentHandler(i,e,t);return this.createMoveHandler(e,t)}createAxisAlignedSegmentHandler(e,t,i){var o,r;const s=e.dataset;let a,u,f,d,c,l;const p=parseInt(s.index),h=parseInt(s.segmentIndex),g=t.segments[p],m=t.layout.segments[p];g.pos>=0?(d=h===1,h===0?f=m.originalStart.y:h===1?f=m.start.x+g.pos*(m.end.x-m.start.x):f=m.originalEnd.y):(d=h!==1,h===0?f=m.originalStart.x:h===1?f=m.end.y+g.pos*(m.end.y-m.start.y):f=m.originalEnd.x);const y=p===0&&t.startMarker!=null?Bd.markerWidth(t.startMarker):0,v=p===t.segments.length-1&&t.endMarker!=null?Bd.markerWidth(t.endMarker):0;if(d){const _=m.originalEnd.x-m.originalStart.x;a=m.originalStart.x+Math.sign(_)*y,u=m.originalEnd.x-Math.sign(_)*v,c=m.originalStart.y,l=m.originalEnd.y}else{const _=m.originalEnd.y-m.originalStart.y;a=m.originalStart.y+Math.sign(_)*y,u=m.originalEnd.y-Math.sign(_)*v,c=m.originalStart.x,l=m.originalEnd.x}return new iM(f,a,u,d,g,c,l,this.settingsProvider.settings,(r=(o=this.configManager.config)===null||o===void 0?void 0:o.snappingEnabled)!==null&&r!==void 0?r:!0,this.makeRelative(t.getMouseTransformationMatrix(),i),Ky(e.classList))}createResizeHandler(e,t,i){var o,r;const s=e.root.selectedElements.filter(l=>l instanceof Bn),a=this.computeXResizeFactor(s,t,e),u=this.computeYResizeFactor(s,t,e);if(a==null&&u==null)return;const f=Y0(s,l=>a!=null?u!=null?`${l.width}x${l.height}`:l.width:l.height),{groupedEntries:d,elements:c}=this.computeResizeElements(f,a,u);if(Wi.isConsistent(d))return new cM(e,new Set(s.map(l=>l.id)),this.settingsProvider.settings,a,u,c,(r=(o=this.configManager.config)===null||o===void 0?void 0:o.snappingEnabled)!==null&&r!==void 0?r:!0,this.makeRelative(e.getMouseTransformationMatrix(),i),Ky(t))}computeResizeElements(e,t,i){const o=[],r=[];for(const s of e.values()){const a=[];let u,f;t!=null&&(a.push(...s.map(d=>d.edits[Be.RESIZE_WIDTH])),u=s[0].width),i!=null&&(a.push(...s.map(d=>d.edits[Be.RESIZE_HEIGHT])),f=s[0].height),o.push(a),r.push({elements:s.map(d=>d.id),originalWidth:u,originalHeight:f})}return{groupedEntries:o,elements:r}}computeXResizeFactor(e,t,i){if(!e.every(r=>Be.RESIZE_WIDTH in r.edits))return;let o;if(t.contains(Rt.LEFT)?o=i.width/i.dx:t.contains(Rt.RIGHT)&&(o=i.width/(i.width+i.dx)),o!=null)return Math.abs(o)>ky&&(o=t.contains(Rt.LEFT)?-1:1),o}computeYResizeFactor(e,t,i){if(!e.every(r=>Be.RESIZE_HEIGHT in r.edits))return;let o;if(t.contains(Rt.TOP)?o=i.height/i.dy:t.contains(Rt.BOTTOM)&&(o=i.height/(i.height+i.dy)),o!=null)return Math.abs(o)>ky&&(o=t.contains(Rt.TOP)?-1:1),o}createRotationHandler(e){if(Be.ROTATE in e.edits)return new dM(e.id,e.rotation,e.getMouseTransformationMatrix())}createMoveHandler(e,t){const i=e.root.selectedElements.filter(r=>r instanceof Ft||r instanceof Bn||r instanceof yo);if(i.length===0)return;const o=this.computeMovedSelection(i,e.root);if(o!=null)return"linePoint"in o?this.createLineMoveHandler(o.linePoint,o.selector,t):this.createTranslationMoveHandler(o.entries,o.selector,t,e.root)}computeMovedSelection(e,t){const i=new _M(e,t.index),o=this.tryComputeMovedSelection(t,i,!0,!0);if(o!=null)return o;const r=this.tryComputeMovedSelection(t,i,!0,!1);if(r!=null&&"entries"in r)return r;const s=this.tryComputeMovedSelection(t,i,!1,!0);if(s!=null&&"entries"in s)return s}tryComputeMovedSelection(e,t,i,o){if(t.initialize(i,o),t.hasConflict)return;const r=new Set,s=new Set,a=new Set;for(const u of t.movedElementsX)u instanceof uu?r.add(u):s.add(u);for(const u of t.movedElementsY)u instanceof uu?r.add(u):a.add(u);if(r.size>0)return r.size>1||s.size>0||a.size>0?void 0:{linePoint:r.values().next().value,selector:t};if(!(s.size===0&&a.size===0)){for(const u of s)if(u.edits[Be.MOVE_X]==null)return;for(const u of a)if(u.edits[Be.MOVE_Y]==null)return;return{entries:this.computeTranslationMoveEntries(e,s,a),selector:t}}}createLineMoveHandler(e,t,i){var o,r,s;const a=e.edits[Be.MOVE_LPOS_POS]!=null,u=e.edits[Be.MOVE_LPOS_DIST]!=null&&!(a&&i.shiftKey),f=[];if(a&&f.push(e.edits[Be.MOVE_LPOS_POS]),u&&f.push(e.edits[Be.MOVE_LPOS_DIST]),f.length==0||!Wi.isConsistent([f]))return;const d=e.root,c=d.getMouseTransformationMatrix(),l=Le(c,{x:i.pageX,y:i.pageY}),p=d.layoutEngine.getPoint(e.id,d.id),h=Ji(p.x-l.x,p.y-l.y),g=d.layoutEngine.layoutLine(d.index.getById(e.lineProvider),d.id);return new oM(e.id,a,u,g,(o=this.settingsProvider.settings)!==null&&o!==void 0?o:{},e.segment==null?e.pos:[e.segment,e.pos],e.distance,t.selected,t.affectedElementIds,d,p,(s=(r=this.configManager.config)===null||r===void 0?void 0:r.snappingEnabled)!==null&&s!==void 0?s:!0,Xi(h,c))}createTranslationMoveHandler(e,t,i,o){var r,s;if(e.length==0)return;const a=e.map(u=>{const f=[];return u.moveX&&u.elements.forEach(d=>f.push(d.edits[Be.MOVE_X])),u.moveY&&u.elements.forEach(d=>f.push(d.edits[Be.MOVE_Y])),f});if(Wi.isConsistent(a))return new lM(e.map(u=>Object.assign(Object.assign({},u),{elements:u.elements.map(f=>f.id)})),t.selected,t.affectedElementIds,o,this.settingsProvider.settings,(s=(r=this.configManager.config)===null||r===void 0?void 0:r.snappingEnabled)!==null&&s!==void 0?s:!0,this.makeRelative(o.getMouseTransformationMatrix(),i))}computeTranslationMoveEntries(e,t,i){const o=new Set,r=new Set,s=new Set;for(const a of t)i.has(a)?o.add(a):r.add(a);for(const a of i)o.has(a)||s.add(a);return[...this.computeTranslationMoveEntriesInternal(e,o,!0,!0),...this.computeTranslationMoveEntriesInternal(e,r,!0,!1),...this.computeTranslationMoveEntriesInternal(e,s,!1,!0)]}computeTranslationMoveEntriesInternal(e,t,i,o){const r=new Map,s=new Map;for(const a of t){const u=W.findParentByFeature(a,Yy);if(!s.has(u.id)){const f=e.layoutEngine.localToAncestor(u.id,e.id),d=gl(f),{scale:c,rotation:l}=wa(d),p=`${l.angle} ${c.sx} ${c.sy}`;s.set(u.id,p),r.has(p)||r.set(p,{transformation:Xi(Su(c.sx,c.sy),lv(l.angle)),globalRotation:u.globalRotation,elements:[],moveX:i,moveY:o})}r.get(s.get(u.id)).elements.push(a)}return[...r.values()]}makeRelative(e,t){const i=Le(e,{x:t.pageX,y:t.pageY});return Xi(Ji(-i.x,-i.y),e)}};Gr.MAX_UPDATES_PER_REVISION=5;hf([Ee(le.ConfigManager),kb("design:type",Function)],Gr.prototype,"configManager",void 0);hf([Ee(le.SettingsProvider),kb("design:type",Function)],Gr.prototype,"settingsProvider",void 0);Gr=Wd=hf([Re()],Gr);const bM=new At((n,e,t)=>{n(Gr).toSelf().inSingletonScope(),n(le.MouseListener).toService(Gr)});var Ub=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},SM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let ha=class{updateConfig(e){if(this.config!=null){this.config=Object.assign(Object.assign({},this.config),e);const t={kind:av.KIND,config:this.config};this.actionDispatcher.dispatch(t)}}};Ub([Ee(le.IActionDispatcher),SM("design:type",Object)],ha.prototype,"actionDispatcher",void 0);ha=Ub([Re()],ha);var pf=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Gb=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let $o=class extends W.Command{execute(e){return this.configManager.config=this.action.config,e.root}undo(e){throw new Error("Undo is not supported")}redo(e){throw new Error("Redo is not supported")}};$o.KIND=pl.KIND;pf([Ee(le.Action),Gb("design:type",Object)],$o.prototype,"action",void 0);pf([Ee(le.ConfigManager),Gb("design:type",Function)],$o.prototype,"configManager",void 0);$o=pf([Re()],$o);const wM=new At((n,e,t)=>{n(ha).toSelf().inSingletonScope(),n(le.ConfigManager).toService(ha),W.configureCommand({bind:n,isBound:t},$o)});var qu=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},gf=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Uy=function(n,e){return function(t,i){e(t,i,n)}};let Yo=class{constructor(e=[]){this.touchListeners=e}register(e){this.touchListeners.push(e)}deregister(e){const t=this.touchListeners.indexOf(e);t>=0&&this.touchListeners.splice(t,1)}getTargetElement(e,t){let i=t.target;const o=e.index;for(;i;){if(i.id){const r=o.getById(this.domHelper.findSModelIdByDOMElement(i));if(r!==void 0)return r}i=i.parentNode}}handleEvent(e,t,i){const o=this.getTargetElement(t,i);if(!o)return;const r=this.touchListeners.map(s=>s[e](o,i)).reduce((s,a)=>s.concat(a));if(r.length>0){i.preventDefault();for(const s of r)ft.isAction(s)?this.actionDispatcher.dispatch(s):s.then(a=>{this.actionDispatcher.dispatch(a)})}}touchStart(e,t){this.handleEvent("touchStart",e,t)}touchMove(e,t){this.handleEvent("touchMove",e,t)}touchEnd(e,t){this.handleEvent("touchEnd",e,t)}decorate(e,t){return t instanceof W.SModelRootImpl&&(W.on(e,"touchstart",this.touchStart.bind(this,t)),W.on(e,"touchmove",this.touchMove.bind(this,t)),W.on(e,"touchend",this.touchEnd.bind(this,t))),e}postUpdate(){}};qu([Ee(le.IActionDispatcher),gf("design:type",Object)],Yo.prototype,"actionDispatcher",void 0);qu([Ee(le.DOMHelper),gf("design:type",Function)],Yo.prototype,"domHelper",void 0);Yo=qu([Re(),Uy(0,Jv(le.ITouchListener)),Uy(0,Zv()),gf("design:paramtypes",[Array])],Yo);let Zd=class{touchStart(e,t){return[]}touchMove(e,t){return[]}touchEnd(e,t){return[]}};Zd=qu([Re()],Zd);var Hu=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},mf=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Gy=function(n,e){return function(t,i){e(t,i,n)}};let ko=class{constructor(e=[]){this.pointerListeners=e}register(e){this.pointerListeners.push(e)}deregister(e){const t=this.pointerListeners.indexOf(e);t>=0&&this.pointerListeners.splice(t,1)}getTargetElement(e,t){let i=t.target;const o=e.index;for(;i;){if(i.id){const r=o.getById(this.domHelper.findSModelIdByDOMElement(i));if(r!==void 0)return r}i=i.parentNode}}handleEvent(e,t,i){const o=this.getTargetElement(t,i);if(!o)return;const r=this.pointerListeners.map(s=>s[e](o,i)).reduce((s,a)=>s.concat(a),[]);if(r.length>0){i.preventDefault();for(const s of r)ft.isAction(s)?this.actionDispatcher.dispatch(s):s.then(a=>{this.actionDispatcher.dispatch(a)})}}decorate(e,t){return t instanceof W.SModelRootImpl&&(W.on(e,"pointerover",this.handleEvent.bind(this,"pointerOver",t)),W.on(e,"pointerenter",this.handleEvent.bind(this,"pointerEnter",t)),W.on(e,"pointerdown",this.handleEvent.bind(this,"pointerDown",t)),W.on(e,"pointermove",this.handleEvent.bind(this,"pointerMove",t)),W.on(e,"pointerup",this.handleEvent.bind(this,"pointerUp",t)),W.on(e,"pointercancel",this.handleEvent.bind(this,"pointerCancel",t)),W.on(e,"pointerout",this.handleEvent.bind(this,"pointerOut",t)),W.on(e,"pointerleave",this.handleEvent.bind(this,"pointerLeave",t)),W.on(e,"gotpointercapture",this.handleEvent.bind(this,"gotPointerCapture",t)),W.on(e,"lostpointercapture",this.handleEvent.bind(this,"lostPointerCapture",t))),e}postUpdate(){}};Hu([Ee(le.IActionDispatcher),mf("design:type",Object)],ko.prototype,"actionDispatcher",void 0);Hu([Ee(le.DOMHelper),mf("design:type",Function)],ko.prototype,"domHelper",void 0);ko=Hu([Re(),Gy(0,Jv(le.IPointerListener)),Gy(0,Zv()),mf("design:paramtypes",[Array])],ko);let Jd=class{pointerOver(e,t){return[]}pointerEnter(e,t){return[]}pointerDown(e,t){return[]}pointerMove(e,t){return[]}pointerUp(e,t){return[]}pointerCancel(e,t){return[]}pointerOut(e,t){return[]}pointerLeave(e,t){return[]}gotPointerCapture(e,t){return[]}lostPointerCapture(e,t){return[]}};Jd=Hu([Re()],Jd);const EM=new At(n=>{n(Yo).toSelf().inSingletonScope(),n(le.IVNodePostprocessor).toService(Yo),n(ko).toSelf().inSingletonScope(),n(le.IVNodePostprocessor).toService(ko)});function Xb(n){return n instanceof Bn||n instanceof gn}class PM extends Va{constructor(e,t,i,o){super(o,"cursor-crosshair",!1),this.edit=e,this.start=t,this.settings=i}handleMove(e,t,i,o){var r;const s=W.findParentByFeature(o,Xb);let a={x:e,y:t};if(s!=null){const f=s.root,d=f.layoutEngine.layoutLine(s,f.id),c=Vo({x:e,y:t},d,{settings:(r=this.settings)!==null&&r!==void 0?r:{},hasSegment:!1},0);a=Object.assign(Object.assign({},a),{expression:s.editExpression,pos:c.pos})}return{edits:[{types:[this.edit],values:{start:this.start,end:a},elements:[o.root.id]}]}}}var Wb=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},MM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},du;(function(n){n.KIND="updateCreateConnectionHoverDataAction"})(du||(du={}));let pa=class extends W.Command{execute(e){const t=e.root;return t.createConnectionHoverData=this.action.data,e.root}undo(e){throw new Error("Undo is not supported")}redo(e){throw new Error("Redo is not supported")}};pa.KIND=du.KIND;Wb([Ee(le.Action),MM("design:type",Object)],pa.prototype,"action",void 0);pa=Wb([Re()],pa);var Ku=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},yf=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let Po=class extends Ba{mouseDown(e,t){if(this.toolTypeProvider.toolType!==xe.CONNECT||this.isForcedScroll(t))return[];const i=e.root,o=i.createConnectionHoverData;if(o==null)return[];const r=this.connectionEditProvider.connectionEdit;return r==null?[]:[this.generateStartCreateConnectionAction(i,o,r)]}generateStartCreateConnectionAction(e,t,i){let o;return"target"in t?o={x:t.x,y:t.y,expression:t.editExpression,pos:t.position}:o=t,{kind:Eo.KIND,maxUpdatesPerRevision:1,handlerProvider:()=>new PM(i,o,this.settingsProvider.settings,e.getMouseTransformationMatrix())}}mouseMove(e,t){if(this.toolTypeProvider.toolType!==xe.CONNECT&&!this.transactionStateProvider.isInCreateConnectionTransaction)return[];let i;const o=W.findParentByFeature(e,Xb),s=e.root.getPosition(t);return o==null||o.editExpression==null?i=s:i=this.generateLineProviderData(t,o,s),[{kind:du.KIND,data:i}]}generateLineProviderData(e,t,i){var o;const r=t.parent,s=t.root.layoutEngine.layoutLine(t,r.id),a=Le(r.getMouseTransformationMatrix(),{x:e.pageX,y:e.pageY}),u=Vo(a,s,{settings:(o=this.settingsProvider.settings)!==null&&o!==void 0?o:{},hasSegment:!1},0);return Object.assign(Object.assign({line:s,projectionResult:u,position:u.pos,target:t.id},i),{editExpression:t.editExpression})}};Ku([Ee(le.ConnectionEditProvider),yf("design:type",Object)],Po.prototype,"connectionEditProvider",void 0);Ku([Ee(le.TransactionStateProvider),yf("design:type",Function)],Po.prototype,"transactionStateProvider",void 0);Ku([Ee(le.SettingsProvider),yf("design:type",Function)],Po.prototype,"settingsProvider",void 0);Po=Ku([Re()],Po);var Zb=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},RM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let ga=class{decorate(e,t){return(t instanceof Bn||t instanceof gn)&&this.transactionStateProvider.isInCreateConnectionTransaction&&t.editExpression==null&&W.setAttr(e,"pointer-events","none"),e}postUpdate(){}};Zb([Ee(le.TransactionStateProvider),RM("design:type",Function)],ga.prototype,"transactionStateProvider",void 0);ga=Zb([Re()],ga);const AM=new At((n,e,t)=>{n(Po).toSelf().inSingletonScope(),n(le.MouseListener).toService(Po),n(ga).toSelf().inSingletonScope(),n(le.IVNodePostprocessor).toService(ga),W.configureCommand({bind:n,isBound:t},pa)}),OM=new At((n,e,t)=>{n(ua).toSelf().inSingletonScope(),n(le.MoveCursorProvider).toService(ua),W.configureCommand({bind:n,isBound:t},zo)});var vf=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Jb=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},ma;(function(n){n.KIND="updateKeyState"})(ma||(ma={}));let Uo=class extends W.Command{execute(e){return this.action.isShiftPressed!=null&&(this.keyState.isShiftPressed=this.action.isShiftPressed),this.action.isSpacePressed!=null&&(this.keyState.isSpacePressed=this.action.isSpacePressed),e.root}undo(e){throw new Error("Undo is not supported")}redo(e){throw new Error("Redo is not supported")}};Uo.KIND=ma.KIND;vf([Ee(le.Action),Jb("design:type",Object)],Uo.prototype,"action",void 0);vf([Ee(le.KeyState),Jb("design:type",Function)],Uo.prototype,"keyState",void 0);Uo=vf([Re()],Uo);var IM=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let lu=class extends W.KeyListener{keyDown(e,t){return fu(t,!0)}keyUp(e,t){return fu(t,!1)}};lu=IM([Re()],lu);function fu(n,e){const t=[];return n.repeat||(n.key==="Shift"?t.push({kind:ma.KIND,isShiftPressed:e}):n.key===" "&&t.push({kind:ma.KIND,isSpacePressed:e})),t}var CM=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let hu=class{constructor(){this.isShiftPressed=!1,this.isSpacePressed=!1}};hu=CM([Re()],hu);const TM=new At((n,e,t)=>{n(lu).toSelf().inSingletonScope(),n(le.KeyListener).toService(lu),n(hu).toSelf().inSingletonScope(),n(le.KeyState).toService(hu),W.configureCommand({bind:n,isBound:t},Uo)});var _f=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Qb=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let vo=class extends W.MouseListener{constructor(){super(...arguments),this.sequenceNumber=0}startMove(e,t){this.context={transactionId:this.transactionIdProvider.generateId(),handler:t.handlerProvider(e),maxUpdatesPerRevision:t.maxUpdatesPerRevision},this.sequenceNumber=0,e.sequenceNumber=0}mouseMove(e,t){const i=e.root,o=this.sequenceNumber-i.sequenceNumber;return this.context==null||o>this.context.maxUpdatesPerRevision?[]:this.generateActions(e,t,t.buttons===0)}mouseUp(e,t){return this.generateActions(e,t,!0)}mouseEnter(e,t){return t.buttons===0?this.generateActions(e,t,!0):[]}generateActions(e,t,i){if(this.context==null)return[];const o=this.context.handler.generateActions(e,t,i,this.context.transactionId,this.sequenceNumber++);return i&&(this.context=void 0),o}};_f([Ee(le.TransactionIdProvider),Qb("design:type",Function)],vo.prototype,"transactionIdProvider",void 0);_f([Ee(le.IActionDispatcher),Qb("design:type",Object)],vo.prototype,"actionDispatcher",void 0);vo=_f([Re()],vo);var bf=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},e0=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let Go=class extends W.Command{execute(e){return this.createMoveMouseListener.startMove(e.root,this.action),e.root}undo(e){throw new Error("Undo is not supported")}redo(e){throw new Error("Redo is not supported")}};Go.KIND=Eo.KIND;bf([Ee(le.Action),e0("design:type",Object)],Go.prototype,"action",void 0);bf([Ee(le.CreateAndMoveMouseListener),e0("design:type",Function)],Go.prototype,"createMoveMouseListener",void 0);Go=bf([Re()],Go);const DM=new At((n,e,t)=>{n(vo).toSelf().inSingletonScope(),n(le.MouseListener).toService(vo),n(le.CreateAndMoveMouseListener).toService(vo),W.configureCommand({bind:n,isBound:t},Go)});var xM=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let pu=class extends W.MouseListener{mouseDown(e,t){return t.altKey?this.navigateToElement(e):[]}doubleClick(e){return this.navigateToElement(e)}navigateToElement(e){return[{kind:sv.KIND,element:e.id}]}};pu=xM([Re()],pu);const jM=new At((n,e,t)=>{n(pu).toSelf().inSingletonScope(),n(le.MouseListener).toService(pu)}),Js=Symbol("boxSelectFeature");function Xy(n){return n.hasFeature(Js)}var ya;(function(n){n.KIND="setTool";function e(t){return t.kind===n.KIND}n.is=e})(ya||(ya={}));var LM=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let ra=class extends Ba{constructor(){super(...arguments),this.initialSelected=new Set}get box(){if(!(this.start==null||this.current==null||this.toolTypeProvider.toolType!==xe.BOX_SELECT))return{position:{x:Math.min(this.start.x,this.current.x),y:Math.min(this.start.y,this.current.y)},size:{width:Math.abs(this.start.x-this.current.x),height:Math.abs(this.start.y-this.current.y)}}}mouseDown(e,t){if(this.toolTypeProvider.toolType!==xe.BOX_SELECT||this.isForcedScroll(t))return[];if(this.start=e.root.getPosition(t),t.shiftKey)for(const i of e.root.index.all())W.isSelected(i)&&this.initialSelected.add(i.id);return[]}mouseMove(e,t){if(this.toolTypeProvider.toolType!==xe.BOX_SELECT||this.start==null)return[];if(t.buttons===0)return this.mouseUp();this.current=e.root.getPosition(t);const i=[],o=[],r=this.box;for(const a of e.root.index.all())W.isSelected(a)?!this.initialSelected.has(a.id)&&!(Xy(a)&&a.isIncluded(r))&&o.push(a.id):Xy(a)&&a.isIncluded(r)&&i.push(a.id);return[ft.SelectAction.create({selectedElementsIDs:i,deselectedElementsIDs:o})]}mouseUp(){return this.toolTypeProvider.toolType!==xe.BOX_SELECT||this.start==null?[]:(this.start=void 0,this.current=void 0,[{kind:ya.KIND,tool:xe.CURSOR}])}mouseEnter(e,t){return t.buttons===0?this.mouseUp():[]}};ra=LM([Re()],ra);var Sf=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},t0=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let Xo=class extends W.SelectMouseListener{mouseDown(e,t){return!Gd(this.toolTypeProvider.toolType)||this.keyState.isSpacePressed?[]:super.mouseDown(e,t)}mouseUp(e,t){return!Gd(this.toolTypeProvider.toolType)||this.keyState.isSpacePressed?[]:super.mouseUp(e,t)}};Sf([Ee(le.ToolTypeProvider),t0("design:type",Object)],Xo.prototype,"toolTypeProvider",void 0);Sf([Ee(le.KeyState),t0("design:type",Function)],Xo.prototype,"keyState",void 0);Xo=Sf([Re()],Xo);const NM=new At((n,e,t,i)=>{n(Xo).toSelf().inSingletonScope(),i(W.SelectMouseListener).toService(Xo),n(ra).toSelf().inSingletonScope(),n(le.MouseListener).toService(ra),n(le.BoxSelectProvider).toService(ra)});var FM=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let oa=class{handle(e){uv.is(e)&&(this.settings=e.settings)}};oa=FM([Re()],oa);const BM=new At((n,e,t)=>{n(oa).toSelf().inSingletonScope(),n(le.SettingsProvider).toService(oa),W.configureActionHandler({bind:n,isBound:t},uv.KIND,oa)});var VM=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let jo=class{constructor(){this.snapLinesLookup=new Map,this.commitedTransactionIds=new Set}handle(e){da.is(e)?(this.snapLinesLookup.has(e.transactionId)||this.snapLinesLookup.set(e.transactionId,[]),this.snapLinesLookup.get(e.transactionId).push(e)):Zi.isTransactionalAction(e)&&e.committed&&this.commitedTransactionIds.add(e.transactionId)}getSnapLines(e){var t;this.commitedTransactionIds.size>0&&(this.commitedTransactionIds.forEach(a=>{this.snapLinesLookup.delete(a)}),this.commitedTransactionIds.clear());const o=e.root.transactionState;if(o==null)return[];const r=this.snapLinesLookup.get(o.id);if(r==null)return[];for(;r.length>0&&r[0].sequenceNumber<o.sequenceNumber;)r.shift();const s=r[0];return s?.sequenceNumber===o.sequenceNumber?(t=s.snapLines.get(e.id))!==null&&t!==void 0?t:[]:[]}};jo=VM([Re()],jo);const zM=new At((n,e,t)=>{n(jo).toSelf().inSingletonScope(),n(le.SnapLinesStateManager).toService(jo),W.configureActionHandler({bind:n,isBound:t},da.KIND,jo),W.configureActionHandler({bind:n,isBound:t},Zi.KIND,jo)});class wf extends Va{constructor(e,t){super(e,"cursor-crosshair",!1),this.initialPoint=t}handleMove(e,t){return{edits:this.generateSplitSegmentEdits(this.hasMoved?e:this.initialPoint.x,this.hasMoved?t:this.initialPoint.y)}}}class qM extends wf{constructor(e,t,i,o,r,s){super(r,s),this.segmentId=e,this.pos=t,this.nextPos=i,this.nextSegmentEdit=o}generateSplitSegmentEdits(e,t){const i=[];return this.nextSegmentEdit!==void 0&&i.push(this.nextSegmentEdit),i.push({types:[Be.SPLIT_CANVAS_AXIS_ALIGNED_SEGMENT],values:{x:e,y:t,pos:this.pos,nextPos:this.nextPos},elements:[this.segmentId]}),i}}class HM extends wf{constructor(e,t,i,o,r,s,a){super(s,a),this.segmentId=e,this.cx1=t,this.cy1=i,this.cx2=o,this.cy2=r}generateSplitSegmentEdits(e,t){return[{types:[Be.SPLIT_CANVAS_BEZIER_SEGMENT],values:{x:e,y:t,cx1:this.cx1,cy1:this.cy1,cx2:this.cx2,cy2:this.cy2},elements:[this.segmentId]}]}}class KM extends wf{constructor(e,t,i){super(t,i),this.segmentId=e}generateSplitSegmentEdits(e,t){return[{types:[Be.SPLIT_CANVAS_LINE_SEGMENT],values:{x:e,y:t},elements:[this.segmentId]}]}}class n0 extends Na{get dependencies(){return[this.end]}generateControlViewElements(){return[]}canSplitSegment(){return Wi.isConsistent([[this.edits[Be.SPLIT_CANVAS_LINE_SEGMENT]]])}}const $M=new Set(["pos"]);class i0 extends Na{constructor(){super(...arguments),this.animatedFields=$M}get dependencies(){return[this.end]}generateControlViewElements(e,t,i){if(Be.AXIS_ALIGNED_SEGMENT_POS in this.edits){const o=t.start,r=t.end;if(this.pos>=0){const s=o.x+this.pos*(r.x-o.x);return[this.generateHorizontalControlLine(e,o.y,o.x,s,i,0),this.generateVerticalControlLine(e,s,o.y,r.y,i,1),this.generateHorizontalControlLine(e,r.y,s,r.x,i,2)]}else{const s=r.y+this.pos*(r.y-o.y);return[this.generateVerticalControlLine(e,o.x,o.y,s,i,0),this.generateHorizontalControlLine(e,s,o.x,r.x,i,1),this.generateVerticalControlLine(e,r.x,s,r.y,i,2)]}}else return[]}generateVerticalControlLine(e,t,i,o,r,s){return W.svg("line.resize",{attrs:{x1:t,y1:i,x2:t,y2:o,"data-index":r.toString(),"data-segment-index":s.toString()},class:{[`cursor-resize-${Xd(e.parent,135)}`]:!0}})}generateHorizontalControlLine(e,t,i,o,r,s){return W.svg("line.resize",{attrs:{x1:i,y1:t,x2:o,y2:t,"data-index":r.toString(),"data-segment-index":s.toString()},class:{[`cursor-resize-${Xd(e.parent,45)}`]:!0}})}canSplitSegment(){return Wi.isConsistent([[this.edits[Be.SPLIT_CANVAS_AXIS_ALIGNED_SEGMENT]]])}}var r0=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},YM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},va;(function(n){n.KIND="updateSplitConnectionPreviewData"})(va||(va={}));let _a=class extends W.Command{execute(e){const t=e.root.index.getById(this.action.connectionId);return t!=null&&t instanceof gn&&(t.splitPreviewDataProvider=this.action.previewDataProvider),e.root}undo(e){throw new Error("Undo is not supported")}redo(e){throw new Error("Redo is not supported")}};_a.KIND=va.KIND;r0([Ee(le.Action),YM("design:type",Object)],_a.prototype,"action",void 0);_a=r0([Re()],_a);var Ef=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},o0=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let Wo=class extends W.MouseListener{mouseDown(e,t){if(!this.canSplit(e,t))return[];const{projectedPoint:i,transformationMatrix:o}=this.projectOnConnection(e,t),r=jt.DEFAULT.getPoint(i.pos,void 0,0,e.line),s=e.line.line.segments[i.segment],a=e.index.getById(s.origin);if(!a.canSplitSegment())return[];const u={projectedCoordinates:r,segmentIndex:s.originSegment,projectedPoint:i,transformationMatrix:o,target:e};return[{kind:Eo.KIND,handlerProvider:()=>this.createSegmentHandler(a,u),maxUpdatesPerRevision:Gr.MAX_UPDATES_PER_REVISION}]}mouseMove(e,t){return e instanceof gn&&e.selected?[{kind:va.KIND,connectionId:e.id,previewDataProvider:()=>this.projectOnConnection(e,t).projectedPoint}]:[]}mouseOut(e){return e instanceof gn&&e.selected?[this.generateUnsetSplitPreviewDataAction(e)]:[]}canSplit(e,t){return t.shiftKey&&e instanceof gn&&!(t.ctrlKey||t.altKey)&&e.selected}projectOnConnection(e,t){var i;const r=e.parent.getMouseTransformationMatrix(),s=Le(r,{x:t.clientX,y:t.clientY});return{projectedPoint:Vo(s,e.line,{settings:(i=this.settingsProvider.settings)!==null&&i!==void 0?i:{},hasSegment:!1},0),transformationMatrix:r}}generateUnsetSplitPreviewDataAction(e){return{kind:va.KIND,connectionId:e.id,previewDataProvider:void 0}}createSegmentHandler(e,t){if(e instanceof n0)return this.createLineHandler(e,t);if(e instanceof i0)return this.createAxisAlignedHandler(e,t);if(e instanceof ff)return this.createBezierHandler(e,t);throw new Error("Unknown segment type")}createLineHandler(e,{transformationMatrix:t,projectedCoordinates:i}){return new KM(e.id,t,i)}createBezierHandler(e,{target:t,projectedPoint:i,transformationMatrix:o,projectedCoordinates:r}){const s=t.segments.indexOf(e),a=t.layout.segments[s],f=new U0(a.start,e.startControlPointPosition,e.endControlPointPosition,a.end).derivative(i.relativePos),d=fn.scaleTo(f,100);return new HM(e.id,d.x,d.y,-d.x,-d.y,o,r)}createAxisAlignedHandler(e,{projectedPoint:t,segmentIndex:i,transformationMatrix:o,projectedCoordinates:r}){const{pos:s,nextPos:a}=this.calculatePosAndNextPos(i,e,t),u=e.edits[Be.AXIS_ALIGNED_SEGMENT_POS],f=e.edits[Be.SPLIT_CANVAS_AXIS_ALIGNED_SEGMENT];let d;return u!=null&&Wi.isConsistent([[u],[f]])&&(d={types:[Be.AXIS_ALIGNED_SEGMENT_POS],values:{pos:a},elements:[e.id]}),new qM(e.id,s,a,d,o,r)}calculatePosAndNextPos(e,t,i){const o=t.pos,r=i.relativePos,s=o+1;return e==0?o>=0?{pos:1,nextPos:(o-r*o)/(1-r*o)}:{pos:0,nextPos:(s-r*s)/(1-r*s)-1}:e==1?o>=0?{pos:1,nextPos:0}:{pos:0,nextPos:-1}:o>=0?{pos:o/(o+r*(1-o)),nextPos:0}:{pos:s/(s+r*(1-s))-1,nextPos:-1}}};Ef([Ee(le.TransactionIdProvider),o0("design:type",Function)],Wo.prototype,"transactionIdProvider",void 0);Ef([Ee(le.SettingsProvider),o0("design:type",Function)],Wo.prototype,"settingsProvider",void 0);Wo=Ef([Re()],Wo);const kM=new At((n,e,t)=>{n(Wo).toSelf().inSingletonScope(),n(le.MouseListener).toService(Wo),W.configureCommand({bind:n,isBound:t},_a)});function Wy(n,e,t,i,o){const r=e===void 0?void 0:e.key;return{sel:n,data:e,children:t,text:i,elm:o,key:r}}const Zy=Array.isArray;function Td(n){return typeof n=="string"||typeof n=="number"||n instanceof String||n instanceof Number}function Pf(n,e,t){if(n.ns="http://www.w3.org/2000/svg",t!=="foreignObject"&&e!==void 0)for(let i=0;i<e.length;++i){const o=e[i];if(typeof o=="string")continue;const r=o.data;r!==void 0&&Pf(r,o.children,o.sel)}}function et(n,e,t){let i={},o,r,s;if(t!==void 0?(e!==null&&(i=e),Zy(t)?o=t:Td(t)?r=t.toString():t&&t.sel&&(o=[t])):e!=null&&(Zy(e)?o=e:Td(e)?r=e.toString():e&&e.sel?o=[e]:i=e),o!==void 0)for(s=0;s<o.length;++s)Td(o[s])&&(o[s]=Wy(void 0,void 0,void 0,o[s],void 0));return n.startsWith("svg")&&(n.length===3||n[3]==="."||n[3]==="#")&&Pf(i,o,n),Wy(n,i,o,r,void 0)}function Jc(n,e){var t;const i=(t=e.data)===null||t===void 0?void 0:t.ns;n.data.fn=e.data.fn,n.data.args=e.data.args,e.data=n.data,e.children=n.children,e.text=n.text,e.elm=n.elm,i&&Pf(e.data,e.children,e.sel)}function UM(n){const e=n.data,t=e.fn(...e.args);Jc(t,n)}function GM(n,e){let t;const i=n.data,o=e.data,r=i.args,s=o.args;if(i.fn!==o.fn||r.length!==s.length){Jc(o.fn(...s),e);return}for(t=0;t<s.length;++t)if(r[t]!==s[t]){Jc(o.fn(...s),e);return}Jc(n,e)}const s0=function(e,t,i,o){return o===void 0&&(o=i,i=t,t=void 0),et(e,{key:t,hook:{init:UM,prepatch:GM},fn:i,args:o})};function a0(n,e){if(n.showPreviewFor!=e.edit)return;const t=n.elementPreviews.get(e.edit);if(t!=null)return et("div.preview",{hook:{insert:i=>{const o=i.elm,r=o.parentElement,s=r.closest(".toolbox"),a=r.getBoundingClientRect().top-s.getBoundingClientRect().top;o.style.top=`${a}px`}}},t)}function ba(n,e=[]){return s0("svg.icon",XM,[n,e])}function XM(n,e){return et("svg.icon",{attrs:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},class:Object.fromEntries(e.map(t=>[t,!0]))},n.map(([t,i])=>et(t,{attrs:i})))}/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c0=[["path",{d:"M7 7h10v10"}],["path",{d:"M7 17 17 7"}]];/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WM=[["path",{d:"M2 11.5V5a2 2 0 0 1 2-2h3.9c.7 0 1.3.3 1.7.9l.8 1.2c.4.6 1 .9 1.7.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-9.5"}],["path",{d:"M11.378 13.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}]];/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZM=[["path",{d:"M12 10v6"}],["path",{d:"M9 13h6"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JM=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"}]];/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QM=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]];/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eR=[["path",{d:"M12.586 12.586 19 19"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z"}]];/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tR=[["path",{d:"M13 7 8.7 2.7a2.41 2.41 0 0 0-3.4 0L2.7 5.3a2.41 2.41 0 0 0 0 3.4L7 13"}],["path",{d:"m8 6 2-2"}],["path",{d:"m18 16 2-2"}],["path",{d:"m17 11 4.3 4.3c.94.94.94 2.46 0 3.4l-2.6 2.6c-.94.94-2.46.94-3.4 0L11 17"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nR=[["path",{d:"m21 21-4.34-4.34"}],["circle",{cx:"11",cy:"11",r:"8"}]];/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iR=[["path",{d:"M12.034 12.681a.498.498 0 0 1 .647-.647l9 3.5a.5.5 0 0 1-.033.943l-3.444 1.068a1 1 0 0 0-.66.66l-1.067 3.443a.5.5 0 0 1-.943.033z"}],["path",{d:"M5 3a2 2 0 0 0-2 2"}],["path",{d:"M19 3a2 2 0 0 1 2 2"}],["path",{d:"M5 21a2 2 0 0 1-2-2"}],["path",{d:"M9 3h1"}],["path",{d:"M9 21h2"}],["path",{d:"M14 3h1"}],["path",{d:"M3 9v1"}],["path",{d:"M21 9v2"}],["path",{d:"M3 14v1"}]];/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rR=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72"}],["path",{d:"m14 7 3 3"}],["path",{d:"M5 6v4"}],["path",{d:"M19 14v4"}],["path",{d:"M10 2v2"}],["path",{d:"M7 8H3"}],["path",{d:"M21 16h-4"}],["path",{d:"M11 3H9"}]];/**
 * @license lucide v0.547.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oR=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];function sR(n){const e=[dR(n)];return n.connectionSearchString!=null&&e.push(et("div.items",aR(n))),e}function aR(n){const e=n.getConnectionEdits(),t=cR(n,e),i=n.getCurrentConnection(e);return et("div.group",[...t.map(o=>uR(n,o,o.name===i))])}function cR(n,e){let t=e;if(n.searchString.length>0){t=n.getConnectionSearchIndex().search(n.searchString).map(s=>s.edit);const r=new Set(t);for(const s of e)!r.has(s)&&s.name.includes(n.searchString)&&t.push(s)}return t}function uR(n,e,t){return et("button.item",{on:{click:i=>{n.selectedConnection=e.name,n.connectionSearchString=void 0,i.stopPropagation(),n.update()},mouseenter:()=>{n.showPreview(e)},mouseleave:()=>{n.showPreviewFor=void 0},mousedown:i=>{i.preventDefault()}},class:{selected:t}},[e.name,a0(n,e)])}function dR(n){var e;const t=n.getConnectionEdits(),i=(e=n.getCurrentConnection(t))!==null&&e!==void 0?e:"",o=et("div.selectable-input",{on:{click:(r,s)=>{var a;n.connectionSearchString="",(a=s.elm.querySelector("input"))===null||a===void 0||a.focus(),n.update()},focusout:()=>{n.connectionSearchString=void 0,n.update()},mousedown:r=>{r.target instanceof HTMLInputElement||r.preventDefault()}}},[ba(c0),lR(n,i)]);return et("div.toolbox-details-header",[o])}function lR(n,e){return et("input",{attrs:{value:e},on:{input:t=>{n.connectionSearchString=t.target.value,n.update()},keydown:t=>{t.key==="Escape"&&(n.connectionSearchString=void 0,n.update())}},hook:{update:(t,i)=>{n.connectionSearchString==null&&(i.elm.value=e)}}})}class fR extends Ha{constructor(e,t,i,o,r,s){const a=new hR(t,r);super(a,s,t.getMouseTransformationMatrix(),void 0,!1),this.edit=e,this.root=t,this.editTarget=i,this.pointerId=o}generateActions(e,t,i,o,r){var s;return!this.hasMoved&&!i&&((s=t.target)===null||s===void 0||s.setPointerCapture(this.pointerId)),super.generateActions(e,t,i,o,r)}handleMove(e,t,i,o){let r,s;if(this.hasMoved){if(r={x:e,y:t},this.isSnappingEnabled(i)){const u=o.root;this.snapHandler.updateReferenceData(u);const f=Si(u),{snappedValues:d,snapLines:c}=this.snapHandler.snap(r,f);r=d,s=c}}else r={x:this.root.scroll.x+this.root.canvasBounds.width/this.root.zoom/2,y:this.root.scroll.y+this.root.canvasBounds.height/this.root.zoom/2};return r.expression=this.editTarget.editExpression,{edits:[{types:[this.edit],values:r,elements:[this.editTarget.id]}],snapLines:s}}}class hR extends za{constructor(e,t){super(ls(e,new Set([e.id]),new Set),t),this.context=e.id}snap(e,t){const i={bounds:void 0,points:[{x:0,y:0}]},o=qa(new Map([[this.context,i]]),this.referenceData,t,this.roundToTranslationPrecision(e),{snapX:!0,snapY:!0,snapGaps:!1,snapPoints:!0,snapSize:!1});la(o,this.createRoundedTranslation(o.snapOffset));const r=Ko(o,this.createRoundedTranslation(o.snapOffset));return{snappedValues:o.snapOffset,snapLines:r}}createRoundedTranslation(e){const t=this.roundToTranslationPrecision(e);return Ji(t.x,t.y)}roundToTranslationPrecision(e){return{x:bi.roundToTranslationPrecision(this.settings,e.x),y:bi.roundToTranslationPrecision(this.settings,e.y)}}}function pR(n){return n.getToolboxEdits().length===0?[]:[vR(n),et("div.items",n.searchString.length>0?mR(n,n.searchString):gR(n))]}function gR(n){var e;const t=new Map;for(const i of n.getToolboxEdits()){const o=i.group;t.has(o)||t.set(o,[]),(e=t.get(o))===null||e===void 0||e.push(i)}return[...t.entries()].sort(([i],[o])=>i.localeCompare(o)).map(([i,o])=>yR(n,i,o))}function mR(n,e){const i=n.getSearchIndex().search(e);return et("div.group",[...i.map(o=>u0(n,o))])}function yR(n,e,t){return et("div.group",[et("div.group-header",e),...t.map(i=>u0(n,i))])}function u0(n,e){return et("button.item",{on:{pointerdown:t=>{e.canMove?bR(n,e,t):SR(n,e,t)},pointerup:()=>{!e.canMove&&!n.toolState.isLocked&&n.updateTool(xe.CURSOR,!1)},mouseenter:()=>{n.showPreview(e)},mouseleave:()=>{n.showPreviewFor=void 0}}},[e.name,a0(n,e)])}function vR(n){const e=_R(n),t=ba(nR);return et("div.toolbox-details-header",[et("div.selectable-input",[t,e])])}function _R(n){return et("input",{props:{placeholder:"Search"},hook:{insert:e=>{e.elm.focus()},update:(e,t)=>{const i=t.elm;i.value=n.searchString}},on:{input:e=>{n.searchString=e.target.value,n.update()},keydown:e=>{e.key==="Escape"&&(n.searchString="",n.update())}}})}function bR(n,e,t){const i={kind:Eo.KIND,handlerProvider:o=>{var r,s;return new fR(e.edit,o,e.target,t.pointerId,n.settingsProvider.settings,(s=(r=n.configManager.config)===null||r===void 0?void 0:r.snappingEnabled)!==null&&s!==void 0?s:!0)},maxUpdatesPerRevision:1};n.toolState.isLocked||n.updateTool(xe.CURSOR,!1),n.pointerEventsDisabled=!0,n.update(),n.actionDispatcher.dispatch(i)}function SR(n,e,t){var i;const o={types:[e.edit],values:{x:0,y:0,expression:e.target.editExpression},elements:[e.target.id]},r={kind:Zi.KIND,sequenceNumber:0,committed:!0,transactionId:n.transactionIdProvider.generateId(),edits:[o]};n.toolState.isLocked||(i=t.target)===null||i===void 0||i.setPointerCapture(t.pointerId),n.actionDispatcher.dispatch(r)}const wR=[{id:xe.HAND,icon:()=>JM,title:"Hand (panning)",action:n=>Uc(n,xe.HAND)},{id:xe.CURSOR,icon:()=>eR,title:"Default (selection)",action:n=>Uc(n,xe.CURSOR)},{id:xe.ADD_ELEMENT,icon:n=>n.selectedElementMode?WM:ZM,title:"Add Element",action:n=>Jy(n,xe.ADD_ELEMENT)},{id:xe.CONNECT,icon:()=>c0,title:"Connect",action:n=>Jy(n,xe.CONNECT)},{id:xe.BOX_SELECT,icon:()=>iR,title:"Box Select",action:n=>Uc(n,xe.BOX_SELECT)},{id:xe.AUTOLAYOUT,icon:()=>rR,title:"Auto Layout",action:n=>Uc(n,xe.AUTOLAYOUT)}];function Uc(n,e){n.toolState.toolType!=e&&n.updateTool(e,!1)}function Jy(n,e){n.toolState.toolType!=e?n.updateTool(e,!1):n.updateTool(e,!n.toolState.isLocked),n.update()}function ER(n){return et("div.toolbox",{class:{"pointer-events-disabled":n.pointerEventsDisabled,closed:!n.isOpen},on:{keydown:e=>{n.actionDispatcher.dispatchAll(fu(e,!0))},keyup:e=>{n.actionDispatcher.dispatchAll(fu(e,!1))}}},[PR(n),MR(n)])}function PR(n){return et("div.toolbox-tools",{class:{"pointer-events-disabled":n.pointerEventsDisabled,closed:!n.isOpen}},et("div.wrapper",[...wR.map(e=>RR(n,e)),et("div.divider"),AR(n)]))}function MR(n){const e=n.toolState.toolType;let t;return e===xe.ADD_ELEMENT?t=pR(n):e===xe.CONNECT?t=sR(n):xe.AUTOLAYOUT,et("div.toolbox-details",t)}function RR(n,e){const t=n.toolState.toolType===e.id;return et("button.toolbox-tool-button",{on:{click:()=>e.action(n)},attrs:{title:e.title,disabled:!n.isToolEnabled(e.id)},class:{active:t}},[ba(e.icon(n)),t&&n.toolState.isLocked?ba(QM,["locked"]):void 0])}function AR(n){return et("button.toolbox-tool-button",{on:{click:()=>n.toggleToolbox()},attrs:{title:n.isOpen?"Close Toolbox":"Open Toolbox"}},ba(n.isOpen?oR:tR))}var OR=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let Zo=class{constructor(){this.toolType=xe.CURSOR,this.isLocked=!1}};Zo=OR([Re()],Zo);var Dd={exports:{}},Qy;function IR(){return Qy||(Qy=1,(function(n,e){(function(t){n.exports=t()})(function(){return(function(){function t(i,o,r){function s(f,d){if(!o[f]){if(!i[f]){var c=typeof Wa=="function"&&Wa;if(!d&&c)return c(f,!0);if(a)return a(f,!0);var l=new Error("Cannot find module '"+f+"'");throw l.code="MODULE_NOT_FOUND",l}var p=o[f]={exports:{}};i[f][0].call(p.exports,function(h){var g=i[f][1][h];return s(g||h)},p,p.exports,t,i,o,r)}return o[f].exports}for(var a=typeof Wa=="function"&&Wa,u=0;u<r.length;u++)s(r[u]);return s}return t})()({1:[function(t,i,o){const r=t("./utils"),s=(function(){const a=r.stringToArray,u=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],f=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],d=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],c=["Thousand","Million","Billion","Trillion"];function l(j,V){var F=function(ne,re,Z){var ie="";if(ne<=19)ie=(re?" and ":"")+(Z?f[ne]:u[ne]);else if(ne<100){const Ae=Math.floor(ne/10),Oe=ne%10;ie=(re?" and ":"")+d[Ae-2],Oe>0?ie+="-"+F(Oe,!1,Z):Z&&(ie=ie.substring(0,ie.length-1)+"ieth")}else if(ne<1e3){const Ae=Math.floor(ne/100),Oe=ne%100;ie=(re?", ":"")+u[Ae]+" Hundred",Oe>0?ie+=F(Oe,!0,Z):Z&&(ie+="th")}else{var he=Math.floor(Math.log10(ne)/3);he>c.length&&(he=c.length);const Ae=Math.pow(10,he*3),Oe=Math.floor(ne/Ae),ye=ne-Oe*Ae;ie=(re?", ":"")+F(Oe,!1,!1)+" "+c[he-1],ye>0?ie+=F(ye,!0,Z):Z&&(ie+="th")}return ie},X=F(j,!1,V);return X}const p={};u.forEach(function(j,V){p[j.toLowerCase()]=V}),f.forEach(function(j,V){p[j.toLowerCase()]=V}),d.forEach(function(j,V){const F=j.toLowerCase();p[F]=(V+2)*10,p[F.substring(0,j.length-1)+"ieth"]=p[F]}),p.hundredth=100,c.forEach(function(j,V){const F=j.toLowerCase(),X=Math.pow(10,(V+1)*3);p[F]=X,p[F+"th"]=X});function h(j){const F=j.split(/,\s|\sand\s|[\s\\-]/).map(re=>p[re]);let X=[0];return F.forEach(re=>{if(re<100){let Z=X.pop();Z>=1e3&&(X.push(Z),Z=0),X.push(Z+re)}else X.push(X.pop()*re)}),X.reduce((re,Z)=>re+Z,0)}const g=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],m={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function y(j){for(var V=0;V<g.length;V++){const F=g[V];if(j>=F[0])return F[1]+y(j-F[0])}return""}function b(j){for(var V=0,F=1,X=j.length-1;X>=0;X--){const ne=j[X],re=m[ne];re<F?V-=re:(F=re,V+=re)}return V}function v(j,V){for(var F=[],X=V.charCodeAt(0);j>0;)F.unshift(String.fromCharCode((j-1)%26+X)),j=Math.floor((j-1)/26);return F.join("")}function _(j,V){for(var F=V.charCodeAt(0),X=0,ne=0;ne<j.length;ne++)X+=(j.charCodeAt(j.length-ne-1)-F+1)*Math.pow(26,ne);return X}function S(j,V){if(typeof j>"u")return;j=Math.floor(j);const F=M(V);return R(j,F)}const E={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},O={UPPER:"upper",LOWER:"lower",TITLE:"title"};function R(j,V){let F;const X=j<0;switch(j=Math.abs(j),V.primary){case E.LETTERS:F=v(j,V.case===O.UPPER?"A":"a");break;case E.ROMAN:F=y(j),V.case===O.UPPER&&(F=F.toUpperCase());break;case E.WORDS:F=l(j,V.ordinal),V.case===O.UPPER?F=F.toUpperCase():V.case===O.LOWER&&(F=F.toLowerCase());break;case E.DECIMAL:F=""+j;var ne=V.mandatoryDigits-F.length;if(ne>0){var re=new Array(ne+1).join("0");F=re+F}if(V.zeroCode!==48&&(F=a(F).map(Ae=>String.fromCodePoint(Ae.codePointAt(0)+V.zeroCode-48)).join("")),V.regular){const Ae=Math.floor((F.length-1)/V.groupingSeparators.position);for(let Oe=Ae;Oe>0;Oe--){const ye=F.length-Oe*V.groupingSeparators.position;F=F.substr(0,ye)+V.groupingSeparators.character+F.substr(ye)}}else V.groupingSeparators.reverse().forEach(Ae=>{const Oe=F.length-Ae.position;F=F.substr(0,Oe)+Ae.character+F.substr(Oe)});if(V.ordinal){var Z={1:"st",2:"nd",3:"rd"},ie=F[F.length-1],he=Z[ie];(!he||F.length>1&&F[F.length-2]==="1")&&(he="th"),F=F+he}break;case E.SEQUENCE:throw{code:"D3130",value:V.token}}return X&&(F="-"+F),F}const w=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function M(j){const V={type:"integer",primary:E.DECIMAL,case:O.LOWER,ordinal:!1};let F,X;const ne=j.lastIndexOf(";");switch(ne===-1?F=j:(F=j.substring(0,ne),X=j.substring(ne+1),X[0]==="o"&&(V.ordinal=!0)),F){case"A":V.case=O.UPPER;case"a":V.primary=E.LETTERS;break;case"I":V.case=O.UPPER;case"i":V.primary=E.ROMAN;break;case"W":V.case=O.UPPER,V.primary=E.WORDS;break;case"Ww":V.case=O.TITLE,V.primary=E.WORDS;break;case"w":V.primary=E.WORDS;break;default:{let re=null,Z=0,ie=0,he=[],Ae=0;if(a(F).map(ye=>ye.codePointAt(0)).reverse().forEach(ye=>{let Se=!1;for(let Ie=0;Ie<w.length;Ie++){const pe=w[Ie];if(ye>=pe&&ye<=pe+9){if(Se=!0,Z++,Ae++,re===null)re=pe;else if(pe!==re)throw{code:"D3131"};break}}Se||(ye===35?(Ae++,ie++):he.push({position:Ae,character:String.fromCodePoint(ye)}))}),Z>0){V.primary=E.DECIMAL,V.zeroCode=re,V.mandatoryDigits=Z,V.optionalDigits=ie;const Se=function(Ie){if(Ie.length===0)return 0;const pe=Ie[0].character;for(let mt=1;mt<Ie.length;mt++)if(Ie[mt].character!==pe)return 0;const Xe=Ie.map(mt=>mt.position),mn=function(mt,ut){return ut===0?mt:mn(ut,mt%ut)},Lt=Xe.reduce(mn);for(let mt=1;mt<=Xe.length;mt++)if(Xe.indexOf(mt*Lt)===-1)return 0;return Lt}(he);Se>0?(V.regular=!0,V.groupingSeparators={position:Se,character:he[0].character}):(V.regular=!1,V.groupingSeparators=he)}else V.primary=E.SEQUENCE,V.token=F}}return V}const I={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function D(j){var V=[];const F={type:"datetime",parts:V},X=function(Se,Ie){if(Ie>Se){let pe=j.substring(Se,Ie);pe=pe.split("]]").join("]"),V.push({type:"literal",value:pe})}};for(var ne=0,re=0;re<j.length;){if(j.charAt(re)==="["){if(j.charAt(re+1)==="["){X(ne,re),V.push({type:"literal",value:"["}),re+=2,ne=re;continue}if(X(ne,re),ne=re,re=j.indexOf("]",ne),re===-1)throw{code:"D3135"};let Se=j.substring(ne+1,re);Se=Se.split(/\s+/).join("");var Z={type:"marker",component:Se.charAt(0)},ie=Se.lastIndexOf(","),he;if(ie!==-1){const Ie=Se.substring(ie+1),pe=Ie.indexOf("-");let Xe,mn;const Lt=function(ut){if(!(typeof ut>"u"||ut==="*"))return parseInt(ut)};pe===-1?Xe=Ie:(Xe=Ie.substring(0,pe),mn=Ie.substring(pe+1));const mt={min:Lt(Xe),max:Lt(mn)};Z.width=mt,he=Se.substring(1,ie)}else he=Se.substring(1);if(he.length===1)Z.presentation1=he;else if(he.length>1){var Ae=he.charAt(he.length-1);"atco".indexOf(Ae)!==-1?(Z.presentation2=Ae,Ae==="o"&&(Z.ordinal=!0),Z.presentation1=he.substring(0,he.length-1)):Z.presentation1=he}else Z.presentation1=I[Z.component];if(typeof Z.presentation1>"u")throw{code:"D3132",value:Z.component};if(Z.presentation1[0]==="n")Z.names=O.LOWER;else if(Z.presentation1[0]==="N")Z.presentation1[1]==="n"?Z.names=O.TITLE:Z.names=O.UPPER;else if("YMDdFWwXxHhmsf".indexOf(Z.component)!==-1){var Oe=Z.presentation1;if(Z.presentation2&&(Oe+=";"+Z.presentation2),Z.integerFormat=M(Oe),Z.width&&Z.width.min!==void 0&&Z.integerFormat.mandatoryDigits<Z.width.min&&(Z.integerFormat.mandatoryDigits=Z.width.min),Z.component==="Y")if(Z.n=-1,Z.width&&Z.width.max!==void 0)Z.n=Z.width.max,Z.integerFormat.mandatoryDigits=Z.n;else{var ye=Z.integerFormat.mandatoryDigits+Z.integerFormat.optionalDigits;ye>=2&&(Z.n=ye)}const Ie=V[V.length-1];Ie&&Ie.integerFormat&&(Ie.integerFormat.parseWidth=Ie.integerFormat.mandatoryDigits)}(Z.component==="Z"||Z.component==="z")&&(Z.integerFormat=M(Z.presentation1)),V.push(Z),ne=re+1}re++}return X(ne,re),F}const C=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],z=["January","February","March","April","May","June","July","August","September","October","November","December"],G=1e3*60*60*24,N=function(j){const V=Date.UTC(j.year,j.month);var F=new Date(V).getUTCDay();return F===0&&(F=7),F>4?V+(8-F)*G:V-(F-1)*G},U=function(j,V){return{year:j,month:V,nextMonth:function(){return V===11?U(j+1,0):U(j,V+1)},previousMonth:function(){return V===0?U(j-1,11):U(j,V-1)},nextYear:function(){return U(j+1,V)},previousYear:function(){return U(j-1,V)}}},Q=function(j,V){return(V-j)/(G*7)+1},J=(j,V)=>{let F;switch(V){case"Y":F=j.getUTCFullYear();break;case"M":F=j.getUTCMonth()+1;break;case"D":F=j.getUTCDate();break;case"d":{const X=Date.UTC(j.getUTCFullYear(),j.getUTCMonth(),j.getUTCDate()),ne=Date.UTC(j.getUTCFullYear(),0);F=(X-ne)/G+1;break}case"F":F=j.getUTCDay(),F===0&&(F=7);break;case"W":{const X=U(j.getUTCFullYear(),0),ne=N(X),re=Date.UTC(X.year,j.getUTCMonth(),j.getUTCDate());let Z=Q(ne,re);if(Z>52){const ie=N(X.nextYear());re>=ie&&(Z=1)}else if(Z<1){const ie=N(X.previousYear());Z=Q(ie,re)}F=Math.floor(Z);break}case"w":{const X=U(j.getUTCFullYear(),j.getUTCMonth()),ne=N(X),re=Date.UTC(X.year,X.month,j.getUTCDate());let Z=Q(ne,re);if(Z>4){const ie=N(X.nextMonth());re>=ie&&(Z=1)}else if(Z<1){const ie=N(X.previousMonth());Z=Q(ie,re)}F=Math.floor(Z);break}case"X":{const X=U(j.getUTCFullYear(),0),ne=N(X),re=N(X.nextYear()),Z=j.getTime();Z<ne?F=X.year-1:Z>=re?F=X.year+1:F=X.year;break}case"x":{const X=U(j.getUTCFullYear(),j.getUTCMonth()),ne=N(X),re=X.nextMonth(),Z=N(re),ie=j.getTime();ie<ne?F=X.previousMonth().month+1:ie>=Z?F=re.month+1:F=X.month+1;break}case"H":F=j.getUTCHours();break;case"h":F=j.getUTCHours(),F=F%12,F===0&&(F=12);break;case"P":F=j.getUTCHours()>=12?"pm":"am";break;case"m":F=j.getUTCMinutes();break;case"s":F=j.getUTCSeconds();break;case"f":F=j.getUTCMilliseconds();break;case"Z":case"z":break;case"C":F="ISO";break;case"E":F="ISO";break}return F};let ce=null;function we(j,V,F){var X=0,ne=0;if(typeof F<"u"){const Oe=parseInt(F);X=Math.floor(Oe/100),ne=Oe%100}var re=function(Oe,ye){var Se=J(Oe,ye.component);if("YMDdFWwXxHhms".indexOf(ye.component)!==-1)if(ye.component==="Y"&&ye.n!==-1&&(Se=Se%Math.pow(10,ye.n)),ye.names){if(ye.component==="M"||ye.component==="x")Se=z[Se-1];else if(ye.component==="F")Se=C[Se];else throw{code:"D3133",value:ye.component};ye.names===O.UPPER?Se=Se.toUpperCase():ye.names===O.LOWER&&(Se=Se.toLowerCase()),ye.width&&Se.length>ye.width.max&&(Se=Se.substring(0,ye.width.max))}else Se=R(Se,ye.integerFormat);else if(ye.component==="f")Se=R(Se,ye.integerFormat);else if(ye.component==="Z"||ye.component==="z"){const Ie=X*100+ne;if(ye.integerFormat.regular)Se=R(Ie,ye.integerFormat);else{const pe=ye.integerFormat.mandatoryDigits;if(pe===1||pe===2)Se=R(X,ye.integerFormat),ne!==0&&(Se+=":"+S(ne,"00"));else if(pe===3||pe===4)Se=R(Ie,ye.integerFormat);else throw{code:"D3134",value:pe}}Ie>=0&&(Se="+"+Se),ye.component==="z"&&(Se="GMT"+Se),Ie===0&&ye.presentation2==="t"&&(Se="Z")}else ye.component==="P"&&ye.names===O.UPPER&&(Se=Se.toUpperCase());return Se};let Z;typeof V>"u"?(ce===null&&(ce=D("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),Z=ce):Z=D(V);const ie=(60*X+ne)*60*1e3,he=new Date(j+ie);let Ae="";return Z.parts.forEach(function(Oe){Oe.type==="literal"?Ae+=Oe.value:Ae+=re(he,Oe)}),Ae}function K(j){var V={};if(j.type==="datetime")V.type="datetime",V.parts=j.parts.map(function(F){var X={};if(F.type==="literal")X.regex=F.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(F.component==="Z"||F.component==="z"){let re;Array.isArray(F.integerFormat.groupingSeparators)||(re=F.integerFormat.groupingSeparators),X.regex="",F.component==="z"&&(X.regex="GMT"),X.regex+="[-+][0-9]+",re&&(X.regex+=re.character+"[0-9]+"),X.parse=function(Z){F.component==="z"&&(Z=Z.substring(3));let ie=0,he=0;return re?(ie=Number.parseInt(Z.substring(0,Z.indexOf(re.character))),he=Number.parseInt(Z.substring(Z.indexOf(re.character)+1))):Z.length-1<=2?ie=Number.parseInt(Z):(ie=Number.parseInt(Z.substring(0,3)),he=Number.parseInt(Z.substring(3))),ie*60+he}}else if(F.integerFormat)X=K(F.integerFormat);else{X.regex="[a-zA-Z]+";var ne={};if(F.component==="M"||F.component==="x")z.forEach(function(re,Z){F.width&&F.width.max?ne[re.substring(0,F.width.max)]=Z+1:ne[re]=Z+1});else if(F.component==="F")C.forEach(function(re,Z){Z>0&&(F.width&&F.width.max?ne[re.substring(0,F.width.max)]=Z:ne[re]=Z)});else if(F.component==="P")ne={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:F.component};X.parse=function(re){return ne[re]}}return X.component=F.component,X});else{V.type="integer";const F=j.case===O.UPPER;switch(j.primary){case E.LETTERS:V.regex=F?"[A-Z]+":"[a-z]+",V.parse=function(X){return _(X,F?"A":"a")};break;case E.ROMAN:V.regex=F?"[MDCLXVI]+":"[mdclxvi]+",V.parse=function(X){return b(F?X:X.toUpperCase())};break;case E.WORDS:V.regex="(?:"+Object.keys(p).concat("and","[\\-, ]").join("|")+")+",V.parse=function(X){return h(X.toLowerCase())};break;case E.DECIMAL:V.regex="[0-9]",j.parseWidth?V.regex+=`{${j.parseWidth}}`:V.regex+="+",j.ordinal&&(V.regex+="(?:th|st|nd|rd)"),V.parse=function(X){let ne=X;return j.ordinal&&(ne=X.substring(0,X.length-2)),j.regular?ne=ne.split(",").join(""):j.groupingSeparators.forEach(re=>{ne=ne.split(re.character).join("")}),j.zeroCode!==48&&(ne=ne.split("").map(re=>String.fromCodePoint(re.codePointAt(0)-j.zeroCode+48)).join("")),parseInt(ne)};break;case E.SEQUENCE:throw{code:"D3130",value:j.token}}}return V}function q(j,V){if(typeof j>"u")return;const F=M(V);return K(F).parse(j)}function ae(j,V){const F=D(V),X=K(F),ne="^"+X.parts.map(he=>"("+he.regex+")").join("")+"$";var Z=new RegExp(ne,"i").exec(j);if(Z!==null){const pe={};for(let Te=1;Te<Z.length;Te++){const T=X.parts[Te-1];T.parse&&(pe[T.component]=T.parse(Z[Te]))}if(Object.getOwnPropertyNames(pe).length===0)return;let Xe=0;const mn=Te=>{Xe<<=1,Xe+=Te?1:0},Lt=Te=>!(~Te&Xe)&&!!(Te&Xe);"YXMxWwdD".split("").forEach(Te=>mn(pe[Te]));const ut=!Lt(161)&&Lt(130),ii=Lt(84),Pi=!ii&&Lt(72);Xe=0,"PHhmsf".split("").forEach(Te=>mn(pe[Te]));const qn=!Lt(23)&&Lt(47),oe=(ut?"YD":ii?"XxwF":Pi?"XWF":"YMD")+(qn?"Phmsf":"Hmsf"),ue=this.environment.timestamp;let Me=!1,ze=!1;if(oe.split("").forEach(Te=>{if(typeof pe[Te]>"u")Me?(pe[Te]="MDd".indexOf(Te)!==-1?1:0,ze=!0):pe[Te]=J(ue,Te);else if(Me=!0,ze)throw{code:"D3136"}}),pe.M>0?pe.M-=1:pe.M=0,ut){const Te=Date.UTC(pe.Y,0),T=(pe.d-1)*1e3*60*60*24,B=new Date(Te+T);pe.M=B.getUTCMonth(),pe.D=B.getUTCDate()}if(ii)throw{code:"D3136"};if(Pi)throw{code:"D3136"};qn&&(pe.H=pe.h===12?0:pe.h,pe.P===1&&(pe.H+=12));var ie=Date.UTC(pe.Y,pe.M,pe.D,pe.H,pe.m,pe.s,pe.f);return(pe.Z||pe.z)&&(ie-=(pe.Z||pe.z)*60*1e3),ie}}var me=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function ve(j,V){if(!(typeof j>"u"))if(typeof V>"u"){if(!me.test(j))throw{stack:new Error().stack,code:"D3110",value:j};return Date.parse(j)}else return ae.call(this,j,V)}function L(j,V,F){if(!(typeof j>"u"))return we.call(this,j,V,F)}return{formatInteger:S,parseInteger:q,fromMillis:L,toMillis:ve}})();i.exports=s},{"./utils":6}],2:[function(t,i,o){(function(r){(function(){var s=t("./utils");const a=(()=>{var u=s.isNumeric,f=s.isArrayOfStrings,d=s.isArrayOfNumbers,c=s.createSequence,l=s.isSequence,p=s.isFunction,h=s.isLambda,g=s.isPromise,m=s.getFunctionArity,y=s.isDeepEqual,b=s.stringToArray;function v(P){if(!(typeof P>"u")){var A=0;return P.forEach(function(x){A+=x}),A}}function _(P){return typeof P>"u"?0:P.length}function S(P){if(!(typeof P>"u"||P.length===0))return Math.max.apply(Math,P)}function E(P){if(!(typeof P>"u"||P.length===0))return Math.min.apply(Math,P)}function O(P){if(!(typeof P>"u"||P.length===0)){var A=0;return P.forEach(function(x){A+=x}),A/P.length}}function R(P,A=!1){if(!(typeof P>"u")){var x;if(typeof P=="string")x=P;else if(p(P))x="";else{if(typeof P=="number"&&!isFinite(P))throw{code:"D3001",value:P,stack:new Error().stack};var k=A?2:0;Array.isArray(P)&&P.outerWrapper&&(P=P[0]),x=JSON.stringify(P,function(Y,ee){return typeof ee<"u"&&ee!==null&&ee.toPrecision&&u(ee)?Number(ee.toPrecision(15)):ee&&p(ee)?"":ee},k)}return x}}function w(P,A,x){if(!(typeof P>"u")){var k=b(P),Y=k.length;if(Y+A<0&&(A=0),typeof x<"u"){if(x<=0)return"";var ee=A>=0?A+x:Y+A+x;return k.slice(A,ee).join("")}return k.slice(A).join("")}}function M(P,A){if(!(typeof P>"u")){var x=P.indexOf(A);return x>-1?P.substr(0,x):P}}function I(P,A){if(!(typeof P>"u")){var x=P.indexOf(A);return x>-1?P.substr(x+A.length):P}}function D(P){if(!(typeof P>"u"))return P.toLowerCase()}function C(P){if(!(typeof P>"u"))return P.toUpperCase()}function z(P){if(!(typeof P>"u"))return b(P).length}function G(P){if(!(typeof P>"u")){var A=P.replace(/[ \t\n\r]+/gm," ");return A.charAt(0)===" "&&(A=A.substring(1)),A.charAt(A.length-1)===" "&&(A=A.substring(0,A.length-1)),A}}function N(P,A,x){if(!(typeof P>"u")){(typeof x>"u"||x.length===0)&&(x=" ");var k;A=Math.trunc(A);var Y=Math.abs(A)-z(P);if(Y>0){var ee=new Array(Y+1).join(x);x.length>1&&(ee=w(ee,0,Y)),A>0?k=P+ee:k=ee+P}else k=P;return k}}async function U(P,A){var x=P.apply(this,[A]);if(g(x)&&(x=await x),x&&!(typeof x.start=="number"||x.end==="number"||Array.isArray(x.groups)||p(x.next)))throw{code:"T1010",stack:new Error().stack};return x}async function Q(P,A){if(!(typeof P>"u")){var x;if(typeof A=="string")x=P.indexOf(A)!==-1;else{var k=await U(A,P);x=typeof k<"u"}return x}}async function J(P,A,x){if(!(typeof P>"u")){if(x<0)throw{stack:new Error().stack,value:x,code:"D3040",index:3};var k=c();if(typeof x>"u"||x>0){var Y=0,ee=await U(A,P);if(typeof ee<"u")for(;typeof ee<"u"&&(typeof x>"u"||Y<x);)k.push({match:ee.match,index:ee.start,groups:ee.groups}),ee=await U(ee.next),Y++}return k}}async function ce(P,A,x,k){if(!(typeof P>"u")){var Y=this;if(A==="")throw{code:"D3010",stack:new Error().stack,value:A,index:2};if(k<0)throw{code:"D3011",stack:new Error().stack,value:k,index:4};var ee;typeof x=="string"?ee=function($e){for(var Nt="",Ve=0,dt=x.indexOf("$",Ve);dt!==-1&&Ve<x.length;){Nt+=x.substring(Ve,dt),Ve=dt+1;var Hn=x.charAt(Ve);if(Hn==="$")Nt+="$",Ve++;else if(Hn==="0")Nt+=$e.match,Ve++;else{var Vt;if($e.groups.length===0?Vt=1:Vt=Math.floor(Math.log($e.groups.length)*Math.LOG10E)+1,dt=parseInt(x.substring(Ve,Ve+Vt),10),Vt>1&&dt>$e.groups.length&&(dt=parseInt(x.substring(Ve,Ve+Vt-1),10)),isNaN(dt))Nt+="$";else{if($e.groups.length>0){var Co=$e.groups[dt-1];typeof Co<"u"&&(Nt+=Co)}Ve+=dt.toString().length}}dt=x.indexOf("$",Ve)}return Nt+=x.substring(Ve),Nt}:ee=x;var de="",_e=0;if(typeof k>"u"||k>0){var Pe=0;if(typeof A=="string"){for(var Ye=P.indexOf(A,_e);Ye!==-1&&(typeof k>"u"||Pe<k);)de+=P.substring(_e,Ye),de+=x,_e=Ye+A.length,Pe++,Ye=P.indexOf(A,_e);de+=P.substring(_e)}else{var Ne=await U(A,P);if(typeof Ne<"u"){for(;typeof Ne<"u"&&(typeof k>"u"||Pe<k);){de+=P.substring(_e,Ne.start);var We=ee.apply(Y,[Ne]);if(g(We)&&(We=await We),typeof We=="string")de+=We;else throw{code:"D3012",stack:new Error().stack,value:We};_e=Ne.start+Ne.match.length,Pe++,Ne=await U(Ne.next)}de+=P.substring(_e)}else de=P}}else de=P;return de}}function we(P){if(!(typeof P>"u")){var A=typeof window<"u"?window.btoa:function(x){return new r.Buffer.from(x,"binary").toString("base64")};return A(P)}}function K(P){if(!(typeof P>"u")){var A=typeof window<"u"?window.atob:function(x){return new r.Buffer.from(x,"base64").toString("binary")};return A(P)}}function q(P){if(!(typeof P>"u")){var A;try{A=encodeURIComponent(P)}catch{throw{code:"D3140",stack:new Error().stack,value:P,functionName:"encodeUrlComponent"}}return A}}function ae(P){if(!(typeof P>"u")){var A;try{A=encodeURI(P)}catch{throw{code:"D3140",stack:new Error().stack,value:P,functionName:"encodeUrl"}}return A}}function me(P){if(!(typeof P>"u")){var A;try{A=decodeURIComponent(P)}catch{throw{code:"D3140",stack:new Error().stack,value:P,functionName:"decodeUrlComponent"}}return A}}function ve(P){if(!(typeof P>"u")){var A;try{A=decodeURI(P)}catch{throw{code:"D3140",stack:new Error().stack,value:P,functionName:"decodeUrl"}}return A}}async function L(P,A,x){if(!(typeof P>"u")){if(x<0)throw{code:"D3020",stack:new Error().stack,value:x,index:3};var k=[];if(typeof x>"u"||x>0)if(typeof A=="string")k=P.split(A,x);else{var Y=0,ee=await U(A,P);if(typeof ee<"u"){for(var de=0;typeof ee<"u"&&(typeof x>"u"||Y<x);)k.push(P.substring(de,ee.start)),de=ee.end,ee=await U(ee.next),Y++;(typeof x>"u"||Y<x)&&k.push(P.substring(de))}else k.push(P)}return k}}function j(P,A){if(!(typeof P>"u"))return typeof A>"u"&&(A=""),P.join(A)}function V(P,A,x){if(!(typeof P>"u")){var k={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"‰","zero-digit":"0",digit:"#","pattern-separator":";"},Y=k;typeof x<"u"&&Object.keys(x).forEach(function(De){Y[De]=x[De]});for(var ee=[],de=Y["zero-digit"].charCodeAt(0),_e=de;_e<de+10;_e++)ee.push(String.fromCharCode(_e));var Pe=ee.concat([Y["decimal-separator"],Y["exponent-separator"],Y["grouping-separator"],Y.digit,Y["pattern-separator"]]),Ye=A.split(Y["pattern-separator"]);if(Ye.length>2)throw{code:"D3080",stack:new Error().stack};var Ne=function(De){var rt=(function(){for(var Ot,xn=0;xn<De.length;xn++)if(Ot=De.charAt(xn),Pe.indexOf(Ot)!==-1&&Ot!==Y["exponent-separator"])return De.substring(0,xn)})(),Jt=(function(){for(var Ot,xn=De.length-1;xn>=0;xn--)if(Ot=De.charAt(xn),Pe.indexOf(Ot)!==-1&&Ot!==Y["exponent-separator"])return De.substring(xn+1)})(),nt=De.substring(rt.length,De.length-Jt.length),yn,Rr,vn,io,Dn=De.indexOf(Y["exponent-separator"],rt.length);Dn===-1||Dn>De.length-Jt.length?(yn=nt,Rr=void 0):(yn=nt.substring(0,Dn),Rr=nt.substring(Dn+1));var ri=yn.indexOf(Y["decimal-separator"]);return ri===-1?(vn=yn,io=Jt):(vn=yn.substring(0,ri),io=yn.substring(ri+1)),{prefix:rt,suffix:Jt,activePart:nt,mantissaPart:yn,exponentPart:Rr,integerPart:vn,fractionalPart:io,subpicture:De}},We=function(De){var rt,Jt,nt=De.subpicture,yn=nt.indexOf(Y["decimal-separator"]);yn!==nt.lastIndexOf(Y["decimal-separator"])&&(rt="D3081"),nt.indexOf(Y.percent)!==nt.lastIndexOf(Y.percent)&&(rt="D3082"),nt.indexOf(Y["per-mille"])!==nt.lastIndexOf(Y["per-mille"])&&(rt="D3083"),nt.indexOf(Y.percent)!==-1&&nt.indexOf(Y["per-mille"])!==-1&&(rt="D3084");var Rr=!1;for(Jt=0;Jt<De.mantissaPart.length;Jt++){var vn=De.mantissaPart.charAt(Jt);if(ee.indexOf(vn)!==-1||vn===Y.digit){Rr=!0;break}}Rr||(rt="D3085");var io=De.activePart.split("").map(function(Ot){return Pe.indexOf(Ot)===-1?"p":"a"}).join("");io.indexOf("p")!==-1&&(rt="D3086"),yn!==-1?(nt.charAt(yn-1)===Y["grouping-separator"]||nt.charAt(yn+1)===Y["grouping-separator"])&&(rt="D3087"):De.integerPart.charAt(De.integerPart.length-1)===Y["grouping-separator"]&&(rt="D3088"),nt.indexOf(Y["grouping-separator"]+Y["grouping-separator"])!==-1&&(rt="D3089");var Dn=De.integerPart.indexOf(Y.digit);Dn!==-1&&De.integerPart.substring(0,Dn).split("").filter(function(Ot){return ee.indexOf(Ot)>-1}).length>0&&(rt="D3090"),Dn=De.fractionalPart.lastIndexOf(Y.digit),Dn!==-1&&De.fractionalPart.substring(Dn).split("").filter(function(Ot){return ee.indexOf(Ot)>-1}).length>0&&(rt="D3091");var ri=typeof De.exponentPart=="string";if(ri&&De.exponentPart.length>0&&(nt.indexOf(Y.percent)!==-1||nt.indexOf(Y["per-mille"])!==-1)&&(rt="D3092"),ri&&(De.exponentPart.length===0||De.exponentPart.split("").filter(function(Ot){return ee.indexOf(Ot)===-1}).length>0)&&(rt="D3093"),rt)throw{code:rt,stack:new Error().stack}},$e=function(De){var rt=function(zt,ka){for(var gs=[],ir=zt.indexOf(Y["grouping-separator"]);ir!==-1;){var Ua=(ka?zt.substring(0,ir):zt.substring(ir)).split("").filter(function(Do){return ee.indexOf(Do)!==-1||Do===Y.digit}).length;gs.push(Ua),ir=De.integerPart.indexOf(Y["grouping-separator"],ir+1)}return gs},Jt=rt(De.integerPart),nt=function(zt){if(zt.length===0)return 0;for(var ka=function(Ua,Do){return Do===0?Ua:ka(Do,Ua%Do)},gs=zt.reduce(ka),ir=1;ir<=zt.length;ir++)if(zt.indexOf(ir*gs)===-1)return 0;return gs},yn=nt(Jt),Rr=rt(De.fractionalPart,!0),vn=De.integerPart.split("").filter(function(zt){return ee.indexOf(zt)!==-1}).length,io=vn,Dn=De.fractionalPart.split(""),ri=Dn.filter(function(zt){return ee.indexOf(zt)!==-1}).length,Ot=Dn.filter(function(zt){return ee.indexOf(zt)!==-1||zt===Y.digit}).length,xn=typeof De.exponentPart=="string";vn===0&&Ot===0&&(xn?(ri=1,Ot=1):vn=1),xn&&vn===0&&De.integerPart.indexOf(Y.digit)!==-1&&(vn=1),vn===0&&ri===0&&(ri=1);var If=0;return xn&&(If=De.exponentPart.split("").filter(function(zt){return ee.indexOf(zt)!==-1}).length),{integerPartGroupingPositions:Jt,regularGrouping:yn,minimumIntegerPartSize:vn,scalingFactor:io,prefix:De.prefix,fractionalPartGroupingPositions:Rr,minimumFactionalPartSize:ri,maximumFactionalPartSize:Ot,minimumExponentSize:If,suffix:De.suffix,picture:De.subpicture}},Nt=Ye.map(Ne);Nt.forEach(We);var Ve=Nt.map($e),dt=Y["minus-sign"],Hn=Y["zero-digit"],Vt=Y["decimal-separator"],Co=Y["grouping-separator"];Ve.length===1&&(Ve.push(JSON.parse(JSON.stringify(Ve[0]))),Ve[1].prefix=dt+Ve[1].prefix);var yt;P>=0?yt=Ve[0]:yt=Ve[1];var hs;yt.picture.indexOf(Y.percent)!==-1?hs=P*100:yt.picture.indexOf(Y["per-mille"])!==-1?hs=P*1e3:hs=P;var no,To;if(yt.minimumExponentSize===0)no=hs;else{var y0=Math.pow(10,yt.scalingFactor),v0=Math.pow(10,yt.scalingFactor-1);for(no=hs,To=0;no<v0;)no*=10,To-=1;for(;no>y0;)no/=10,To+=1}var _0=ie(no,yt.maximumFactionalPartSize),Af=function(De,rt){var Jt=Math.abs(De).toFixed(rt);return Hn!=="0"&&(Jt=Jt.split("").map(function(nt){return nt>="0"&&nt<="9"?ee[nt.charCodeAt(0)-48]:nt}).join("")),Jt},je=Af(_0,yt.maximumFactionalPartSize),Zt=je.indexOf(".");for(Zt===-1?je=je+Vt:je=je.replace(".",Vt);je.charAt(0)===Hn;)je=je.substring(1);for(;je.charAt(je.length-1)===Hn;)je=je.substring(0,je.length-1);Zt=je.indexOf(Vt);var ps=yt.minimumIntegerPartSize-Zt,Of=yt.minimumFactionalPartSize-(je.length-Zt-1);if(je=(ps>0?new Array(ps+1).join(Hn):"")+je,je=je+(Of>0?new Array(Of+1).join(Hn):""),Zt=je.indexOf(Vt),yt.regularGrouping>0)for(var b0=Math.floor((Zt-1)/yt.regularGrouping),$a=1;$a<=b0;$a++)je=[je.slice(0,Zt-$a*yt.regularGrouping),Co,je.slice(Zt-$a*yt.regularGrouping)].join("");else yt.integerPartGroupingPositions.forEach(function(De){je=[je.slice(0,Zt-De),Co,je.slice(Zt-De)].join(""),Zt++});if(Zt=je.indexOf(Vt),yt.fractionalPartGroupingPositions.forEach(function(De){je=[je.slice(0,De+Zt+1),Co,je.slice(De+Zt+1)].join("")}),Zt=je.indexOf(Vt),(yt.picture.indexOf(Vt)===-1||Zt===je.length-1)&&(je=je.substring(0,je.length-1)),typeof To<"u"){var Ya=Af(To,0);ps=yt.minimumExponentSize-Ya.length,ps>0&&(Ya=new Array(ps+1).join(Hn)+Ya),je=je+Y["exponent-separator"]+(To<0?dt:"")+Ya}return je=yt.prefix+je+yt.suffix,je}}function F(P,A){if(!(typeof P>"u")){if(P=ie(P),typeof A>"u"?A=10:A=ie(A),A<2||A>36)throw{code:"D3100",stack:new Error().stack,value:A};var x=P.toString(A);return x}}function X(P){var A;if(!(typeof P>"u")){if(typeof P=="number")A=P;else if(typeof P=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(P)&&!isNaN(parseFloat(P))&&isFinite(P))A=parseFloat(P);else if(typeof P=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(P))A=Number(P);else if(P===!0)A=1;else if(P===!1)A=0;else throw{code:"D3030",value:P,stack:new Error().stack,index:1};return A}}function ne(P){var A;if(!(typeof P>"u"))return A=Math.abs(P),A}function re(P){var A;if(!(typeof P>"u"))return A=Math.floor(P),A}function Z(P){var A;if(!(typeof P>"u"))return A=Math.ceil(P),A}function ie(P,A){var x;if(!(typeof P>"u")){if(A){var k=P.toString().split("e");P=+(k[0]+"e"+(k[1]?+k[1]+A:A))}x=Math.round(P);var Y=x-P;return Math.abs(Y)===.5&&Math.abs(x%2)===1&&(x=x-1),A&&(k=x.toString().split("e"),x=+(k[0]+"e"+(k[1]?+k[1]-A:-A))),Object.is(x,-0)&&(x=0),x}}function he(P){var A;if(!(typeof P>"u")){if(P<0)throw{stack:new Error().stack,code:"D3060",index:1,value:P};return A=Math.sqrt(P),A}}function Ae(P,A){var x;if(!(typeof P>"u")){if(x=Math.pow(P,A),!isFinite(x))throw{stack:new Error().stack,code:"D3061",index:1,value:P,exp:A};return x}}function Oe(){return Math.random()}function ye(P){if(!(typeof P>"u")){var A=!1;if(Array.isArray(P)){if(P.length===1)A=ye(P[0]);else if(P.length>1){var x=P.filter(function(k){return ye(k)});A=x.length>0}}else typeof P=="string"?P.length>0&&(A=!0):u(P)?P!==0&&(A=!0):P!==null&&typeof P=="object"&&!p(P)?Object.keys(P).length>0&&(A=!0):typeof P=="boolean"&&P===!0&&(A=!0);return A}}function Se(P){if(!(typeof P>"u"))return!ye(P)}function Ie(P,A,x,k){var Y=[A],ee=m(P);return ee>=2&&Y.push(x),ee>=3&&Y.push(k),Y}async function pe(P,A){if(!(typeof P>"u")){for(var x=c(),k=0;k<P.length;k++){var Y=Ie(A,P[k],k,P),ee=await A.apply(this,Y);typeof ee<"u"&&x.push(ee)}return x}}async function Xe(P,A){if(!(typeof P>"u")){for(var x=c(),k=0;k<P.length;k++){var Y=P[k],ee=Ie(A,Y,k,P),de=await A.apply(this,ee);ye(de)&&x.push(Y)}return x}}async function mn(P,A){if(!(typeof P>"u")){for(var x=!1,k,Y=0;Y<P.length;Y++){var ee=P[Y],de=!0;if(typeof A<"u"){var _e=Ie(A,ee,Y,P),Pe=await A.apply(this,_e);de=ye(Pe)}if(de)if(!x)k=ee,x=!0;else throw{stack:new Error().stack,code:"D3138",index:Y}}if(!x)throw{stack:new Error().stack,code:"D3139"};return k}}function Lt(){for(var P=[],A=Array.prototype.slice.call(arguments),x=Math.min.apply(Math,A.map(function(ee){return Array.isArray(ee)?ee.length:0})),k=0;k<x;k++){var Y=A.map(ee=>ee[k]);P.push(Y)}return P}async function mt(P,A,x){if(!(typeof P>"u")){var k,Y=m(A);if(Y<2)throw{stack:new Error().stack,code:"D3050",index:1};var ee;for(typeof x>"u"&&P.length>0?(k=P[0],ee=1):(k=x,ee=0);ee<P.length;){var de=[k,P[ee]];Y>=3&&de.push(ee),Y>=4&&de.push(P),k=await A.apply(this,de),ee++}return k}}function ut(P){var A=c();if(Array.isArray(P)){var x={};P.forEach(function(k){var Y=ut(k);Y.forEach(function(ee){x[ee]=!0})}),A=ut(x)}else P!==null&&typeof P=="object"&&!p(P)&&Object.keys(P).forEach(k=>A.push(k));return A}function ii(P,A){var x;if(Array.isArray(P)){x=c();for(var k=0;k<P.length;k++){var Y=ii(P[k],A);typeof Y<"u"&&(Array.isArray(Y)?Y.forEach(ee=>x.push(ee)):x.push(Y))}}else P!==null&&typeof P=="object"&&!p(P)&&(x=P[A]);return x}function Pi(P,A){return typeof P>"u"?A:typeof A>"u"?P:(Array.isArray(P)||(P=c(P)),Array.isArray(A)||(A=[A]),P.concat(A))}function Io(P){return!(typeof P>"u")}function qn(P){var A=c();if(Array.isArray(P))P.forEach(function(Y){A=Pi(A,qn(Y))});else if(P!==null&&typeof P=="object"&&!h(P))for(var x in P){var k={};k[x]=P[x],A.push(k)}else A=P;return A}function $(P){if(!(typeof P>"u")){var A={};return P.forEach(function(x){for(var k in x)A[k]=x[k]}),A}}function te(P){if(!(typeof P>"u")){if(P.length<=1)return P;for(var A=P.length,x=new Array(A),k=0;k<A;k++)x[A-k-1]=P[k];return x}}async function oe(P,A){var x=c();for(var k in P){var Y=Ie(A,P[k],k,P),ee=await A.apply(this,Y);typeof ee<"u"&&x.push(ee)}return x}function ue(P){throw{code:"D3137",stack:new Error().stack,message:P||"$error() function evaluated"}}function Me(P,A){if(!P)throw{code:"D3141",stack:new Error().stack,message:A||"$assert() statement failed"}}function ze(P){if(P!==void 0)return P===null?"null":u(P)?"number":typeof P=="string"?"string":typeof P=="boolean"?"boolean":Array.isArray(P)?"array":p(P)?"function":"object"}async function Te(P,A){if(!(typeof P>"u")){if(P.length<=1)return P;var x;if(typeof A>"u"){if(!d(P)&&!f(P))throw{stack:new Error().stack,code:"D3070",index:1};x=async function(de,_e){return de>_e}}else x=A;var k=async function(de,_e){var Pe=async function(Ne,We,$e){We.length===0?Array.prototype.push.apply(Ne,$e):$e.length===0?Array.prototype.push.apply(Ne,We):await x(We[0],$e[0])?(Ne.push($e[0]),await Pe(Ne,We,$e.slice(1))):(Ne.push(We[0]),await Pe(Ne,We.slice(1),$e))},Ye=[];return await Pe(Ye,de,_e),Ye},Y=async function(de){if(!Array.isArray(de)||de.length<=1)return de;var _e=Math.floor(de.length/2),Pe=de.slice(0,_e),Ye=de.slice(_e);return Pe=await Y(Pe),Ye=await Y(Ye),await k(Pe,Ye)},ee=await Y(P);return ee}}function T(P){if(!(typeof P>"u")){if(P.length<=1)return P;for(var A=new Array(P.length),x=0;x<P.length;x++){var k=Math.floor(Math.random()*(x+1));x!==k&&(A[x]=A[k]),A[k]=P[x]}return A}}function B(P){if(!(typeof P>"u")){if(!Array.isArray(P)||P.length<=1)return P;for(var A=l(P)?c():[],x=0;x<P.length;x++){for(var k=P[x],Y=!1,ee=0;ee<A.length;ee++)if(y(k,A[ee])){Y=!0;break}Y||A.push(k)}return A}}async function H(P,A){var x={};for(var k in P){var Y=P[k],ee=Ie(A,Y,k,P),de=await A.apply(this,ee);ye(de)&&(x[k]=Y)}return Object.keys(x).length===0&&(x=void 0),x}return{sum:v,count:_,max:S,min:E,average:O,string:R,substring:w,substringBefore:M,substringAfter:I,lowercase:D,uppercase:C,length:z,trim:G,pad:N,match:J,contains:Q,replace:ce,split:L,join:j,formatNumber:V,formatBase:F,number:X,floor:re,ceil:Z,round:ie,abs:ne,sqrt:he,power:Ae,random:Oe,boolean:ye,not:Se,map:pe,zip:Lt,filter:Xe,single:mn,foldLeft:mt,sift:H,keys:ut,lookup:ii,append:Pi,exists:Io,spread:qn,merge:$,reverse:te,each:oe,error:ue,assert:Me,type:ze,sort:Te,shuffle:T,distinct:B,base64encode:we,base64decode:K,encodeUrlComponent:q,encodeUrl:ae,decodeUrlComponent:me,decodeUrl:ve}})();i.exports=a}).call(this)}).call(this,typeof tu<"u"?tu:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(t,i,o){var r=t("./datetime"),s=t("./functions"),a=t("./utils"),u=t("./parser"),f=t("./signature"),d=(function(){var c=a.isNumeric,l=a.isArrayOfStrings,p=a.isArrayOfNumbers,h=a.createSequence,g=a.isSequence,m=a.isFunction,y=a.isLambda,b=a.isIterable,v=a.isPromise,_=a.getFunctionArity,S=a.isDeepEqual,E=ue(null);async function O(T,B,H){var P,A=H.lookup(Symbol.for("jsonata.__evaluate_entry"));switch(A&&await A(T,B,H),T.type){case"path":P=await R(T,B,H);break;case"binary":P=await z(T,B,H);break;case"unary":P=await G(T,B,H);break;case"name":P=N(T,B);break;case"string":case"number":case"value":P=U(T);break;case"wildcard":P=Q(T,B);break;case"descendant":P=ce(T,B);break;case"parent":P=H.lookup(T.slot.label);break;case"condition":P=await re(T,B,H);break;case"block":P=await Z(T,B,H);break;case"bind":P=await ne(T,B,H);break;case"regex":P=ie(T);break;case"function":P=await Ie(T,B,H);break;case"variable":P=he(T,B,H);break;case"lambda":P=mn(T,B,H);break;case"partial":P=await Lt(T,B,H);break;case"apply":P=await Se(T,B,H);break;case"transform":P=Oe(T,B,H);break}if(Object.prototype.hasOwnProperty.call(T,"predicate"))for(var x=0;x<T.predicate.length;x++)P=await C(T.predicate[x].expr,P,H);T.type!=="path"&&Object.prototype.hasOwnProperty.call(T,"group")&&(P=await V(T.group,P,H));var k=H.lookup(Symbol.for("jsonata.__evaluate_exit"));return k&&await k(T,B,H,P),P&&g(P)&&!P.tupleStream&&(T.keepArray&&(P.keepSingleton=!0),P.length===0?P=void 0:P.length===1&&(P=P.keepSingleton?P:P[0])),P}async function R(T,B,H){var P;Array.isArray(B)&&T.steps[0].type!=="variable"?P=B:P=h(B);for(var A,x=!1,k=void 0,Y=0;Y<T.steps.length;Y++){var ee=T.steps[Y];if(ee.tuple&&(x=!0),Y===0&&ee.consarray?A=await O(ee,P,H):x?k=await D(ee,P,k,H):A=await M(ee,P,H,Y===T.steps.length-1),!x&&(typeof A>"u"||A.length===0))break;typeof ee.focus>"u"&&(P=A)}if(x)if(T.tuple)A=k;else for(A=h(),Y=0;Y<k.length;Y++)A.push(k[Y]["@"]);return T.keepSingletonArray&&(Array.isArray(A)&&A.cons&&!A.sequence&&(A=h(A)),A.keepSingleton=!0),T.hasOwnProperty("group")&&(A=await V(T.group,x?k:A,H)),A}function w(T,B){var H=ue(T);for(const P in B)H.bind(P,B[P]);return H}async function M(T,B,H,P){var A;if(T.type==="sort")return A=await Ae(T,B,H),T.stages&&(A=await I(T.stages,A,H)),A;A=h();for(var x=0;x<B.length;x++){var k=await O(T,B[x],H);if(T.stages)for(var Y=0;Y<T.stages.length;Y++)k=await C(T.stages[Y].expr,k,H);typeof k<"u"&&A.push(k)}var ee=h();return P&&A.length===1&&Array.isArray(A[0])&&!g(A[0])?ee=A[0]:A.forEach(function(de){!Array.isArray(de)||de.cons?ee.push(de):de.forEach(_e=>ee.push(_e))}),ee}async function I(T,B,H){for(var P=B,A=0;A<T.length;A++){var x=T[A];switch(x.type){case"filter":P=await C(x.expr,P,H);break;case"index":for(var k=0;k<P.length;k++){var Y=P[k];Y[x.value]=k}break}}return P}async function D(T,B,H,P){var A;if(T.type==="sort"){if(H)A=await Ae(T,H,P);else{var x=await Ae(T,B,P);A=h(),A.tupleStream=!0;for(var k=0;k<x.length;k++){var Y={"@":x[k]};Y[T.index]=k,A.push(Y)}}return T.stages&&(A=await I(T.stages,A,P)),A}A=h(),A.tupleStream=!0;var ee=P;H===void 0&&(H=B.map(Ye=>({"@":Ye})));for(var de=0;de<H.length;de++){ee=w(P,H[de]);var _e=await O(T,H[de]["@"],ee);if(typeof _e<"u"){Array.isArray(_e)||(_e=[_e]);for(var Pe=0;Pe<_e.length;Pe++)Y={},Object.assign(Y,H[de]),_e.tupleStream?Object.assign(Y,_e[Pe]):(T.focus?(Y[T.focus]=_e[Pe],Y["@"]=H[de]["@"]):Y["@"]=_e[Pe],T.index&&(Y[T.index]=Pe),T.ancestor&&(Y[T.ancestor.label]=H[de]["@"])),A.push(Y)}}return T.stages&&(A=await I(T.stages,A,P)),A}async function C(T,B,H){var P=h();if(B&&B.tupleStream&&(P.tupleStream=!0),Array.isArray(B)||(B=h(B)),T.type==="number"){var A=Math.floor(T.value);A<0&&(A=B.length+A);var x=await B[A];typeof x<"u"&&(Array.isArray(x)?P=x:P.push(x))}else for(A=0;A<B.length;A++){var x=B[A],k=x,Y=H;B.tupleStream&&(k=x["@"],Y=w(H,x));var ee=await O(T,k,Y);c(ee)&&(ee=[ee]),p(ee)?ee.forEach(function(_e){var Pe=Math.floor(_e);Pe<0&&(Pe=B.length+Pe),Pe===A&&P.push(x)}):s.boolean(ee)&&P.push(x)}return P}async function z(T,B,H){var P,A=await O(T.lhs,B,H),x=T.value,k=async()=>await O(T.rhs,B,H);if(x==="and"||x==="or")try{return await ve(A,k,x)}catch(ee){throw ee.position=T.position,ee.token=x,ee}var Y=await k();try{switch(x){case"+":case"-":case"*":case"/":case"%":P=K(A,Y,x);break;case"=":case"!=":P=q(A,Y,x);break;case"<":case"<=":case">":case">=":P=ae(A,Y,x);break;case"&":P=j(A,Y);break;case"..":P=X(A,Y);break;case"in":P=me(A,Y);break}}catch(ee){throw ee.position=T.position,ee.token=x,ee}return P}async function G(T,B,H){var P;switch(T.value){case"-":if(P=await O(T.expression,B,H),typeof P>"u")P=void 0;else if(c(P))P=-P;else throw{code:"D1002",stack:new Error().stack,position:T.position,token:T.value,value:P};break;case"[":P=[];let k=await Promise.all(T.expressions.map(async(Y,ee)=>(H.isParallelCall=ee>0,[Y,await O(Y,B,H)])));for(let Y of k){var[A,x]=Y;typeof x<"u"&&(A.value==="["?P.push(x):P=s.append(P,x))}T.consarray&&Object.defineProperty(P,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":P=await V(T,B,H);break}return P}function N(T,B,H){return s.lookup(B,T.value)}function U(T){return T.value}function Q(T,B){var H=h();return Array.isArray(B)&&B.outerWrapper&&B.length>0&&(B=B[0]),B!==null&&typeof B=="object"&&Object.keys(B).forEach(function(P){var A=B[P];Array.isArray(A)?(A=J(A),H=s.append(H,A)):H.push(A)}),H}function J(T,B){return typeof B>"u"&&(B=[]),Array.isArray(T)?T.forEach(function(H){J(H,B)}):B.push(T),B}function ce(T,B){var H,P=h();return typeof B<"u"&&(we(B,P),P.length===1?H=P[0]:H=P),H}function we(T,B){Array.isArray(T)||B.push(T),Array.isArray(T)?T.forEach(function(H){we(H,B)}):T!==null&&typeof T=="object"&&Object.keys(T).forEach(function(H){we(T[H],B)})}function K(T,B,H){var P;if(typeof T<"u"&&!c(T))throw{code:"T2001",stack:new Error().stack,value:T};if(typeof B<"u"&&!c(B))throw{code:"T2002",stack:new Error().stack,value:B};if(typeof T>"u"||typeof B>"u")return P;switch(H){case"+":P=T+B;break;case"-":P=T-B;break;case"*":P=T*B;break;case"/":P=T/B;break;case"%":P=T%B;break}return P}function q(T,B,H){var P,A=typeof T,x=typeof B;if(A==="undefined"||x==="undefined")return!1;switch(H){case"=":P=S(T,B);break;case"!=":P=!S(T,B);break}return P}function ae(T,B,H){var P,A=typeof T,x=typeof B,k=A==="undefined"||A==="string"||A==="number",Y=x==="undefined"||x==="string"||x==="number";if(!k||!Y)throw{code:"T2010",stack:new Error().stack,value:A==="string"||A==="number"?B:T};if(!(A==="undefined"||x==="undefined")){if(A!==x)throw{code:"T2009",stack:new Error().stack,value:T,value2:B};switch(H){case"<":P=T<B;break;case"<=":P=T<=B;break;case">":P=T>B;break;case">=":P=T>=B;break}return P}}function me(T,B){var H=!1;if(typeof T>"u"||typeof B>"u")return!1;Array.isArray(B)||(B=[B]);for(var P=0;P<B.length;P++)if(B[P]===T){H=!0;break}return H}async function ve(T,B,H){var P,A=L(T);switch(H){case"and":P=A&&L(await B());break;case"or":P=A||L(await B());break}return P}function L(T){var B=s.boolean(T);return typeof B>"u"?!1:B}function j(T,B){var H,P="",A="";return typeof T<"u"&&(P=s.string(T)),typeof B<"u"&&(A=s.string(B)),H=P.concat(A),H}async function V(T,B,H){var P={},A={},x=!!(B&&B.tupleStream);Array.isArray(B)||(B=h(B)),B.length===0&&B.push(void 0);for(var k=0;k<B.length;k++)for(var Y=B[k],ee=x?w(H,Y):H,de=0;de<T.lhs.length;de++){var _e=T.lhs[de],Pe=await O(_e[0],x?Y["@"]:Y,ee);if(typeof Pe!="string"&&Pe!==void 0)throw{code:"T1003",stack:new Error().stack,position:T.position,value:Pe};if(Pe!==void 0){var Ye={data:Y,exprIndex:de};if(A.hasOwnProperty(Pe)){if(A[Pe].exprIndex!==de)throw{code:"D1009",stack:new Error().stack,position:T.position,value:Pe};A[Pe].data=s.append(A[Pe].data,Y)}else A[Pe]=Ye}}let Ne=await Promise.all(Object.keys(A).map(async($e,Nt)=>{let Ve=A[$e];var dt=Ve.data,Hn=H;if(x){var Vt=F(Ve.data);dt=Vt["@"],delete Vt["@"],Hn=w(H,Vt)}return H.isParallelCall=Nt>0,[$e,await O(T.lhs[Ve.exprIndex][1],dt,Hn)]}));for(let $e of Ne){var[Pe,We]=await $e;typeof We<"u"&&(P[Pe]=We)}return P}function F(T){if(!Array.isArray(T))return T;var B={};Object.assign(B,T[0]);for(var H=1;H<T.length;H++)for(const P in T[H])B[P]=s.append(B[P],T[H][P]);return B}function X(T,B){var H;if(typeof T<"u"&&!Number.isInteger(T))throw{code:"T2003",stack:new Error().stack,value:T};if(typeof B<"u"&&!Number.isInteger(B))throw{code:"T2004",stack:new Error().stack,value:B};if(typeof T>"u"||typeof B>"u"||T>B)return H;var P=B-T+1;if(P>1e7)throw{code:"D2014",stack:new Error().stack,value:P};H=new Array(P);for(var A=T,x=0;A<=B;A++,x++)H[x]=A;return H.sequence=!0,H}async function ne(T,B,H){var P=await O(T.rhs,B,H);return H.bind(T.lhs.value,P),P}async function re(T,B,H){var P,A=await O(T.condition,B,H);return s.boolean(A)?P=await O(T.then,B,H):typeof T.else<"u"&&(P=await O(T.else,B,H)),P}async function Z(T,B,H){for(var P,A=ue(H),x=0;x<T.expressions.length;x++)P=await O(T.expressions[x],B,A);return P}function ie(T){var B=new Te.RegexEngine(T.value),H=function(P,A){var x;B.lastIndex=A||0;var k=B.exec(P);if(k!==null){if(x={match:k[0],start:k.index,end:k.index+k[0].length,groups:[]},k.length>1)for(var Y=1;Y<k.length;Y++)x.groups.push(k[Y]);x.next=function(){if(!(B.lastIndex>=P.length)){var ee=H(P,B.lastIndex);if(ee&&ee.match==="")throw{code:"D1004",stack:new Error().stack,position:T.position,value:T.value.source};return ee}}}return x};return H}function he(T,B,H){var P;return T.value===""?P=B&&B.outerWrapper?B[0]:B:P=H.lookup(T.value),P}async function Ae(T,B,H){var P,A=B,x=!!B.tupleStream,k=async function(ee,de){for(var _e=0,Pe=0;_e===0&&Pe<T.terms.length;Pe++){var Ye=T.terms[Pe],Ne=ee,We=H;x&&(Ne=ee["@"],We=w(H,ee));var $e=await O(Ye.expression,Ne,We);Ne=de,We=H,x&&(Ne=de["@"],We=w(H,de));var Nt=await O(Ye.expression,Ne,We),Ve=typeof $e,dt=typeof Nt;if(Ve==="undefined"){_e=dt==="undefined"?0:1;continue}if(dt==="undefined"){_e=-1;continue}if(!(Ve==="string"||Ve==="number")||!(dt==="string"||dt==="number"))throw{code:"T2008",stack:new Error().stack,position:T.position,value:Ve==="string"||Ve==="number"?Nt:$e};if(Ve!==dt)throw{code:"T2007",stack:new Error().stack,position:T.position,value:$e,value2:Nt};$e!==Nt&&($e<Nt?_e=-1:_e=1,Ye.descending===!0&&(_e=-_e))}return _e===1},Y={environment:H,input:B};return P=await s.sort.apply(Y,[A,k]),P}function Oe(T,B,H){var P=async function(A){if(!(typeof A>"u")){var x=H.lookup("clone");if(!m(x))throw{code:"T2013",stack:new Error().stack,position:T.position};var k=await pe(x,[A],null,H),Y=await O(T.pattern,k,H);if(typeof Y<"u"){Array.isArray(Y)||(Y=[Y]);for(var ee=0;ee<Y.length;ee++){var de=Y[ee];if(de&&(de.isPrototypeOf(k)||de instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:T.position};var _e=await O(T.update,de,H),Pe=typeof _e;if(Pe!=="undefined"){if(Pe!=="object"||_e===null||Array.isArray(_e))throw{code:"T2011",stack:new Error().stack,position:T.update.position,value:_e};for(var Ye in _e)de[Ye]=_e[Ye]}if(typeof T.delete<"u"){var Ne=await O(T.delete,de,H);if(typeof Ne<"u"){var We=Ne;if(Array.isArray(Ne)||(Ne=[Ne]),!l(Ne))throw{code:"T2012",stack:new Error().stack,position:T.delete.position,value:We};for(var $e=0;$e<Ne.length;$e++)typeof de=="object"&&de!==null&&delete de[Ne[$e]]}}}}return k}};return $(P,"<(oa):o>")}var ye=u("function($f, $g) { function($x){ $g($f($x)) } }");async function Se(T,B,H){var P,A=await O(T.lhs,B,H);if(T.rhs.type==="function")P=await Ie(T.rhs,B,H,{context:A});else{var x=await O(T.rhs,B,H);if(!m(x))throw{code:"T2006",stack:new Error().stack,position:T.position,value:x};if(m(A)){var k=await O(ye,null,H);P=await pe(k,[A,x],null,H)}else P=await pe(x,[A],null,H)}return P}async function Ie(T,B,H,P){var A,x=await O(T.procedure,B,H);if(typeof x>"u"&&T.procedure.type==="path"&&H.lookup(T.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:T.position,token:T.procedure.steps[0].value};var k=[];typeof P<"u"&&k.push(P.context);for(var Y=0;Y<T.arguments.length;Y++){const de=await O(T.arguments[Y],B,H);if(m(de)){const _e=async function(...Pe){return await pe(de,Pe,null,H)};_e.arity=_(de),k.push(_e)}else k.push(de)}var ee=T.procedure.type==="path"?T.procedure.steps[0].value:T.procedure.value;try{typeof x=="object"&&(x.token=ee,x.position=T.position),A=await pe(x,k,B,H)}catch(de){throw de.position||(de.position=T.position),de.token||(de.token=ee),de}return A}async function pe(T,B,H,P){var A;for(A=await Xe(T,B,H,P);y(A)&&A.thunk===!0;){var x=await O(A.body.procedure,A.input,A.environment);A.body.procedure.type==="variable"&&(x.token=A.body.procedure.value),x.position=A.body.procedure.position;for(var k=[],Y=0;Y<A.body.arguments.length;Y++)k.push(await O(A.body.arguments[Y],A.input,A.environment));A=await Xe(x,k,H,P)}return A}async function Xe(T,B,H,P){var A;try{var x=B;if(T&&(x=mt(T.signature,B,H)),y(T))A=await ut(T,x);else if(T&&T._jsonata_function===!0){var k={environment:P,input:H};A=T.implementation.apply(k,x),b(A)&&(A=A.next().value),v(A)&&(A=await A)}else if(typeof T=="function")A=T.apply(H,x),v(A)&&(A=await A);else throw{code:"T1006",stack:new Error().stack}}catch(Y){throw T&&(typeof Y.token>"u"&&typeof T.token<"u"&&(Y.token=T.token),Y.position=T.position||Y.position),Y}return A}function mn(T,B,H){var P={_jsonata_lambda:!0,input:B,environment:H,arguments:T.arguments,signature:T.signature,body:T.body};return T.thunk===!0&&(P.thunk=!0),P.apply=async function(A,x){return await pe(P,x,B,A?A.environment:H)},P}async function Lt(T,B,H){for(var P,A=[],x=0;x<T.arguments.length;x++){var k=T.arguments[x];k.type==="operator"&&k.value==="?"?A.push(k):A.push(await O(k,B,H))}var Y=await O(T.procedure,B,H);if(typeof Y>"u"&&T.procedure.type==="path"&&H.lookup(T.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:T.position,token:T.procedure.steps[0].value};if(y(Y))P=ii(Y,A);else if(Y&&Y._jsonata_function===!0)P=Pi(Y.implementation,A);else if(typeof Y=="function")P=Pi(Y,A);else throw{code:"T1008",stack:new Error().stack,position:T.position,token:T.procedure.type==="path"?T.procedure.steps[0].value:T.procedure.value};return P}function mt(T,B,H){if(typeof T>"u")return B;var P=T.validate(B,H);return P}async function ut(T,B){var H,P=ue(T.environment);return T.arguments.forEach(function(A,x){P.bind(A.value,B[x])}),typeof T.body=="function"?H=await Io(T.body,P):H=await O(T.body,T.input,P),H}function ii(T,B){var H=ue(T.environment),P=[];T.arguments.forEach(function(x,k){var Y=B[k];Y&&Y.type==="operator"&&Y.value==="?"?P.push(x):H.bind(x.value,Y)});var A={_jsonata_lambda:!0,input:T.input,environment:H,arguments:P,body:T.body};return A}function Pi(T,B){var H=qn(T);H=H.map(function(k){return"$"+k.trim()});var P="function("+H.join(", ")+"){ _ }",A=u(P);A.body=T;var x=ii(A,B);return x}async function Io(T,B){var H=qn(T),P=H.map(function(k){return B.lookup(k.trim())}),A={environment:B},x=T.apply(A,P);return v(x)&&(x=await x),x}function qn(T){var B=T.toString(),H=/\(([^)]*)\)/.exec(B)[1],P=H.split(",");return P}function $(T,B){var H={_jsonata_function:!0,implementation:T};return typeof B<"u"&&(H.signature=f(B)),H}async function te(T,B){if(!(typeof T>"u")){var H=this.input;typeof B<"u"&&(H=B,Array.isArray(H)&&!g(H)&&(H=h(H),H.outerWrapper=!0));try{var P=u(T,!1)}catch(x){throw ze(x),{stack:new Error().stack,code:"D3120",value:x.message,error:x}}try{var A=await O(P,H,this.environment)}catch(x){throw ze(x),{stack:new Error().stack,code:"D3121",value:x.message,error:x}}return A}}function oe(T){if(!(typeof T>"u"))return JSON.parse(s.string(T))}function ue(T){var B={};const H={bind:function(A,x){B[A]=x},lookup:function(A){var x;return B.hasOwnProperty(A)?x=B[A]:T&&(x=T.lookup(A)),x},timestamp:T?T.timestamp:null,async:T?T.async:!1,isParallelCall:T?T.isParallelCall:!1,global:T?T.global:{ancestry:[null]}};if(T){var P=T.lookup(Symbol.for("jsonata.__createFrame_push"));P&&P(T,H)}return H}E.bind("sum",$(s.sum,"<a<n>:n>")),E.bind("count",$(s.count,"<a:n>")),E.bind("max",$(s.max,"<a<n>:n>")),E.bind("min",$(s.min,"<a<n>:n>")),E.bind("average",$(s.average,"<a<n>:n>")),E.bind("string",$(s.string,"<x-b?:s>")),E.bind("substring",$(s.substring,"<s-nn?:s>")),E.bind("substringBefore",$(s.substringBefore,"<s-s:s>")),E.bind("substringAfter",$(s.substringAfter,"<s-s:s>")),E.bind("lowercase",$(s.lowercase,"<s-:s>")),E.bind("uppercase",$(s.uppercase,"<s-:s>")),E.bind("length",$(s.length,"<s-:n>")),E.bind("trim",$(s.trim,"<s-:s>")),E.bind("pad",$(s.pad,"<s-ns?:s>")),E.bind("match",$(s.match,"<s-f<s:o>n?:a<o>>")),E.bind("contains",$(s.contains,"<s-(sf):b>")),E.bind("replace",$(s.replace,"<s-(sf)(sf)n?:s>")),E.bind("split",$(s.split,"<s-(sf)n?:a<s>>")),E.bind("join",$(s.join,"<a<s>s?:s>")),E.bind("formatNumber",$(s.formatNumber,"<n-so?:s>")),E.bind("formatBase",$(s.formatBase,"<n-n?:s>")),E.bind("formatInteger",$(r.formatInteger,"<n-s:s>")),E.bind("parseInteger",$(r.parseInteger,"<s-s:n>")),E.bind("number",$(s.number,"<(nsb)-:n>")),E.bind("floor",$(s.floor,"<n-:n>")),E.bind("ceil",$(s.ceil,"<n-:n>")),E.bind("round",$(s.round,"<n-n?:n>")),E.bind("abs",$(s.abs,"<n-:n>")),E.bind("sqrt",$(s.sqrt,"<n-:n>")),E.bind("power",$(s.power,"<n-n:n>")),E.bind("random",$(s.random,"<:n>")),E.bind("boolean",$(s.boolean,"<x-:b>")),E.bind("not",$(s.not,"<x-:b>")),E.bind("map",$(s.map,"<af>")),E.bind("zip",$(s.zip,"<a+>")),E.bind("filter",$(s.filter,"<af>")),E.bind("single",$(s.single,"<af?>")),E.bind("reduce",$(s.foldLeft,"<afj?:j>")),E.bind("sift",$(s.sift,"<o-f?:o>")),E.bind("keys",$(s.keys,"<x-:a<s>>")),E.bind("lookup",$(s.lookup,"<x-s:x>")),E.bind("append",$(s.append,"<xx:a>")),E.bind("exists",$(s.exists,"<x:b>")),E.bind("spread",$(s.spread,"<x-:a<o>>")),E.bind("merge",$(s.merge,"<a<o>:o>")),E.bind("reverse",$(s.reverse,"<a:a>")),E.bind("each",$(s.each,"<o-f:a>")),E.bind("error",$(s.error,"<s?:x>")),E.bind("assert",$(s.assert,"<bs?:x>")),E.bind("type",$(s.type,"<x:s>")),E.bind("sort",$(s.sort,"<af?:a>")),E.bind("shuffle",$(s.shuffle,"<a:a>")),E.bind("distinct",$(s.distinct,"<x:x>")),E.bind("base64encode",$(s.base64encode,"<s-:s>")),E.bind("base64decode",$(s.base64decode,"<s-:s>")),E.bind("encodeUrlComponent",$(s.encodeUrlComponent,"<s-:s>")),E.bind("encodeUrl",$(s.encodeUrl,"<s-:s>")),E.bind("decodeUrlComponent",$(s.decodeUrlComponent,"<s-:s>")),E.bind("decodeUrl",$(s.decodeUrl,"<s-:s>")),E.bind("eval",$(te,"<sx?:x>")),E.bind("toMillis",$(r.toMillis,"<s-s?:n>")),E.bind("fromMillis",$(r.fromMillis,"<n-s?s?:s>")),E.bind("clone",$(oe,"<(oa)-:o>"));var Me={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function ze(T){var B=Me[T.code];if(typeof B<"u"){var H=B.replace(/\{\{\{([^}]+)}}}/g,function(){return T[arguments[1]]});H=H.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(T[arguments[1]])}),T.message=H}}function Te(T,B){var H,P;try{H=u(T,B&&B.recover),P=H.errors,delete H.errors}catch(k){throw ze(k),k}var A=ue(E),x=new Date;return A.bind("now",$(function(k,Y){return r.fromMillis(x.getTime(),k,Y)},"<s?s?:s>")),A.bind("millis",$(function(){return x.getTime()},"<:n>")),B&&B.RegexEngine?Te.RegexEngine=B.RegexEngine:Te.RegexEngine=RegExp,{evaluate:async function(k,Y,ee){if(typeof P<"u"){var de={code:"S0500",position:0};throw ze(de),de}if(typeof Y<"u"){var _e;_e=ue(A);for(var Pe in Y)_e.bind(Pe,Y[Pe])}else _e=A;_e.bind("$",k),x=new Date,_e.timestamp=x,Array.isArray(k)&&!g(k)&&(k=h(k),k.outerWrapper=!0);var Ye;try{return Ye=await O(H,k,_e),typeof ee=="function"&&ee(null,Ye),Ye}catch(Ne){throw ze(Ne),Ne}},assign:function(k,Y){A.bind(k,Y)},registerFunction:function(k,Y,ee){var de=$(Y,ee);A.bind(k,de)},ast:function(){return H},errors:function(){return P}}}return Te.parser=u,Te})();i.exports=d},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(t,i,o){var r=t("./signature");const s=(()=>{var a={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,"?:":40,"??":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},f=function(c){var l=0,p=c.length,h=function(y,b){var v={type:y,value:b,position:l};return v},g=function(){for(var y=l,b=0,v,_,S=function(O){if(c.charAt(O)==="/"&&b===0){for(var R=0;c.charAt(O-(R+1))==="\\";)R++;if(R%2===0)return!0}return!1};l<p;){var E=c.charAt(l);if(S(l)){if(v=c.substring(y,l),v==="")throw{code:"S0301",stack:new Error().stack,position:l};for(l++,E=c.charAt(l),y=l;E==="i"||E==="m";)l++,E=c.charAt(l);return _=c.substring(y,l)+"g",new RegExp(v,_)}(E==="("||E==="["||E==="{")&&c.charAt(l-1)!=="\\"&&b++,(E===")"||E==="]"||E==="}")&&c.charAt(l-1)!=="\\"&&b--,l++}throw{code:"S0302",stack:new Error().stack,position:l}},m=function(y){if(l>=p)return null;for(var b=c.charAt(l);l<p&&` 	
\r\v`.indexOf(b)>-1;)l++,b=c.charAt(l);if(b==="/"&&c.charAt(l+1)==="*"){var v=l;for(l+=2,b=c.charAt(l);!(b==="*"&&c.charAt(l+1)==="/");)if(b=c.charAt(++l),l>=p)throw{code:"S0106",stack:new Error().stack,position:v};return l+=2,b=c.charAt(l),m(y)}if(y!==!0&&b==="/")return l++,h("regex",g());if(b==="."&&c.charAt(l+1)===".")return l+=2,h("operator","..");if(b===":"&&c.charAt(l+1)==="=")return l+=2,h("operator",":=");if(b==="!"&&c.charAt(l+1)==="=")return l+=2,h("operator","!=");if(b===">"&&c.charAt(l+1)==="=")return l+=2,h("operator",">=");if(b==="<"&&c.charAt(l+1)==="=")return l+=2,h("operator","<=");if(b==="*"&&c.charAt(l+1)==="*")return l+=2,h("operator","**");if(b==="~"&&c.charAt(l+1)===">")return l+=2,h("operator","~>");if(b==="?"&&c.charAt(l+1)===":")return l+=2,h("operator","?:");if(b==="?"&&c.charAt(l+1)==="?")return l+=2,h("operator","??");if(Object.prototype.hasOwnProperty.call(a,b))return l++,h("operator",b);if(b==='"'||b==="'"){var _=b;l++;for(var S="";l<p;){if(b=c.charAt(l),b==="\\")if(l++,b=c.charAt(l),Object.prototype.hasOwnProperty.call(u,b))S+=u[b];else if(b==="u"){var E=c.substr(l+1,4);if(/^[0-9a-fA-F]+$/.test(E)){var O=parseInt(E,16);S+=String.fromCharCode(O),l+=4}else throw{code:"S0104",stack:new Error().stack,position:l}}else throw{code:"S0103",stack:new Error().stack,position:l,token:b};else{if(b===_)return l++,h("string",S);S+=b}l++}throw{code:"S0101",stack:new Error().stack,position:l}}var R=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,w=R.exec(c.substring(l));if(w!==null){var M=parseFloat(w[0]);if(!isNaN(M)&&isFinite(M))return l+=w[0].length,h("number",M);throw{code:"S0102",stack:new Error().stack,position:l,token:w[0]}}var I;if(b==="`"){l++;var D=c.indexOf("`",l);if(D!==-1)return I=c.substring(l,D),l=D+1,h("name",I);throw l=p,{code:"S0105",stack:new Error().stack,position:l}}for(var C=l,z;;)if(z=c.charAt(C),C===p||` 	
\r\v`.indexOf(z)>-1||Object.prototype.hasOwnProperty.call(a,z)){if(c.charAt(l)==="$")return I=c.substring(l+1,C),l=C,h("variable",I);switch(I=c.substring(l,C),l=C,I){case"or":case"in":case"and":return h("operator",I);case"true":return h("value",!0);case"false":return h("value",!1);case"null":return h("value",null);default:return l===p&&I===""?null:h("name",I)}}else C++};return m},d=function(c,l){var p,h,g={},m=[],y=function(){var K=[];p.id!=="(end)"&&K.push({type:p.type,value:p.value,position:p.position});for(var q=h();q!==null;)K.push(q),q=h();return K},b={nud:function(){var K={code:"S0211",token:this.value,position:this.position};if(l)return K.remaining=y(),K.type="error",m.push(K),K;throw K.stack=new Error().stack,K}},v=function(K,q){var ae=g[K];return q=q||0,ae?q>=ae.lbp&&(ae.lbp=q):(ae=Object.create(b),ae.id=ae.value=K,ae.lbp=q,g[K]=ae),ae},_=function(K){if(l){K.remaining=y(),m.push(K);var q=g["(error)"];return p=Object.create(q),p.error=K,p.type="(error)",p}else throw K.stack=new Error().stack,K},S=function(K,q){if(K&&p.id!==K){var ae;p.id==="(end)"?ae="S0203":ae="S0202";var me={code:ae,position:p.position,token:p.value,value:K};return _(me)}var ve=h(q);if(ve===null)return p=g["(end)"],p.position=c.length,p;var L=ve.value,j=ve.type,V;switch(j){case"name":case"variable":V=g["(name)"];break;case"operator":if(V=g[L],!V)return _({code:"S0204",stack:new Error().stack,position:ve.position,token:L});break;case"string":case"number":case"value":V=g["(literal)"];break;case"regex":j="regex",V=g["(regex)"];break;default:return _({code:"S0205",stack:new Error().stack,position:ve.position,token:L})}return p=Object.create(V),p.value=L,p.type=j,p.position=ve.position,p},E=function(K){var q,ae=p;for(S(null,!0),q=ae.nud();K<p.lbp;)ae=p,S(),q=ae.led(q);return q},O=function(K){var q=v(K,0);q.nud=function(){return this}},R=function(K,q,ae){var me=q||a[K],ve=v(K,me);return ve.led=ae||function(L){return this.lhs=L,this.rhs=E(me),this.type="binary",this},ve},w=function(K,q,ae){var me=v(K,q);return me.led=ae,me},M=function(K,q){var ae=v(K);return ae.nud=q||function(){return this.expression=E(70),this.type="unary",this},ae};O("(end)"),O("(name)"),O("(literal)"),O("(regex)"),v(":"),v(";"),v(","),v(")"),v("]"),v("}"),v(".."),R("."),R("+"),R("-"),R("*"),R("/"),R("%"),R("="),R("<"),R(">"),R("!="),R("<="),R(">="),R("&"),R("and"),R("or"),R("in"),O("and"),O("or"),O("in"),M("-"),R("~>"),R("??",a["??"],function(K){return this.type="condition",this.condition={type:"function",value:"(",procedure:{type:"variable",value:"exists"},arguments:[K]},this.then=K,this.else=E(0),this}),w("(error)",10,function(K){return this.lhs=K,this.error=p.error,this.remaining=y(),this.type="error",this}),M("*",function(){return this.type="wildcard",this}),M("**",function(){return this.type="descendant",this}),M("%",function(){return this.type="parent",this}),R("(",a["("],function(K){if(this.procedure=K,this.type="function",this.arguments=[],p.id!==")")for(;p.type==="operator"&&p.id==="?"?(this.type="partial",this.arguments.push(p),S("?")):this.arguments.push(E(0)),p.id===",";)S(",");if(S(")",!0),K.type==="name"&&(K.value==="function"||K.value==="λ")){if(this.arguments.forEach(function(L,j){if(L.type!=="variable")return _({code:"S0208",stack:new Error().stack,position:L.position,token:L.value,value:j+1})}),this.type="lambda",p.id==="<"){for(var q=p.position,ae=1,me="<";ae>0&&p.id!=="{"&&p.id!=="(end)";){var ve=S();ve.id===">"?ae--:ve.id==="<"&&ae++,me+=ve.value}S(">");try{this.signature=r(me)}catch(L){return L.position=q+L.offset,_(L)}}S("{"),this.body=E(0),S("}")}return this}),M("(",function(){for(var K=[];p.id!==")"&&(K.push(E(0)),p.id===";");)S(";");return S(")",!0),this.type="block",this.expressions=K,this}),M("[",function(){var K=[];if(p.id!=="]")for(;;){var q=E(0);if(p.id===".."){var ae={type:"binary",value:"..",position:p.position,lhs:q};S(".."),ae.rhs=E(0),q=ae}if(K.push(q),p.id!==",")break;S(",")}return S("]",!0),this.expressions=K,this.type="unary",this}),R("[",a["["],function(K){if(p.id==="]"){for(var q=K;q&&q.type==="binary"&&q.value==="[";)q=q.lhs;return q.keepArray=!0,S("]"),K}else return this.lhs=K,this.rhs=E(a["]"]),this.type="binary",S("]",!0),this}),R("^",a["^"],function(K){S("(");for(var q=[];;){var ae={descending:!1};if(p.id==="<"?S("<"):p.id===">"&&(ae.descending=!0,S(">")),ae.expression=E(0),q.push(ae),p.id!==",")break;S(",")}return S(")"),this.lhs=K,this.rhs=q,this.type="binary",this});var I=function(K){var q=[];if(p.id!=="}")for(;;){var ae=E(0);S(":");var me=E(0);if(q.push([ae,me]),p.id!==",")break;S(",")}return S("}",!0),typeof K>"u"?(this.lhs=q,this.type="unary"):(this.lhs=K,this.rhs=q,this.type="binary"),this};M("{",I),R("{",a["{"],I),w(":=",a[":="],function(K){return K.type!=="variable"?_({code:"S0212",stack:new Error().stack,position:K.position,token:K.value}):(this.lhs=K,this.rhs=E(a[":="]-1),this.type="binary",this)}),R("@",a["@"],function(K){return this.lhs=K,this.rhs=E(a["@"]),this.rhs.type!=="variable"?_({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),R("#",a["#"],function(K){return this.lhs=K,this.rhs=E(a["#"]),this.rhs.type!=="variable"?_({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),R("?",a["?"],function(K){return this.type="condition",this.condition=K,this.then=E(0),p.id===":"&&(S(":"),this.else=E(0)),this}),R("?:",a["?:"],function(K){return this.type="condition",this.condition=K,this.then=K,this.else=E(0),this}),M("|",function(){return this.type="transform",this.pattern=E(0),S("|"),this.update=E(0),p.id===","&&(S(","),this.delete=E(0)),S("|"),this});var D=function(K){var q;if(K.type==="function"&&!K.predicate){var ae={type:"lambda",thunk:!0,arguments:[],position:K.position};ae.body=K,q=ae}else if(K.type==="condition")K.then=D(K.then),typeof K.else<"u"&&(K.else=D(K.else)),q=K;else if(K.type==="block"){var me=K.expressions.length;me>0&&(K.expressions[me-1]=D(K.expressions[me-1])),q=K}else q=K;return q},C=0,z=0,G=[],N=function(K,q){switch(K.type){case"name":case"wildcard":q.level--,q.level===0&&(typeof K.ancestor>"u"||(G[q.index].slot.label=K.ancestor.label),K.ancestor=q,K.tuple=!0);break;case"parent":q.level++;break;case"block":K.expressions.length>0&&(K.tuple=!0,q=N(K.expressions[K.expressions.length-1],q));break;case"path":K.tuple=!0;var ae=K.steps.length-1;for(q=N(K.steps[ae--],q);q.level>0&&ae>=0;)q=N(K.steps[ae--],q);break;default:throw{code:"S0217",token:K.type,position:K.position}}return q},U=function(K,q){if(typeof q.seekingParent<"u"||q.type==="parent"){var ae=typeof q.seekingParent<"u"?q.seekingParent:[];q.type==="parent"&&ae.push(q.slot),typeof K.seekingParent>"u"?K.seekingParent=ae:Array.prototype.push.apply(K.seekingParent,ae)}},Q=function(K){var q=K.steps.length-1,ae=K.steps[q],me=typeof ae.seekingParent<"u"?ae.seekingParent:[];ae.type==="parent"&&me.push(ae.slot);for(var ve=0;ve<me.length;ve++){var L=me[ve];for(q=K.steps.length-2;L.level>0;){if(q<0){typeof K.seekingParent>"u"?K.seekingParent=[L]:K.seekingParent.push(L);break}for(var j=K.steps[q--];q>=0&&j.focus&&K.steps[q].focus;)j=K.steps[q--];L=N(j,L)}}},J=function(K){var q;switch(K.type){case"binary":switch(K.value){case".":var ae=J(K.lhs);ae.type==="path"?q=ae:q={type:"path",steps:[ae]},ae.type==="parent"&&(q.seekingParent=[ae.slot]);var me=J(K.rhs);me.type==="function"&&me.procedure.type==="path"&&me.procedure.steps.length===1&&me.procedure.steps[0].type==="name"&&q.steps[q.steps.length-1].type==="function"&&(q.steps[q.steps.length-1].nextFunction=me.procedure.steps[0].value),me.type==="path"?Array.prototype.push.apply(q.steps,me.steps):(typeof me.predicate<"u"&&(me.stages=me.predicate,delete me.predicate),q.steps.push(me)),q.steps.filter(function(ie){if(ie.type==="number"||ie.type==="value")throw{code:"S0213",stack:new Error().stack,position:ie.position,value:ie.value};return ie.type==="string"}).forEach(function(ie){ie.type="name"}),q.steps.filter(function(ie){return ie.keepArray===!0}).length>0&&(q.keepSingletonArray=!0);var ve=q.steps[0];ve.type==="unary"&&ve.value==="["&&(ve.consarray=!0);var L=q.steps[q.steps.length-1];L.type==="unary"&&L.value==="["&&(L.consarray=!0),Q(q);break;case"[":q=J(K.lhs);var j=q,V="predicate";if(q.type==="path"&&(j=q.steps[q.steps.length-1],V="stages"),typeof j.group<"u")throw{code:"S0209",stack:new Error().stack,position:K.position};typeof j[V]>"u"&&(j[V]=[]);var F=J(K.rhs);typeof F.seekingParent<"u"&&(F.seekingParent.forEach(ie=>{ie.level===1?N(j,ie):ie.level--}),U(j,F)),j[V].push({type:"filter",expr:F,position:K.position});break;case"{":if(q=J(K.lhs),typeof q.group<"u")throw{code:"S0210",stack:new Error().stack,position:K.position};q.group={lhs:K.rhs.map(function(ie){return[J(ie[0]),J(ie[1])]}),position:K.position};break;case"^":q=J(K.lhs),q.type!=="path"&&(q={type:"path",steps:[q]});var X={type:"sort",position:K.position};X.terms=K.rhs.map(function(ie){var he=J(ie.expression);return U(X,he),{descending:ie.descending,expression:he}}),q.steps.push(X),Q(q);break;case":=":q={type:"bind",value:K.value,position:K.position},q.lhs=J(K.lhs),q.rhs=J(K.rhs),U(q,q.rhs);break;case"@":if(q=J(K.lhs),j=q,q.type==="path"&&(j=q.steps[q.steps.length-1]),typeof j.stages<"u"||typeof j.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:K.position};if(j.type==="sort")throw{code:"S0216",stack:new Error().stack,position:K.position};K.keepArray&&(j.keepArray=!0),j.focus=K.rhs.value,j.tuple=!0;break;case"#":q=J(K.lhs),j=q,q.type==="path"?j=q.steps[q.steps.length-1]:(q={type:"path",steps:[q]},typeof j.predicate<"u"&&(j.stages=j.predicate,delete j.predicate)),typeof j.stages>"u"?j.index=K.rhs.value:j.stages.push({type:"index",value:K.rhs.value,position:K.position}),j.tuple=!0;break;case"~>":q={type:"apply",value:K.value,position:K.position},q.lhs=J(K.lhs),q.rhs=J(K.rhs),q.keepArray=q.lhs.keepArray||q.rhs.keepArray;break;default:q={type:K.type,value:K.value,position:K.position},q.lhs=J(K.lhs),q.rhs=J(K.rhs),U(q,q.lhs),U(q,q.rhs)}break;case"unary":q={type:K.type,value:K.value,position:K.position},K.value==="["?q.expressions=K.expressions.map(function(ie){var he=J(ie);return U(q,he),he}):K.value==="{"?q.lhs=K.lhs.map(function(ie){var he=J(ie[0]);U(q,he);var Ae=J(ie[1]);return U(q,Ae),[he,Ae]}):(q.expression=J(K.expression),K.value==="-"&&q.expression.type==="number"?(q=q.expression,q.value=-q.value):U(q,q.expression));break;case"function":case"partial":q={type:K.type,name:K.name,value:K.value,position:K.position},q.arguments=K.arguments.map(function(ie){var he=J(ie);return U(q,he),he}),q.procedure=J(K.procedure);break;case"lambda":q={type:K.type,arguments:K.arguments,signature:K.signature,position:K.position};var ne=J(K.body);q.body=D(ne);break;case"condition":q={type:K.type,position:K.position},q.condition=J(K.condition),U(q,q.condition),q.then=J(K.then),U(q,q.then),typeof K.else<"u"&&(q.else=J(K.else),U(q,q.else));break;case"transform":q={type:K.type,position:K.position},q.pattern=J(K.pattern),q.update=J(K.update),typeof K.delete<"u"&&(q.delete=J(K.delete));break;case"block":q={type:K.type,position:K.position},q.expressions=K.expressions.map(function(ie){var he=J(ie);return U(q,he),(he.consarray||he.type==="path"&&he.steps[0].consarray)&&(q.consarray=!0),he});break;case"name":q={type:"path",steps:[K]},K.keepArray&&(q.keepSingletonArray=!0);break;case"parent":q={type:"parent",slot:{label:"!"+C++,level:1,index:z++}},G.push(q);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":q=K;break;case"operator":if(K.value==="and"||K.value==="or"||K.value==="in")K.type="name",q=J(K);else if(K.value==="?")q=K;else throw{code:"S0201",stack:new Error().stack,position:K.position,token:K.value};break;case"error":q=K,K.lhs&&(q=J(K.lhs));break;default:var re="S0206";K.id==="(end)"&&(re="S0207");var Z={code:re,position:K.position,token:K.value};if(l)return m.push(Z),{type:"error",error:Z};throw Z.stack=new Error().stack,Z}return K.keepArray&&(q.keepArray=!0),q};h=f(c),S();var ce=E(0);if(p.id!=="(end)"){var we={code:"S0201",position:p.position,token:p.value};_(we)}if(ce=J(ce),ce.type==="parent"||typeof ce.seekingParent<"u")throw{code:"S0217",token:ce.type,position:ce.position};return m.length>0&&(ce.errors=m),ce};return d})();i.exports=s},{"./signature":5}],5:[function(t,i,o){var r=t("./utils");const s=(()=>{var a={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function u(f){for(var d=1,c=[],l={},p=l;d<f.length;){var h=f.charAt(d);if(h===":")break;var g=function(){c.push(l),p=l,l={}},m=function(R,w,M,I){for(var D=1,C=w;C<R.length;)if(C++,h=R.charAt(C),h===I){if(D--,D===0)break}else h===M&&D++;return C};switch(h){case"s":case"n":case"b":case"l":case"o":l.regex="["+h+"m]",l.type=h,g();break;case"a":l.regex="[asnblfom]",l.type=h,l.array=!0,g();break;case"f":l.regex="f",l.type=h,g();break;case"j":l.regex="[asnblom]",l.type=h,g();break;case"x":l.regex="[asnblfom]",l.type=h,g();break;case"-":p.context=!0,p.contextRegex=new RegExp(p.regex),p.regex+="?";break;case"?":case"+":p.regex+=h;break;case"(":var y=m(f,d,"(",")"),b=f.substring(d+1,y);if(b.indexOf("<")===-1)l.regex="["+b+"m]";else throw{code:"S0402",stack:new Error().stack,value:b,offset:d};l.type="("+b+")",d=y,g();break;case"<":if(p.type==="a"||p.type==="f"){var v=m(f,d,"<",">");p.subtype=f.substring(d+1,v),d=v}else throw{code:"S0401",stack:new Error().stack,value:p.type,offset:d};break}d++}var _="^"+c.map(function(R){return"("+R.regex+")"}).join("")+"$",S=new RegExp(_),E=function(R){var w;if(r.isFunction(R))w="f";else{var M=typeof R;switch(M){case"string":w="s";break;case"number":w="n";break;case"boolean":w="b";break;case"object":R===null?w="l":Array.isArray(R)?w="a":w="o";break;case"undefined":default:w="m"}}return w},O=function(R,w){for(var M="^",I=0,D=0;D<c.length;D++){M+=c[D].regex;var C=w.match(M);if(C===null)throw{code:"T0410",stack:new Error().stack,value:R[I],index:I+1};I=C[0].length}throw{code:"T0410",stack:new Error().stack,value:R[I],index:I+1}};return{definition:f,validate:function(R,w){var M="";R.forEach(function(z){M+=E(z)});var I=S.exec(M);if(I){var D=[],C=0;return c.forEach(function(z,G){var N=R[C],U=I[G+1];if(U==="")if(z.context&&z.contextRegex){var Q=E(w);if(z.contextRegex.test(Q))D.push(w);else throw{code:"T0411",stack:new Error().stack,value:w,index:C+1}}else D.push(N),C++;else U.split("").forEach(function(J){if(z.type==="a"){if(J==="m")N=void 0;else{N=R[C];var ce=!0;if(typeof z.subtype<"u"){if(J!=="a"&&U!==z.subtype)ce=!1;else if(J==="a"&&N.length>0){var we=E(N[0]);if(we!==z.subtype.charAt(0))ce=!1;else{var K=N.filter(function(q){return E(q)!==we});ce=K.length===0}}}if(!ce)throw{code:"T0412",stack:new Error().stack,value:N,index:C+1,type:a[z.subtype]};J!=="a"&&(N=[N])}D.push(N),C++}else D.push(N),C++})}),D}O(R,M)}}}return u})();i.exports=s},{"./utils":6}],6:[function(t,i,o){const r=(()=>{function s(v){var _=!1;if(typeof v=="number"&&(_=!isNaN(v),_&&!isFinite(v)))throw{code:"D1001",value:v,stack:new Error().stack};return _}function a(v){var _=!1;return Array.isArray(v)&&(_=v.filter(function(S){return typeof S!="string"}).length===0),_}function u(v){var _=!1;return Array.isArray(v)&&(_=v.filter(function(S){return!s(S)}).length===0),_}function f(){var v=[];return v.sequence=!0,arguments.length===1&&v.push(arguments[0]),v}function d(v){return v.sequence===!0&&Array.isArray(v)}function c(v){return v&&(v._jsonata_function===!0||v._jsonata_lambda===!0)||typeof v=="function"}function l(v){var _=typeof v.arity=="number"?v.arity:typeof v.implementation=="function"?v.implementation.length:typeof v.length=="number"?v.length:v.arguments.length;return _}function p(v){return v&&v._jsonata_lambda===!0}var h=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function g(v){return typeof v=="object"&&v!==null&&h in v&&"next"in v&&typeof v.next=="function"}function m(v,_){if(v===_)return!0;if(typeof v=="object"&&typeof _=="object"&&v!==null&&_!==null){if(Array.isArray(v)&&Array.isArray(_)){if(v.length!==_.length)return!1;for(var S=0;S<v.length;S++)if(!m(v[S],_[S]))return!1;return!0}var E=Object.getOwnPropertyNames(v),O=Object.getOwnPropertyNames(_);if(E.length!==O.length)return!1;for(E=E.sort(),O=O.sort(),S=0;S<E.length;S++)if(E[S]!==O[S])return!1;for(S=0;S<E.length;S++){var R=E[S];if(!m(v[R],_[R]))return!1}return!0}return!1}function y(v){return typeof v=="object"&&v!==null&&"then"in v&&typeof v.then=="function"}function b(v){var _=[];for(let S of v)_.push(S);return _}return{isNumeric:s,isArrayOfStrings:a,isArrayOfNumbers:u,createSequence:f,isSequence:d,isFunction:c,isLambda:p,isIterable:g,getFunctionArity:l,isDeepEqual:m,stringToArray:b,isPromise:y}})();i.exports=r},{}]},{},[3])(3)})})(Dd)),Dd.exports}var CR=IR();const TR=ov(CR);var Ao=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Oo=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},ev=function(n,e){return function(t,i){e(t,i,n)}},Qd;let xt=Qd=class extends W.AbstractUIExtension{constructor(e,t){var i,o;super(),this.configManager=e,this.pointerEventsDisabled=!1,this.searchString="",this.elementPreviews=new Map,this.selectedElements=new Set,this.index=void 0,this.isOpen=(o=(i=e.config)===null||i===void 0?void 0:i.toolboxEnabled)!==null&&o!==void 0?o:!0,this.renderer=t("popup",[])}handle(e){e.kind===ft.UpdateModelAction.KIND||e.kind===ft.SetModelAction.KIND?this.handleUpdateModelAction(e):Zi.isTransactionalAction(e)?this.handleTransactionalAction(e):pl.is(e)?(this.isOpen=e.config.toolboxEnabled,this.update()):ya.is(e)?this.updateTool(e.tool,!1):(e.kind===ft.SelectAction.KIND||e.kind===ft.SelectAllAction.KIND)&&this.handleSelectAction(e)}resetCache(){this.elementPreviews.clear(),this.searchIndex=void 0,this.connectionSearchIndex=void 0,this.index=void 0,this.toolboxEdits=void 0,this.connectionEdits=void 0}handleUpdateModelAction(e){var t;if(((t=e.newRoot)===null||t===void 0?void 0:t.type)!==yv.TYPE)return;const i=e.newRoot;this.currentRoot=i,this.initializeToolbox(),this.resetCache();for(const o of this.selectedElements)this.getIndex().get(o)==null&&this.selectedElements.delete(o);this.update()}handleTransactionalAction(e){let t=!1;e.committed&&(this.pointerEventsDisabled=!1,t=!0);const i=this.toolState.toolType;!this.toolState.isLocked&&i==xe.CONNECT&&(this.updateTool(xe.CURSOR,!1),t=!0),t&&this.update()}handleSelectAction(e){const t=this.selectedElements.size===1?this.selectedElements.values().next().value:void 0;if(e.kind===ft.SelectAction.KIND)e.selectedElementsIDs.forEach(o=>this.selectedElements.add(o)),e.deselectedElementsIDs.forEach(o=>this.selectedElements.delete(o));else if(e.select){if(this.currentRoot!=null){this.selectedElements.clear();for(const o of this.getIndex().values())(ts.isCanvasElement(o)||ml.isCanvasConnection(o)||gv.isCanvasPoint(o))&&this.selectedElements.add(o.id)}}else this.selectedElements.clear();const i=this.selectedElements.size===1?this.selectedElements.values().next().value:void 0;t!==i&&(this.resetCache(),this.update())}initializeToolbox(){this.containerElement||this.initialize(),this.update()}update(){this.currentRoot!=null&&(this.currentVNode=this.patcherProvider.patcher(this.currentVNode,ER(this)))}id(){return Qd.ID}containerClass(){return"toolbox-wrapper"}initializeContents(e){const t=document.createElement("div");e.appendChild(t),e.classList.add("hylimo"),this.currentVNode=this.patcherProvider.patcher(t,et("div"))}toggleToolbox(){this.isOpen=!this.isOpen,this.update(),this.configManager.updateConfig({toolboxEnabled:this.isOpen})}updateTool(e,t){const i=this.toolState.toolType;if(!(i==e&&this.toolState.isLocked==t)){if(i!=e){const o=[];let r=null;e==xe.HAND?r="cursor-grab":(e==xe.CONNECT||e==xe.BOX_SELECT)&&(r="cursor-crosshair");const s={kind:So.KIND,toolCursor:r};o.push(s),(e==xe.CONNECT||e==xe.HAND)&&o.push(ft.SelectAllAction.create({select:!1})),this.actionDispatcher.dispatchAll(o)}this.toolState.toolType=e,this.toolState.isLocked=t,this.update()}}get connectionEdit(){if(this.currentRoot==null)return;const e=this.getConnectionEdits();if(e.length!==0)return`connection/${this.getCurrentConnection(e)}`}getCurrentConnection(e){var t;return this.selectedConnection!=null&&e.some(i=>i.name===this.selectedConnection)?this.selectedConnection:(t=e[0])===null||t===void 0?void 0:t.name}getToolboxEdits(){if(this.toolboxEdits==null){const e=this.selectedElements.size===1?this.getIndex().get(this.selectedElements.values().next().value):this.currentRoot,t=Object.entries(e.edits).filter(([i,o])=>i.startsWith("toolbox/")&&Wi.isConsistent([[o]]));this.toolboxEdits=t.map(([i,o])=>{const[r,s]=i.substring(8).split("/"),a={canMove:!1,requiresExpression:!1};for(const u of o.template)typeof u=="string"&&this.extractTemplateInformationRecursive(TR(u).ast(),a);return Object.assign({group:r,name:s,edit:i,target:{id:e.id,editExpression:e.editExpression}},a)}).filter(i=>!i.requiresExpression||i.target.editExpression!=null)}return this.toolboxEdits}extractTemplateInformationRecursive(e,t){if(e!=null)if(Array.isArray(e))for(const i of e)this.extractTemplateInformationRecursive(i,t);else e.type==="name"?e.value==="x"||e.value==="y"?t.canMove=!0:e.value==="expression"&&(t.requiresExpression=!0):(this.extractTemplateInformationRecursive(e.arguments,t),this.extractTemplateInformationRecursive(e.lhs,t),this.extractTemplateInformationRecursive(e.rhs,t),this.extractTemplateInformationRecursive(e.steps,t),this.extractTemplateInformationRecursive(e.expressions,t),this.extractTemplateInformationRecursive(e.procedure,t),this.extractTemplateInformationRecursive(e.stages,t))}getConnectionEdits(){return this.connectionEdits==null&&(this.connectionEdits=Object.entries(this.currentRoot.edits).filter(([e,t])=>e.startsWith("connection/")&&Wi.isConsistent([[t]])).map(([e])=>({name:e.substring(11),edit:e}))),this.connectionEdits}showPreview(e){this.showPreviewFor=e.edit,this.elementPreviews.has(e.edit)?this.update():this.requestPrediction(this.generatePredictionEdit(e),e.edit)}generatePredictionEdit(e){return e.edit.startsWith("toolbox/")?{types:[e.edit],values:{x:0,y:0,prediction:!0,expression:e.target.editExpression},elements:[e.target.id]}:{types:[e.edit],values:{start:{x:0,y:0},end:{x:200,y:0},prediction:!0},elements:[this.currentRoot.id]}}async requestPrediction(e,t){var i,o;const r={kind:cv.KIND,edit:e,requestId:ft.generateRequestId()},s=await this.actionDispatcher.request(r);let a;const u=(o=(i=s.root)===null||i===void 0?void 0:i.rootBounds)===null||o===void 0?void 0:o.size;if(s.root!=null&&u?.height&&u?.width){const f=this.modelFactory.createRoot(s.root);a=this.renderer.renderElement(f)}this.elementPreviews.set(t,a),this.update()}getSearchIndex(){return this.searchIndex==null&&(this.searchIndex=new xf({fields:["name","group"],storeFields:["name","group","edit"],searchOptions:{prefix:!0,fuzzy:.2,boost:{name:2}}}),this.searchIndex.addAll(this.getToolboxEdits().map(e=>Object.assign(Object.assign({},e),{id:e.edit})))),this.searchIndex}getConnectionSearchIndex(){return this.connectionSearchIndex==null&&(this.connectionSearchIndex=new xf({fields:["edit"],storeFields:["edit"],searchOptions:{prefix:!0,fuzzy:.2},tokenize:e=>e.split(" ")}),this.connectionSearchIndex.addAll(this.getConnectionEdits().map(e=>Object.assign(Object.assign({},e),{id:e})))),this.connectionSearchIndex}getIndex(){return this.currentRoot==null?new Map:(this.index==null&&(this.index=new Map,this.buildIndexRecursive(this.currentRoot)),this.index)}buildIndexRecursive(e){this.index.set(e.id,e);for(const t of e.children)this.buildIndexRecursive(t)}isToolEnabled(e){return e===xe.ADD_ELEMENT?this.getToolboxEdits().length>0:e===xe.CONNECT?this.getCurrentConnection(this.getConnectionEdits())!=null:e!==xe.AUTOLAYOUT}get selectedElementMode(){return this.selectedElements.size===1}};xt.ID="toolbox";Ao([Ee(le.PatcherProvider),Oo("design:type",Function)],xt.prototype,"patcherProvider",void 0);Ao([Ee(le.IActionDispatcher),Oo("design:type",Object)],xt.prototype,"actionDispatcher",void 0);Ao([Ee(le.IModelFactory),Oo("design:type",Object)],xt.prototype,"modelFactory",void 0);Ao([Ee(Zo),Oo("design:type",Zo)],xt.prototype,"toolState",void 0);Ao([Ee(le.SettingsProvider),Oo("design:type",Function)],xt.prototype,"settingsProvider",void 0);Ao([Ee(le.TransactionIdProvider),Oo("design:type",Function)],xt.prototype,"transactionIdProvider",void 0);xt=Qd=Ao([Re(),ev(0,Ee(le.ConfigManager)),ev(1,Ee(le.ModelRendererFactory)),Oo("design:paramtypes",[Function,Function])],xt);const DR=new At((n,e,t)=>{const i={bind:n,isBound:t};n(Zo).toSelf().inSingletonScope(),n(xt).toSelf().inSingletonScope(),n(le.IUIExtension).toService(xt),n(le.ConnectionEditProvider).toService(xt),n(le.ToolTypeProvider).toService(Zo),W.configureActionHandler(i,ft.UpdateModelAction.KIND,xt),W.configureActionHandler(i,ft.SetModelAction.KIND,xt),W.configureActionHandler(i,Zi.KIND,xt),W.configureActionHandler(i,pl.KIND,xt),W.configureActionHandler(i,ya.KIND,xt),W.configureActionHandler(i,ft.SelectAction.KIND,xt),W.configureActionHandler(i,ft.SelectAllAction.KIND,xt)});var xR=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let gu=class{constructor(){this.idCounter=0}generateId(){return this.idCounter++,this.idCounter.toString()}};gu=xR([Re()],gu);var jR=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let sa=class{constructor(){this.isInTransaction=!1,this.types=void 0}get isInCreateConnectionTransaction(){const e=this.types;return e!=null&&e.length===1&&e[0].startsWith("connection/")}handle(e){Zi.isTransactionalAction(e)&&(this.isInTransaction=!e.committed,e.committed?this.types=void 0:this.types==null&&(this.types=e.edits.flatMap(t=>{var i;return(i=t.types)!==null&&i!==void 0?i:[]})))}};sa=jR([Re()],sa);const LR=new At((n,e,t)=>{n(gu).toSelf().inSingletonScope(),n(le.TransactionIdProvider).toService(gu),n(sa).toSelf().inSingletonScope(),n(le.TransactionStateProvider).toService(sa),W.configureActionHandler({bind:n,isBound:t},Zi.KIND,sa)});var NR=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let mu=class extends W.KeyListener{keyDown(e,t){return W.isCtrlOrCmd(t)?t.key.toLowerCase()=="y"||t.shiftKey&&t.key.toLowerCase()=="z"?[{kind:Fd.KIND}]:t.key.toLowerCase()=="z"?[{kind:Nd.KIND}]:[]:[]}};mu=NR([Re()],mu);const FR=new At(n=>{n(mu).toSelf().inSingletonScope(),n(le.KeyListener).toService(mu)}),BR=new At((n,e,t)=>{W.configureCommand({bind:n,isBound:t},Bo),W.configureCommand({bind:n,isBound:t},bo)});var Mf=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},d0=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let Jo=class extends Zd{touchStart(e,t){const i=W.findParentByFeature(e,W.isViewport);return i!=null?t.touches.length===1?this.lastTouchPosition={x:t.touches[0].clientX,y:t.touches[0].clientY}:t.touches.length===2&&(this.lastTouchDistance=this.calculateDistance(t.touches),this.lastTouchMidpoint=this.calculateMidpoint(t.touches,i.canvasBounds)):this.lastTouchPosition=void 0,[]}touchMove(e,t){const i=W.findParentByFeature(e,W.isViewport);if(i==null||t.touches.length<1||t.touches.length>2)return[];let o;if(t.touches.length===1){if(this.lastTouchPosition==null)return[];o=this.calculateViewportFromOneTouch(i,t)}else{if(this.lastTouchDistance==null||this.lastTouchMidpoint==null)return[];o=this.calculateViewportFromTwoTouches(i,t)}return[ft.SetViewportAction.create(i.id,o,{animate:!1})]}calculateViewportFromOneTouch(e,t){const i=t.touches[0],o={scroll:{x:e.scroll.x-(i.clientX-this.lastTouchPosition.x)/e.zoom,y:e.scroll.y-(i.clientY-this.lastTouchPosition.y)/e.zoom},zoom:e.zoom};return this.lastTouchPosition={x:i.clientX,y:i.clientY},o}calculateViewportFromTwoTouches(e,t){const i=this.calculateDistance(t.touches),o=this.calculateMidpoint(t.touches,e.canvasBounds),r=i/this.lastTouchDistance,s=W.limit(e.zoom*r,this.viewerOptions.zoomLimits),a=(o.x-this.lastTouchMidpoint.x)/e.zoom,u=(o.y-this.lastTouchMidpoint.y)/e.zoom,f=1/s-1/e.zoom,d={scroll:{x:e.scroll.x-a-f*o.x,y:e.scroll.y-u-f*o.y},zoom:s};return this.lastTouchDistance=i,this.lastTouchMidpoint=o,d}touchEnd(e,t){return t.touches.length===0?(this.lastTouchPosition=void 0,this.lastTouchDistance=void 0,this.lastTouchMidpoint=void 0):t.touches.length===1&&(this.lastTouchPosition={x:t.touches[0].clientX,y:t.touches[0].clientY}),[]}calculateDistance(e){const t=e[0].clientX-e[1].clientX,i=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+i*i)}calculateMidpoint(e,t){const i=W.getWindowScroll();return{x:(e[0].clientX+e[1].clientX)/2+i.x-t.x,y:(e[0].clientY+e[1].clientY)/2+i.y-t.y}}};Mf([Ee(le.IActionDispatcher),d0("design:type",Object)],Jo.prototype,"actionDispatcher",void 0);Mf([Ee(le.ViewerOptions),d0("design:type",Object)],Jo.prototype,"viewerOptions",void 0);Jo=Mf([Re()],Jo);var VR=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let el=class{handle(e){return cf(!1)}};el=VR([Re()],el);var zR=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let yu=class extends W.KeyListener{keyDown(e,t){return!W.isCtrlOrCmd(t)||!t.shiftKey?[]:t.key.toLowerCase()=="c"?[ft.CenterAction.create([],{retainZoom:!0})]:t.key.toLowerCase()=="f"?[cf()]:[]}};yu=zR([Re()],yu);var qR=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},HR=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},KR=function(n,e){return function(t,i){e(t,i,n)}};let tl=class extends W.SetViewportCommand{constructor(e){super(e),this.action=e,this.isStopped=!1,this.stoppableCommandKey=e.zoomAnimation!==void 0?ft.SetViewportAction.KIND:""}execute(e){return this.action.zoomAnimation!=null&&(e.duration=this.action.zoomAnimation.animationDuration),super.execute(e)}setViewport(e,t,i,o){return this.action.zoomAnimation!=null&&W.isViewport(e)&&i.zoom!=t.zoom&&!this.isStopped?(this.animation=new $R(e,t,i,o,this.action.zoomAnimation.ease),this.animation.start()):super.setViewport(e,t,i,o)}stopExecution(){var e;(e=this.animation)===null||e===void 0||e.stop(),this.action.animate=!1,this.isStopped=!0}};tl=qR([Re(),KR(0,Ee(le.Action)),HR("design:paramtypes",[Object])],tl);class $R extends W.Animation{constructor(e,t,i,o,r){super(o,r),this.element=e,this.oldViewport=t,this.newViewport=i,this.zoomFactor=Math.log(i.zoom/t.zoom),this.viewportOffset=fn.scale(fn.sub(this.oldViewport.scroll,this.newViewport.scroll),1/(1/i.zoom-1/t.zoom))}tween(e,t){const i=this.oldViewport.zoom*Math.exp(e*this.zoomFactor);return i!=this.oldViewport.zoom&&(this.element.scroll=fn.sub(this.oldViewport.scroll,fn.scale(this.viewportOffset,1/i-1/this.oldViewport.zoom))),this.element.zoom=i,t.root}}var Rf=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},l0=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let Qo=class extends W.ScrollMouseListener{mouseDown(e,t){let i=e;const o=this.toolTypeProvider.toolType,r=this.keyState.isSpacePressed||t.button===1;if((o===xe.BOX_SELECT||o===xe.CONNECT)&&!r)return[];(r||this.toolTypeProvider.toolType===xe.HAND)&&(i=e.root);const s=super.mouseDown(i,t);if(this.lastScrollPosition!=null){const a={kind:So.KIND,moveCursor:"cursor-grabbing"};s.push(a)}return s}mouseUp(e,t){const i=[];if(this.lastScrollPosition!=null){const o={kind:So.KIND,moveCursor:null};i.push(o)}return i.push(...super.mouseUp(e,t)),i}};Rf([Ee(le.ToolTypeProvider),l0("design:type",Object)],Qo.prototype,"toolTypeProvider",void 0);Rf([Ee(le.KeyState),l0("design:type",Function)],Qo.prototype,"keyState",void 0);Qo=Rf([Re()],Qo);var xd,tv;function YR(){if(tv)return xd;tv=1,xd=n;function n(e,t,i,o){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=o}return n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,o=0;o<8;o++){var r=this.sampleCurveX(i)-e;if(Math.abs(r)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i=i-r/s}var a=0,u=1;for(i=e,o=0;o<20&&(r=this.sampleCurveX(i),!(Math.abs(r-e)<t));o++)e>r?a=i:u=i,i=(u-a)*.5+a;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},xd}var kR=YR();const UR=ov(kR);var f0=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},GR=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};const XR=1/300,WR=1/200,ZR=30,JR=40,jd=250;function nv(n,e,t,i){const o=new UR(n,e,t,i);return r=>o.solve(r)}let Sa=class extends W.ZoomMouseListener{constructor(){super(...arguments),this.lastWheelEventTime=0,this.delta=0,this.rollingValues=[]}wheel(e,t){const i=W.findParentByFeature(e,W.isViewport);if(i==null)return[];const o=this.getViewportOffset(i,t);let r=t.deltaY;return t.deltaMode===WheelEvent.DOM_DELTA_LINE?r*=10:t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(r*=100),this.delta+=r,this.detectWheelType(r,i,o),t.preventDefault(),this.type!=null?this.updateViewport(i,o):[]}detectWheelType(e,t,i){const o=Date.now(),r=o-this.lastWheelEventTime;this.rollingValues.length>4&&this.rollingValues.shift(),this.rollingValues.push({timeDelta:r,value:e});const s=this.rollingValues.reduce((a,u)=>a+u.timeDelta,0)/this.rollingValues.length;this.lastWheelEventTime=o,this.rollingValues.length>=3&&new Set(this.rollingValues.map(a=>Math.abs(a.value))).size===1&&Math.abs(e)>10?this.type="wheel":e!==0&&Math.abs(e)<4||s<25?(this.type="trackpad",this.previousEasing=void 0):r>1.5*jd?(this.type=void 0,this.previousEasing=void 0,this.timeout=setTimeout(()=>{this.type="wheel",this.actionDispatcher.dispatchAll(this.updateViewport(t,i))},JR)):(!this.type||r>200)&&(this.type=Math.abs(r*e)<200?"trackpad":"wheel"),this.type!=null&&this.clearTimeoutIfSet()}clearTimeoutIfSet(){this.timeout!=null&&(clearTimeout(this.timeout),this.timeout=void 0)}updateViewport(e,t){var i;const o=this.type==="wheel";if(o&&this.previousEasing!=null&&Date.now()-this.previousEasing.start<ZR)return[];const r=o?XR:WR,s=Math.exp(-this.delta*r),a=W.limit(((i=this.targetZoom)!==null&&i!==void 0?i:e.zoom)*s,this.viewerOptions.zoomLimits);return this.delta=0,a===e.zoom?[]:[this.generateUpdateViewportAction(a,e,t,o)]}generateUpdateViewportAction(e,t,i,o){const r=1/e-1/t.zoom,s={kind:"viewport",elementId:t.id,newViewport:{scroll:{x:t.scroll.x-r*i.x,y:t.scroll.y-r*i.y},zoom:e},animate:!1,zoomAnimation:o?{animationDuration:jd,ease:this.computeWheelEasing()}:null};return this.targetZoom=e,s}computeWheelEasing(){let e=nv(.25,.1,.25,1);if(this.previousEasing){const t=this.previousEasing,i=(Date.now()-t.start)/jd,o=t.easing(i+.01)-t.easing(i),r=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.27*.27-r*r);e=nv(r,s,.25,1)}return this.previousEasing={start:Date.now(),easing:e},e}};f0([Ee(le.IActionDispatcher),GR("design:type",Object)],Sa.prototype,"actionDispatcher",void 0);Sa=f0([Re()],Sa);var h0=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},p0=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};class vu extends Jd{isForcedScroll(e){return this.keyState.isSpacePressed||e.button===1}pointerDown(e,t){var i;return(this.toolTypeProvider.toolType!==xe.CONNECT||this.isForcedScroll(t))&&((i=t.target)===null||i===void 0||i.setPointerCapture(t.pointerId)),[]}}h0([Ee(le.ToolTypeProvider),p0("design:type",Object)],vu.prototype,"toolTypeProvider",void 0);h0([Ee(le.KeyState),p0("design:type",Function)],vu.prototype,"keyState",void 0);const QR=new At((n,e,t)=>{W.configureCommand({bind:n,isBound:t},W.CenterCommand),W.configureCommand({bind:n,isBound:t},W.FitToScreenCommand),W.configureCommand({bind:n,isBound:t},W.GetViewportCommand),n(vu).toSelf().inSingletonScope(),n(le.IPointerListener).toService(vu),W.configureCommand({bind:n,isBound:t},tl),n(yu).toSelf().inSingletonScope(),n(le.KeyListener).toService(yu),n(Qo).toSelf().inSingletonScope(),n(Sa).toSelf().inSingletonScope(),n(le.MouseListener).toService(Qo),n(le.MouseListener).toService(Sa),n(Jo).toSelf().inSingletonScope(),n(le.ITouchListener).toService(Jo),W.configureActionHandler({bind:n,isBound:t},ft.SetModelAction.KIND,el)});var eA=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let _u=class extends W.Command{execute(e){return e.root}undo(e){return e.root}redo(e){return e.root}};_u.KIND=ft.BringToFrontAction.KIND;_u=eA([Re()],_u);const tA=new At((n,e,t)=>{W.configureCommand({bind:n,isBound:t},_u)});class Mo extends La{}(function(n){n.defaultAnimatedFields=["width","height","x","y"]})(Mo||(Mo={}));const nA=new Set(["dx","dy"]);class iA extends Mo{get pointVisibilityManager(){return this._pointVisibilityManager||(this._pointVisibilityManager=new Cb(this)),this._pointVisibilityManager}constructor(){super(),this.animatedFields=nA,this.cachedProperty("globalRotation",()=>{const e=this.root.layoutEngine.localToAncestor(this.id,this.root.id),{rotation:t}=wa(e);return t.angle*(180/Math.PI)})}}class Xr extends Mo{}(function(n){n.defaultAnimatedFields=[...Mo.defaultAnimatedFields]})(Xr||(Xr={}));const rA=new Set(Xr.defaultAnimatedFields);class oA extends Xr{constructor(){super(...arguments),this.animatedFields=rA}}const sA=new Set(Xr.defaultAnimatedFields);class aA extends Xr{constructor(){super(...arguments),this.animatedFields=sA}}const cA=new Set(Xr.defaultAnimatedFields);class uA extends Xr{constructor(){super(...arguments),this.animatedFields=cA}}const dA=new Set(Mo.defaultAnimatedFields);class lA extends Mo{constructor(){super(...arguments),this.animatedFields=dA}}var fA=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let nl=class extends fa{renderInternal(e){return W.svg("g",null,...this.renderPoint(e,e.position))}};nl=fA([Re()],nl);var g0=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},hA=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let bu=class extends wo{render(e,t,i){const o=e.children.filter(c=>c instanceof Na),r=this.renderMarkers(e,t),{path:s,childControlElements:a}=this.renderPathAndControlElements(e,o),u=[];e.stroke!=null&&u.push(...this.renderConnectionPath(e,s));const f=this.renderCreateConnection(e),d=this.renderSplitSegmentPreview(e);return W.svg("g.selectable.canvas-connection",null,...u,...r,...a,f,d)}renderConnectionPath(e,t){return[W.svg("path",{attrs:Object.assign(Object.assign({d:t},G0(e)),{fill:"none"})}),W.svg("path.select-canvas-connection",{attrs:{d:t}})]}renderPathAndControlElements(e,t){const i=e.layout,o=[],r=e.showControlElements;for(let s=0;s<t.length;s++){const a=t[s];r&&o.push(...a.generateControlViewElements(e,i.segments[s],s))}return{path:i.path,childControlElements:o}}renderMarkers(e,t){const i=e.startMarker,o=e.endMarker,r=[];if(o!=null){const s=e.layout.endMarker;r.push(this.renderMarker(o,s,t))}if(i!=null){const s=e.layout.startMarker;r.push(this.renderMarker(i,s,t))}return r}renderMarker(e,t,i){const o=t.rotation,{x:r,y:s}=t.position;return W.svg("g",{attrs:{transform:`translate(${r},${s}) rotate(${o})`}},i.renderElement(e))}renderSplitSegmentPreview(e){const t=e.splitPreviewDataProvider;if(t==null||!e.selected||!this.keyState.isShiftPressed)return;const i=t(),o=e.line;if(e.index.getById(o.line.segments[i.segment].origin).canSplitSegment())return this.renderPreviewPoint(jt.DEFAULT.getPoint(i.pos,void 0,0,o),e)}renderPreviewPoint({x:e,y:t},i){return W.svg("g.split-canvas-connetion-preview",null,...df({x:e,y:t},Si(i),!0))}};g0([Ee(le.KeyState),hA("design:type",Function)],bu.prototype,"keyState",void 0);bu=g0([Re()],bu);var m0=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},pA=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Qc;let es=Qc=class{renderSnapLines(e){const t=this.snapLinesStateManager.getSnapLines(e);if(t==null)return[];const i=[],o=Si(e);for(const r of t)if(i.push(this.renderSnapLine(r)),r.type===ct.GAP)i.push(...this.renderGapSnapLines(r,o));else if(r.type===ct.POINTS)for(const s of r.points)i.push(this.renderSnapLinePoint(s,o));return i}renderSnapLine(e){const t={x1:e.points[0].x,y1:e.points[0].y,x2:e.points.at(-1).x,y2:e.points.at(-1).y};return e.type===ct.SIZE&&(t["marker-start"]=`url(#${Qc.SNAP_ARROW_MARKER_ID})`,t["marker-end"]=`url(#${Qc.SNAP_ARROW_MARKER_ID})`),W.svg("line.snap-line",{attrs:t})}renderSnapLinePoint(e,t){const i=2/t;return W.svg("path.snap-line-point",{attrs:{d:`M ${e.x-i} ${e.y-i} L ${e.x+i} ${e.y+i} M ${e.x-i} ${e.y+i} L ${e.x+i} ${e.y-i}`}})}renderGapSnapLines(e,t){const i=3/t,o=[],r=e.direction==="horizontal",s=fn.linearInterpolate(e.points[0],e.points[1],.5);for(const a of[-1,1])o.push(W.svg("line.snap-line-gap",{x1:s.x+(r?a*i:i*2),y1:s.y+(r?i*2:a*i),x2:s.x+(r?a*i:-i*2),y2:s.y+(r?-i*2:a*i)}));return o}};es.SNAP_ARROW_MARKER_ID="snap-arrow";m0([Ee(le.SnapLinesStateManager),pA("design:type",Function)],es.prototype,"snapLinesStateManager",void 0);es=Qc=m0([Re()],es);var gA=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let il=class extends es{render(e,t,i){return W.svg("g",{attrs:{"pointer-events":"auto",transform:`translate(${e.dx}, ${e.dy})`}},...t.renderChildren(e),...this.renderSnapLines(e))}};il=gA([Re()],il);var mA=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let rl=class extends fa{renderInternal(e){const t=e.position,i=this.renderPoint(e,t);if(e.distance){const o=e.rootPosition;return W.svg("g",null,W.svg("line.canvas-dependency-line",{attrs:{x1:o.x,y1:o.y,x2:t.x,y2:t.y}}),...i)}else return W.svg("g",null,...i)}};rl=mA([Re()],rl);var yA=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let ol=class{render(e,t,i){return W.svg("g.marker",{attrs:{"pointer-events":"visible"}},...t.renderChildren(e))}};ol=yA([Re()],ol);var fs=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ka=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},eu;let Ei=eu=class extends es{get backgroundPatternId(){return this.options.baseDiv+"-background-pattern"}render(e,t,i){if(t.targetKind=="hidden")return W.svg("svg.hylimo",null);const o=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return W.svg("svg.hylimo",{attrs:this.generateAttributes(e,t),class:this.computeRootClass()},this.renderStyles(e),this.renderDefs(e),this.renderBackground(e),W.svg("g.sprotty-root",{attrs:{transform:o}},...t.renderChildren(e,void 0),...this.renderSnapLines(e),this.renderSelectBox()))}renderStyles(e){return s0("style",()=>W.svg("style",null,X0(e.fonts)),e.fonts.map(t=>t.fontFamily).sort())}renderBackground(e){var t;if(!(e.preview||((t=this.configManager.config)===null||t===void 0?void 0:t.gridEnabled)!=!0))return W.svg("rect",{attrs:{x:0,y:0,width:"100%",height:"100%",fill:`url(#${this.backgroundPatternId})`}})}computeRootClass(){var e,t;const i=this.keyState.isSpacePressed?"cursor-grab":void 0,o=(t=(e=this.moveCursorProvider.moveCursor)!==null&&e!==void 0?e:i)!==null&&t!==void 0?t:this.moveCursorProvider.toolCursor;return o!=null?{[o]:!0}:{}}generateAttributes(e,t){const i={};if(t.targetKind!="main"){const o=e.rootBounds;i.viewBox=`${o.position.x} ${o.position.y} ${o.size.width} ${o.size.height}`}return i}renderSelectBox(){const e=this.boxSelectProvider.box;if(e!=null)return W.svg("rect.select-box",{attrs:{x:e.position.x,y:e.position.y,width:e.size.width,height:e.size.height}})}renderDefs(e){return W.svg("defs",null,this.renderArrowMarker(eu.ARROW_MARKER_ID,"arrow-marker"),this.renderArrowMarker(eu.SNAP_ARROW_MARKER_ID,"snap-arrow-marker"),this.renderBackgroundPattern(e))}renderBackgroundPattern(e){if(e.preview)return;const i=25*(e.zoom/Math.pow(3,Math.floor(Math.log(e.zoom)/Math.log(3))));return W.svg("pattern",{attrs:{id:this.backgroundPatternId,width:i,height:i,x:-e.scroll.x*e.zoom%i,y:-e.scroll.y*e.zoom%i,patternUnits:"userSpaceOnUse"}},W.svg("circle.background-pattern",{attrs:{cx:i/2,cy:i/2,r:1}}))}renderArrowMarker(e,t){return W.svg("marker",{attrs:{id:e,viewBox:"0 0 10 10",refX:9,refY:5,markerWidth:6,markerHeight:6,markerUnits:"strokeWidth",orient:"auto-start-reverse"}},W.svg("path",{attrs:{d:"M 0 0 L 10 5 L 0 10 z"},class:{[t]:!0}}))}};Ei.ARROW_MARKER_ID="arrow";fs([Ee(le.ViewerOptions),Ka("design:type",Object)],Ei.prototype,"options",void 0);fs([Ee(le.MoveCursorProvider),Ka("design:type",Function)],Ei.prototype,"moveCursorProvider",void 0);fs([Ee(le.BoxSelectProvider),Ka("design:type",Object)],Ei.prototype,"boxSelectProvider",void 0);fs([Ee(le.KeyState),Ka("design:type",Function)],Ei.prototype,"keyState",void 0);fs([Ee(le.ConfigManager),Ka("design:type",Function)],Ei.prototype,"configManager",void 0);Ei=eu=fs([Re()],Ei);var vA=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let sl=class extends fa{renderInternal(e){const t=e.position,i=e.targetXPosition,o=e.targetYPosition,r=Ft.POINT_SIZE/e.root.zoom/2,s=[...this.renderPoint(e,t)];if(!ei.equals(t,i)){const a=i.y+Math.sign(t.y-i.y)*r,u=t.x-Math.sign(t.x-i.x)*r;let f,d;i.x===t.x?f=t.y-Math.sign(t.y-i.y)*r:f=t.y,i.y===t.y?d=i.x+Math.sign(t.x-i.x)*r:d=i.x,s.push(W.svg("polyline.canvas-dependency-line",{attrs:{points:`${d},${a} ${d},${f} ${u},${f}`,"marker-start":`url(#${Ei.ARROW_MARKER_ID})`,"stroke-dasharray":8}}))}if(!ei.equals(t,o)){const a=o.x+Math.sign(t.x-o.x)*r,u=t.y-Math.sign(t.y-o.y)*r;let f,d;o.x===t.x?f=t.x-Math.sign(t.x-o.x)*r:f=t.x,o.y===t.y?d=o.y+Math.sign(t.y-o.y)*r:d=o.y,s.push(W.svg("polyline.canvas-dependency-line",{attrs:{points:`${a},${d} ${f},${d} ${f},${u}`,"marker-start":`url(#${Ei.ARROW_MARKER_ID})`,"stroke-dasharray":8}}))}return W.svg("g",null,...s)}};sl=vA([Re()],sl);var _A=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let al=class{render(e,t,i){var o,r;const s=(r=(o=e.stroke)===null||o===void 0?void 0:o.width)!==null&&r!==void 0?r:0,a=Object.assign(Object.assign({},vv(e)),{cx:e.x+e.width/2,cy:e.y+e.height/2,rx:(e.width-s)/2,ry:(e.height-s)/2});return W.svg("g",null,W.svg("ellipse",{attrs:a}),...t.renderChildren(e))}};al=_A([Re()],al);var bA=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let cl=class{render(e,t,i){const o=Object.assign(Object.assign({},vv(e)),{d:e.path,transform:`translate(${e.x}, ${e.y})`});return W.svg("path",{attrs:o})}};cl=bA([Re()],cl);var SA=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let ul=class{render(e,t,i){var o;const r=Object.assign({},W0(e));if(e.cornerRadius){const s=(o=e.stroke)===null||o===void 0?void 0:o.width;r.rx=Math.max(0,e.cornerRadius-(s?s/2:0))}return W.svg("g",null,W.svg("rect",{attrs:r}),...t.renderChildren(e))}};ul=SA([Re()],ul);var wA=function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};let dl=class{render(e,t,i){var o;const r=[],s=Z0(e),a=(o=e.fontFeatureSettings)===null||o===void 0?void 0:o.map(u=>`"${u}"`).join(", ");return r.push(W.svg("text",{attrs:Object.assign(Object.assign(Object.assign({},J0(e)),s),{"font-family":e.fontFamily,"font-size":e.fontSize,"font-style":e.fontStyle,"font-weight":e.fontWeight,style:a!=null?`font-feature-settings: ${a}`:""})},e.text)),e.underline!=null&&r.push(this.drawLine(e,e.underline)),e.strikethrough!=null&&r.push(this.drawLine(e,e.strikethrough)),r.length==1?r[0]:W.svg("g",{},...r)}drawLine(e,t){var i;const o={stroke:t.color};return t.opacity!=1&&(o["stroke-opacity"]=t.opacity),o["stroke-width"]=t.width,t.dash!=null&&(o["stroke-dasharray"]=`${t.dash} ${(i=t.dashSpace)!==null&&i!==void 0?i:t.dash}`),W.svg("line",{attrs:Object.assign({x1:e.x,x2:e.x+e.width,y1:e.y+t.y,y2:e.y+t.y},o)})}};dl=wA([Re()],dl);const EA=new At((n,e,t,i)=>{const o={bind:n,unbind:e,isBound:t,rebind:i};i(le.ICommandStack).to(kd).inSingletonScope(),W.configureModelElement(o,yv.TYPE,Yd,Ei),W.configureModelElement(o,Q0.TYPE,uA,ul),W.configureModelElement(o,eS.TYPE,oA,al),W.configureModelElement(o,tS.TYPE,aA,cl),W.configureModelElement(o,nS.TYPE,lA,dl),W.configureModelElement(o,iS.TYPE,iA,il),W.configureModelElement(o,ts.TYPE,Bn,wi,{enable:[W.selectFeature,W.moveFeature,Js]}),W.configureModelElement(o,rS.TYPE,Yb,nl,{enable:[W.selectFeature,W.moveFeature,Js]}),W.configureModelElement(o,oS.TYPE,Zc,sl,{enable:[W.selectFeature,W.moveFeature,Js]}),W.configureModelElement(o,mv.TYPE,uu,rl,{enable:[W.selectFeature,W.moveFeature,Js]}),W.configureModelElement(o,ml.TYPE,gn,bu,{enable:[W.selectFeature,W.moveFeature]}),W.configureModelElement(o,Bd.TYPE,yo,ol,{enable:[W.selectFeature,W.moveFeature]}),W.registerModelElement(o,fv.TYPE,n0),W.registerModelElement(o,pv.TYPE,ff),W.registerModelElement(o,hv.TYPE,i0)});function PA(n){const e=new ou;return W.loadDefaultModules(e,{exclude:[W.updateModule,W.moveModule,W.zorderModule,W.decorationModule,W.undoRedoModule,W.exportModule,W.viewportModule]}),e.load(BR,tA,LR,DM,bP,jM,bM,kM,QR,FR,DR,wM,AM,OM,NM,TM,zM,EM,BM),e.load(EA),W.overrideViewerOptions(e,{needsClientLayout:!1,needsServerLayout:!1,baseDiv:n}),e}class MA{modified;original}class RA{id;config;logger=new L0;editor;diffEditor;modelRefs=new MA;onTextChanged;textChangedDisposables={};modelDisposables={};modelRefDisposeTimeout=-1;startingAwait;disposingAwait;constructor(e){if(this.id=e?.id??Math.floor(Math.random()*1000001).toString(),(e?.useDiffEditor??!1)&&!e?.codeResources?.original)throw new Error(`Use diff editor was used without a valid config. code: ${e?.codeResources?.modified} codeOriginal: ${e?.codeResources?.original}`);this.config={codeResources:e?.codeResources??void 0,useDiffEditor:e?.useDiffEditor??!1,readOnly:e?.readOnly??!1,domReadOnly:e?.domReadOnly??!1,overrideAutomaticLayout:e?.overrideAutomaticLayout??!0},this.config.editorOptions={...e?.editorOptions,automaticLayout:e?.overrideAutomaticLayout??!0},this.config.diffEditorOptions={...e?.diffEditorOptions,automaticLayout:e?.overrideAutomaticLayout??!0},this.config.languageDef=e?.languageDef,this.logger.setLevel(this.config.logLevel??Gu.Off)}isDiffEditor(){return this.config.useDiffEditor===!0}getConfig(){return this.config}getEditor(){return this.editor}getDiffEditor(){return this.diffEditor}getTextModels(){return{modified:this.modelRefs.modified?.object.textEditorModel??void 0,original:this.modelRefs.original?.object.textEditorModel??void 0}}getLogger(){return this.logger}registerOnTextChangedCallback(e){this.onTextChanged=e}setModelRefDisposeTimeout(e){this.modelRefDisposeTimeout=e}isStarting(){return this.startingAwait!==void 0}getStartingAwait(){return this.startingAwait}isStarted(){return this.editor!==void 0||this.diffEditor!==void 0}async start(e){this.isStarting()&&await this.getStartingAwait();let t=()=>{};this.startingAwait=new Promise(i=>{t=i});try{const i=N0(),o=i.viewServiceType;if(!(i.vscodeApiInitialised??!1))return Promise.reject("monaco-vscode-api was not initialized. Aborting.");if(o!=="EditorService"&&o!==void 0)return Promise.reject("No EditorService configured. monaco-editor will not be started.");if(!this.isDisposed())return Promise.reject("Start was called without properly disposing the EditorApp first.");const r=this.config.languageDef;r&&(Xa.register(r.languageExtensionConfig),Xa.getLanguages().filter(a=>a.id===r.languageExtensionConfig.id).length===0&&Xa.register({id:r.languageExtensionConfig.id}),r.monarchLanguage&&Xa.setMonarchTokensProvider(r.languageExtensionConfig.id,r.monarchLanguage),r.theme&&(ms.defineTheme(r.theme.name,r.theme.data),ms.setTheme(r.theme.name))),this.config.editorOptions?.["semanticHighlighting.enabled"]!==void 0&&F0.get(B0).updateValue("editor.semanticHighlighting.enabled",this.config.editorOptions["semanticHighlighting.enabled"],V0.USER),await this.createEditors(e),t(),this.logger.info("EditorApp start completed successfully.")}catch(i){return Promise.reject(i)}finally{this.startingAwait=void 0}}async createEditors(e){const t={text:this.config.codeResources?.modified?.text??"",uri:this.config.codeResources?.modified?.uri??`default-uri-modified-${this.id}`,enforceLanguageId:this.config.codeResources?.modified?.enforceLanguageId??void 0};if(this.modelRefs.modified=await this.buildModelReference(t,this.logger),this.isDiffEditor()){const i={text:this.config.codeResources?.original?.text??"",uri:this.config.codeResources?.original?.uri??`default-uri-original-${this.id}`,enforceLanguageId:this.config.codeResources?.original?.enforceLanguageId??void 0};this.modelRefs.original=await this.buildModelReference(i,this.logger)}if(this.logger.info(`Starting monaco-editor (${this.id})`),this.isDiffEditor()){this.diffEditor=ms.createDiffEditor(e,this.config.diffEditorOptions);const i=this.modelRefs.modified.object.textEditorModel??void 0,o=this.modelRefs.original?.object.textEditorModel??void 0;if(i!==void 0&&o!==void 0){const r={modified:i,original:o};this.diffEditor.setModel(r),this.announceModelUpdate(r)}}else{const i={modified:this.modelRefs.modified.object.textEditorModel};this.editor=ms.create(e,{...this.config.editorOptions,model:i.modified}),this.announceModelUpdate(i)}}updateCode(e){this.isDiffEditor()?(e.modified!==void 0&&this.diffEditor?.getModifiedEditor().setValue(e.modified),e.original!==void 0&&this.diffEditor?.getOriginalEditor().setValue(e.original)):e.modified!==void 0&&this.editor?.setValue(e.modified)}async updateCodeResources(e){let t=!1,i=!1;if(e?.modified!==void 0&&e.modified.uri!==this.modelRefs.modified?.object.resource.path&&(this.modelDisposables.modified=this.modelRefs.modified,this.modelRefs.modified=await this.buildModelReference(e.modified,this.logger),t=!0),e?.original!==void 0&&e.original.uri!==this.modelRefs.original?.object.resource.path&&(this.modelDisposables.original=this.modelRefs.original,this.modelRefs.original=await this.buildModelReference(e.original,this.logger),i=!0),this.isDiffEditor())if(t&&i){const o=this.modelRefs.modified?.object.textEditorModel??void 0,r=this.modelRefs.original?.object.textEditorModel??void 0;if(o!==void 0&&r!==void 0){const s={modified:o,original:r};this.diffEditor?.setModel(s),this.announceModelUpdate(s)}}else this.logger.info("Diff Editor: Code resources were not updated. They are ether unchanged or undefined.");else if(t){const o={modified:this.modelRefs.modified?.object.textEditorModel};o.modified!==void 0&&o.modified!==null&&(this.editor?.setModel(o.modified),this.announceModelUpdate(o))}else this.logger.info("Editor: Code resources were not updated. They are either unchanged or undefined.");await this.disposeModelRefs()}async buildModelReference(e,t){const i=e.text,o=await z0(q0.parse(e.uri),i);o.object.textEditorModel?.getValue()!==i&&o.object.textEditorModel?.setValue(i);const r=e.enforceLanguageId;return r!==void 0&&(o.object.setLanguageId(r),t?.info(`Main languageId is enforced: ${r}`)),o}announceModelUpdate(e){if(this.onTextChanged!==void 0){let t=!1;if(e.modified!==void 0&&e.modified!==null){const i=this.textChangedDisposables.modified;this.textChangedDisposables.modified=e.modified.onDidChangeContent(()=>{Ld(e,this.onTextChanged)}),i?.dispose(),t=!0}if(e.original!==void 0&&e.original!==null){const i=this.textChangedDisposables.original;this.textChangedDisposables.original=e.original.onDidChangeContent(()=>{Ld(e,this.onTextChanged)}),i?.dispose(),t=!0}t&&Ld(e,this.onTextChanged)}}async dispose(){this.isDisposing()&&await this.getDisposingAwait();let e=()=>{};this.disposingAwait=new Promise(t=>{e=t}),this.editor&&(this.editor.dispose(),this.editor=void 0),this.diffEditor&&(this.diffEditor.dispose(),this.diffEditor=void 0),this.textChangedDisposables.modified?.dispose(),this.textChangedDisposables.original?.dispose(),this.textChangedDisposables.modified=void 0,this.textChangedDisposables.original=void 0,await this.disposeModelRefs(),e(),this.disposingAwait=void 0}isDisposed(){return this.editor===void 0&&this.diffEditor===void 0&&this.modelDisposables.original===void 0&&this.modelDisposables.modified===void 0}isDisposing(){return this.disposingAwait!==void 0}getDisposingAwait(){return this.disposingAwait}async disposeModelRefs(){const e=()=>{if(this.logger.getLevel()===Gu.Debug){const t=ms.getModels();this.logger.debug("Current model URIs:"),t.forEach((i,o)=>{this.logger.debug(`${i.uri.toString()}`)})}this.modelDisposables.modified!==void 0&&!this.modelDisposables.modified.object.isDisposed()&&(this.modelDisposables.modified.dispose(),this.modelDisposables.modified=void 0),this.modelDisposables.original!==void 0&&!this.modelDisposables.original.object.isDisposed()&&(this.modelDisposables.original.dispose(),this.modelDisposables.original=void 0),this.logger.getLevel()===Gu.Debug&&(this.modelDisposables.modified===void 0&&this.modelDisposables.original===void 0?this.logger.debug("All model references are disposed."):this.logger.debug("Model references are still available."))};this.modelRefDisposeTimeout>0?(this.logger.debug("Using async dispose of model references"),await new Promise(t=>setTimeout(()=>{e(),t()},this.modelRefDisposeTimeout))):e()}updateLayout(e,t){this.isDiffEditor()?this.diffEditor?.layout(e,t):this.editor?.layout(e,t)}reportStatus(){const e=[];return e.push("EditorApp status:"),e.push(`Editor: ${this.editor?.getId()}`),e.push(`DiffEditor: ${this.diffEditor?.getId()}`),e}}const Ld=(n,e)=>{const t=n.modified?.getValue()??"",i=n.original?.getValue()??"";e?.({modified:t,original:i})},AA=["id"],OA=O0({__name:"HylimoEditor",props:Cf({horizontal:{type:Boolean,default:!1}},{modelValue:{type:String,required:!0},modelModifiers:{}}),emits:Cf(["update:diagram","save"],["update:modelValue"]),setup(n,{emit:e}){I0(b=>({v7806456a:l.value}));const t=e,i=C0(n,"modelValue"),o=_i(null),r=_i(null),s=Ga([]),a=mr(aS),u=mr(cS),f=mr(uS),d=_i(f()),{isDark:c}=T0(),l=Gi(()=>{const b=u.diagramConfig.value;return c.value?b.darkBackgroundColor:b.lightBackgroundColor}),p=Ga(),h=Ga(),g=Ga(),m=_i(0),y=_i(!0);return Qs(i,b=>{h.value!=null&&b!=h.value.getValue()&&h.value.setValue(b)}),jf(r,()=>{p.value?.dispatch({kind:au.KIND})}),jf(o,()=>{g.value?.layout()}),sS("s",b=>{(b.ctrlKey||b.metaKey)&&t("save")},{target:o}),ll(async()=>{const b=await a.value,v={editorOptions:{language:Tf,fixedOverflowWidgets:!0,hover:{above:!1},suggest:{snippetsPreventQuickSuggestions:!1},scrollbar:{alwaysConsumeMouseWheel:!1},glyphMargin:!1,editContext:!1},codeResources:{modified:{text:i.value,uri:`diagram-${d.value}.hyl`,enforceLanguageId:Tf}},overrideAutomaticLayout:!1},_=new RA(v);s.value.push(_),await _.start(o.value);const S=_.getEditor();S.layout(),g.value=S,y.value=!1;const E=S.getModel();h.value=E;const O=E.pushStackElement.bind(h.value);E.pushStackElement=()=>{m.value==0&&O()},E.onDidChangeContent(()=>{i.value=S.getValue(),m.value==2&&(m.value=0)});const R=S.getModel()?.uri?.toString(),w=b.onNotification(H0.type,C=>{if(S&&C.uri==R){const z=C.range,G={startLineNumber:z.start.line+1,startColumn:z.start.character+1,endLineNumber:z.end.line+1,endColumn:z.end.character+1};S.setSelection(G),S.revealRange(G)}});if(s.value.push(w),R==null)throw new Error("Missing editor or model");b.sendNotification(K0.type,{clientId:R,diagramUri:R});class M extends Ud{clientId=R;initialize(z){super.initialize(z);const G=b.onNotification(Df.type,N=>{"newRoot"in N.action&&N.action.newRoot!=null&&N.clientId==this.clientId&&t("update:diagram",N.action.newRoot),this.messageReceived(N)});s.value.push(G)}sendMessage(z){b.sendNotification(Df.type,z)}handleUndo(){S.focus(),S.trigger("diagram","undo",{})}handleRedo(){S.focus(),S.trigger("diagram","redo",{})}handleTransactionStart(){h.value?.pushStackElement(),m.value=1}handleTransactionCommit(){m.value=2}}const I=PA(`sprotty-container-${d.value}`);I.bind(M).toSelf().inSingletonScope(),I.bind(le.ModelSource).toService(M);const D=I.get(le.IActionDispatcher);p.value=D,D.request(ft.RequestModelAction.create()).then(C=>{D.dispatch(C)})}),fl(()=>{s.value.forEach(b=>{try{b.dispose()}catch{}})}),(b,v)=>(hl(),iv("div",{class:D0(["editor",{hidden:y.value}])},[Yu(Gc(dS),{horizontal:n.horizontal},{default:ku(()=>[Yu(Gc(Ff),null,{default:ku(()=>[Uu("div",{ref_key:"editorElement",ref:o,class:"editor-element"},null,512)]),_:1}),Yu(Gc(Ff),null,{default:ku(()=>[Uu("div",{ref_key:"sprottyWrapper",ref:r,class:"sprotty-wrapper"},[Uu("div",{id:`sprotty-container-${d.value}`},null,8,AA)],512)]),_:1})]),_:1},8,["horizontal"])],2))}}),PC=x0(OA,[["__scopeId","data-v-7f7611f8"]]);export{PC as default};
