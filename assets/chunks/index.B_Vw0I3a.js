const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/main.5YIPBZHN.js","assets/chunks/commonjsHelpers.CqkleIqs.js","assets/chunks/main2.DClG33jO.js"])))=>i.map(i=>d[i]);
import{o as A,p as Fe,q as Me,r as ke,s as F,t as ze,u as je,v as Be,w as $e,x as Ve,y as Te,A as Ge,z as We,B as He,F as Se,G as Z,H as ye,O as qe,J as W,W as Ue,K as Ee,M as Je,Q as Ke,_ as q,V as m,X as xe,f as fe,Y as me,Z as pe,$ as Pe,a0 as Ye,a1 as re,a2 as Qe,a3 as g,a4 as Ze,a5 as Xe,a6 as J,a7 as De,a8 as M,a9 as et,aa as tt,ab as be,ac as nt,ad as it,ae as ot,af as we,ag as rt,ah as st,ai as K,aj as at,ak as ct,al as dt,am as ut,an as Ne,ao as Oe,ap as Ae,aq as lt,ar as gt,as as ht,at as _e,au as ft,av as mt,aw as pt,ax as _t,ay as kt,az as Tt,aA as ve,aB as p,aC as St,aD as U,aE as yt,aF as Ce,aG as bt,aH as wt,aI as vt,aJ as Ct,aK as Le,aL as Lt,aM as It,aN as Mt,aO as zt,aP as Et,aQ as xt,aR as Pt}from"./lspPlugin.CHzmpfo0.js";import{Z as ae}from"./framework.YNMxXZI1.js";import{I as Re}from"./workbenchThemeService.service.BiwwaYjD.js";import{t as H,g as Dt,S as Nt}from"./tokenClassificationRegistry.DoJhhBrs.js";import"./commonjsHelpers.DsqdWQfm.js";import"./theme.Dzb54cU2.js";class Ot extends A{get onDidEncounterLanguage(){return this._onDidEncounterLanguage.event}constructor(e,t,n,o,i,r,s){super(),this._grammar=e,this._initialState=t,this._containsEmbeddedLanguages=n,this._createBackgroundTokenizer=o,this._backgroundTokenizerShouldOnlyVerifyTokens=i,this._reportTokenizationTime=r,this._reportSlowTokenization=s,this._seenLanguages=[],this._onDidEncounterLanguage=this._register(new Fe)}get backgroundTokenizerShouldOnlyVerifyTokens(){return this._backgroundTokenizerShouldOnlyVerifyTokens()}getInitialState(){return this._initialState}tokenize(e,t,n){throw new Error("Not supported!")}createBackgroundTokenizer(e,t){if(this._createBackgroundTokenizer)return this._createBackgroundTokenizer(e,t)}tokenizeEncoded(e,t,n){const o=Math.random()*1e4<1,i=this._reportSlowTokenization||o,r=i?new Me(!0):void 0,s=this._grammar.tokenizeLine2(e,n,500);if(i){const a=r.elapsed();(o||a>32)&&this._reportTokenizationTime(a,e.length,o)}if(s.stoppedEarly)return console.warn(`Time limit reached when tokenizing line: ${e.substring(0,100)}`),new ke(s.tokens,s.fonts,n);if(this._containsEmbeddedLanguages){const a=this._seenLanguages,u=s.tokens;for(let l=0,f=u.length>>>1;l<f;l++){const k=u[(l<<1)+1],b=F.getLanguageId(k);a[b]||(a[b]=!0,this._onDidEncounterLanguage.fire(b))}}let c;return n.equals(s.ruleStack)?c=n:c=s.ruleStack,new ke(s.tokens,s.fonts,c)}}class At extends A{get backgroundTokenizerShouldOnlyVerifyTokens(){return this._actual.backgroundTokenizerShouldOnlyVerifyTokens}constructor(e,t,n,o){super(),this._encodedLanguageId=e,this._actual=t,this._maxTokenizationLineLength=o,this._register(ze(this._maxTokenizationLineLength)),this._register(n)}getInitialState(){return this._actual.getInitialState()}tokenize(e,t,n){throw new Error("Not supported!")}tokenizeEncoded(e,t,n){return e.length>=this._maxTokenizationLineLength.get()?je(this._encodedLanguageId,n):this._actual.tokenizeEncoded(e,t,n)}createBackgroundTokenizer(e,t){if(this._actual.createBackgroundTokenizer)return this._actual.createBackgroundTokenizer(e,t)}}const G=class G{static getChannel(e){return e.getChannel(G.CHANNEL_NAME)}static setChannel(e,t){e.setChannel(G.CHANNEL_NAME,t)}};G.CHANNEL_NAME="textMateWorkerHost";let ce=G;class X{static fromMany(e){const t=e.map(n=>new X(n));return new Rt(t)}constructor(e){this.transformation=e,this.idx=0,this.offset=0}transform(e){let t=this.transformation.replacements.at(this.idx);for(;t&&t.replaceRange.endExclusive<=e;)this.offset+=t.getLengthDelta(),this.idx++,t=this.transformation.replacements.at(this.idx);if(!(t&&t.replaceRange.start<=e))return e+this.offset}}class Rt{constructor(e){this.transformers=e}transform(e){for(const t of this.transformers){const n=t.transform(e);if(n===void 0)return;e=n}return e}}const ie=class ie extends A{constructor(e,t,n,o,i,r){super(),this._model=e,this._worker=t,this._languageIdCodec=n,this._backgroundTokenizationStore=o,this._configurationService=i,this._maxTokenizationLineLength=r,this.controllerId=ie._id++,this._pendingChanges=[],this._states=new Be,this._loggingEnabled=$e("editor.experimental.asyncTokenizationLogging",!1,this._configurationService),this._register(ze(this._loggingEnabled)),this._register(this._model.onDidChangeContent(a=>{this._shouldLog&&console.log("model change",{fileName:this._model.uri.fsPath.split("\\").pop(),changes:se(a.changes)}),this._worker.$acceptModelChanged(this.controllerId,a),this._pendingChanges.push(a)})),this._register(this._model.onDidChangeLanguage(a=>{const u=this._model.getLanguageId(),l=this._languageIdCodec.encodeLanguageId(u);this._worker.$acceptModelLanguageChanged(this.controllerId,u,l)}));const s=this._model.getLanguageId(),c=this._languageIdCodec.encodeLanguageId(s);this._worker.$acceptNewModel({uri:this._model.uri,versionId:this._model.getVersionId(),lines:this._model.getLinesContent(),EOL:this._model.getEOL(),languageId:s,encodedLanguageId:c,maxTokenizationLineLength:this._maxTokenizationLineLength.get(),controllerId:this.controllerId}),this._register(Ve(a=>{const u=this._maxTokenizationLineLength.read(a);this._worker.$acceptMaxTokenizationLineLength(this.controllerId,u)}))}dispose(){super.dispose(),this._worker.$acceptRemovedModel(this.controllerId)}requestTokens(e,t){this._worker.$retokenize(this.controllerId,e,t)}async setTokensAndStates(e,t,n,o,i){if(this.controllerId!==e)return;let r=Te.deserialize(new Uint8Array(n));const s=Ge.deserialize(o,We());if(this._shouldLog&&console.log("received background tokenization result",{fileName:this._model.uri.fsPath.split("\\").pop(),updatedTokenLines:r.map(a=>a.getLineRange()).join(" & "),updatedStateLines:i.map(a=>new He(a.startLineNumber,a.startLineNumber+a.stateDeltas.length).toString()).join(" & ")}),this._shouldLog){const a=this._pendingChanges.filter(u=>u.versionId<=t).map(u=>u.changes).map(u=>se(u)).join(" then ");console.log("Applying changes to local states",a)}for(;this._pendingChanges.length>0&&this._pendingChanges[0].versionId<=t;){const a=this._pendingChanges.shift();this._states.acceptChanges(a.changes)}if(this._pendingChanges.length>0){if(this._shouldLog){const l=this._pendingChanges.map(f=>f.changes).map(f=>se(f)).join(" then ");console.log("Considering non-processed changes",l)}const a=X.fromMany(this._pendingChanges.map(l=>Se(l.changes))),u=new Te;for(const l of r)for(let f=l.startLineNumber;f<=l.endLineNumber;f++)a.transform(f-1)!==void 0&&u.add(f,l.getLineTokens(f));r=u.finalize();for(const l of this._pendingChanges)for(const f of l.changes)for(let k=0;k<r.length;k++)r[k].applyEdit(f.range,f.text);s.rebase(this._stringEditFromChanges(this._model,this._pendingChanges))}const c=X.fromMany(this._pendingChanges.map(a=>Se(a.changes)));if(!this._applyStateStackDiffFn||!this._initialState){const{applyStateStackDiff:a,INITIAL:u}=await ae(()=>import("./main.5YIPBZHN.js"),__vite__mapDeps([0,1])).then(function(l){return l.main});this._applyStateStackDiffFn=a,this._initialState=u}for(const a of i){let u=a.startLineNumber<=1?this._initialState:this._states.getEndState(a.startLineNumber-1);for(let l=0;l<a.stateDeltas.length;l++){const f=a.stateDeltas[l];let k;f?(k=this._applyStateStackDiffFn(u,f),this._states.setEndState(a.startLineNumber+l,k)):k=this._states.getEndState(a.startLineNumber+l);const b=c.transform(a.startLineNumber+l-1);b!==void 0&&this._backgroundTokenizationStore.setEndState(b+1,k),a.startLineNumber+l>=this._model.getLineCount()-1&&this._backgroundTokenizationStore.backgroundTokenizationFinished(),u=k}}this._backgroundTokenizationStore.setTokens(r),this._backgroundTokenizationStore.setFontInfo(s)}_stringEditFromChanges(e,t){const n=[];for(const o of t)for(const i of o.changes){const r=Z.lift(i.range),s=i.text,c=e.getOffsetAt(r.getStartPosition()),a=e.getOffsetAt(r.getEndPosition());n.push(ye.replace(new qe(c,a),s))}return ye.compose(n)}get _shouldLog(){return this._loggingEnabled.get()}};ie._id=0;let de=ie;function se(h){return h.map(e=>Z.lift(e.range).toString()+" => "+e.text).join(" & ")}var Y,D;let ue=(D=class{constructor(e,t,n,o,i,r,s,c){this._reportTokenizationTime=e,this._shouldTokenizeAsync=t,this._extensionResourceLoaderService=n,this._configurationService=o,this._languageService=i,this._notificationService=r,this._telemetryService=s,this._webWorkerService=c,this._workerProxyPromise=null,this._worker=null,this._workerProxy=null,this._workerTokenizerControllers=new Map,this._currentTheme=null,this._currentTokenColorMap=null,this._grammarDefinitions=[]}dispose(){this._disposeWorker()}createBackgroundTokenizer(e,t,n){if(!this._shouldTokenizeAsync()||e.isTooLargeForSyncing())return;const o=new W,i=this._getWorkerProxy().then(r=>{if(o.isDisposed||!r)return;const s={controller:void 0,worker:this._worker};return o.add(Ft(e,()=>{const c=new de(e,r,this._languageService.languageIdCodec,t,this._configurationService,n);return s.controller=c,this._workerTokenizerControllers.set(c.controllerId,c),Ke(()=>{s.controller=void 0,this._workerTokenizerControllers.delete(c.controllerId),c.dispose()})})),s});return{dispose(){o.dispose()},requestTokens:async(r,s)=>{const c=await i;c?.controller&&c.worker===this._worker&&c.controller.requestTokens(r,s)},reportMismatchingTokens:r=>{Y._reportedMismatchingTokens||(Y._reportedMismatchingTokens=!0,this._notificationService.error({message:"Async Tokenization Token Mismatch in line "+r,name:"Async Tokenization Token Mismatch"}),this._telemetryService.publicLog2("asyncTokenizationMismatchingTokens",{}))}}}setGrammarDefinitions(e){this._grammarDefinitions=e,this._disposeWorker()}acceptTheme(e,t){this._currentTheme=e,this._currentTokenColorMap=t,this._currentTheme&&this._currentTokenColorMap&&this._workerProxy&&this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap)}_getWorkerProxy(){return this._workerProxyPromise||(this._workerProxyPromise=this._createWorkerProxy()),this._workerProxyPromise}async _createWorkerProxy(){const e={grammarDefinitions:this._grammarDefinitions,onigurumaWASMUri:new URL("/assets/onig.Du5pRr7Y.wasm",import.meta.url).href},t=this._worker=this._webWorkerService.createWorkerClient(new Ue({esmModuleLocation:Ee.asBrowserUri("vs/workbench/services/textMate/browser/backgroundTokenization/worker/textMateTokenizationWorker.workerMain.js"),label:"TextMateWorker"}));return ce.setChannel(t,{$readFile:async n=>{const o=Je.revive(n);return this._extensionResourceLoaderService.readExtensionResource(o)},$setTokensAndStates:async(n,o,i,r,s)=>{const c=this._workerTokenizerControllers.get(n);c&&c.setTokensAndStates(n,o,i,r,s)},$reportTokenizationTime:(n,o,i,r,s)=>{this._reportTokenizationTime(n,o,i,r,s)}}),await t.proxy.$init(e),this._worker!==t?null:(this._workerProxy=t.proxy,this._currentTheme&&this._currentTokenColorMap&&this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap),t.proxy)}_disposeWorker(){for(const e of this._workerTokenizerControllers.values())e.dispose();this._workerTokenizerControllers.clear(),this._worker&&(this._worker.dispose(),this._worker=null),this._workerProxy=null,this._workerProxyPromise=null}},Y=D,D._reportedMismatchingTokens=!1,D);ue=Y=q([m(2,xe),m(3,fe),m(4,me),m(5,pe),m(6,Pe),m(7,Ye)],ue);function Ft(h,e){const t=new W,n=t.add(new W);function o(){h.isAttachedToEditor()?n.add(e()):n.clear()}return o(),t.add(h.onDidChangeAttached(()=>{o()})),t}class jt{constructor(){this._scopeNameToLanguageRegistration=Object.create(null)}reset(){this._scopeNameToLanguageRegistration=Object.create(null)}register(e){this._scopeNameToLanguageRegistration[e.scopeName]=e}getGrammarDefinition(e){return this._scopeNameToLanguageRegistration[e]||null}}const Q="No TM Grammar registered for this language.";class Bt extends A{constructor(e,t,n,o){super(),this._host=e,this._initialState=n.INITIAL,this._scopeRegistry=new jt,this._injections={},this._injectedEmbeddedLanguages={},this._languageToScope=new Map,this._grammarRegistry=this._register(new n.Registry({onigLib:o,loadGrammar:async i=>{const r=this._scopeRegistry.getGrammarDefinition(i);if(!r)return this._host.logTrace(`No grammar found for scope ${i}`),null;const s=r.location;try{const c=await this._host.readFile(s);return n.parseRawGrammar(c,s.path)}catch(c){return this._host.logError(`Unable to load and parse grammar for scope ${i} from ${s}`,c),null}},getInjections:i=>{const r=i.split(".");let s=[];for(let c=1;c<=r.length;c++){const a=r.slice(0,c).join(".");s=[...s,...this._injections[a]||[]]}return s}}));for(const i of t){if(this._scopeRegistry.register(i),i.injectTo){for(const r of i.injectTo){let s=this._injections[r];s||(this._injections[r]=s=[]),s.push(i.scopeName)}if(i.embeddedLanguages)for(const r of i.injectTo){let s=this._injectedEmbeddedLanguages[r];s||(this._injectedEmbeddedLanguages[r]=s=[]),s.push(i.embeddedLanguages)}}i.language&&this._languageToScope.set(i.language,i.scopeName)}}has(e){return this._languageToScope.has(e)}setTheme(e,t){this._grammarRegistry.setTheme(e,t)}getColorMap(){return this._grammarRegistry.getColorMap()}async createGrammar(e,t){const n=this._languageToScope.get(e);if(typeof n!="string")throw new Error(Q);const o=this._scopeRegistry.getGrammarDefinition(n);if(!o)throw new Error(Q);const i=o.embeddedLanguages;if(this._injectedEmbeddedLanguages[n]){const c=this._injectedEmbeddedLanguages[n];for(const a of c)for(const u of Object.keys(a))i[u]=a[u]}const r=Object.keys(i).length>0;let s;try{s=await this._grammarRegistry.loadGrammarWithConfiguration(n,t,{embeddedLanguages:i,tokenTypes:o.tokenTypes,balancedBracketSelectors:o.balancedBracketSelectors,unbalancedBracketSelectors:o.unbalancedBracketSelectors})}catch(c){throw c.message&&c.message.startsWith("No grammar provided for")?new Error(Q):c}return{languageId:e,grammar:s,initialState:this._initialState,containsEmbeddedLanguages:r,sourceExtensionId:o.sourceExtensionId}}}const E=re.registerExtensionPoint({extensionPoint:"grammars",deps:[Qe],jsonSchema:{description:g(14288,"Contributes textmate tokenizers."),type:"array",defaultSnippets:[{body:[{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}]}],items:{type:"object",defaultSnippets:[{body:{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}}],properties:{language:{description:g(14289,"Language identifier for which this syntax is contributed to."),type:"string"},scopeName:{description:g(14290,"Textmate scope name used by the tmLanguage file."),type:"string"},path:{description:g(14291,"Path of the tmLanguage file. The path is relative to the extension folder and typically starts with './syntaxes/'."),type:"string"},embeddedLanguages:{description:g(14292,"A map of scope name to language id if this grammar contains embedded languages."),type:"object"},tokenTypes:{description:g(14293,"A map of scope name to token types."),type:"object",additionalProperties:{enum:["string","comment","other"]}},injectTo:{description:g(14294,"List of language scope names to which this grammar is injected to."),type:"array",items:{type:"string"}},balancedBracketScopes:{description:g(14295,"Defines which scope names contain balanced brackets."),type:"array",items:{type:"string"},default:["*"]},unbalancedBracketScopes:{description:g(14296,"Defines which scope names do not contain balanced brackets."),type:"array",items:{type:"string"},default:[]}},required:["scopeName","path"]}}});var j,N;let le=(N=class extends A{constructor(e,t,n,o,i,r,s,c,a,u){super(),this._languageService=e,this._themeService=t,this._extensionResourceLoaderService=n,this._notificationService=o,this._logService=i,this._configurationService=r,this._progressService=s,this._environmentService=c,this._instantiationService=a,this._telemetryService=u,this._createdModes=[],this._encounteredLanguages=[],this._debugMode=!1,this._debugModePrintFunc=()=>{},this._grammarDefinitions=null,this._grammarFactory=null,this._tokenizersRegistrations=this._register(new W),this._currentTheme=null,this._currentTokenColorMap=null,this._currentTokenFontMap=null,this._threadedBackgroundTokenizerFactory=this._instantiationService.createInstance(ue,(l,f,k,b,L)=>this._reportTokenizationTime(l,f,k,b,!0,L),()=>this.getAsyncTokenizationEnabled()),this._vscodeOniguruma=null,this._styleElement=Ze(),this._styleElement.className="vscode-tokens-styles",E.setHandler(l=>this._handleGrammarsExtPoint(l)),this._updateTheme(this._themeService.getColorTheme(),!0),this._register(this._themeService.onDidColorThemeChange(()=>{this._updateTheme(this._themeService.getColorTheme(),!1)})),this._register(this._languageService.onDidRequestRichLanguageFeatures(l=>{this._createdModes.push(l)}))}getAsyncTokenizationEnabled(){return!!this._configurationService.getValue("editor.experimental.asyncTokenization")}getAsyncTokenizationVerification(){return!!this._configurationService.getValue("editor.experimental.asyncTokenizationVerification")}_handleGrammarsExtPoint(e){this._grammarDefinitions=null,this._grammarFactory&&(this._grammarFactory.dispose(),this._grammarFactory=null),this._tokenizersRegistrations.clear(),this._grammarDefinitions=[];for(const t of e){const n=t.value;for(const o of n){const i=this._validateGrammarDefinition(t,o);if(i&&(this._grammarDefinitions.push(i),i.language)){const r=new Xe(()=>this._createTokenizationSupport(i.language));this._tokenizersRegistrations.add(r),this._tokenizersRegistrations.add(J.registerFactory(i.language,r))}}}this._threadedBackgroundTokenizerFactory.setGrammarDefinitions(this._grammarDefinitions);for(const t of this._createdModes)J.getOrCreate(t)}_validateGrammarDefinition(e,t){if(!Gt(e.description.extensionLocation,t,e.collector,this._languageService))return null;const n=De(e.description.extensionLocation,t.path),o=Object.create(null);if(t.embeddedLanguages){const c=Object.keys(t.embeddedLanguages);for(let a=0,u=c.length;a<u;a++){const l=c[a],f=t.embeddedLanguages[l];typeof f=="string"&&this._languageService.isRegisteredLanguageId(f)&&(o[l]=this._languageService.languageIdCodec.encodeLanguageId(f))}}const i=Object.create(null);if(t.tokenTypes){const c=Object.keys(t.tokenTypes);for(const a of c)switch(t.tokenTypes[a]){case"string":i[a]=M.String;break;case"other":i[a]=M.Other;break;case"comment":i[a]=M.Comment;break}}const r=t.language&&this._languageService.isRegisteredLanguageId(t.language)?t.language:void 0;function s(c,a){return!Array.isArray(c)||!c.every(u=>typeof u=="string")?a:c}return{location:n,language:r,scopeName:t.scopeName,embeddedLanguages:o,tokenTypes:i,injectTo:t.injectTo,balancedBracketSelectors:s(t.balancedBracketScopes,["*"]),unbalancedBracketSelectors:s(t.unbalancedBracketScopes,[]),sourceExtensionId:e.description.id}}startDebugMode(e,t){if(this._debugMode){this._notificationService.error(g(14277,"Already Logging."));return}this._debugModePrintFunc=e,this._debugMode=!0,this._debugMode&&this._progressService.withProgress({location:et.Notification,buttons:[g(14278,"Stop")]},n=>(n.report({message:g(14279,"Preparing to log TM Grammar parsing. Press Stop when finished.")}),this._getVSCodeOniguruma().then(o=>(o.setDefaultDebugCall(!0),n.report({message:g(14280,"Now logging TM Grammar parsing. Press Stop when finished.")}),new Promise((i,r)=>{})))),n=>{this._getVSCodeOniguruma().then(o=>{this._debugModePrintFunc=()=>{},this._debugMode=!1,o.setDefaultDebugCall(!1),t()})})}_canCreateGrammarFactory(){return!!this._grammarDefinitions}async _getOrCreateGrammarFactory(){if(this._grammarFactory)return this._grammarFactory;const[e,t]=await Promise.all([ae(()=>import("./main.5YIPBZHN.js"),__vite__mapDeps([0,1])).then(function(o){return o.main}),this._getVSCodeOniguruma()]),n=Promise.resolve({createOnigScanner:o=>t.createOnigScanner(o),createOnigString:o=>t.createOnigString(o)});return this._grammarFactory?this._grammarFactory:(this._grammarFactory=new Bt({logTrace:o=>this._logService.trace(o),logError:(o,i)=>this._logService.error(o,i),readFile:o=>this._extensionResourceLoaderService.readExtensionResource(o)},this._grammarDefinitions||[],e,n),this._updateTheme(this._themeService.getColorTheme(),!0),this._grammarFactory)}async _createTokenizationSupport(e){if(!this._languageService.isRegisteredLanguageId(e)||!this._canCreateGrammarFactory())return null;try{const t=await this._getOrCreateGrammarFactory();if(!t.has(e))return null;const n=this._languageService.languageIdCodec.encodeLanguageId(e),o=await t.createGrammar(e,n);if(!o.grammar)return null;const i=Wt("editor.maxTokenizationLineLength",e,-1,this._configurationService),r=new W,s=r.add(new Ot(o.grammar,o.initialState,o.containsEmbeddedLanguages,(c,a)=>this._threadedBackgroundTokenizerFactory.createBackgroundTokenizer(c,a,i),()=>this.getAsyncTokenizationVerification(),(c,a,u)=>{this._reportTokenizationTime(c,e,o.sourceExtensionId,a,!1,u)},!0));return r.add(s.onDidEncounterLanguage(c=>{if(!this._encounteredLanguages[c]){const a=this._languageService.languageIdCodec.decodeLanguageId(c);this._encounteredLanguages[c]=!0,this._languageService.requestBasicLanguageFeatures(a)}})),new At(n,s,r,i)}catch(t){return t.message&&t.message===Q||tt(t),null}}_updateTheme(e,t){if(!t&&this._currentTheme&&this._currentTokenColorMap&&Vt(this._currentTheme.settings,e.tokenColors)&&be(this._currentTokenColorMap,e.tokenColorMap)&&this._currentTokenFontMap&&be(this._currentTokenFontMap,e.tokenFontMap))return;this._currentTheme={name:e.label,settings:e.tokenColors},this._currentTokenColorMap=e.tokenColorMap,this._currentTokenFontMap=e.tokenFontMap,this._grammarFactory?.setTheme(this._currentTheme,this._currentTokenColorMap);const n=$t(this._currentTokenColorMap),o=nt(n),i=it(this._currentTokenFontMap);this._styleElement.textContent=o+i,J.setColorMap(n),this._currentTheme&&this._currentTokenColorMap&&this._threadedBackgroundTokenizerFactory.acceptTheme(this._currentTheme,this._currentTokenColorMap)}async createTokenizer(e){if(!this._languageService.isRegisteredLanguageId(e))return null;const t=await this._getOrCreateGrammarFactory();if(!t.has(e))return null;const n=this._languageService.languageIdCodec.encodeLanguageId(e),{grammar:o}=await t.createGrammar(e,n);return o}_getVSCodeOniguruma(){return this._vscodeOniguruma||(this._vscodeOniguruma=(async()=>{const[e,t]=await Promise.all([ae(()=>import("./main2.DClG33jO.js"),__vite__mapDeps([2,1])).then(function(n){return n.main}),this._loadVSCodeOnigurumaWASM()]);return await e.loadWASM({data:t,print:n=>{this._debugModePrintFunc(n)}}),e})()),this._vscodeOniguruma}async _loadVSCodeOnigurumaWASM(){return at?await(await fetch(new URL("/assets/onig.Du5pRr7Y.wasm",import.meta.url).href)).arrayBuffer():await fetch(Ee.asBrowserUri(`${ot}/vscode-oniguruma/release/onig.wasm`).toString(!0))}_reportTokenizationTime(e,t,n,o,i,r){const s=i?"async":"sync";j.reportTokenizationTimeCounter[s]>50||(j.reportTokenizationTimeCounter[s]===0&&setTimeout(()=>{j.reportTokenizationTimeCounter[s]=0},1e3*60*60),j.reportTokenizationTimeCounter[s]++,this._telemetryService.publicLog2("editor.tokenizedLine",{timeMs:e,languageId:t,lineLength:o,fromWorker:i,sourceExtensionId:n,isRandomSample:r,tokenizationSetting:this.getAsyncTokenizationEnabled()?this.getAsyncTokenizationVerification()?2:1:0}))}},j=N,N.reportTokenizationTimeCounter={sync:0,async:0},N);le=j=q([m(0,me),m(1,Re),m(2,xe),m(3,pe),m(4,ct),m(5,fe),m(6,dt),m(7,ut),m(8,Ne),m(9,Pe)],le);function $t(h){const e=[null];for(let t=1,n=h.length;t<n;t++)e[t]=K.fromHex(h[t]);return e}function Vt(h,e){if(!e||!h||e.length!==h.length)return!1;for(let t=e.length-1;t>=0;t--){const n=e[t],o=h[t];if(n.scope!==o.scope)return!1;const i=n.settings,r=o.settings;if(i&&r){if(i.fontStyle!==r.fontStyle||i.foreground!==r.foreground||i.background!==r.background)return!1}else if(!i||!r)return!1}return!0}function Gt(h,e,t,n){if(e.language&&(typeof e.language!="string"||!n.isRegisteredLanguageId(e.language)))return t.error(g(14281,"Unknown language in `contributes.{0}.language`. Provided value: {1}",E.name,String(e.language))),!1;if(!e.scopeName||typeof e.scopeName!="string")return t.error(g(14282,"Expected string in `contributes.{0}.scopeName`. Provided value: {1}",E.name,String(e.scopeName))),!1;if(!e.path||typeof e.path!="string")return t.error(g(14283,"Expected string in `contributes.{0}.path`. Provided value: {1}",E.name,String(e.path))),!1;if(e.injectTo&&(!Array.isArray(e.injectTo)||e.injectTo.some(i=>typeof i!="string")))return t.error(g(14284,"Invalid value in `contributes.{0}.injectTo`. Must be an array of language scope names. Provided value: {1}",E.name,JSON.stringify(e.injectTo))),!1;if(e.embeddedLanguages&&!we(e.embeddedLanguages))return t.error(g(14285,"Invalid value in `contributes.{0}.embeddedLanguages`. Must be an object map from scope name to language. Provided value: {1}",E.name,JSON.stringify(e.embeddedLanguages))),!1;if(e.tokenTypes&&!we(e.tokenTypes))return t.error(g(14286,"Invalid value in `contributes.{0}.tokenTypes`. Must be an object map from scope name to token type. Provided value: {1}",E.name,JSON.stringify(e.tokenTypes))),!1;const o=De(h,e.path);return rt(o,h)||t.warn(g(14287,"Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",E.name,o.path,h.path)),!0}function Wt(h,e,t,n){return st(o=>n.onDidChangeConfiguration(i=>{i.affectsConfiguration(h,{overrideIdentifier:e})&&o(i)}),()=>n.getValue(h,{overrideIdentifier:e})??t)}const z=Dt(),Ht=re.registerExtensionPoint({extensionPoint:"semanticTokenTypes",jsonSchema:{description:g(14487,"Contributes semantic token types."),type:"array",items:{type:"object",properties:{id:{type:"string",description:g(14488,"The identifier of the semantic token type"),pattern:H,patternErrorMessage:g(14489,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},superType:{type:"string",description:g(14490,"The super type of the semantic token type"),pattern:H,patternErrorMessage:g(14491,"Super types should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:g(14492,"The description of the semantic token type")}}}}}),qt=re.registerExtensionPoint({extensionPoint:"semanticTokenModifiers",jsonSchema:{description:g(14493,"Contributes semantic token modifiers."),type:"array",items:{type:"object",properties:{id:{type:"string",description:g(14494,"The identifier of the semantic token modifier"),pattern:H,patternErrorMessage:g(14495,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:g(14496,"The description of the semantic token modifier")}}}}}),Ut=re.registerExtensionPoint({extensionPoint:"semanticTokenScopes",jsonSchema:{description:g(14497,"Contributes semantic token scope maps."),type:"array",items:{type:"object",properties:{language:{description:g(14498,"Lists the languge for which the defaults are."),type:"string"},scopes:{description:g(14499,"Maps a semantic token (described by semantic token selector) to one or more textMate scopes used to represent that token."),type:"object",additionalProperties:{type:"array",items:{type:"string"}}}}}}});class Jt{constructor(){function e(t,n,o){if(typeof t.id!="string"||t.id.length===0)return o.error(g(14500,"'configuration.{0}.id' must be defined and can not be empty",n)),!1;if(!t.id.match(H))return o.error(g(14501,"'configuration.{0}.id' must follow the pattern letterOrDigit[-_letterOrDigit]*",n)),!1;const i=t.superType;return i&&!i.match(H)?(o.error(g(14502,"'configuration.{0}.superType' must follow the pattern letterOrDigit[-_letterOrDigit]*",n)),!1):typeof t.description!="string"||t.id.length===0?(o.error(g(14503,"'configuration.{0}.description' must be defined and can not be empty",n)),!1):!0}Ht.setHandler((t,n)=>{for(const o of n.added){const i=o.value,r=o.collector;if(!i||!Array.isArray(i)){r.error(g(14504,"'configuration.semanticTokenType' must be an array"));return}for(const s of i)e(s,"semanticTokenType",r)&&z.registerTokenType(s.id,s.description,s.superType)}for(const o of n.removed){const i=o.value;for(const r of i)z.deregisterTokenType(r.id)}}),qt.setHandler((t,n)=>{for(const o of n.added){const i=o.value,r=o.collector;if(!i||!Array.isArray(i)){r.error(g(14505,"'configuration.semanticTokenModifier' must be an array"));return}for(const s of i)e(s,"semanticTokenModifier",r)&&z.registerTokenModifier(s.id,s.description)}for(const o of n.removed){const i=o.value;for(const r of i)z.deregisterTokenModifier(r.id)}}),Ut.setHandler((t,n)=>{for(const o of n.added){const i=o.value,r=o.collector;if(!i||!Array.isArray(i)){r.error(g(14506,"'configuration.semanticTokenScopes' must be an array"));return}for(const s of i){if(s.language&&typeof s.language!="string"){r.error(g(14507,"'configuration.semanticTokenScopes.language' must be a string"));continue}if(!s.scopes||typeof s.scopes!="object"){r.error(g(14508,"'configuration.semanticTokenScopes.scopes' must be defined as an object"));continue}for(const c in s.scopes){const a=s.scopes[c];if(!Array.isArray(a)||a.some(u=>typeof u!="string")){r.error(g(14509,"'configuration.semanticTokenScopes.scopes' values must be an array of strings"));continue}try{const u=z.parseTokenSelector(c,s.language);z.registerTokenStyleDefault(u,{scopesToProbe:a.map(l=>l.split(" "))})}catch{r.error(g(14510,"configuration.semanticTokenScopes.scopes': Problems parsing selector {0}.",c))}}}}for(const o of n.removed){const i=o.value;for(const r of i)for(const s in r.scopes){const c=r.scopes[s];try{const a=z.parseTokenSelector(s,r.language);z.registerTokenStyleDefault(a,{scopesToProbe:c.map(u=>u.split(" "))})}catch{}}}})}}var B;let ee=(B=class{constructor(e){this.instantiationService=e,this.instantiationService.createInstance(Jt)}},B.ID="workbench.contrib.tokenClassificationExtensionPoint",B);ee=q([m(0,Ne)],ee);Oe(ee.ID,ee,Ae.BlockStartup);const Kt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function Yt(h,e,t=!0){for(let n=e.length-1;n>=0;n--){const o=e.slice(0,n),i=e[n],r=Qt(h,i,o,t);if(r)return r}return null}function Qt(h,e,t,n){let o=null;for(let i=h.tokenColors.length-1;i>=0;i--){const r=h.tokenColors[i];if(n&&!r.settings.foreground)continue;let s;if(typeof r.scope=="string")s=r.scope.split(/,/).map(c=>c.trim());else if(Array.isArray(r.scope))s=r.scope;else continue;for(let c=0,a=s.length;c<a;c++){const u=s[c],l=new te(u,r.settings);l.matches(e,t)&&l.isMoreSpecific(o)&&(o=l)}}return o}class te{constructor(e,t){this.rawSelector=e,this.settings=t;const n=this.rawSelector.split(/ /);this.scope=n[n.length-1],this.parentScopes=n.slice(0,n.length-1)}matches(e,t){return te._matches(this.scope,this.parentScopes,e,t)}static _cmp(e,t){if(e===null&&t===null)return 0;if(e===null)return-1;if(t===null)return 1;if(e.scope.length!==t.scope.length)return e.scope.length-t.scope.length;const n=e.parentScopes.length,o=t.parentScopes.length;if(n!==o)return n-o;for(let i=0;i<n;i++){const r=e.parentScopes[i].length,s=t.parentScopes[i].length;if(r!==s)return r-s}return 0}isMoreSpecific(e){return te._cmp(this,e)>0}static _matchesOne(e,t){const n=e+".";return e===t||t.substring(0,n.length)===n}static _matches(e,t,n,o){if(!this._matchesOne(e,n))return!1;let i=t.length-1,r=o.length-1;for(;i>=0&&r>=0;)this._matchesOne(t[i],o[r])&&i--,r--;return i===-1}}var ge;lt(Kt);const d=Lt;var O;let V=(O=class extends A{static get(e){return e.getContribution(ge.ID)}constructor(e,t,n,o,i,r,s){super(),this._editor=e,this._textMateService=t,this._themeService=o,this._languageService=n,this._notificationService=i,this._configurationService=r,this._languageFeaturesService=s,this._widget=null,this._register(this._editor.onDidChangeModel(c=>this.stop())),this._register(this._editor.onDidChangeModelLanguage(c=>this.stop())),this._register(this._editor.onKeyUp(c=>c.keyCode===gt.Escape&&this.stop()))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&this._editor.getModel().uri.scheme!==ht.vscodeNotebookCell&&(this._widget=new he(this._editor,this._textMateService,this._languageService,this._themeService,this._notificationService,this._configurationService,this._languageFeaturesService))}stop(){this._widget&&(this._widget.dispose(),this._widget=null)}toggle(){this._widget?this.stop():this.launch()}},ge=O,O.ID="editor.contrib.inspectEditorTokens",O);V=ge=q([m(1,_e),m(2,me),m(3,Re),m(4,pe),m(5,fe),m(6,ft)],V);class Zt extends It{constructor(){super({id:"editor.action.inspectTMScopes",label:Mt(6175,"Developer: Inspect Editor Tokens and Scopes"),precondition:void 0})}run(e,t){V.get(t)?.toggle()}}function Ie(h){h.length>40&&(h=h.substr(0,20)+"…"+h.substr(h.length-20));let e="";for(let t=0,n=h.length;t<n;t++){const o=h.charCodeAt(t);switch(o){case Le.Tab:e+="→";break;case Le.Space:e+="·";break;default:e+=String.fromCharCode(o)}}return e}const oe=class oe extends A{constructor(e,t,n,o,i,r,s){super(),this.allowEditorOverflow=!0,this._isDisposed=!1,this._editor=e,this._languageService=n,this._themeService=o,this._textMateService=t,this._notificationService=i,this._configurationService=r,this._languageFeaturesService=s,this._model=this._editor.getModel(),this._domNode=mt("div"),this._domNode.className="token-inspect-widget",this._currentRequestCancellationTokenSource=new pt,this._beginCompute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition(c=>this._beginCompute(this._editor.getPosition()))),this._register(o.onDidColorThemeChange(c=>this._beginCompute(this._editor.getPosition()))),this._register(r.onDidChangeConfiguration(c=>c.affectsConfiguration("editor.semanticHighlighting.enabled")&&this._beginCompute(this._editor.getPosition()))),this._editor.addContentWidget(this)}dispose(){this._isDisposed=!0,this._editor.removeContentWidget(this),this._currentRequestCancellationTokenSource.cancel(),super.dispose()}getId(){return oe._ID}_beginCompute(e){const t=this._textMateService.createTokenizer(this._model.getLanguageId()),n=this._computeSemanticTokens(e),o=this._model.tokenization.tokens.get(),i=o instanceof Ct?o:void 0;_t(this._domNode),this._domNode.appendChild(kt(g(6176,"Loading..."))),Promise.all([t,n]).then(([r,s])=>{if(this._isDisposed)return;const c=i?.tree.get();this._compute(r,s,c,e),this._domNode.style.maxWidth=`${Math.max(this._editor.getLayoutInfo().width*.66,500)}px`,this._editor.layoutContentWidget(this)},r=>{this._notificationService.warn(r),setTimeout(()=>{V.get(this._editor)?.stop()})})}_isSemanticColoringEnabled(){const e=this._configurationService.getValue(Tt,{overrideIdentifier:this._model.getLanguageId(),resource:this._model.uri})?.enabled;return typeof e=="boolean"?e:this._themeService.getColorTheme().semanticHighlighting}_compute(e,t,n,o){const i=e&&this._getTokensAtPosition(e,o),r=t&&this._getSemanticTokenAtPosition(t,o),s=n&&this._getTreeSitterTokenAtPosition(n,o);if(!i&&!r&&!s){ve(this._domNode,"No grammar or semantic tokens available.");return}const c=i?.metadata,a=r?.metadata,u=r&&Ie(this._model.getValueInRange(r.range)),l=i&&Ie(this._model.getLineContent(o.lineNumber).substring(i.token.startIndex,i.token.endIndex)),f=r&&this._model.getValueLengthInRange(r.range),k=i&&i.token.endIndex-i.token.startIndex,b=u||l||"",L=f||k||0;if(ve(this._domNode,d("h2.tiw-token",void 0,b,d("span.tiw-token-length",void 0,`${L} ${L===1?"char":"chars"}`))),p(this._domNode,d("hr.tiw-metadata-separator",{style:"clear:both"})),p(this._domNode,d("table.tiw-metadata-table",void 0,d("tbody",void 0,d("tr",void 0,d("td.tiw-metadata-key",void 0,"language"),d("td.tiw-metadata-value",void 0,c?.languageId||"")),d("tr",void 0,d("td.tiw-metadata-key",void 0,"standard token type"),d("td.tiw-metadata-value",void 0,this._tokenTypeToString(c?.tokenType||M.Other))),...this._formatMetadata(a,c)))),r){p(this._domNode,d("hr.tiw-metadata-separator"));const w=p(this._domNode,d("table.tiw-metadata-table",void 0)),I=p(w,d("tbody",void 0,d("tr",void 0,d("td.tiw-metadata-key",void 0,"semantic token type"),d("td.tiw-metadata-value",void 0,r.type))));if(r.modifiers.length&&p(I,d("tr",void 0,d("td.tiw-metadata-key",void 0,"modifiers"),d("td.tiw-metadata-value",void 0,r.modifiers.join(" ")))),r.metadata){const S=["foreground","bold","italic","underline","strikethrough"],T={},v=new Array;for(const _ of S)if(r.metadata[_]!==void 0){const y=r.definitions[_],x=this._renderTokenStyleDefinition(y,_),C=x.map(P=>St(P)?P.outerHTML:P).join();let R=T[C];R||(T[C]=R=[],v.push([x,C])),R.push(_)}for(const[_,y]of v)p(I,d("tr",void 0,d("td.tiw-metadata-key",void 0,T[y].join(", ")),d("td.tiw-metadata-value",void 0,..._)))}}if(i){const w=this._themeService.getColorTheme();p(this._domNode,d("hr.tiw-metadata-separator"));const I=p(this._domNode,d("table.tiw-metadata-table")),S=p(I,d("tbody"));l&&l!==b&&p(S,d("tr",void 0,d("td.tiw-metadata-key",void 0,"textmate token"),d("td.tiw-metadata-value",void 0,`${l} (${l.length})`)));const T=new Array;for(let y=i.token.scopes.length-1;y>=0;y--)T.push(i.token.scopes[y]),y>0&&T.push(d("br"));p(S,d("tr",void 0,d("td.tiw-metadata-key",void 0,"textmate scopes"),d("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...T)));const v=Yt(w,i.token.scopes,!1),_=r?.metadata?.foreground;if(v){if(_!==i.metadata.foreground){let y=d("code.tiw-theme-selector",void 0,v.rawSelector,d("br"),JSON.stringify(v.settings,null,"	"));_&&(y=d("s",void 0,y)),p(S,d("tr",void 0,d("td.tiw-metadata-key",void 0,"foreground"),d("td.tiw-metadata-value",void 0,y)))}}else _||p(S,d("tr",void 0,d("td.tiw-metadata-key",void 0,"foreground"),d("td.tiw-metadata-value",void 0,"No theme selector")))}if(s){const w=s[s.length-1];p(this._domNode,d("hr.tiw-metadata-separator"));const I=p(this._domNode,d("table.tiw-metadata-table")),S=p(I,d("tbody"));p(S,d("tr",void 0,d("td.tiw-metadata-key",void 0,`tree-sitter token ${w.id}`),d("td.tiw-metadata-value",void 0,`${w.text}`)));const T=new Array;let v=s.length-1,_=s[v];for(;_.parent||v>0;)T.push(_.type),_=_.parent??s[--v],_&&T.push(d("br"));p(S,d("tr",void 0,d("td.tiw-metadata-key",void 0,"tree-sitter tree"),d("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...T)));const x=this._model.tokenization.tokens.get().tokenizationImpl.get()?.captureAtPosition(o.lineNumber,o.column);x&&x.length>0&&p(S,d("tr",void 0,d("td.tiw-metadata-key",void 0,"foreground"),d("td.tiw-metadata-value",void 0,x.map(C=>C.name).join(" "))))}}_formatMetadata(e,t){const n=new Array;function o(a){const u=e?.[a]||t?.[a];if(u!==void 0){const l=e?.[a]?"tiw-metadata-semantic":"";n.push(d("tr",void 0,d("td.tiw-metadata-key",void 0,a),d(`td.tiw-metadata-value.${l}`,void 0,u)))}return u}const i=o("foreground"),r=o("background");if(i&&r){const a=K.fromHex(r),u=K.fromHex(i);a.isOpaque()?n.push(d("tr",void 0,d("td.tiw-metadata-key",void 0,"contrast ratio"),d("td.tiw-metadata-value",void 0,a.getContrastRatio(u.makeOpaque(a)).toFixed(2)))):n.push(d("tr",void 0,d("td.tiw-metadata-key",void 0,"Contrast ratio cannot be precise for background colors that use transparency"),d("td.tiw-metadata-value")))}const s=new Array;function c(a){let u;e&&e[a]?u=d("span.tiw-metadata-semantic",void 0,a):t&&t[a]&&(u=a),u&&(s.length&&s.push(" "),s.push(u))}return c("bold"),c("italic"),c("underline"),c("strikethrough"),s.length&&n.push(d("tr",void 0,d("td.tiw-metadata-key",void 0,"font style"),d("td.tiw-metadata-value",void 0,...s))),n}_decodeMetadata(e){const t=this._themeService.getColorTheme().tokenColorMap,n=F.getLanguageId(e),o=F.getTokenType(e),i=F.getFontStyle(e),r=F.getForeground(e),s=F.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(n),tokenType:o,bold:i&U.Bold?!0:void 0,italic:i&U.Italic?!0:void 0,underline:i&U.Underline?!0:void 0,strikethrough:i&U.Strikethrough?!0:void 0,foreground:t[r],background:t[s]}}_tokenTypeToString(e){switch(e){case M.Other:return"Other";case M.Comment:return"Comment";case M.String:return"String";case M.RegEx:return"RegEx";default:return"??"}}_getTokensAtPosition(e,t){const n=t.lineNumber,o=this._getStateBeforeLine(e,n),i=e.tokenizeLine(this._model.getLineContent(n),o),r=e.tokenizeLine2(this._model.getLineContent(n),o);let s=0;for(let a=i.tokens.length-1;a>=0;a--){const u=i.tokens[a];if(t.column-1>=u.startIndex){s=a;break}}let c=0;for(let a=r.tokens.length>>>1;a>=0;a--)if(t.column-1>=r.tokens[a<<1]){c=a;break}return{token:i.tokens[s],metadata:this._decodeMetadata(r.tokens[(c<<1)+1])}}_getStateBeforeLine(e,t){let n=null;for(let o=1;o<t;o++)n=e.tokenizeLine(this._model.getLineContent(o),n).ruleStack;return n}isSemanticTokens(e){return e&&e.data}async _computeSemanticTokens(e){if(!this._isSemanticColoringEnabled())return null;const t=this._languageFeaturesService.documentSemanticTokensProvider.ordered(this._model);if(t.length){const o=t[0],i=await Promise.resolve(o.provideDocumentSemanticTokens(this._model,null,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(i))return{tokens:i,legend:o.getLegend()}}const n=this._languageFeaturesService.documentRangeSemanticTokensProvider.ordered(this._model);if(n.length){const o=n[0],i=e.lineNumber,r=new Z(i,1,i,this._model.getLineMaxColumn(i)),s=await Promise.resolve(o.provideDocumentRangeSemanticTokens(this._model,r,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(s))return{tokens:s,legend:o.getLegend()}}return null}_getSemanticTokenAtPosition(e,t){const n=e.tokens.data,o=this._model.getLanguageId();let i=0,r=0;const s=t.lineNumber-1,c=t.column-1;for(let a=0;a<n.length;a+=5){const u=n[a],l=n[a+1],f=n[a+2],k=n[a+3],b=n[a+4],L=i+u,w=u===0?r+l:l;if(s===L&&w<=c&&c<w+f){const I=e.legend.tokenTypes[k]||"not in legend (ignored)",S=[];let T=b;for(let P=0;T>0&&P<e.legend.tokenModifiers.length;P++)T&1&&S.push(e.legend.tokenModifiers[P]),T=T>>1;T>0&&S.push("not in legend (ignored)");const v=new Z(L+1,w+1,L+1,w+1+f),_={},y=this._themeService.getColorTheme().tokenColorMap,C=this._themeService.getColorTheme().getTokenStyleMetadata(I,S,o,!0,_);let R;return C&&(R={languageId:void 0,tokenType:M.Other,bold:C?.bold,italic:C?.italic,underline:C?.underline,strikethrough:C?.strikethrough,foreground:y[C?.foreground||yt.None],background:void 0}),{type:I,modifiers:S,range:v,metadata:R,definitions:_}}i=L,r=w}return null}_walkTreeforPosition(e,t){const n=this._model.getOffsetAt(t);e.gotoFirstChild();let o=!1,i=null;do e.currentNode.startIndex<=n&&n<e.currentNode.endIndex?(o=!0,i=e.currentNode):o=!1;while(o?e.gotoFirstChild():e.gotoNextSibling());return i}_getTreeSitterTokenAtPosition(e,t){const n=[];let o=e?.tree.get();for(;o;){const i=o.walk(),r=this._walkTreeforPosition(i,t);i.delete(),r?(n.push(r),e=e?.getInjectionTrees(r.startIndex,e.languageId),o=e?.tree.get()):o=void 0}return n.length>0?n:null}_renderTokenStyleDefinition(e,t){const n=new Array;if(e===void 0)return n;const o=this._themeService.getColorTheme();if(Array.isArray(e)){const i={};o.resolveScopes(e,i);const r=i[t];if(r&&i.scope){const s=d("ul.tiw-metadata-values"),c=Array.isArray(r.scope)?r.scope:[String(r.scope)];for(const a of c)s.appendChild(d("li.tiw-metadata-value.tiw-metadata-scopes",void 0,a));return n.push(i.scope.join(" "),s,d("code.tiw-theme-selector",void 0,JSON.stringify(r.settings,null,"	"))),n}return n}else if(Nt.is(e)){const i=o.getTokenStylingRuleScope(e);return i==="setting"?(n.push(`User settings: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),n):(i==="theme"&&n.push(`Color theme: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),n)}else{const i=o.resolveTokenStyleValue(e);return n.push(`Default: ${i?this._renderStyleProperty(i,t):""}`),n}}_renderStyleProperty(e,t){return t==="foreground"?e.foreground?K.Format.CSS.formatHexA(e.foreground,!0):"":e[t]!==void 0?String(e[t]):""}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[Ce.BELOW,Ce.ABOVE]}}};oe._ID="editor.contrib.inspectEditorTokensWidget";let he=oe;bt(V.ID,V,wt.Lazy);vt(Zt);var $;let ne=($=class{constructor(e){}},$.ID="workbench.contrib.textMateTokenizationInstantiator",$);ne=q([m(0,_e)],ne);Oe(ne.ID,ne,Ae.BlockRestore);zt.registerCommand("_workbench.colorizeTextMateTokens",async(h,e)=>{const t=h.get(Et),n=e?(await t.files.resolve(e)).textEditorModel:void 0;if(!n)throw new Error(`Cannot resolve text model for resource ${e}`);const o=await J.getOrCreate(n.getLanguageId());if(!o)throw new Error(`Cannot resolve tokenizer for language ${n.getLanguageId()}`);const i=new Me;let r=o.getInitialState();for(let s=1;s<=n.getLineCount();s++)r=o.tokenizeEncoded(n.getLineContent(s),!0,r).endState;return i.stop(),{tokenizeTime:i.elapsed()}});function sn(){return{...Pt(),[_e.toString()]:new xt(le,[],!1)}}export{_e as ITextMateTokenizationService,sn as default};
