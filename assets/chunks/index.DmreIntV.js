import{aI as M,cz as j,cb as H,cA as L,d as q,_ as z,K as ee,ag as te,cB as ie,cC as oe,cD as re,cE as ne,bP as se,ad as ae,bO as le,cF as de,cG as ce,f as ue,bR as fe,cH as pe,cI as g,cJ as O,cK as V,cL as P,cM as ge,cN as c,cO as K,b1 as h,H as Pe,cP as k,cQ as x,cR as E,cS as we,cT as ve,cU as ye,ac as me}from"./lspPlugin.Dc7u3h4q.js";import{c$ as Fe,d0 as Ye,cV as Xe,cZ as $e,d3 as Je,d1 as Qe,cW as Ze,cX as je,c_ as qe,d2 as ze,cY as et}from"./lspPlugin.Dc7u3h4q.js";import{g as Re,a as Se,E as Te,S as he,P as Ae,A as Ce}from"./views.CT4Ka2pQ.js";import{b as it}from"./views.CT4Ka2pQ.js";import{M as be,a as Ee}from"./editor.CoEEhjzm.js";import"./commonjsHelpers.DsqdWQfm.js";import"./framework.CDajJPzx.js";import"./theme.gF1Kghr5.js";import"./fileCommands._save.C8lgyWlu.js";import"./workbenchThemeService.service.Cqu-UKbN.js";function Ie(t,r,l){const p=document.createElement(r==="status"?"footer":"div");return p.classList.add("part","monaco-workbench-part",...l),p.id=t,p.setAttribute("role",r),r==="status"&&p.setAttribute("aria-live","off"),p}function Be(t){const r=t.getContainer()?.parentNode;r!=null&&t.layout(Math.max(t.minimumWidth,Math.min(t.maximumWidth,r.offsetWidth)),Math.max(t.minimumHeight,Math.min(t.maximumHeight,r.offsetHeight)),r.offsetTop,r.offsetLeft)}function Oe(t,r){t.oncontextmenu=()=>!1;function l(){Be(r)}r.onDidVisibilityChange(p=>{p&&l()}),l()}function Ve(t){return t.isConnected?t.checkVisibility!=null?t.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}):t.offsetHeight>0&&t.offsetWidth>0:!1}function I(){const t=q.get(L).mainPart.getContainer();return t!=null&&Ve(t)}let D=class extends Ee{constructor(r,l){super(l.createInstance(Te),!1,r,l),this.restoreGroup=(...p)=>this.delegate.restoreGroup(...p)}getId(){return"standalone"}updateStyles(){}registerPart(r){return this.delegate.registerPart(r)}bind(r,l){return this.delegate.bind(r,l)}get activePart(){return this.delegate.activePart}};D=z([ee(1,te)],D);let N=t=>t;ie(async t=>{const r=t.get(oe),l=t.get(re),p=t.get(ne),m=t.get(se),R=t.get(L),U=t.get(H),S=t.get(ae),F=t.get(le),A=t.get(de),_=t.get(ce),W=t.get(ue),Y=t.get(fe),u=t.get(pe);function X(){const e=A.options?.defaultLayout;if((e?.editors!=null&&e.editors.length>0||e?.layout?.editors!=null)&&((e.force??!1)||m.isNew(h.WORKSPACE)))return{layout:e.layout?.editors,filesToOpenOrCreate:e.editors?.map(i=>({viewColumn:i.viewColumn,fileUri:Pe.revive(i.uri),openOnlyIfExists:i.openOnlyIfExists,options:i.options}))};const{filesToOpenOrCreate:d,filesToDiff:o,filesToMerge:a}=A;if(d!=null||o!=null||a!=null)return{filesToOpenOrCreate:d,filesToDiff:o,filesToMerge:a}}function $(e,d){const o=e.options?.defaultLayout;if(o==null||!(o.force??!1)&&!d.isNew(h.WORKSPACE))return;const{views:a}=o;if(a!=null&&a.length>0)return a.map(i=>i.id)}function J(e,d){return ve(e.getWorkspace())?!1:!!(W.getValue("window.restoreWindows")==="preserve")||d===void 0}async function Q(e,d){if(d!=null){const o=k(await x(d.filesToMerge,e,S));if(o.length===4&&E(o[0])&&E(o[1])&&E(o[2])&&E(o[3]))return[{editor:{input1:{resource:o[0].resource},input2:{resource:o[1].resource},base:{resource:o[2].resource},result:{resource:o[3].resource},options:{pinned:!0}}}];const a=k(await x(d.filesToDiff,e,S));if(a.length===2)return[{editor:{original:{resource:a[0].resource},modified:{resource:a[1].resource},options:{pinned:!0}}}];const i=[],f=await x(d.filesToOpenOrCreate,e,S);for(let s=0;s<f.length;s++){const w=f[s];w!=null&&i.push({editor:w,viewColumn:d.filesToOpenOrCreate?.[s].viewColumn})}return i}else if(_.getWorkbenchState()===we.EMPTY&&W.getValue("workbench.startupEditor")==="newUntitledFile")return R.mainPart.hasRestorableState?[]:[{editor:{resource:void 0}}];return[]}const T=X();T!=null&&S.info("Initial editor state",T);let n={layout:{editors:T?.layout},editor:{restoreEditors:J(_,T),editorsToOpen:Q(Y,T)},views:{defaults:$(A,m),containerToRestore:{}}};function v(e){return l.getDefaultViewContainer(e)??l.getViewContainersByLocation(e)[0]}function Z(){if(u.isVisible(g.SIDEBAR_PART)){let e;!A.isBuilt||p.startupKind===ye.ReloadedWindow||me?e=m.get(he.activeViewletSettingsKey,h.WORKSPACE,v(c.Sidebar)?.id):e=v(c.Sidebar)?.id,n.views.containerToRestore.sideBar=e}if(u.isVisible(g.PANEL_PART)){const e=m.get(Ae.activePanelSettingsKey,h.WORKSPACE,v(c.Panel)?.id);n.views.containerToRestore.panel=e}if(u.isVisible(g.AUXILIARYBAR_PART)){const e=m.get(Ce.activeViewSettingsKey,h.WORKSPACE,v(c.AuxiliaryBar)?.id);n.views.containerToRestore.auxiliaryBar=e}}Z(),n=N(n),n.views.containerToRestore.sideBar==null&&u.setPartHidden(!0,g.SIDEBAR_PART),n.views.containerToRestore.panel==null&&u.setPartHidden(!0,g.PANEL_PART),n.views.containerToRestore.auxiliaryBar==null&&u.setPartHidden(!0,g.AUXILIARYBAR_PART);const B=document.createElement("div");B.style.display="none",document.body.append(B);for(const{id:e,role:d,classes:o,options:a,getPosition:i,onDidChangePosition:f}of[{id:g.TITLEBAR_PART,role:"none",classes:["titlebar"]},{id:g.BANNER_PART,role:"banner",classes:["banner"]},{id:g.ACTIVITYBAR_PART,role:"none",classes:["activitybar"],getPosition:()=>u.getSideBarPosition(),onDidChangePosition:u.onDidChangeSideBarPosition},{id:g.SIDEBAR_PART,role:"none",classes:["sidebar"],getPosition:()=>u.getSideBarPosition(),onDidChangePosition:u.onDidChangeSideBarPosition},{id:g.EDITOR_PART,role:"main",classes:["editor"],options:{restorePreviousState:n.editor.restoreEditors}},{id:g.PANEL_PART,role:"none",classes:["panel","basepanel"],getPosition:()=>u.getPanelPosition(),onDidChangePosition:u.onDidChangePanelPosition},{id:g.AUXILIARYBAR_PART,role:"none",classes:["auxiliarybar","basepanel"],getPosition:()=>u.getSideBarPosition()===O.LEFT?O.RIGHT:O.LEFT,onDidChangePosition:u.onDidChangeSideBarPosition},{id:g.STATUSBAR_PART,role:"status",classes:["statusbar"]}]){const s=u.getPart(e);if(s!=null){const w=Ie(e,d,o);if(s.create(w,a),Oe(w,s),s.layout(9999,9999,0,0),B.append(w),i!=null){let b=i();s.element.classList.add(V(b)),f?.(()=>{s.element.classList.remove(V(b)),b=i(),s.element.classList.add(V(b))})}}}const y=[],G=[];y.push((async()=>{P("code/willRestoreEditors"),await R.mainPart.whenReady,P("code/restoreEditors/editorGroupsReady"),n.layout?.editors!=null&&R.applyLayout(n.layout.editors);const e=await n.editor.editorsToOpen;P("code/restoreEditors/editorsToOpenResolved");let d;if(e.length>0){const o=R.getGroups(ge.GRID_APPEARANCE),a=new Map;for(const i of e){const f=o[(i.viewColumn??1)-1];let s=a.get(f.id);s==null&&(s=new Set,a.set(f.id,s)),s.add(i.editor)}d=Promise.all(Array.from(a).map(async([i,f])=>{try{await U.openEditors(Array.from(f),i,{validateTrust:!0})}catch(s){S.error(s)}}))}G.push(Promise.all([d?.finally(()=>P("code/restoreEditors/editorsOpened")),R.mainPart.whenRestored.finally(()=>P("code/restoreEditors/editorGroupsRestored"))]).finally(()=>{P("code/didRestoreEditors")}))})());const C=(async()=>{if(n.views.defaults!=null&&n.views.defaults.length>0){P("code/willOpenDefaultViews");const e=[],d=i=>{const f=l.getViewLocationById(i.id);if(f!==null){const s=l.getViewContainerByViewId(i.id);if(s!=null){i.order>=(e[f]?.order??0)&&(e[f]={id:s.id,order:i.order});const w=l.getViewContainerModel(s);return w.setCollapsed(i.id,!1),w.setVisible(i.id,!0),!0}}return!1},o=[...n.views.defaults].reverse().map((i,f)=>({id:i,order:f}));let a=o.length;for(;a>0;)a--,d(o[a])&&o.splice(a,1);if(o.length>0){await F.whenInstalledExtensionsRegistered();let i=o.length;for(;i>0;)i--,d(o[i])&&o.splice(i,1)}e[c.Sidebar]!=null&&(n.views.containerToRestore.sideBar=e[c.Sidebar].id),e[c.Panel]!=null&&(n.views.containerToRestore.panel=e[c.Panel].id),e[c.AuxiliaryBar]!=null&&(n.views.containerToRestore.auxiliaryBar=e[c.AuxiliaryBar].id),P("code/didOpenDefaultViews")}})();y.push(C),y.push((async()=>{if(await C,n.views.containerToRestore.sideBar==null)return;P("code/willRestoreViewlet"),await r.openPaneComposite(n.views.containerToRestore.sideBar,c.Sidebar)==null&&await r.openPaneComposite(v(c.Sidebar)?.id,c.Sidebar),P("code/didRestoreViewlet")})()),y.push((async()=>{if(await C,n.views.containerToRestore.panel==null)return;P("code/willRestorePanel"),await r.openPaneComposite(n.views.containerToRestore.panel,c.Panel)==null&&await r.openPaneComposite(v(c.Panel)?.id,c.Panel),P("code/didRestorePanel")})()),y.push((async()=>{if(await C,n.views.containerToRestore.auxiliaryBar==null)return;P("code/willRestoreAuxiliaryBar"),await r.openPaneComposite(n.views.containerToRestore.auxiliaryBar,c.AuxiliaryBar)==null&&await r.openPaneComposite(v(c.AuxiliaryBar)?.id,c.AuxiliaryBar),P("code/didRestoreAuxiliaryBar")})()),await K.settled(y),await K.settled(G)});function He(t,r,l){return l!=null&&(N=typeof l=="boolean"?p=>({...p,editor:{...p.editor,restoreEditors:l}}):l),{...Se(r),...j({isKeybindingConfigurationVisible:I,shouldUseGlobalPicker:I}),...Re({shouldUseGlobalKeybindings:I}),[L.toString()]:new M(D,[t],!1),[H.toString()]:new M(be,[t,I],!1)}}export{Fe as AbstractResourceEditorInput,Ye as AbstractTextResourceEditorInput,it as ActivityService,Xe as ActivitybarPart,$e as ConfirmResult,Je as DomScrollableElement,Qe as EditorInput,Ze as EditorInputCapabilities,je as GroupOrientation,Ae as PanelPart,g as Parts,O as Position,qe as RegisteredEditorPriority,he as SidebarPart,ze as SplitView,c as ViewContainerLocation,et as ViewPaneContainer,He as default,I as isEditorPartVisible,Oe as renderPart};
